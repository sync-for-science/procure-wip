{"version":3,"sources":["store/initial-state.js","smart/fhir.js","smart/smart-core.js","smart/smart-popup.js","store/file-exporter.js","store/merge-objects.js","store/config-loader.js","store/zip-exporter.js","store/github-api.js","store/spreadsheet-exporter.js","store/csv-writer.js","store/user-settings.js","store/store.js","store/fhir-loader.js","store/github-exporter.js","components/ProviderForm.js","components/TimeAgo.js","components/ProviderList.js","components/Fetcher.js","components/Loader.js","components/GithubUploader.js","components/SettingsImportDropZone.js","components/Header.js","components/FhirTree.js","components/Toolbar.js","components/BlankSlate.js","components/FileUploader.js","components/Wizard/Start.js","components/Wizard/SelectProvider.js","components/Wizard/Retrieve.js","components/Wizard/DownloadButton.js","components/Wizard/Review.js","components/Wizard/Upload.js","components/Wizard/index.js","components/App.js","serviceWorker.js","index.js"],"names":["module","exports","uiState","mode","spreadsheetTemplates","isDirty","nonModalUi","queryProfile","mimeTypeMappings","githubConfig","upload","providers","fetchFHIR","url","config","fhirVersion","token","retryLimit","retries","headers","Accept","isR2","toUpperCase","Authorization","fetch","then","response","ok","Error","status","statusText","data","json","resourceType","error","issue","diagnostics","catch","err","replaceValue","path","element","replaceFn","split","value","nextPath","slice","length","undefined","Array","isArray","forEach","v","newValue","pathToValues","map","reduce","a","b","concat","filter","buildAbsoluteUrl","fhirEndpoint","reference","test","replace","addProvenance","resource","meta","source","extension","push","valueUri","getResourcesByUrl","urls","allowErrors","signal","statusCallback","Promise","all","_","fullUrl","e","name","message","requestType","errorLog","r","entry","findReferences","paths","p","refIndex","ent","i","each","ref","rawUrl","embedReferences","refEntry","contained","id","findAttachments","attachmentIndex","attachment","contentType","count","getResourcesByQuery","query","resolve","reject","fetchResources","page","fhirData","nextUrl","link","find","l","relation","pageLimit","errorCount","followAndEmbedReferences","keys","updatedEntry","followReferences","findAndDownloadAttachments","fetchAttachment","blob","urlExtension","match","mimeExtension","fileName","toString","files","attachmentsToFilenames","file","f","authEndpointErr","getWellKnownEndpoints","baseUrl","endpoints","registrationEndpoint","registration_endpoint","authorizationEndpoint","authorization_endpoint","tokenEndpoint","token_endpoint","getCapabilityEndpoints","fhir","extensions","obj","trim","out","key","getPath","o","ext","getAuthEndpoints","buildQs","fhirParams","Object","k","join","encodeURIComponent","buildAuthorizeUrl","authEndpoint","state","scope","redirectUri","clientId","clientSecret","launch","params","exchangeCodeForToken","code","method","body","btoa","refreshToken","generateStateParam","targetLen","charSet","result","charAt","Math","floor","random","SmartPopup","constructor","provider","this","authWindow","window","open","document","write","parseQs","qs","pairs","pair","decodeURIComponent","cancel","clearInterval","popupPoll","removeEventListener","messageListener","close","authorize","authEndpoints","ignoreState","stateParam","SMART","setInterval","closed","addEventListener","event","origin","location","access_token","console","log","href","FileExporter","controller","abort","resetCancelled","AbortController","isValidUrl","whitelist","rule","matchUrl","getManifest","accept","tv4","validate","configSchema","putFile","get","indexOf","merge","templates","mergeArray","base","override","overrideItem","baseIndex","findIndex","splice","mergeObject","isPlainObject","JSON","parse","stringify","template","getUrlParameter","results","RegExp","exec","search","readConfigFile","isOverride","text","stripJsonComments","loadConfigFile","overridePath","allowQsOverride","configReaders","qsOverridePath","mergeObjects","endpointLists","invalidEndpointId","defaults","queryProfiles","invalidCredentialId","credentialId","credentials","templateNames","templateName","extends","baseTemplateName","endpointPromises","chain","sortBy","reverse","item","endpointList","address","endpointListSchema","Entries","endpoint","newEntry","OrganizationName","FHIRPatientFacingURI","orgId","defaultId","getEndpointList","list","organizations","unionBy","orgDefaults","mapValues","loadEndpointLists","manifestUrl","qsManifestUrl","label","showWizard","overlayQsValues","uploadUrl","fileExporter","manifest","addProviderToZip","zipFolder","bundles","groupBy","total","type","bundle","exportProvidersAsBlob","zip","jszip","selected","folder","sanitizeFilename","generateAsync","generateFile","multiProviderFileName","exportableProviders","currDate","Date","dateWithOffset","getTime","getTimezoneOffset","date","saveAs","exportProviders","callApi","jsonPayload","reqConfig","owner","project","stats","getLastCommit","branchName","getTree","commit","object","sha","tree","truncated","createBlob","createTree","commitTree","lastCommit","parents","commitTreeToPullRequest","title","newBranchName","baseBranch","bodyText","head","maintainer_can_modify","defaultHelperFns","validateExists","validateCode","c","target","validateCodeableConcept","cc","coding","validateValue","getHelperData","helperData","helperDataField","stringifyCodings","system","parseDateForExcel","format","flatten","helperFns","rows","field","mergeRows","rowsToMerge","newRows","mergeRow","mergeRowItem","row","at","first","transform","children","childRows","childElement","flattenProviders","providerHelperData","getTemplateColumns","cols","arrayToCols","templateArray","exportFlatDataCSV","flatData","columns","col","csv","rawValue","toLocaleString","Blob","csvWriter","exportSpreadsheet","templateId","templateDefinition","templateDefinitions","mergedTemplateDefinition","s","sortDir","dir","orderBy","dateCols","XlsxPopulate","fromBlankAsync","workbook","sheet","cell","dateCol","column","style","outputAsync","exportFlatDataExcel","buildJSON","lastUpdated","download","readFromFile","reader","FileReader","onload","onerror","readAsText","userSettingsSchema","initialState","require","fhirLoader","resetAbortController","popup","mergeAndDeDupeData","uniqueUrls","queryResult","getFHIR","context","patientId","patient","queries","q","skip","FHIR","containReferences","retrieveReferences","downloadAttachments","authAndGetFHIR","Smart","ghExporter","canceled","blobToBase64","base64","readAsDataURL","buildProviderTree","content","encoding","statusCb","gh","buildResourceTree","buildFileTree","trees","buildTree","baseTree","allProviders","folders","newTrees","prepareCommit","export","pullRequest","commitPullRequest","commitToMaster","toISOString","pull","html_url","simulateTimer","createUniqueId","store","createStore","on","newUiState","counts","countType","newState","dirtySnapshot","reset","newSnapshot","UserSettings","dispatch","endState","ConfigLoader","process","newConfig","providerId","handleLoadDone","submode","handleStatusUpdate","isError","requestCount","loadFhir","handleGlobalError","isOpen","isDownloading","ZipExporter","finally","isExportingSheet","SpreadsheetExporter","statusUrl","simulate","clearTimeout","setTimeout","zipExporter","noCustomEndpoints","useStoreon","useState","setProvider","validation","setValidation","showDetails","setShowDetails","orgOptions","handleCancel","useCallback","preventDefault","useEffect","downHandler","keyCode","currentProvider","handleSubmit","skipRefresh","errors","handleOrgSelection","selection","orgConfig","updatedProvider","isInvalidUrl","toLowerCase","renderTextInput","property","isRequired","instructions","valueFn","onChangeFn","formText","FormText","color","errorText","FormFeedback","onChange","FormGroup","Label","for","Input","invalid","required","renderProfileSelector","profileOptions","openCheckbox","check","checked","detailsLink","onClick","shortForm","autoFocus","filterOption","createFilter","ignoreAccents","isSearchable","options","defaultMenuIsOpen","renderOrgSelector","openDetails","secureDetails","Modal","fade","backdrop","ModalHeader","ModalBody","Form","onSubmit","className","noValidate","ModalFooter","Button","marginLeft","TimeAgo","React","Component","props","super","timeAgo","time","componentDidMount","interval","setState","refreshMinutes","componentWillUnmount","render","toggleProviderSelection","pluralizeEn","len","marginBottom","marginRight","icon","faPlus","controls","handleEditProvider","faEdit","handleDeleteProvider","faTrash","fontWeight","handleLoadRecords","Card","margin","CardBody","Row","Col","xs","size","visibility","width","height","htmlFor","faCheckSquare","faSquare","cursor","display","useMemo","handleClose","handleSave","handleLogDownload","textAlign","padding","Spinner","downloadLink","renderLoadedButtons","showInstructions","setShowInstructions","handleHideDialog","handleCancelExport","handleFieldChange","fieldName","handleToggleInstructions","Container","Alert","rel","renderMessage","form","marginTop","placeholder","data-lpignore","readOnly","defaultValue","dropHint","fileDropHandler","dragCounter","setDragCounter","isFileDrag","dataTransfer","types","overlay","border","backgroundColor","position","top","bottom","left","right","zIndex","onDragEnter","stopPropagation","onDragOver","onDragLeave","onDrop","warnOnPageNavigate","appName","fileInput","useRef","onbeforeunload","readFile","confirm","SettingsImportDropZone","Navbar","light","expand","NavbarBrand","faMedkit","alt","Nav","navbar","NavItem","NavLink","current","click","dateSortElements","setResourceType","setPosition","overlayResources","setOverlayResources","componentTopRef","resourceTypeOptions","uniq","resources","sortElements","sortElement","start","simplifyUrl","referenceIndex","index","j","handlePosChange","filters","isClearable","treeTheme","base00","base01","base02","base03","base04","base05","base06","base07","base08","base09","base0A","base0B","base0C","base0D","base0E","base0F","valueRenderer","raw","refUrl","last","substring","textDecoration","scrollTo","offsetTop","handleReference","noResources","nextPrevNav","outline","disabled","faChevronLeft","faChevronRight","overlayNav","renderPositionNav","overlayData","getResourceByUrl","borderRadius","background","theme","hideRoot","shouldExpandNode","keyName","level","invertTheme","renderJsonTree","showSpreadsheetOptions","setShowSpreadsheetOptions","handelExportSpreadsheet","uploadButton","faFileUpload","downloadAllButton","faFileDownload","ghExportButton","faGithub","hasResources","menuItems","DropdownItem","bind","Dropdown","toggle","DropdownToggle","caret","faTable","DropdownMenu","renderSpreadsheetExport","block","handleDone","continueUrl","handleUploadFile","renderLoading","infoUrl","successMessage","continueLabel","handleBack","renderWorking","showDownloadOptions","setShowDownloadOptions","providerList","DownloadButton","numberStyle","active","inactive","switchToFull","md","offset","lg","borderBottom","minWidth","minHeight","Start","SelectProvider","Retrieve","Review","Upload","App","Loader","inlineError","hasProviders","hasData","fullUi","Header","fluid","xl","ProviderList","sm","BlankSlate","Toolbar","FhirTree","renderData","ProviderForm","Fetcher","GithubUploader","FileUploader","wizardUi","Wizard","classList","add","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","onUpdate","onSuccess","ReactDOM","Provider","getElementById","URL","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.e8e6fd1f.chunk.js","sourcesContent":["module.exports = {\n\tuiState: {mode: \"loading\"},\n\tspreadsheetTemplates: {},\n\tisDirty: false,\n\tnonModalUi: {},\n\tqueryProfile: {},\n\tmimeTypeMappings: {},\n\tgithubConfig: {},\n\tupload: {},\n\tproviders: []\n}","import \"cross-fetch\";\nimport _ from \"lodash\";\n\nfunction fetchFHIR(url, config={}, fhirVersion=\"DSTU2\", token=null, retryLimit=0, retries=0) {\n\tif (!config) config = {};\n\tif (!config.headers) config.headers = {};\n\tif (!config.headers.Accept) {\n\t\tconst isR2 = fhirVersion.toUpperCase() === \"DSTU2\" || fhirVersion.toUpperCase() === \"R2\";\n\t\tconfig.headers.Accept = isR2 ? \"application/json+fhir\" : \"application/fhir+json\"; \n\t}\n\tif (token) config.headers.Authorization = `Bearer ${token}`\n\n\t// if (console) console.log(\"Fetching: \" + url);\n\n\treturn fetch(url, config)\n\t\t.then( response => {\n\t\t\tif (!response.ok)\n\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.json() )\n\t\t// .then( json => { console.log(json); return json; })\n\t\t.then( json => {\n\t\t\tif (!json.resourceType || json.resourceType === \"OperationOutcome\") {\n\t\t\t\tconst error = json.issue && json.issue[0] && json.issue[0].diagnostics;\n\t\t\t\tthrow new Error(error || \"Fetch failed for \" + url);\n\t\t\t}\n\t\t\treturn json;\n\t\t})\n\t\t.catch( err => {\n\t\t\tif (retryLimit && retries < retryLimit) {\n\t\t\t\treturn fetchFHIR(url, config, fhirVersion, token, retryLimit, retries+1)\n\t\t\t} else {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t});\n}\n\nfunction replaceValue(path, element, replaceFn) {\n\tif (typeof(path) === \"string\")\n\t\tpath = path.split(\".\");\n\n\tif (!element) return;\n\n\tconst value = element[path[0]];\n\tconst nextPath = path.slice(1);\n\n\tif (!nextPath.length && value !== undefined) {\n\t\tconst newValue = replaceFn(value);\n\t\tif (newValue !== undefined) element[path[0]] = newValue;\n\n\t} else if (value !== undefined) {\n\t\t(Array.isArray(value) ? value : [value])\n\t\t\t.forEach( v => replaceValue(nextPath, v, replaceFn) )\n\t}\n\t\n\treturn element;\n}\n\nfunction pathToValues(path, element) {\n\tif (typeof(path) === \"string\")\n\t\tpath = path.split(\".\");\n\n\tif (!element) return [];\n\n\tlet value = element[path[0]] || [];\n\tif (!Array.isArray(value)) value = [value];\n\tconst nextPath = path.slice(1);\n\n\tif (!nextPath.length) return value\n\n\treturn value\n\t\t.map( v => pathToValues(nextPath, v) )\n\t\t.reduce((a, b) => a.concat(b), []) //flatten\n\t\t.filter( v => v !== undefined);\n}\n\n//this is probably too simplistic\nfunction buildAbsoluteUrl(fhirEndpoint=\"\", reference) {\n\tif (/^http/.test(reference)) {\n\t\treturn reference;\n\t} else {\n\t\treturn fhirEndpoint.replace(/\\/*$/, \"/\") + reference;\n\t}\n}\n\nfunction addProvenance(resource, fhirEndpoint, fhirVersion=\"R2\") {\n\tresource.meta = resource.meta || {};\n\tif (fhirVersion.toUpperCase() === \"STU4\" || fhirVersion.toUpperCase() === \"R4\") {\n\t\tresource.meta.source = resource.meta.source || fhirEndpoint;\n\t} else {\n\t\tresource.meta.extension = resource.meta.extension || [];\n\t\t//per http://build.fhir.org/versions.html#extensions\n\t\tresource.meta.extension.push({\n\t\t\turl: \"http://hl7.org/fhir/4.0/StructureDefinition/extension-Meta.source\",\n\t\t\tvalueUri: fhirEndpoint\n\t\t})\n\t}\n\treturn resource;\n}\n\nfunction getResourcesByQuery({ fhirEndpoint, query={}, retryLimit=0, token, signal, allowErrors, statusCallback }) {\n\tlet entry = [];\n\treturn new Promise( (resolve, reject) => {\n\t\tconst fetchResources = (url, retries=0, page=1) => {\n\t\t\tif (statusCallback) statusCallback(url);\n\t\t\tfetchFHIR(url, {signal}, query.fhirVersion, token, retryLimit)\n\t\t\t\t.then( fhirData => {\n\t\t\t\t\t//single resource fetch (Operation Outcomes are converted to errors in fetchFHIR function)\n\t\t\t\t\tif (fhirData.resourceType !== \"Bundle\") {\n\t\t\t\t\t\tfhirData = addProvenance(fhirData, fhirEndpoint, query.fhirVersion);\n\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\tquery, entry: [{resource: fhirData, fullUrl: url}]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t//Epic returns Operation Outcomes in bundles to indicate data is not guaranteed to be complete\n\t\t\t\t\tentry = entry.concat(\n\t\t\t\t\t\t(fhirData.entry || [])\n\t\t\t\t\t\t\t.filter( r => r.resource.resourceType !== \"OperationOutcome\")\n\t\t\t\t\t\t\t.map(r => {\n\t\t\t\t\t\t\t\tr.resource = addProvenance(r.resource, fhirEndpoint, query.fhirVersion);\n\t\t\t\t\t\t\t\tr.fullUrl = buildAbsoluteUrl(fhirEndpoint, r.resource.resourceType + \"/\" + r.resource.id);\n\t\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\t//walk to next bundle or return resources\n\t\t\t\t\tconst nextUrl = fhirData.link && fhirData.link.find(l => l.relation === \"next\");\n\t\t\t\t\treturn (nextUrl && (!query.pageLimit || page < query.pageLimit))\n\t\t\t\t\t\t? fetchResources(nextUrl.url, retries, page+1)\n\t\t\t\t\t\t: resolve({ entry, query });\n\t\t\t\t\n\t\t\t\t})\n\t\t\t\t.catch( e => {\n\t\t\t\t\tif (allowErrors && e.name !== \"AbortError\") {\n\t\t\t\t\t\tif (statusCallback) statusCallback(url, true);\n\t\t\t\t\t\tresolve({errorLog: [{fullUrl: url, error: e.message, requestType: \"query\"}], entry: [], errorCount: 1});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(e)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t}\n\n\t\tconst url = fhirEndpoint.replace(/\\/*$/, \"/\") + (query.path || \"\");\n\t\tfetchResources(url);\n\t});\n\n}\n\nfunction getResourcesByUrl({ urls=[], fhirVersion, retryLimit, token, allowErrors, signal, statusCallback }) {\n\tconst getResourceByUrl = (url) => {\n\t\tif (statusCallback) statusCallback(url);\n\t\treturn fetchFHIR(url, {signal}, fhirVersion, token, retryLimit)\n\t\t\t.then( resource => ({fullUrl: url, resource}) )\n\t\t\t.catch( e => {\n\t\t\t\tif (!allowErrors || e.name === \"AbortError\") throw e;\n\t\t\t\tif (statusCallback) statusCallback(url, true);\n\t\t\t\treturn {fullUrl: url, error: e.message, requestType: \"reference\"};\n\t\t\t});\n\t}\n\n\treturn Promise.all( _.map(urls, getResourceByUrl) )\n\t\t.then( data => {\n\t\t\tconst errorLog = data.filter( r => r.error );\n\t\t\tconst entry = data.filter( r => !r.error );\n\t\t\treturn allowErrors ? {entry, errorLog} : entry;\n\t\t});\n\n}\n\nfunction findReferences({ entry=[], paths=[], fhirEndpoint }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\t//add reference element within reference type if not included\n\tpaths = paths.map(p => /\\.reference$/.test(p) ? p : p+\".reference\");\n\n\treturn _.reduce( entry, (refIndex, ent, i) => {\n\t\t_.each( paths, path => {\n\t\t\t_.each( pathToValues(path, ent.resource), ref => {\n\t\t\t\t//ignore contained references\n\t\t\t\tif (/^#/.test(ref)) return;\n\t\t\t\tconst url = buildAbsoluteUrl(fhirEndpoint, ref);\n\t\t\t\trefIndex[url] = refIndex[url] || [];\n\t\t\t\trefIndex[url].push({i, path, rawUrl: ref});\n\t\t\t});\n\t\t});\n\t\treturn refIndex;\n\t}, {});\n}\n\n//note - this function mutates the entries that are passed in\nfunction embedReferences({ entry=[], refEntry=[], refIndex={} }) {\n\t_.each( refEntry, ent => {\n\t\tlet resource;\n\t\t_.each( (refIndex[ent.fullUrl] || []), ref => {\n\t\t\tif (!resource) {\n\t\t\t\tresource = \tentry[ref.i].resource;\n\t\t\t\tresource.contained = entry[ref.i].resource.contained || [];\n\t\t\t\tresource.contained.push(ent.resource);\n\t\t\t}\n\t\t\treplaceValue(ref.path, resource, v => {\n\t\t\t\tif (v === ref.rawUrl) return \"#\" + ent.resource.id;\n\t\t\t});\n\t\t});\n\t});\n\treturn entry;\n}\n\nfunction followReferences({ entry=[], paths=[], fhirEndpoint, fhirVersion, retryLimit=0, token, allowErrors, signal, statusCallback }) {\n\tconst refIndex = findReferences({ entry, paths, fhirEndpoint });\n\treturn getResourcesByUrl({ urls: _.keys(refIndex), fhirVersion, retryLimit, token, allowErrors, signal, statusCallback })\n\t\t.then( data => {\n\t\t\tif (allowErrors) data.errorCount = \n\t\t\t\t_.reduce(data.errorLog, (count, ent) => count+refIndex[ent.fullUrl].length, 0);\n\t\t\treturn data;\n\t\t})\n}\n\nfunction followAndEmbedReferences({ entry=[], paths=[], fhirEndpoint, fhirVersion, retryLimit=0, token, allowErrors, signal, statusCallback }) {\n\tconst refIndex = findReferences({ entry, paths, fhirEndpoint });\n\treturn getResourcesByUrl({ urls: _.keys(refIndex), fhirVersion, retryLimit, token, allowErrors, signal, statusCallback })\n\t\t.then( data => {\n\t\t\tconst refEntry = allowErrors ? data.entry : data;\n\t\t\tconst updatedEntry = embedReferences({ entry, refEntry, refIndex })\n\t\t\treturn allowErrors ? {entry: updatedEntry, errorLog: data.errorLog} : updatedEntry;\n\t\t})\n}\n\nfunction findAttachments({ entry=[], paths=[], fhirEndpoint }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\n\treturn _.reduce( entry, (attachmentIndex, ent) => {\n\t\t_.each( paths, path => {\n\t\t\t_.each( pathToValues(path, ent.resource), attachment => {\n\t\t\t\t//ignore embedded data\n\t\t\t\tif (!attachment.url || attachment.data) return;\n\t\t\t\tconst url = buildAbsoluteUrl(fhirEndpoint, attachment.url);\n\t\t\t\tconst contentType = attachment.contentType || \"\";\n\t\t\t\tattachmentIndex[url+\"::\"+contentType||\"\"] = attachmentIndex[url+\"::\"+contentType||\"\"] || \n\t\t\t\t\t{contentType: attachment.contentType, url: url, rawUrl: attachment.url, count: 0};\n\t\t\t\tattachmentIndex[url+\"::\"+contentType||\"\"].count += 1;\n\t\t\t});\n\t\t});\n\t\treturn attachmentIndex;\n\t}, {});\n}\n\n//this function mutates the resources passed in\nfunction attachmentsToFilenames({ entry = [], files = [], paths }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\t_.each( entry, ent => {\n\t\t_.each( paths, path => {\n\t\t\tent.resource = replaceValue(path, ent.resource, v => {\n\t\t\t\tconst file = files.find(f => f.rawUrl === v.url && f.contentType === v.contentType);\n\t\t\t\tif (file) return {...v, url: file.fileName};\n\t\t\t});\n\t\t});\n\t})\n\treturn entry;\n}\n\nfunction findAndDownloadAttachments({ entry=[], paths=[], fhirEndpoint, token, allowErrors, retryLimit=0, signal, statusCallback, mimeTypeMappings={} }) {\n\t\n\tconst attachmentIndex = findAttachments({ entry, paths, fhirEndpoint });\n\t\n\tconst fetchAttachment = (url, config={}, retryLimit=0, retries=0) => {\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\t//Note that CORS errors for any reason even due to a 401 will not have an error code\n\t\t\t\t//in logs. See https://github.com/github/fetch/issues/201\n\t\t\t\tif (retryLimit && retries < retryLimit) {\n\t\t\t\t\treturn fetchAttachment(url, config, retryLimit, retries+1)\n\t\t\t\t} else {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\tlet i = 0;\n\treturn Promise.all(\n\t\t_.map( attachmentIndex, attachment => {\n\t\t\tlet config = {signal, headers: {\n\t\t\t\tAuthorization: token ? `Bearer ${token}` : undefined,\n\t\t\t\tAccept: attachment.contentType || undefined\n\t\t\t}};\n\t\t\tif (statusCallback) statusCallback(attachment.url);\n\t\t\treturn fetchAttachment(attachment.url, config, retryLimit)\n\t\t\t\t.then( data => data.blob() )\n\t\t\t\t.then( blob => {\n\t\t\t\t\tconst urlExtension = attachment.url.match(/\\.(.{3})$|\\.(.{4})$/);\n\t\t\t\t\tconst mimeExtension = attachment.contentType && mimeTypeMappings[attachment.contentType];\n\t\t\t\t\tconst extension = (urlExtension && urlExtension[1]) || mimeExtension;\n\t\t\t\t\tconst fileName = (i += 1).toString() + (extension ? \".\" + extension : \"\");\n\t\t\t\t\treturn {fileName, fullUrl: attachment.url, blob, contentType: attachment.contentType, rawUrl: attachment.rawUrl}\n\t\t\t\t})\n\t\t\t\t.catch( e => {\n\t\t\t\t\tif (!allowErrors || e.name === \"AbortError\") throw e;\n\t\t\t\t\tif (statusCallback) statusCallback(attachment.url, true);\n\t\t\t\t\treturn {fullUrl: attachment.url, contentType: attachment.contentType, error: e.message, requestType: \"attachment\", rawUrl: attachment.rawUrl};\n\t\t\t\t})\n\t\t})\n\t).then( data => {\n\t\tif (!allowErrors) return data;\n\t\tconst errorLog = data.filter( r => r.error );\n\t\tconst errorCount = _.reduce(errorLog, (count, ent) => count+attachmentIndex[ent.fullUrl+\"::\"+ent.contentType||\"\"].count, 0);\n\t\tconst files = data.filter( r => !r.error );\n\t\treturn allowErrors ? { files, errorLog, errorCount } : files;\n\t});\n}\n\n\nexport default { \n\tfetchFHIR, replaceValue, pathToValues, findReferences, embedReferences, findAttachments,\n\tgetResourcesByQuery, followAndEmbedReferences, followReferences, findAndDownloadAttachments,\n\tattachmentsToFilenames\n}","import fhir from \"./fhir\";\n\nconst authEndpointErr = \"Authorization endpoint or token endpoint not found\";\n\nfunction getPath(obj, path = \"\") {\n\tpath = path.trim();\n\tif (!path) return obj;\n\treturn path.split(\".\").reduce(\n\t\t(out, key) => out ? out[key] : undefined,\n\t\tobj\n\t);\n}\n\nfunction getAuthEndpoints(fhirEndpoint) {\n\tconst url = fhirEndpoint.replace(/\\/*$/, \"/\");\n\treturn new Promise( (resolve, reject) => {\n\t\tgetWellKnownEndpoints(url)\n\t\t\t.then( endpoints => resolve(endpoints) )\n\t\t\t.catch( err => {\n\t\t\t\tgetCapabilityEndpoints(url)\n\t\t\t\t\t.then( endpoints => resolve(endpoints) )\n\t\t\t\t\t.catch( err => reject( authEndpointErr ) )\n\t\t\t});\n\t});\n}\n\nfunction getWellKnownEndpoints(baseUrl) {\n\tconst url = baseUrl + \".well-known/smart-configuration\";\n\treturn fetch(url)\n\t\t.then( response => {\n\t\t\tif (!response.ok)\n\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.json() )\n\t\t.then( json => {\n\t\t\tlet endpoints = {\n\t\t\t\tregistrationEndpoint  : json.registration_endpoint,\n\t\t\t\tauthorizationEndpoint : json.authorization_endpoint,\n\t\t\t\ttokenEndpoint         : json.token_endpoint\n\t\t\t};\n\t\t\tif (!endpoints.authorizationEndpoint || !endpoints.tokenEndpoint) {\n\t\t\t\tthrow authEndpointErr;\n\t\t\t} else {\n\t\t\t\treturn endpoints;\t\t\n\t\t\t}\n\t\t})\n\t\t.catch( e => { throw authEndpointErr });\n}\n\nfunction getCapabilityEndpoints(baseUrl) {\n\tconst nsUri = \"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris\";\n\tconst url = baseUrl + \"metadata\";\n\n\treturn fhir.fetchFHIR(url)\n\t\t.then( json => {\n\t\t\tconst extensions = (getPath(json || {}, \"rest.0.security.extension\") || [])\n\t\t\t\t.filter(e => e.url === nsUri)\n\t\t\t\t.map(o => o.extension)[0];\n\n\t\t\tlet endpoints = {};\n\t\t\tif (extensions) {\n\t\t\t\textensions.forEach(ext => {\n\t\t\t\t\tif (ext.url === \"register\")\n\t\t\t\t\t\tendpoints.registrationEndpoint = ext.valueUri;\n\t\t\t\t\tif (ext.url === \"authorize\")\n\t\t\t\t\t\tendpoints.authorizationEndpoint = ext.valueUri;\n\t\t\t\t\tif (ext.url === \"token\")\n\t\t\t\t\t\tendpoints.tokenEndpoint = ext.valueUri;\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!endpoints.authorizationEndpoint || !endpoints.tokenEndpoint) {\n\t\t\t\tthrow authEndpointErr;\n\t\t\t} else{\n\t\t\t\treturn endpoints;\t\t\n\t\t\t}\n\t\t})\n\t\t.catch( e => { throw authEndpointErr });\n}\n\nfunction generateStateParam(targetLen=32) {\n\tconst charSet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\tlet result = [];\n\twhile (targetLen--)\n\t\tresult.push(charSet.charAt(Math.floor(Math.random() * charSet.length)));\n\treturn result.join(\"\");\n}\n\nfunction buildAuthorizeUrl(authEndpoint, fhirEndpoint, state, scope, redirectUri, clientId, clientSecret, launch) {\n\tif (Array.isArray(scope)) scope = scope.join(\" \");\n\n\tlet params = [\n\t\t\"response_type=code\",\n\t\t\"client_id=\"    + encodeURIComponent(clientId),\n\t\t\"scope=\"        + encodeURIComponent(scope),\n\t\t\"redirect_uri=\" + encodeURIComponent(redirectUri),\n\t\t\"aud=\"          + encodeURIComponent(fhirEndpoint),\n\t\t\"state=\"        + state\n\t];\n\n\tif (launch) \n\t\tparams.push(\"launch=\" + encodeURIComponent(launch));\n\tif (clientSecret) \n\t\tparams.push(\"client_secret=\" + encodeURIComponent(clientSecret));\n\n\treturn authEndpoint + \"?\" + params.join(\"&\");\n}\n\nfunction exchangeCodeForToken(tokenEndpoint, code, redirectUri, clientId, clientSecret) {\n\tlet config = {\n\t\tmethod: \"post\",\n\t\theaders:  {\"content-type\": \"application/x-www-form-urlencoded\"},\n\t\t// mode: \"cors\",\n\t\tbody: [\n\t\t\t\"grant_type=authorization_code\",\n\t\t\t\"code=\" + encodeURIComponent(code),\n\t\t\t\"redirect_uri=\" + encodeURIComponent(redirectUri)\n\t\t].join(\"&\")\n\t}\n\n\tif (clientSecret) {\n\t\tconfig.headers.Authorization = `Basic ${btoa(`${clientId}:${clientSecret}`)}`;\n\t} else {\n\t\tconfig.body += \"&client_id=\" + encodeURIComponent(clientId);\n\t}\n\n\treturn fetch(tokenEndpoint, config)\n\n}\n\nfunction refreshToken(tokenEndpoint, refreshToken) {\n\treturn fetch(tokenEndpoint, {\n\t\tmethod: \"post\",\n\t\theaders:  {\"content-type\": \"application/x-www-form-urlencoded\"},\n\t\tmode: \"cors\",\n\t\tbody: [\n\t\t\t\"grant_type=refresh_token\",\n\t\t\t\"refresh_token=\" + encodeURIComponent(refreshToken)\n\t\t].join(\"&\")\n\t})\n}\n\nfunction buildQs(fhirParams) {\n\treturn \"?\" + Object.keys(fhirParams).map( k => {\n\t\tconst value = Array.isArray(fhirParams[k]) ? fhirParams[k].join(\",\") : fhirParams[k];\n\t\treturn k + \"=\" + encodeURIComponent(value);\n\t}).join(\"&\");\n}\n\nexport default {\n\tgetWellKnownEndpoints, getCapabilityEndpoints, getAuthEndpoints, buildQs,\n\tbuildAuthorizeUrl, exchangeCodeForToken, refreshToken, generateStateParam\n}","import SMART from \"./smart-core\";\n\nexport default class SmartPopup {\n\n\tconstructor(provider) {\n\t\tthis.provider = provider;\n\t\tthis.authWindow = window.open('', '_blank');\n\t\tthis.authWindow.document.write('Loading...');\n\t}\n\n\tparseQs(qs) {\n\t\tconst pairs = qs.split('&');\n\t\tlet result = {};\n\t\tpairs.forEach( pair => {\n\t\t\tpair = pair.split('=');\n\t\t\tresult[pair[0]] = decodeURIComponent(pair[1]||\"\");\n\t\t});\n\t\treturn result;\n\t}\n\n\tcancel() {\n\t\tif (this.reject) {\n\t\t\tclearInterval(this.popupPoll);\n\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\tthis.authWindow.close();\n\t\t\tthis.reject(new Error(\"cancelled\"))\n\t\t}\n\t}\n\n\tauthorize(authEndpoints, ignoreState) {\t\n\t\treturn new Promise( (resolve, reject) => {\n\t\t\tthis.reject = reject;\n\t\t\tconst stateParam = SMART.generateStateParam();\n\n\t\t\tthis.popupPoll = setInterval( () => {   \n\t\t\t\tif (this.authWindow.closed) {\n\t\t\t\t\tclearInterval(this.popupPoll);\n\t\t\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\t\t\treject(new Error(\"Login window closed by user\"));\n\t\t\t\t}\n\t\t\t}, 500); \n\t\n\n\t\t\tconst receiveMessage = (event) => {\n\t\t\t\tif (event.origin !== window.location.origin) return;\n\t\t\t\t//block react dev tools messages\n\t\t\t\tif (typeof event.data !== \"string\") return;\n\t\t\t\tclearInterval(this.popupPoll);\n\t\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\t\tthis.authWindow.close();\n\n\t\t\t\tconst data = this.parseQs(event.data);\n\n\t\t\t\tif (data.error) {\n\t\t\t\t\treject(data.error);\n\t\t\t\t} else if (data.code && ignoreState !== true && data.state !== stateParam) {\n\t\t\t\t\treject(\"Invalid state parameter returned by server\");\n\t\t\t\t} else if (data.code) {\n\t\t\t\t\tSMART.exchangeCodeForToken(\n\t\t\t\t\t\tauthEndpoints.tokenEndpoint,\n\t\t\t\t\t\tdata.code,\n\t\t\t\t\t\tthis.provider.redirectUri,\n\t\t\t\t\t\tthis.provider.clientId,\n\t\t\t\t\t\tthis.provider.clientSecret\n\t\t\t\t\t)\n\t\t\t\t\t.then( data => data.json() )\n\t\t\t\t\t.then( data => {\n\t\t\t\t\t\tif (data.access_token) {\n\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t\t\treject(\"No access token in server token response\");\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\treject(\"Failed to retrieve code parameter\");\n\t\t\t\t}\n\t\t\t};\n\t\t\n\t\t\tconst url = SMART.buildAuthorizeUrl(\n\t\t\t\tauthEndpoints.authorizationEndpoint,\n\t\t\t\tthis.provider.fhirEndpoint,\n\t\t\t\tstateParam,\n\t\t\t\tthis.provider.scope,\n\t\t\t\tthis.provider.redirectUri,\n\t\t\t\tthis.provider.clientId\n\t\t\t);\n\n\t\t\tthis.messageListener = \n\t\t\t\twindow.addEventListener(\"message\", receiveMessage, false);\n\t\t\t\n\t\t\tthis.authWindow.location.href = url;\n\t\t});\n\t}\n\n}","import tv4 from \"tv4\";\nimport  matchUrl from 'match-url-wildcard';\nimport configSchema from \"../schemas/upload-manifest-schema.json\";\nimport _ from \"lodash\";\n\nexport default class FileExporter {\n\n\tcancel() {\n\t\tthis.controller.abort();\n\t}\n\n\tresetCancelled() {\n\t\tthis.controller = new AbortController();\n\t\tthis.signal = this.controller.signal;\n\t}\n\n\tisValidUrl(url, whitelist) {\n\t\treturn _.find(whitelist, rule => matchUrl(url, rule)) !== undefined;\n\t}\n\n\tgetManifest(url) {\n\t\tthis.resetCancelled();\n\t\tconst config = {\n\t\t\tsignal: this.signal,\n\t\t\taccept: \"application/json\"\n\t\t}\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.then( data => data.json() )\n\t\t\t.then( data => {\n\t\t\t\ttv4.validate(data, configSchema);\n\t\t\t\tif (tv4.error) {\n\t\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\t\tthrow new Error(url + \": \" + tv4.error.message);\n\t\t\t\t}\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\t\n\tputFile(url, file) {\n\t\tthis.resetCancelled()\n\t\tconst config = {\n\t\t\tsignal: this.signal,\n\t\t\tmethod: \"PUT\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/octet-stream\"\n\t\t\t},\n\t\t\tbody: file\n\t\t}\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.then( response => {\n\t\t\t\tconst contentType = response.headers.get(\"content-type\");\n\t\t\t\tif (contentType && contentType.indexOf(\"application/json\") !== -1) {\n\t\t\t\t\treturn response.json();\n\t\t\t\t} else {\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (data.error) throw new Error(data.error);\n\t\t\t})\n\t\t\t.catch( error => {\t\n\t\t\t\tconsole.log(error);\n\t\t\t\tif (error.name === \"AbortError\") {\n\t\t\t\t\tthrow(error);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`An error occurred sending your data: ${error.message}`);\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\n}","import _ from \"lodash\";\n\n//matching object keys merge properties\n//if key has an underscore, then object is replaced\n//arrays items merge by id, appending otherwise\n//array items with an underscore property replace all properties\n//objects item with an underscore property are deleted\nfunction merge(templates) {\n\n\tconst mergeArray = (base, override) => {\n\t\t_.each(override, overrideItem => {\n\t\t\tconst baseIndex = overrideItem.id \n\t\t\t\t? _.findIndex(base, b => b.id === overrideItem.id) \n\t\t\t\t: -1;\n\t\t\tif (overrideItem._) {\n\t\t\t\tif (baseIndex > -1) base.splice(baseIndex, 1); \n\t\t\t} else if (baseIndex > -1) {\n\t\t\t\tbase[baseIndex] = mergeObject(base[baseIndex], overrideItem);\n\t\t\t} else {\n\t\t\t\tbase.push(overrideItem)\n\t\t\t}\n\t\t});\n\t\treturn base;\n\t}\n\n\tconst mergeObject = (base, override) => {\n\t\t_.each( _.keys(override), key => {\n\t\t\tif (key[0] === \"_\") {\n\t\t\t\tbase[key.slice(1)] = override[key];\n\t\t\t} else if (base[key] === undefined) {\n\t\t\t\tbase[key] = override[key];\n\t\t\t} else if (_.isPlainObject(override[key]) && override[key]._) {\n\t\t\t\tdelete base[key];\n\t\t\t} else if (_.isPlainObject(override[key])) {\n\t\t\t\tbase[key] = mergeObject(base[key], override[key]);\n\t\t\t} else if (_.isArray(base[key]) && _.isArray(override[key])) {\n\t\t\t\tbase[key] = mergeArray(base[key], override[key]);\n\t\t\t} else {\n\t\t\t\tbase[key] = override[key];\n\t\t\t}\n\t\t})\n\t\treturn base;\n\t}\n\n\tlet base = JSON.parse(JSON.stringify(templates[0]));\n\t_.each( templates, (template, i) => {\n\t\tif (i === 0) return;\n\t\ttemplate = JSON.parse(JSON.stringify(template));\n\t\tif (_.isPlainObject(base) && _.isPlainObject(template)) {\n\t\t\tbase = mergeObject(base, template)\n\t\t} else if (_.isArray(base) && _.isArray(template)) {\n\t\t\tbase = mergeArray(base, template);\n\t\t} else {\n\t\t\tbase = template;\n\t\t}\n\t})\n\treturn base;\n\n}\n\nexport default { merge };","import fetch from \"cross-fetch\";\nimport stripJsonComments from \"strip-json-comments\";\nimport tv4 from \"tv4\";\nimport endpointListSchema from \"../schemas/endpoint-list-schema.json\";\nimport configSchema from \"../schemas/config-schema.json\";\nimport FileExporter from \"./file-exporter\";\nimport _ from \"lodash\";\nimport mergeObjects from \"./merge-objects.js\";\n\nfunction getUrlParameter(name) {\n    name = name.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\");\n    var results = regex.exec(window.location.search);\n    return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\nfunction overlayQsValues(config) {\n\tconst manifestUrl = getUrlParameter(\"upload_manifest_url\");\n\tif (manifestUrl) {\n\t\tconfig.upload = config.upload || {};\n\t\tconfig.upload.manifestUrl = manifestUrl;\n\t\tconfig.upload.qsManifestUrl = true;\n\t}\n\tconst label = getUrlParameter(\"upload_label\");\n\tif (label) {\n\t\tconfig.upload = config.upload || {};\n\t\tconfig.upload.label = label;\n\t}\n\tconst wizard = getUrlParameter(\"wizard\");\n\tif (wizard) config.showWizard = true;\n\treturn config;\n}\n\n\nfunction readConfigFile(path, isOverride) {\n\treturn fetch(path, { headers: {'Accept': 'application/json'} })\n\t\t.then( response => {\n\t\t\tif (!response.ok && !isOverride)\n\t\t\t\tthrow new Error(`${path} - HTTP ${response.status} - ${response.statusText}`);\t\t\t\t\n\t\t\t\n\t\t\tif (!response.ok && isOverride)\n\t\t\t\tresponse = { text: () => \"{}\" };\n\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.text() )\n\t\t.then( data => {\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(stripJsonComments(data));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tthrow new Error(`${path} is not valid JSON.`);\n\t\t\t}\n\t\t})\n\n}\n\nfunction loadConfigFile(path, overridePath, allowQsOverride) {\n\tlet configReaders = [readConfigFile(path)];\n\tconst qsOverridePath = getUrlParameter(\"config\");\n\n\tif (qsOverridePath && allowQsOverride) {\n\t\tconfigReaders.push(readConfigFile(qsOverridePath, true));\n\t} else if (overridePath) {\n\t\tconfigReaders.push(readConfigFile(overridePath, true));\n\t}\n\n\treturn Promise.all(configReaders)\n\t\t.then( data => mergeObjects.merge(data) )\n\t\t.then( data => {\n\t\t\ttv4.validate(data, configSchema);\n\t\t\tif (tv4.error) {\n\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\tthrow new Error(path + \": \" + tv4.error.message);\n\t\t\t}\n\t\t\treturn data;\n\t\t})\n\t\t//check for invalid queryProfile name and credential references (can't do this in json schema v4)\n\t\t.then( config => {\n\t\t\tif (!config.endpointLists) return config;\n\t\t\t\n\t\t\tconst invalidEndpointId = _.find( _.keys(config.endpointLists) || [], id => {\n\t\t\t\tconst v = config.endpointLists[id];\n\t\t\t\treturn (\n\t\t\t\t\tv && v.defaults && v.defaults.queryProfile && \n\t\t\t\t\t!config.queryProfiles[v.defaults.queryProfile]\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tif (invalidEndpointId) throw new Error(\n\t\t\t\t\"Invalid query profile in endpoint \" + \n\t\t\t\tpath + \": /endpointLists/\" + invalidEndpointId + \"/defaults\"\n\t\t\t);\n\n\t\t\tconst invalidCredentialId = _.find( _.keys(config.endpointLists) || [], id => {\n\t\t\t\tconst v = config.endpointLists[id];\n\t\t\t\treturn (\n\t\t\t\t\tv && v.defaults && v.defaults.credentialId && \n\t\t\t\t\t!config.credentials[v.defaults.credentialId]\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tif (invalidCredentialId) throw new Error(\n\t\t\t\t\"Invalid credential id in endpoint \" + \n\t\t\t\tpath + \": /endpointLists/\" + invalidCredentialId + \"/defaults\"\n\t\t\t);\n\n\t\t\treturn config;\n\t\t})\n\t\t//check for invalid template name references (can't do this in json schema v4)\n\t\t.then( config => {\n\t\t\tif (!config.spreadsheetTemplates) return config;\n\n\t\t\tconst templateNames = Object.keys(config.spreadsheetTemplates);\n\t\t\ttemplateNames.forEach( templateName => {\n\t\t\t\tconst baseTemplates = config.spreadsheetTemplates[templateName].extends || [];\n\t\t\t\tbaseTemplates.forEach( baseTemplateName => {\n\t\t\t\t\tif (templateNames.indexOf(baseTemplateName) === -1)\n\t\t\t\t\t\tthrow new Error(\"Invalid base template name in '\" + templateName + \"'\");\n\t\t\t\t})\n\t\t\t})\n\t\t\treturn config;\n\t\t})\n\t\t.then( config => {\n\t\t\tif (!config.endpointLists) return config;\n\t\t\treturn loadEndpointLists(config);\n\t\t})\n\t\t.then( config => {\n\t\t\tconfig.redirectUri = config.redirectUri || \n\t\t\t\twindow.location.href.split(/\\?|#/)[0].replace(/\\/*$/, \"/callback.html\");\n\t\t\treturn config;\n\t\t})\n\t\t.then( config => {\n\t\t\treturn overlayQsValues(config);\n\t\t})\n\t\t//preload manifest if in wizard mode.\n\t\t//manifest is loaded on-demand when in full mode so as not to display \n\t\t//unnecessary errors to the user if it fails to load.\n\t\t.then( config => {\n\n\t\t\tif (!config.showWizard || (config.upload && !config.upload.manifestUrl)) \n\t\t\t\treturn config;\n\t\t\t\n\t\t\tif (!config.upload || (!config.upload.manifestUrl && !config.upload.uploadUrl))\n\t\t\t\tthrow new Error(\"Upload configuration required for wizard mode\");\n\t\t\t\n\t\t\tconst fileExporter = new FileExporter();\n\t\t\tif (config.upload.qsManifestUrl) {\n\t\t\t\tconst isValidUrl = fileExporter.isValidUrl(config.upload.manifestUrl, config.upload.whitelist);\n\t\t\t\tif (!isValidUrl) \n\t\t\t\t\tthrow new Error(\"Url manifest location not in whitelist: \" + config.upload.manifestUrl);\n\t\t\t}\n\n\t\t\treturn fileExporter.getManifest(config.upload.manifestUrl)\n\t\t\t\t.then( manifest => {\n\t\t\t\t\tconfig.upload = {...config.upload, ...manifest}\n\t\t\t\t\treturn config;\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\tthrow new Error(\"Unable to load manifest at \" + config.upload.manifestUrl);\n\t\t\t\t});\n\t\n\n\t\t})\n\t\t// .then( config => {\n\t\t// \tconsole.log(config);\n\t\t// \treturn config;\n\t\t// })\n\n}\n\nfunction loadEndpointLists(config) {\n\n\tconst getEndpointList = (endpointList, id) => {\n\t\tif (!endpointList.path) return;\n\n\t\treturn fetch(endpointList.path, { headers: {'Accept': 'application/json'} })\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`${endpointList.path} - HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\t\t\n\t\t\t.then( data => data.text() )\n\t\t\t.then( data => {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(stripJsonComments(data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\tthrow new Error(`${endpointList.path} is not valid JSON.`);\n\t\t\t\t}\n\t\t\t})\n\t\t\t//convert Endpoint resource bundle to endpoint list format\n\t\t\t.then( data => {\n\t\t\t\tif (data.resourceType !== \"Bundle\") return data;\n\t\t\t\tconst transformedEntries = _.chain(data.entry)\n\t\t\t\t\t.filter( entry => entry.resource && \n\t\t\t\t\t\tentry.resource.name && entry.resource.address &&\n\t\t\t\t\t\tentry.resource.status === \"active\"\n\t\t\t\t\t).map( entry => ({\n\t\t\t\t\t\tfhirEndpoint: entry.resource.address,\n\t\t\t\t\t\tname: entry.resource.name\n\t\t\t\t\t})).value();\n\t\t\t\treturn {entry: transformedEntries}\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\ttv4.validate(data, endpointListSchema);\n\t\t\t\tif (tv4.error) {\n\t\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\t\tthrow new Error(endpointList.path + \": \" + tv4.error.message);\n\t\t\t\t}\n\t\t\t\treturn data;\n\t\t\t})\n\n\t\t\t//check for invalid queryProfile name references and credential ids(can't do this in json schema)\n\t\t\t.then( data => {\n\n\t\t\t\t(data.entry || data.Entries || []).forEach( endpoint => {\n\t\t\t\t\tif (endpoint.queryProfile && !config.queryProfiles[endpoint.queryProfile]\n\t\t\t\t\t) throw new Error(\n\t\t\t\t\t\t\"Invalid query profile in endpoint list \" + \n\t\t\t\t\t\tendpointList.path + \" - \" + endpoint.queryProfile\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\t(data.entry || data.Entries || []).forEach( endpoint => {\n\t\t\t\t\tif (endpoint.credentialId && !config.credentials[endpoint.credentialId]\n\t\t\t\t\t) throw new Error(\n\t\t\t\t\t\t\"Invalid credential id endpoint list \" + \n\t\t\t\t\t\tendpointList.path + \" - \" + endpoint.credentialId\n\t\t\t\t\t);\n\t\t\t\t})\n\n\t\t\t\treturn data; \n\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tconst result = (data.Entries || data.entry).map( entry => {\n\t\t\t\t\tlet newEntry = {...entry}\n\t\t\t\t\t//standardize old epic format\n\t\t\t\t\tif (newEntry.OrganizationName) {\n\t\t\t\t\t\tnewEntry.name = newEntry.OrganizationName;\n\t\t\t\t\t\tdelete newEntry.OrganizationName;\n\t\t\t\t\t}\n\t\t\t\t\tif (newEntry.FHIRPatientFacingURI) {\n\t\t\t\t\t\tnewEntry.fhirEndpoint = newEntry.FHIRPatientFacingURI;\n\t\t\t\t\t\tdelete newEntry.FHIRPatientFacingURI;\n\t\t\t\t\t}\n\t\t\t\t\tif (newEntry.id) {\n\t\t\t\t\t\tnewEntry.orgId = newEntry.id;\n\t\t\t\t\t\tdelete newEntry.id;\n\t\t\t\t\t} \n\t\t\t\t\t//add unique id if not present\n\t\t\t\t\tif (!newEntry.orgId)\n\t\t\t\t\t\tnewEntry.orgId = newEntry.name.replace(/\\W/g, \"\");\n\t\t\t\t\t\n\t\t\t\t\t//add defaults group name\n\t\t\t\t\tif (endpointList.defaults)\n\t\t\t\t\t\tnewEntry.defaultId = id;\n\t\t\t\t\treturn newEntry;\n\t\t\t\t});\n\t\t\t\treturn result\n\t\t\t})\n\t\t\t.catch( e => { \n\t\t\t\tif (e.message) throw e;\n\t\t\t\tthrow new Error(\"Error reading \" + endpointList.path)\n\t\t\t})\n\t}\n\n\t//order by key so can de-dupe by name keeping latest\n\tconst endpointPromises = _.chain( config.endpointLists )\n\t\t.map( (l, id) => ({l, id}) )\n\t\t.sortBy( \"id\" )\n\t\t.reverse()\n\t\t.map( item => \n\t\t\tgetEndpointList(item.l, item.id)\n\t\t\t\t.then( list => list.reverse() )\n\t\t)\n\t\t.value();\n\t\n\treturn Promise.all(endpointPromises)\n\t\t.then( data => {\n\t\t\tconst organizations = _.unionBy(...data, \"orgId\")\n\t\t\tconst orgDefaults = _.mapValues( config.endpointLists, v => v.defaults );\n\t\t\treturn {...config, orgDefaults, organizations, endpointLists: null}\n\t\t});\n}\n\nexport default { loadConfigFile }\n","import sanitizeFilename from \"sanitize-filename\";\nimport _ from \"lodash\";\nimport jszip from \"jszip\";\nimport { saveAs } from \"file-saver\";\n\nfunction addProviderToZip(zipFolder, provider) {\n\t\n\t// console.log(JSON.stringify(provider.data))\n\t\n\tconst bundles = _.chain(provider.data.entry)\n\t\t.groupBy(e => e.resource.resourceType)\n\t\t.mapValues(entry => {\n\t\t\treturn {\n\t\t\t\tentry: _.map(entry, e => ({fullUrl: e.fullUrl, resource: e.resource}) ),\n\t\t\t\ttotal: entry.length, \n\t\t\t\ttype:\"collection\",\n\t\t\t\tresourceType: \"Bundle\"\n\t\t\t}\n\t\t}).value();\n\t_.each(bundles, (bundle, resourceType) => {\n\t\tzipFolder.file(resourceType+\".json\", JSON.stringify(bundle, null, 2)) \n\t});\n\t_.each(provider.data.files, f => {\n\t\tzipFolder.file(f.fileName, f.blob, {type: \"blob\"});\n\t});\n\tif (provider.data.errorLog.length)\n\t\tzipFolder.file(\"error_log.json\", JSON.stringify(provider.data.errorLog, null, 2));\n}\n\nfunction exportProvider(provider) {\n\treturn new Promise( (resolve, reject) => {\n\t\tconst zip = new jszip();\n\t\taddProviderToZip(zip, provider);\n\t\tconst fileName = sanitizeFilename(provider.name);\n\t\tzip.generateAsync({type: \"blob\"})\n\t\t\t.then( blob => saveAs(blob, fileName) )\n\t\t\t.then( resolve )\n\t\t\t.catch( reject );\n\t});\n}\n\nfunction exportProviders(providers, fileName=\"procure-data.zip\") {\n\treturn exportProvidersAsBlob(providers)\n\t\t.then( blob => saveAs(blob, fileName) );\n}\n\nfunction exportProvidersAsBlob(providers) {\n\treturn new Promise( (resolve, reject) => {\n\t\tconst zip = new jszip();\n\t\tproviders.filter( p => p.data && p.selected).forEach( provider => {\n\t\t\tconst folder = zip.folder( sanitizeFilename(provider.name) );\n\t\t\taddProviderToZip(folder, provider);\n\t\t});\n\t\tzip.generateAsync({type: \"blob\"})\n\t\t\t.then( resolve )\n\t\t\t.catch( reject );\n\t});\n}\n\nfunction generateFile(providers, multiProviderFileName) {\n\tconst exportableProviders = _.filter(providers, p => {\n\t\treturn p.data && p.data.entry && p.selected && (p.data.entry.length || p.data.errorLog.length)\n\t});\n\t\n\t//work around jszip timezone bug\n\tconst currDate = new Date();\n\tconst dateWithOffset = new Date(currDate.getTime() - currDate.getTimezoneOffset() * 60000);\n\tjszip.defaults.date = dateWithOffset;\n\t\n\tif (exportableProviders.length > 1) {\n\t\treturn exportProviders(exportableProviders, multiProviderFileName);\n\t} else {\n\t\treturn exportProvider(exportableProviders[0]);\n\t}\n}\n\nexport default { generateFile, exportProvidersAsBlob }","const defaultBaseUrl = \"https://api.github.com\";\n\nfunction callApi(config, path, method=\"GET\", jsonPayload) {\n\tconst reqConfig = {\n\t\theaders: {\"Authorization\": `Bearer ${config.token}`},\n\t\tmethod\n\t}\n\tif (jsonPayload) reqConfig.body = JSON.stringify(jsonPayload);\n\t\n\tconst url = `${config.baseUrl||defaultBaseUrl}/repos/${config.owner}/${config.project}/${path}`\n\treturn fetch(url, reqConfig).then( response => {\n\t\tif (response.ok) {\n\t\t\treturn response.json();\n\t\t} else if (response.status === 404) {\n\t\t\tthrow new Error(\"Repository not found\");\n\t\t} else if (response.stats === 500) {\n\t\t\tthrow new Error(response.message || \"Github API returned a 500 error\");\n\t\t} else {\n\t\t\treturn response.json().then( (json) => {\n\t\t\t\tthrow new Error(json.message);\n\t\t\t});\n\t\t}\n\t})\n}\n\nfunction getLastCommit(config, branchName=\"master\") {\n\treturn callApi(config, `git/refs/heads/${branchName}`)\n\t\t//special handling for uninitialized repository (repo without any files)\n\t\t.catch( e => {\n\t\t\tif (e.message === \"Git Repository is empty.\")\n\t\t\t\te.message = \"Git repository is empty. Please initialize the repository and try again.\"\n\t\t\tthrow e;\n\t\t});\n}\n\nfunction getTree(config, commit) {\n\treturn callApi(config, `git/trees/${commit.object.sha}`)\n\t\t.then( tree => {\n\t\t\tif (tree.truncated)\n\t\t\t\tthrow new Error(\"Unable to load entire head tree - too many files\");\n\t\t\treturn tree;\n\t\t})\n\t\t//handle 404 for when tree has been deleted and repo is empty\n\t\t.catch( e => {\n\t\t\tif (e.message === \"Repository not found\") {\n\t\t\t\treturn {tree: []}\n\t\t\t}\n\t\t})\n}\n\nfunction createBlob(config, blob) {\n\treturn callApi(config, \"git/blobs\", \"POST\", blob)\n}\n\nfunction createTree(config, tree) {\n\treturn callApi(config, \"git/trees\", \"POST\", tree);\n}\n\nfunction commitTree(config, tree, message, lastCommit, branchName=\"master\") {\n\t\treturn callApi(config, \"git/commits\", \"POST\", {\n\t\t\tmessage,\n\t\t\ttree: tree.sha,\n\t\t\tparents: [lastCommit.object.sha]\n\t\t}).then( commit => {\n\t\t\treturn callApi(config, `git/refs/heads/${branchName}`,\"PATCH\", {\n\t\t\t\tsha: commit.sha\n\t\t\t})\n\t\t})\n\t}\n\nfunction commitTreeToPullRequest(config, tree, message, lastCommit, title, newBranchName,  baseBranch=\"master\", bodyText) {\n\treturn callApi(config, \"git/commits\", \"POST\", {\n\t\tmessage,\n\t\ttree: tree.sha,\n\t\tparents: [lastCommit.object.sha]\n\t}).then( commit => {\n\t\treturn callApi(config, \"git/refs\", \"POST\", {\n\t\t\tref: `refs/heads/${newBranchName}`,\n\t\t\tsha: commit.sha\n\t\t});\n\t}).then( () => {\n\t\treturn callApi(config, \"pulls\", \"POST\", {\n\t\t\ttitle: title,\n\t\t\tbody: bodyText,\n\t\t\thead: newBranchName,\n\t\t\tbase: baseBranch,\n\t\t\tmaintainer_can_modify: true\n\t\t})\n\t})\n}\n\nexport default {\n\tgetLastCommit, getTree, createBlob, \n\tcreateTree, commitTree, commitTreeToPullRequest\n}","import _ from \"lodash\";\nimport XlsxPopulate from \"xlsx-populate\";\nimport saveAs from \"file-saver\";\nimport sanitizeFilename from \"sanitize-filename\";\nimport mergeObjects from \"./merge-objects.js\";\nimport csvWriter from \"./csv-writer\";\n\nconst defaultHelperFns = {\n\tvalidateExists: v => {\n\t\treturn v !== undefined\n\t},\n\tvalidateCode: (v, template) => {\n\t\tif (!v) return false;\n\t\tif (!Array.isArray(v)) v = [v];\n\t\treturn v.find( c => c.code === template.target ) ? true : false;\n\t},\n\tvalidateCodeableConcept: (v, template) => {\n\t\tif (!v) return false;\n\t\tif (!Array.isArray(v)) v = [v];\n\t\treturn v.find( cc => {\n\t\t\treturn cc.coding.find( c => c.code === template.target ) \n\t\t}) ? true : false;\n\t},\n\tvalidateValue: (v, template) => {\n\t\treturn v === template.target;\n\t},\n\tgetHelperData: (v, template, helperData) => {\n\t\treturn helperData[template.helperDataField];\n\t},\n\tstringifyCodings: v => {\n\t\tif (!v) return v;\n\t\tif (!Array.isArray(v)) v = [v];\n\t\treturn v\n\t\t\t.map( c => c.system + \"|\" + c.code )\n\t\t\t.join(\" \");\n\t},\n\tparseDateForExcel:  (v, template, helperData) => {\n\t\treturn (v && helperData.format !== \"csv\")\n\t\t\t? new Date(v) \n\t\t\t: v;\n\t}\n}\n\nfunction flatten(element, template, helperData={}, helperFns) {\n\thelperFns = helperFns || defaultHelperFns;\n\tlet rows = [];\n\t_.each(template, field => {\n\n\t\tconst mergeRows = (rowsToMerge) => {\n\t\t\tif (rows.length === 0) rows = [{}];\n\t\t\tlet newRows = [];\n\t\t\t_.each(rowsToMerge, mergeRow => {\n\t\t\t\tif (!_.isArray(mergeRow)) mergeRow = [mergeRow];\n\t\t\t\t_.each(mergeRow, mergeRowItem => {\n\t\t\t\t\t_.each(rows, row => {\n\t\t\t\t\t\tnewRows.push({ ...row, ...mergeRowItem});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\trows = newRows;\n\t\t}\n\n\t\tif (!_.isArray(field.path))\n\t\t\tfield.path = [field.path];\n\n\t\tlet data = _.chain(element)\n\t\t\t.at(element, field.path)\n\t\t\t.filter( v => v !== undefined )\n\t\t\t.first().value();\n\n\t\t//allow a fallback path. Note: this will always be evaluated last regardless of array position\n\t\tif (!data && field.path.indexOf(\"*\") > -1) \n\t\t\tdata = element;\n\n\t\tif (field.transform)\n\t\t\tdata = helperFns[field.transform](data, field, helperData);\n\n\t\tconst valid = \n\t\t\tfield.test === undefined || helperFns[field.test](data, field, helperData);\n\n\t\t// console.log(valid, field, data)\n\n\t\tif (!valid) {\n\t\t\trows = null;\n\t\t\treturn false;\n\t\t} else if (field.children) {\n\t\t\tif (!_.isArray(data)) data = [data];\n\t\t\tconst childRows = _.map( data, childElement => {\n\t\t\t\treturn flatten(childElement, field.children, helperData, helperFns);\n\t\t\t});\n\t\t\t//check if all children were valid and bail if they weren't\n\t\t\tif (childRows.indexOf(null) > -1) {\n\t\t\t\trows = null;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tmergeRows(childRows);\n\t\t\t}\n\t\t} else if (field.name) {\n\t\t\tif (!_.isArray(data)) data = [data];\n\t\t\tconst rowsToMerge = data.map( item => ({[field.name]: item}) );\n\t\t\tmergeRows(rowsToMerge);\n\t\t}\n\t})\n\treturn rows;\n}\n\nfunction flattenProviders(providers, template, helperData={}, helperFns) {\n\treturn _.chain(providers)\n\t\t.filter( p => p.selected && p.data && p.data.entry && p.data.entry.length > 0)\n\t\t.map( p => {\n\t\t\treturn _.chain(p.data.entry).map( e => {\n\t\t\t\tconst providerHelperData = {...helperData, source: p.name};\n\t\t\t\treturn flatten(e.resource, template, providerHelperData, helperFns);\n\t\t\t}).flatten().value()\n\t\t})\n\t\t.flatten()\n\t\t.filter( f => f !== null )\n\t\t.value();\n}\n\nfunction getTemplateColumns(template) {\n\tlet cols = [];\n\tconst arrayToCols = templateArray => {\n\t\t_.each(templateArray, field => {\n\t\t\tif (field.name) cols.push(field.name);\n\t\t\tif (field.children) arrayToCols(field.children);\n\t\t});\n\t}\n\tarrayToCols(template || template.template);\n\treturn cols;\n}\n\n// JS Excel libraries with browser compatibility (others are node.js only)\n// https://github.com/SheetJS/js-xlsx (Apache2, very robust, support for .xls, formatting requires commercial license)\n// https://github.com/dtjohnson/xlsx-populate (MIT, good option)\n// https://github.com/exceljs/exceljs (MIT, good option, slightly more dependencies)\n// https://github.com/egeriis/zipcelx (MIT, very light weight, currently no date support)\n// https://en.wikipedia.org/wiki/Microsoft_Office_XML_formats#Excel_XML_Spreadsheet_example (Excel 2003, seems to not require zip)\n\nfunction exportFlatDataCSV(flatData, template, name) {\n\tconst columns = getTemplateColumns(template);\n\tconst data = flatData.map( row => {\n\t\treturn columns.map( col =>  row[col] );\n\t});\n\tconst blob = csvWriter([columns].concat(data));\n\treturn new Promise( (resolve) => {\n\t\tsaveAs(blob, sanitizeFilename(name) + \".csv\")\n\t\tresolve();\n\t})\n}\n\nfunction exportFlatDataExcel(flatData, template, name) {\n\tconst columns = getTemplateColumns(template);\n\tlet dateCols = [];\n\tconst data = flatData.map( row => {\n\t\treturn columns.map( (col, i) => {\n\t\t\tif (row[col] instanceof Date && dateCols.indexOf(i+1) === -1)\n\t\t\t\tdateCols.push(i+1);\n\t\t\treturn row[col] \n\t\t});\n\t});\n\n\treturn XlsxPopulate.fromBlankAsync()\n    \t.then( workbook => {\n\t\t\tworkbook.sheet(0).name(name)\n\t\t\t\t.cell(\"A1\").value(\n\t\t\t\t\t[columns].concat(data)\n\t\t\t\t)\n\t\t\tdateCols.forEach( dateCol => {\n\t\t\t\tworkbook.sheet(0).column(dateCol)\n\t\t\t\t\t.style(\"numberFormat\", \"dddd, mmmm dd, yyyy\");\n\t\t\t});\n\t\t\treturn workbook.outputAsync()\n\t\t})\n\t\t.then( blob => {\n\t\t\tsaveAs(blob, sanitizeFilename(name) + \".xlsx\");\n\t\t});\n}\n\nfunction exportSpreadsheet(providers, spreadsheetTemplates, templateId, format) {\n\tconst templateDefinition = spreadsheetTemplates[templateId];\n\n\tconst templateDefinitions = _.map( (templateDefinition.extends||[]),\n\t\tid => spreadsheetTemplates[id]\n\t).concat([templateDefinition]);\n\n\tconst mergedTemplateDefinition = mergeObjects.merge(templateDefinitions);\t\n\tlet flatData = flattenProviders(providers, mergedTemplateDefinition.template, { format });\n\n\tif (mergedTemplateDefinition.sortBy) {\n\t\tconst sortBy = _.map(mergedTemplateDefinition.sortBy, s => s.name);\n\t\tconst sortDir = _.map(mergedTemplateDefinition.sortBy, s => s.dir || \"desc\");\n\t\tflatData = _.orderBy(flatData, sortBy, sortDir);\n\t}\n\t\n\t//csv exporter has a bug with undefined values - change to null\n\tflatData = flatData.map( row => {\n\t\treturn _.mapValues(row, v => v === undefined ? null : v )\n\t})\n\n\tif (format === \"xlsx\") {\n\t\treturn exportFlatDataExcel(flatData, mergedTemplateDefinition.template, mergedTemplateDefinition.name)\n\t} else {\n\t\treturn exportFlatDataCSV(flatData, mergedTemplateDefinition.template, mergedTemplateDefinition.name)\n\t}\n}\n\n\nexport default { \n\tflatten, flattenProviders, \n\tdefaultHelperFns, exportSpreadsheet\n}","export default (rows) => {\n\tconst processRow = (row) => {\n\t\treturn row.map( rawValue => {\n\t\t\tlet value = rawValue === null ? \"\" : rawValue.toString();\n\t\t\tif (rawValue instanceof Date)\n\t\t\t\tvalue = rawValue.toLocaleString();\n\t\t\tvalue = value.replace(/\"/g, '\"\"');\n\t\t\tif (value.search(/(\"|,|\\n)/g) >= 0)\n\t\t\t\tvalue = '\"' + value + '\"';\n\t\t\treturn value;\n\t\t}).join(\",\");\n\t};\n\n\tconst csv = rows.map(processRow).join(\"\\n\");\n\treturn new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n}","import _ from \"lodash\";\nimport saveAs from \"file-saver\";\nimport tv4 from \"tv4\";\nimport userSettingsSchema from \"../schemas/user-settings-schema.json\";\n\nfunction buildJSON(providers, githubConfig, redirectUri) {\n\tconst json = {\n\t\tproviders: _.map(providers, p => ({\n\t\t\t...p, lastUpdated: null, data: null\n\t\t}) ),\n\t\tgithubConfig, redirectUri\n\t};\n\treturn JSON.stringify(json, null, 2);\n\n}\n\nfunction download(providers, githubConfig, redirectUri, fileName=\"procure-settings.json\") {\n\tconst json = buildJSON(providers, githubConfig, redirectUri);\n\tconst blob = new Blob(\n\t\t[json], \n\t\t{type: \"application/json;charset=utf-8\"}\n\t);\n    saveAs(blob, fileName);\n}\n\nfunction readFromFile(file, redirectUri, queryProfiles) {\n\tconst reader = new FileReader();\n\treturn new Promise( (resolve, reject) => {\t\n\t\treader.onload = e => resolve(reader.result);\n\t\treader.onerror = e => reject(e);\n\t\treader.readAsText(file);\n\t})\n\t.then( data => {\n\t\ttry {\n\t\t\treturn JSON.parse(data);\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"Unable to read file\")\n\t\t}\n\t})\n\t.then( json => {\n\t\tif (json.redirectUri !== redirectUri)\n\t\t\tthrow new Error(\"Only settings saved from this website can be imported\")\n\t\treturn json;\n\n\t})\n\t.then( json => {\n\t\ttv4.validate(json, userSettingsSchema);\n\t\tif (tv4.error) {\n\t\t\tif (console) console.log(tv4.error);\n\t\t\tthrow new Error(\"Invalid file format: \" + tv4.error.message);\n\t\t}\n\t\treturn json;\n\n\t})\n\t.then( json => {\n\t\t_.each( json.providers, provider => {\n\t\t\tif (!queryProfiles[provider.queryProfile]) \n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Query profile not found: \" + provider.queryProfile\n\t\t\t\t);\n\t\t});\n\t\treturn json;\n\t})\n}\n\nexport default { \n\tbuildJSON, download, readFromFile \n}","import createStore from \"storeon\";\nimport FhirLoader from \"./fhir-loader\";\nimport ConfigLoader from \"./config-loader\";\nimport ZipExporter from \"./zip-exporter\";\nimport GithubExporter from \"./github-exporter\";\nimport SpreadsheetExporter from \"./spreadsheet-exporter\";\nimport UserSettings from \"./user-settings\";\nimport FileExporter from \"./file-exporter\";\nimport zipExporter from \"./zip-exporter\";\n\n//have to use require here since imports need to be at the top level\nlet initialState;\nif (process.env.NODE_ENV !== \"development\") {\n\tinitialState = require(\"./initial-state\");\n} else {\n\tinitialState =  require(\"./initial-state-dev\");\n}\n\nconst fhirLoader = new FhirLoader();\nconst ghExporter = new GithubExporter();\nconst fileExporter = new FileExporter();\nlet simulateTimer;\n\nconst createUniqueId = () => Math.random().toString(36);\nconst actions = store => {\n\tstore.on(\"@init\", () => initialState);\n\tstore.on(\"uiState/set\", (state, uiState) => { \n\t\treturn { uiState }\n\t});\n\tstore.on(\"uiState/merge\", ({ uiState }, newUiState) => {\n\t\treturn {uiState: {...uiState, ...newUiState}}\n\t})\n\tstore.on(\"uiState/incrementCounts\", ({ uiState }, counts) => {\n\t\tObject.keys(counts).forEach( countType => {\n\t\t\tcounts[countType] = counts[countType] + (uiState[countType] || 0)\n\t\t});\t\n\t\treturn {uiState: {...uiState, ...counts}}\n\t})\n\tstore.on(\"wizard/hide\", () => {\n\t\treturn {showWizard: false, uiState: {mode: \"ready\"}}\n\t})\n\tstore.on(\"nonModalUi/merge\", ({ nonModalUi }, newState) => {\n\t\treturn {nonModalUi: {...(nonModalUi ||{}), ...newState}}\n\t});\n\tstore.on(\"refreshDirty\", ({ providers, githubConfig, redirectUri, dirtySnapshot }, reset) => {\n\t\tconst newSnapshot = UserSettings.buildJSON(providers, githubConfig, redirectUri);\n\t\tif (reset) {\n\t\t\treturn {isDirty: false, dirtySnapshot: newSnapshot};\n\t\t} else {\n\t\t\treturn {isDirty: dirtySnapshot === newSnapshot ? false : true};\n\t\t}\n\t})\n\tstore.on(\"providers/add\", ({ providers }, provider) => {\n\t\tif (!provider.id) provider.id = createUniqueId();\n\t\tprovider.selected = true;\n\t\tconsole.log(provider)\n\t\treturn {providers: providers.concat([provider])}\n\t});\n\tstore.on(\"providers/update\", ({ providers }, provider) => {\n\t\treturn {\n\t\t\tproviders: providers.map( p => {\n\t\t\t\treturn (p.id !== provider.id) \n\t\t\t\t\t? p \n\t\t\t\t\t: {...p, ...provider}\n\t\t\t})\n\t\t}\n\t});\n\tstore.on(\"providers/upsert\", (state, provider) => {\n\t\tif (!provider.id) {\n\t\t\tprovider.id = createUniqueId();\n\t\t\tstore.dispatch(\"providers/add\", provider);\n\t\t} else {\n\t\t\tstore.dispatch(\"providers/update\", provider);\n\t\t}\n\t});\n\tstore.on(\"providers/upsertAndLoad\", (state, provider) => {\n\t\tstore.dispatch(\"providers/upsert\", provider);\n\t\tstore.dispatch(\"fhir/loadData\", provider.id);\n\t});\n\tstore.on(\"providers/remove\", ({ providers }, id) => {\n\t\treturn {\n\t\t\tproviders: providers.filter( p => {\n\t\t\t\treturn p.id !== id\n\t\t\t})\n\t\t}\n\t});\n\tstore.on(\"config/load\", (state, endState=\"ready\") => {\n\t\tstore.dispatch(\"uiState/set\", {mode: \"loading\"});\n\t\tconst isDev = process.env.NODE_ENV === \"development\";\n\t\tconst overridePath = isDev\n\t\t\t? \"./config/config-override-dev.json\" \n\t\t\t: \"./config/config-override.json\";\n\n\t\tConfigLoader\n\t\t\t.loadConfigFile(\"./config/config.json\", overridePath, isDev)\n\t\t\t.then( config => {\n\t\t\t\tstore.dispatch(\"config/merge\", config);\n\n\t\t\t\tstore.dispatch(\"uiState/set\", {mode: endState});\n\n\t\t\t\t//initialize content for refresh\n\t\t\t\tstore.dispatch(\"refreshDirty\", true);\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"globalError\", \n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t})\n\t});\n\tstore.on(\"config/merge\", (state, newConfig) => {\n\t\treturn {...state, ...newConfig}\n\t});\n\tstore.on(\"fhir/loadData\", ({ providers, queryProfiles, mimeTypeMappings, ignoreState }, providerId) => {\n\t\tconst provider = providers.find(p => p.id === providerId);\n\t\tconst queryProfile = queryProfiles[provider.queryProfile];\n\t\tconst retryLimit = queryProfiles[provider.queryProfile].retryLimit || 0;\n\t\t\n\t\tconst handleLoadDone = (data) => {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"loaded\",\n\t\t\t\tdata: data,\n\t\t\t\tid: provider.id\n\t\t\t});\n\t\t}\n\n\t\tconst handleStatusUpdate = (url, isError) => {\n\t\t\tif (console) console.log(\"Fetching: \", url);\n\t\t\tstore.dispatch(\"uiState/incrementCounts\", {\n\t\t\t\trequestCount: 1,\n\t\t\t\terrorCount: isError ? 1 : 0,\n\t\t\t})\n\t\t}\n\t\t\n\t\tconst loadFhir = (context) => {\n\t\t\tstore.dispatch(\"uiState/merge\", {submode: \"loading\"});\n\t\t\tfhirLoader.getFHIR(provider, queryProfile, context, true, mimeTypeMappings, retryLimit, handleStatusUpdate)\n\t\t\t\t.then(handleLoadDone)\n\t\t\t\t.catch(handleGlobalError);\n\t\t}\n\n\t\tconst handleGlobalError = (e) => {\n\t\t\t//don't show error if user clicked the cancel button\n\t\t\tif (e.message === \"cancelled\" || e.name === \"AbortError\")\n\t\t\t\treturn;\n\t\t\t\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"loadData\",\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: e.message || e,\n\t\t\t\t\tid: provider.id\n\t\t\t\t});\n\t\t}\n\n\t\tif (!provider.isOpen) {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"authorizing\",\n\t\t\t\tid: provider.id\n\t\t\t});\n\t\t\tfhirLoader.authAndGetFHIR(provider, ignoreState)\n\t\t\t\t.then(loadFhir)\n\t\t\t\t.catch(handleGlobalError);\n\t\t} else {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"loading\",\n\t\t\t\tid: provider.id\t\n\t\t\t});\t\t\n\t\t\tloadFhir()\n\t\t}\n\t});\n\tstore.on(\"fhir/cancelLoad\", (state, endState=\"ready\") =>  {\n\t\tfhirLoader.cancel();\n\t\tstore.dispatch(\"uiState/set\", {mode: endState});\n\t});\n\n\tstore.on(\"export/download\", ({ providers }) => {\n\t\tstore.dispatch(\"nonModalUi/merge\", {isDownloading: true})\n\t\tZipExporter.generateFile(providers)\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"ready\", \n\t\t\t\t\terror: e.message\n\t\t\t\t});\n\t\t\t})\n\t\t\t.finally( () => {\n\t\t\t\tstore.dispatch(\"nonModalUi/merge\", {isDownloading: false})\n\t\t\t});\n\t});\n\tstore.on(\"export/spreadsheet\", ({ providers, spreadsheetTemplates}, params) => {\n\t\tstore.dispatch(\"nonModalUi/merge\", {isExportingSheet: true})\n\t\tSpreadsheetExporter.exportSpreadsheet(\n\t\t\tproviders, spreadsheetTemplates, params.templateId, params.format\n\t\t)\n\t\t.catch( e => {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"globalError\", \n\t\t\t\terror: e\n\t\t\t});\n\t\t})\n\t\t.finally( () => {\n\t\t\tstore.dispatch(\"nonModalUi/merge\", {isExportingSheet: false})\n\t\t});\n\t});\n\n\tstore.on(\"export/github\", ( {githubConfig, providers} ) => {\n\t\t\n\t\tconst statusCallback = (status, statusUrl) => {\n\t\t\tstore.dispatch(\"uiState/merge\", { status, statusUrl });\n\t\t}\n\n\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\tsubmode: \"push\",\n\t\t\terror: null\n\t\t});\n\n\t\tghExporter.export(\n\t\t\tproviders, githubConfig, statusCallback\n\t\t)\n\t\t\t.then( () => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: null\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"githubExport\",\n\t\t\t\t\terror: e.message === \"canceled\" ? null : e.message\n\t\t\t\t});\n\t\t\t});\n\n\t})\n\n\tstore.on(\"export/github/cancel\", () => {\n\t\tghExporter.cancel();\n\t\tstore.dispatch(\"uiState/set\", { \n\t\t\tmode: \"githubExport\"\n\t\t});\n\t});\n\n\tstore.on(\"export/upload\", ({upload})  => {\n\t\tstore.dispatch(\"uiState/set\", { \n\t\t\tmode: \"fileUpload\",\n\t\t\tsubmode: \"getManifest\",\n\t\t\tstatus: \"Preparing to send data\"\n\t\t});\n\n\t\t//check whitelist if url doesn't come from config file\n\t\tif (upload.qsManifestUrl) {\n\t\t\tconst isValidUrl = fileExporter.isValidUrl(upload.manifestUrl, upload.whitelist);\n\t\t\tif (!isValidUrl) return store.dispatch(\"uiState/merge\", {\n\t\t\t\tsubmode: \"error\",\n\t\t\t\tstatus: \"Url manifest location not in whitelist: \" + upload.manifestUrl\n\t\t\t});\n\t\t}\n\n\t\t//if upload url is in config and no overriding manifest url, don't fetch manifest\n\t\tif (upload.uploadUrl && !upload.manifestUrl) {\n\t\t\treturn store.dispatch(\"uiState/merge\", {\n\t\t\t\tsubmode: \"preUpload\"\n\t\t\t});\n\t\t}\n\n\t\t//fetch manifest to get upload info\n\t\tfileExporter.getManifest(upload.manifestUrl)\n\t\t\t.then( data => {\n\t\t\t\tstore.dispatch(\"config/merge\", {\n\t\t\t\t\tupload: {\n\t\t\t\t\t\tmanifestUrl: upload.manifestUrl,\n\t\t\t\t\t\tlabel: upload.label,\n\t\t\t\t\t\t...data\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"preUpload\"\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: \"Unable to load manifest at \" + upload.manifestUrl\n\t\t\t\t});\n\t\t\t});\n\t});\n\t\n\tstore.on(\"export/upload/cancel\", ({upload}) => {\n\t\tif (upload.simulate)\n\t\t\treturn window.clearTimeout(simulateTimer);\n\t\tfileExporter.cancel();\n\t});\n\n\tstore.on(\"export/upload/send\", ({upload, providers}) => {\n\t\tstore.dispatch(\"uiState/set\", {\n\t\t\tmode: \"fileUpload\", \n\t\t\tsubmode: \"uploading\",\n\t\t\tstatus: \"Uploading Data\"\n\t\t});\n\n\t\tif (upload.simulate) {\n\t\t\treturn simulateTimer = window.setTimeout(() => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"postUpload\"\n\t\t\t\t});\n\t\t\t}, 2000);\n\t\t}\n\n\t\tzipExporter.exportProvidersAsBlob(providers)\n\t\t\t.then( file => {\n\t\t\t\treturn fileExporter.putFile(upload.uploadUrl, file)\n\t\t\t})\n\t\t\t.then( () => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"postUpload\"\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tif (err.name === \"AbortError\") return;\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: err.message.toString()\n\t\t\t\t});\n\t\t\t})\n\n\t});\n\n\tstore.on(\"export/settings\", ({providers, githubConfig, redirectUri}) => {\n\t\tUserSettings.download(providers, githubConfig, redirectUri);\n\t});\n\n\tstore.on(\"import/settings\", ({redirectUri, queryProfiles, noCustomEndpoints}, file) => {\n\t\tUserSettings.readFromFile(file, redirectUri, queryProfiles)\n\t\t\t.then( config => {\n\t\t\t\tif (noCustomEndpoints) config.providers = [];\n\t\t\t\t//unloading data controls prior to modifying config to avoid\n\t\t\t\t//timing error from control update and unmount at same time\n\t\t\t\tstore.dispatch(\"uiState/set\", {mode: \"loading\"});\n\t\t\t\tstore.dispatch(\"config/merge\", config);\n\t\t\t\tstore.dispatch(\"uiState/set\", { mode: \"ready\" });\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"ready\", \n\t\t\t\t\terror: e.message\n\t\t\t\t})\n\t\t\t})\n\t});\n\n}\n\nconst store = createStore([actions]);\n\nexport default store;","import Smart from \"../smart/smart-core\";\nimport SmartPopup from \"../smart/smart-popup\";\nimport FHIR from \"../smart/fhir\";\n\nexport default class FhirLoader {\n\t\n\tresetAbortController() {\n\t\tthis.controller = new AbortController();\n\t\tthis.signal = this.controller.signal;\t\n\t}\n\n\tcancel() {\n\t\tif (this.popup) {\n\t\t\tthis.popup.cancel();\n\t\t} else {\n\t\t\tthis.controller.abort();\n\t\t}\n\t}\n\n\tmergeAndDeDupeData(data) {\n\t\tlet uniqueUrls = {};\n\t\tlet files = [];\n\t\tlet entry = [];\n\t\tlet errorLog = [];\n\t\tlet errorCount = 0;\n\t\tdata.forEach( queryResult => {\n\t\t\tqueryResult.entry.forEach( ent => {\n\t\t\t\t//prevent duplicates\n\t\t\t\tif (uniqueUrls[ent.fullUrl]) return;\n\t\t\t\tuniqueUrls[ent.fullUrl] = true;\n\t\t\t\tentry.push(ent)\n\t\t\t})\n\t\t\tfiles = files.concat(queryResult.files || []);\n\t\t\terrorLog = errorLog.concat(queryResult.errorLog || []);\n\t\t\terrorCount += queryResult.errorCount || 0;\n\t\t})\n\t\treturn {entry, files, errorLog, errorCount}\n\t}\n\n\tgetFHIR(provider, queryProfile, context, allowErrors=true, mimeTypeMappings={}, retryLimit, statusCallback) {\n\t\tconst patientId = context ? context.patient : provider.patient;\n\n\t\tconst fetchQuery = (query) => {\n\t\t\tlet params = {...query.params}\n\t\t\tObject.keys(params).forEach(k => {\n\t\t\t\tif (Array.isArray(params[k])) params[k] = params[k].join(\",\");\n\t\t\t\tparams[k] = params[k].toString().replace(\"{{patientId}}\", patientId);\n\t\t\t});\n\t\t\tconst path = query.path.replace(/\\{patientId\\}/g, patientId);\n\n\t\t\treturn FHIR.getResourcesByQuery({\n\t\t\t\tfhirEndpoint: provider.fhirEndpoint, \n\t\t\t\tquery: {...query, params, path, fhirVersion: queryProfile.fhirVersion},\n\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\tretryLimit,\n\t\t\t\tallowErrors,\n\t\t\t\tstatusCallback,\n\t\t\t\tsignal: this.signal\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.containReferences) return data;\n\n\t\t\t\treturn FHIR.followAndEmbedReferences({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.containReferences,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tallowErrors,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then( result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.entry = result.entry;\n\t\t\t\t\treturn data;\n\t\t\t\t}); \n\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.retrieveReferences) return data;\n\n\t\t\t\treturn FHIR.followReferences({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.retrieveReferences,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tallowErrors,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then( result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.entry = data.entry.concat(result.entry);\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.downloadAttachments) return data;\n\t\t\t\treturn FHIR.findAndDownloadAttachments({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.downloadAttachments,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tmimeTypeMappings,\n\t\t\t\t\tallowErrors: true,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then(result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog || []);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.files = result.files;\n\t\t\t\t\tdata.entry = FHIR.attachmentsToFilenames({\n\t\t\t\t\t\tentry: data.entry, files: result.files, paths: query.downloadAttachments\n\t\t\t\t\t});\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\n\t\tthis.resetAbortController();\n\n\t\t//sequential query\n\t\t// return queryProfile.queries.reduce((promiseChain, currentQuery) => {\n\t\t// \treturn promiseChain.then( chainResults =>\n\t\t// \t\tfetchQuery(currentQuery) .then( currentResult =>\n\t\t// \t\t\t[ ...chainResults, currentResult ]\n\t\t// \t\t)\n\t\t// \t);\n\t\t// }, Promise.resolve([]))\n\t\t// \t.then( this.mergeAndDeDupeData )\n\n\t\t//parallel (moderated by browser)\n\t\treturn Promise.all( queryProfile.queries.filter(q => q.skip !== true).map(fetchQuery) )\n\t\t\t.then( this.mergeAndDeDupeData )\n\t}\n\t\n\tauthAndGetFHIR(provider, ignoreState) {\n\t\t//make available to cancel function\n\t\tthis.popup = new SmartPopup(provider);\n\t\treturn Smart.getAuthEndpoints(provider.fhirEndpoint)\n\t\t\t.then(authEndpoints => {\n\t\t\t\treturn this.popup.authorize(authEndpoints, ignoreState);\n\t\t\t})\n\t\t\t.then(context => {\n\t\t\t\tthis.popup = null;\n\t\t\t\treturn context;\n\t\t\t}).catch(e => {\n\t\t\t\tthis.popup = null;\n\t\t\t\tthrow e;\n\t\t\t});\n\n\t}\n\n}\n","import gh from \"./github-api\";\nimport sanitizeFilename from \"sanitize-filename\";\nimport _ from \"lodash\";\n\nexport default class GithubExporter {\n\n\tcancel() {\n\t\tthis.canceled = true;\n\t}\n\n\tblobToBase64(blob) {\n\t\treturn new Promise( (resolve, reject) => {\n\t\t\tlet reader = new FileReader();\n\t\t\treader.onload = () => {\n\t\t\t\tconst dataUrl = reader.result;\n\t\t\t\tconst base64 = dataUrl.split(',')[1];\n\t\t\t\tresolve(base64);\n\t\t\t};\n\t\t\treader.onerror = reject;\n\t\t\treader.readAsDataURL(blob);\n\t\t});\n\t}\n\t\n\tbuildProviderTree(provider, folder) {\t\n\t\tconst createBlob = (content, fileName, encoding=\"utf-8\") => {\n\t\t\tif (this.canceled) throw new Error(\"Canceled\");\n\n\t\t\tif (this.statusCb)\n\t\t\t\tthis.statusCb(\"Adding \" + folder + \"/\" + fileName);\n\n\t\t\treturn gh.createBlob(this.config, {content, encoding})\n\t\t\t\t.then( blob => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsha: blob.sha,\n\t\t\t\t\t\tpath: folder + \"/\" + fileName,\n\t\t\t\t\t\tmode: \"100644\", //file\n\t\t\t\t\t\ttype: \"blob\"\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t};\n\n\t\tconst buildResourceTree = (bundles) => {\n\t\t\treturn Promise.all(\n\t\t\t\t_.map( bundles, (bundle, resourceType) => {\n\t\t\t\t\treturn createBlob(\n\t\t\t\t\t\tJSON.stringify(bundle, null, 2),\n\t\t\t\t\t\tresourceType+\".json\"\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\n\t\tconst buildFileTree = (files) => {\n\t\t\treturn Promise.all(\n\t\t\t\t_.map( files, file => {\n\t\t\t\t\treturn this.blobToBase64(file.blob)\n\t\t\t\t\t\t.then( base64 => {\n\t\t\t\t\t\t\treturn createBlob(base64, file.fileName, \"base64\") \n\t\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\n\t\tconst buildErrorLogTree = (errorLog) => {\n\t\t\treturn !errorLog.length \n\t\t\t\t? Promise.resolve([])\n\t\t\t\t: createBlob(\n\t\t\t\t\t\tJSON.stringify(errorLog, null, 2),\n\t\t\t\t\t\t\"error_log.json\"\n\t\t\t\t\t).then( blob => [blob] );\n\t\t}\n\n\t\t//TODO: share bundle generation code with ZipExporter\n\t\tconst bundles = _.chain(provider.data.entry)\n\t\t\t.groupBy(e => e.resource.resourceType)\n\t\t\t.mapValues(entry => {\n\t\t\t\treturn {\n\t\t\t\t\tentry: _.map(entry, e => ({fullUrl: e.fullUrl, resource: e.resource}) ),\n\t\t\t\t\ttotal: entry.length, \n\t\t\t\t\ttype:\"collection\",\n\t\t\t\t\tresourceType: \"Bundle\"\n\t\t\t\t}\n\t\t\t}).value();\n\n\t\treturn Promise.all([\n\t\t\tbuildResourceTree(bundles),\n\t\t\tbuildFileTree(provider.data.files),\n\t\t\tbuildErrorLogTree(provider.data.errorLog)\n\t\t]).then( trees => _.flatten(trees) );\n\n\t}\n\t\n\tbuildTree(baseTree, allProviders) {\n\t\tconst providers = _.filter( allProviders, p => {\n\t\t\treturn p.selected && p.data && p.data.entry && (p.data.entry.length || p.data.errorLog.length)\n\t\t})\n\t\tconst folders = _.map(providers, p => {\n\t\t\treturn sanitizeFilename(p.name);\n\t\t})\n\t\tconst tree = _.filter(baseTree.tree, item => {\n\t\t\tconst clear = folders.find( f => item.type === \"tree\" && item.path === f);\n\t\t\treturn clear ? false : true;\n\t\t});\n\t\treturn Promise.all( \n\t\t\t_.map( providers, (provider, i) => {\n\t\t\t\treturn this.buildProviderTree(provider, folders[i]);\n\t\t\t})\n\t\t).then( newTrees => {\n\t\t\treturn { \n\t\t\t\t...baseTree, \n\t\t\t\ttree: tree.concat(_.flatten(newTrees))\n\t\t\t}\n\t\t})\n\t}\n\n\tprepareCommit(providers) {\n\t\tlet lastCommit;\n\t\tif (this.statusCb)\n\t\t\tthis.statusCb(\"Retrieving repository information\");\n\n\t\treturn gh.getLastCommit(this.config)\n\t\t\t.then( commit => {\n\t\t\t\tlastCommit = commit;\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn gh.getTree(this.config, commit);\n\t\t\t})\n\t\t\t.then( commit => {\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn this.buildTree(commit, providers) \n\t\t\t})\n\t\t\t.then( tree => {\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn gh.createTree(this.config, tree) \n\t\t\t})\n\t\t\t.then( tree => ({ tree, lastCommit }) );\n\t}\n\n\texport(providers, githubConfig, statusCb, branchName) {\n\t\tthis.config = githubConfig;\n\t\tthis.canceled = false;\n\t\tthis.statusCb = statusCb;\n\t\treturn githubConfig.pullRequest \n\t\t\t? this.commitPullRequest(providers, branchName)\n\t\t\t: this.commitToMaster(providers);\n\t}\n\n\tcommitToMaster(providers) {\n\t\treturn this.prepareCommit(providers)\n\t\t\t.then( ({tree, lastCommit}) => {\n\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\n\t\t\t\tif (this.statusCb)\n\t\t\t\t\tthis.statusCb(\"Committing files\");\n\n\t\t\t\treturn gh.commitTree(\n\t\t\t\t\tthis.config,\n\t\t\t\t\ttree,\n\t\t\t\t\t\"ProcureBot Commit\",\n\t\t\t\t\tlastCommit\n\t\t\t\t).then( () => {\n\t\t\t\t\tif (this.statusCb)\n\t\t\t\t\t\tthis.statusCb(\"Data has been committed to master branch\");\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tcommitPullRequest(providers, branchName) {\n\t\tif (!branchName) \n\t\t\tbranchName = \"Procure/\" + \n\t\t\t\t(new Date().toISOString()).replace(/:/g, \"-\");\n\n\t\treturn this.prepareCommit(providers)\n\t\t\t.then( ({tree, lastCommit}) => {\n\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\n\t\t\t\tif (this.statusCb)\n\t\t\t\t\tthis.statusCb(\"Creating pull request\");\n\n\t\t\t\treturn gh.commitTreeToPullRequest(\n\t\t\t\t\tthis.config,\n\t\t\t\t\ttree,\n\t\t\t\t\t\"ProcureBot commit\",\n\t\t\t\t\tlastCommit,\n\t\t\t\t\t\"ProcureBot pull request\",\n\t\t\t\t\tbranchName\n\t\t\t\t).then( pull => {\n\t\t\t\t\tif (this.statusCb)\n\t\t\t\t\t\tthis.statusCb(\"A new pull request has been created\", pull.html_url);\n\t\t\t\t})\n\t\t\t});\t\t\n\t}\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Modal, ModalHeader, ModalBody, ModalFooter, Form, FormGroup, Label, Input, FormText, FormFeedback} from 'reactstrap';\nimport Select, { createFilter } from \"react-select\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\t//app state\n\tconst {\n\t\tuiState, providers, queryProfiles, credentials,\n\t\torganizations, orgDefaults, redirectUri, noCustomEndpoints, dispatch\n\t } = useStoreon(\n\t\t\"uiState\", \"providers\", \"queryProfiles\", \"credentials\",\n\t\t\"organizations\", \"orgDefaults\", \"redirectUri\", \"noCustomEndpoints\"\n\t );\n\n\t//component state\n\tconst [provider, setProvider] = useState({});\n\tconst [validation, setValidation] = useState({});\n\tconst [showDetails, setShowDetails] = useState(false);\n\t\n\tconst orgOptions = (\n\t\tnoCustomEndpoints ? [] : [{label: \"Custom Endpoint\", value: \"custom\"}] \n\t).concat(\n\t\t_.chain(organizations)\n\t\t\t.map( o => ({label: o.name, value: o.orgId || o.fhirEndpoint}) )\n\t\t\t.sortBy( o => o.label )\n\t\t\t.value()\n\t);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode === 27) handleCancel(e);\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel]);\n\n\tuseEffect( () => {\n\t\tif (!provider.id && uiState.id && uiState.mode === \"editProvider\") {\n\t\t\tconst currentProvider = providers.find(p => p.id === uiState.id);\n\t\t\tsetProvider(currentProvider)\n\t\t\tsetValidation({});\n\t\t\tsetShowDetails(currentProvider && currentProvider.orgId === \"custom\");\n\t\t}\n\t}, [uiState.id, uiState.mode, provider.id, providers])\n\n\tconst handleSubmit = (e, skipRefresh) => {\n\t\te.preventDefault();\n\n\t\tconst errors = validate(provider);\n\t\tif (errors) return setValidation(errors);\n\n\t\tif (skipRefresh) {\n\t\t\tdispatch(\"providers/upsert\", provider);\n\t\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t\t} else {\n\t\t\tdispatch(\"providers/upsertAndLoad\", provider);\n\t\t}\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleOrgSelection = (selection) => {\n\t\tlet orgConfig;\n\t\t//get default details\n\t\tif (selection.value !== \"custom\") {\n\t\t\torgConfig = organizations.find( o => selection.value === o.orgId || selection.value === o.fhirEndpoint );\n\t\t\tconst defaults = orgDefaults[orgConfig.defaultId] || {};\n\t\t\tif (orgConfig.defaultId !== undefined) orgConfig = {...defaults, ...orgConfig};\n\t\t} else {\n\t\t\torgConfig = {\n\t\t\t\tname: selection.label\n\t\t\t}\n\t\t}\n\t\t//get credential details if included by reference\n\t\tif (orgConfig.credentialId)\n\t\t\torgConfig = {...credentials[orgConfig.credentialId], ...orgConfig};\n\n\t\t//update provider with new defaults\n\t\tconst updatedProvider = {\n\t\t\tscope: [\"patient/*.read\", \"launch/patient\"],\n\t\t\tqueryProfile: \"argonaut_spec\",\n\t\t\t...orgConfig,\n\t\t\tredirectUri,\n\t\t\tid: provider.id,\n\t\t\torgId: selection.value\n\t\t}\n\t\t//show form if there's any missing data\n\t\tsetShowDetails(validate(updatedProvider));\n\t\tsetProvider(updatedProvider);\n\t}\n\n\tconst validate = (provider) => {\n\t\tlet validation = {};\n\t\tconst isInvalidUrl = (url) => !/^https?:\\/\\//.test(url.toLowerCase());\n\n\t\tif (provider.isOpen) {\n\t\t\t[\"name\", \"patient\"].forEach( f => { if (!provider[f]) validation[f] = \"Required\" })\n\t\t} else {\n\t\t\t[\"name\", \"clientId\", \"scope\"].forEach( f => { if (!provider[f]) validation[f] = \"Required\" })\n\t\t}\n\n\t\tif (isInvalidUrl(provider.fhirEndpoint || \"\"))\n\t\t\tvalidation.fhirEndpoint = \"Valid URL Required\";\n\t\t\n\t\tif (!provider.isOpen && isInvalidUrl(provider.redirectUri || \"\"))\n\t\t\tvalidation.redirectUri = \"Valid URL Required\";\n\n\t\treturn Object.keys(validation).length > 0 ? validation : null;\n\t}\n\n\tconst renderOrgSelector = () => {\n\t\t//workaround since component uses both the value and label to match and we just want to store the value\n\t\tconst value = provider.orgId ? orgOptions.find(o => o.value === provider.orgId) : null;\n\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"organization\">Healthcare Organization</Label>\n\t\t\t<Select id=\"organization\" autoFocus\n\t\t\t\t//performance improvement on autocomplete\n\t\t\t\tfilterOption={createFilter({ignoreAccents: false})}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={handleOrgSelection}\n\t\t\t\tisSearchable={true}\n\t\t\t\toptions={orgOptions}\n\t\t\t\tdefaultMenuIsOpen={provider.id ? false : true}\n\t\t\t/>\n\t\t</FormGroup>\n\t}\n\n\tconst renderTextInput = (title, property, type, isRequired, instructions, valueFn, onChangeFn) => {\n\t\tconst formText = instructions ? <FormText color=\"muted\">{instructions}</FormText> : \"\";\n\t\tconst errorText = validation[property] ? <FormFeedback>{validation[property]}</FormFeedback> : \"\";\n\t\tconst onChange = onChangeFn || ( e => {setProvider({...provider, [property]: e.target.value}) });\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"{property}\">{title}</Label>\n\t\t\t<Input\n\t\t\t\tvalue={valueFn ? valueFn() : provider[property] || \"\"}\n\t\t\t\ttype={type || \"text\"}\n\t\t\t\tid={property}\n\t\t\t\tonChange={onChange}\n\t\t\t\tinvalid={validation[property] ? true : false}\n\t\t\t\trequired={isRequired}\n\t\t\t/>\n\t\t\t{formText}\n\t\t\t{errorText}\n\t\t</FormGroup>\n\t}\t\n\n\tconst renderProfileSelector = () => {\n\t\tconst profileOptions = Object.keys(queryProfiles).map(q => {\n\t\t\treturn <option value={q} key={q}>{queryProfiles[q].title}</option>\n\t\t});\n\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"profile\">Profile</Label>\n\t\t\t<Input type=\"select\"\n\t\t\t\tvalue={provider.queryProfile || \"argonaut_spec\"}\n\t\t\t\tonChange={ e=> setProvider({...provider, queryProfile: e.target.value}) }\n\t\t\t\tname=\"profile\"\n\t\t\t> {profileOptions} </Input>\n\t\t</FormGroup>\n\t}\n\n\tconst openCheckbox = <FormGroup check>\n\t\t<Input type=\"checkbox\"\n\t\t\tid=\"isOpen\"\n\t\t\tchecked={provider.isOpen === true || provider.isOpen === \"true\" || false}\n\t\t\tonChange={e => setProvider({...provider, isOpen:!provider.isOpen})}\n\t\t/>\n\t\t<Label for=\"isOpen\">Open Endpoint</Label>\n\t</FormGroup>\n\n\tconst detailsLink = !noCustomEndpoints && <FormGroup>\n\t\t<a href=\"#\" onClick={e => setShowDetails(true)} >\n\t\t\t{\"Show Configuration Details\"}\n\t\t</a>\n\t</FormGroup>\n\n\tconst shortForm = <>\n\t\t{ renderOrgSelector() }\n\t\t{ renderTextInput(\"Title\", \"name\", \"text\", true) }\n\t</>\n\n\tconst openDetails = <>\n\t\t{ renderTextInput(\"FHIR Endpoint URL\", \"fhirEndpoint\", \"url\", true) }\n\t\t{ openCheckbox }\n\t\t{ renderProfileSelector() }\n\t\t{ renderTextInput(\"Patient Id\", \"patient\", \"text\", true)}\n\t</>\n\t\n\tconst secureDetails =  <>\n\t\t{ renderTextInput(\"FHIR Endpoint URL\", \"fhirEndpoint\", \"url\", true) }\n\t\t{ openCheckbox }\n\t\t{ renderProfileSelector() }\n\t\t{ renderTextInput(\"Client Id\", \"clientId\", \"text\", true) }\n\t\t{ renderTextInput(\"Client Secret (if applicable)\", \"clientSecret\", \"text\", true) }\n\t\t{ renderTextInput(\"Redirect URL\", \"redirectUri\", \"url\", true) }\n\t\t{ renderTextInput(\n\t\t\t\"Scope\", \"scope\", \"text\", true,  \"separate scopes with spaces\",\n\t\t\t() => (provider.scope || []).join(\" \"),\n\t\t\te => setProvider({...provider, scope: e.target.value.split(/\\s+/)})\n\t\t)}\n\t</>\n\n\treturn  <Modal isOpen={true} fade={false} backdrop={true} autoFocus={false}>\n\t\t<ModalHeader>{provider.id ? \"Update Provider\" : \"Add Provider\"} </ModalHeader>\n\t\t<ModalBody><Form onSubmit={handleSubmit} className=\"needs-validation\" noValidate>\n\t\t\t{ shortForm }\n\t\t\t{ !showDetails && provider.orgId ? detailsLink : null }\n\t\t\t{ showDetails && provider.isOpen ? openDetails : null }\n\t\t\t{ showDetails && !provider.isOpen ? secureDetails : null }\n\t\t</Form></ModalBody>\n\t\t<ModalFooter>\n\t\t\t<div className=\"mr-auto\"><a href=\"#\" onClick={handleCancel}>Cancel</a></div>\n\t\t\t<Button color=\"outline-secondary\" onClick={e => handleSubmit(e, true)}>Save</Button>\n\t\t\t<Button color=\"primary\" style={{marginLeft: \"1em\"}} onClick={handleSubmit}>Save and Load Records</Button>\n\t\t</ModalFooter>\n\t</Modal>\n\n}","import React from \"react\";\nimport {format} from \"timeago.js\";\n\nexport default class TimeAgo extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state= {timeAgo: format(this.props.time)}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.interval = setInterval(() => {\n\t\tthis.setState({timeAgo: format(this.props.time)});\n\t\t}, (this.props.refreshMinutes||1)*60000);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tclearInterval(this.interval);\n\t}\n\n\trender() {\n\t\treturn this.state.timeAgo\n\t}\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport TimeAgo from \"./TimeAgo\"\nimport { Button, CardBody, Card, Row, Col } from \"reactstrap\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faPlus, faTrash, faEdit, faCheckSquare } from \"@fortawesome/free-solid-svg-icons\"\nimport { faSquare } from \"@fortawesome/free-regular-svg-icons\"\n\nexport default () => {\n\n\tconst { providers, dispatch } = useStoreon(\"providers\");\n\n\tconst handleDeleteProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/remove\", id);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleEditProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {\n\t\t\tmode: \"editProvider\", id\n\t\t});\n\t}\n\n\tconst handleLoadRecords = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/loadData\", id);\n\t}\n\n\tconst handleAddProvider = (e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\tconst toggleProviderSelection = (id, newValue, e) => {\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: id, selected: newValue\n\t\t});\n\t}\n\n\tconst pluralizeEn = (text, len) => len === 1 ? text : text+\"s\";\n\n\tconst renderCard = (provider) => {\n\n\n\t\tconst renderDataDetails = () => <p>\t\n\t\t\t{ provider.data.entry.length} { pluralizeEn(\"resource\", provider.data.entry.length) }{\" | \"}\n\t\t\t{ provider.data.files.length} { pluralizeEn(\"file\", provider.data.files.length) }{\" | \"}\n\t\t\t{ provider.data.errorLog.length} { pluralizeEn(\"error\", provider.data.errorLog.length) }\n\t\t\t<br />loaded <TimeAgo time={provider.lastUpdated} />\n\t\t</p>\n\n\t\tconst controls = <div>\n\t\t\t<div className=\"float-right\">\n\t\t\t\t<a href=\"#\" \n\t\t\t\t\tonClick={e => handleEditProvider(provider.id, e)}\n\t\t\t\t\ttitle=\"Edit Provider\"\n\t\t\t\t>\n\t\t\t\t\t<FontAwesomeIcon icon={faEdit} color=\"#6c757d\" className=\"mx-2\" />\n\t\t\t\t</a>\n\n\t\t\t\t<a href=\"#\" \n\t\t\t\t\tonClick={e => handleDeleteProvider(provider.id, e)}\n\t\t\t\t\ttitle=\"Delete Provider\"\n\t\t\t\t>\n\t\t\t\t\t<FontAwesomeIcon icon={faTrash} color=\"#6c757d\" className=\"mx-2\" />\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<a href=\"#\" \n\t\t\t\tstyle={{fontWeight: !provider.lastUpdated ? \"bold\" : \"normal\"}}\n\t\t\t\tonClick={e => handleLoadRecords(provider.id, e)}>\n\t\t\t\t{provider.lastUpdated ? \"re\" : \"\"}load records\n\t\t\t</a>\n\t\t</div>\n\n\t\treturn <Card style={{margin:\"0 1rem 1rem 0\"}} key={provider.id}>\n\t\t\t<CardBody><Row>\n\t\t\t\t<Col xs={{size: \"auto\"}} className=\"mr-0 pr-1 text-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<input type=\"checkbox\"\n\t\t\t\t\t\t\tstyle={{visibility: \"hidden\", width:0, height:0}}\n\t\t\t\t\t\t\tchecked={!!provider.selected} \n\t\t\t\t\t\t\tid={\"selection-\"+ provider.id}\n\t\t\t\t\t\t\tonChange={e => toggleProviderSelection(provider.id, !provider.selected)} \n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label htmlFor={\"selection-\"+ provider.id}>\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={!!provider.selected ? faCheckSquare : faSquare} size=\"lg\" color={!!provider.selected ? \"green\" : \"black\"} />\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</Col><Col>\n\t\t\t\t\t<p className=\"font-weight-bold\" \n\t\t\t\t\t\tstyle={{marginBottom: \".25rem\", cursor: \"pointer\", display:\"inline-block\"}}\n\t\t\t\t\t\tonClick={e => toggleProviderSelection(provider.id, !provider.selected, e)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{provider.name}\n\t\t\t\t\t</p>\n\t\t\t\t\t\t{ provider.lastUpdated && renderDataDetails() }\n\t\t\t\t\t\t{ controls }\n\t\t\t\t</Col>\n\t\t\t</Row></CardBody>\n\t\t</Card>\n\n\t};\n\n\treturn <div>\n\t\t<div style={{marginBottom: \"1.5rem\"}}>\n\t\t\t<Button color=\"success\"\n\t\t\t\tstyle={{marginRight: \"1rem\"}}\n\t\t\t\tonClick={handleAddProvider}\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faPlus} className=\"mr-2\" />\n\t\t\t\tAdd Provider\n\t\t\t</Button>\t\n\t\t</div>\n\t\t{ providers.map(renderCard) }\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Spinner, Modal, ModalBody, ModalFooter} from 'reactstrap';\nimport { saveAs } from \"file-saver\";\n\nexport default () => {\n\n\tconst { uiState, providers, dispatch } = useStoreon(\"uiState\", \"providers\");\n\n\tconst provider =  useMemo( () => {\n\t\treturn providers.find(p => p.id === uiState.id)\n\t}, [uiState.id, providers]);\n\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/cancelLoad\");\n\t}, [dispatch]);\n\n\tconst handleClose = useCallback( e => {\n\t\tif (e) e.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode  === \"authorizing\" || uiState.submode === \"loading\") {\n\t\t\t\thandleCancel(e);\n\t\t\t} else {\n\t\t\t\thandleClose(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel, handleClose, uiState.submode]);\n\n\tconst handleSave = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: provider.id,\n\t\t\tlastUpdated: new Date(),\n\t\t\tdata: uiState.data\n\t\t});\n\t\thandleClose();\n\t}\n\n\tconst handleLogDownload = e => {\n\t\te.preventDefault();\n\t\tconst blob = new Blob(\n\t\t\t[JSON.stringify(uiState.data.errorLog, null, 2)], \n\t\t\t{type: \"application/json\"}\n\t\t);\n\t\tsaveAs(blob, \"errors.json\");\n\t}\n\t\n\tconst renderAuthorizing = () => <div>\n\t\t<h5>Waiting for authorization...</h5>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst pluralizeEn = (text, len) => len === 1 ? text : text+\"s\";\n\n\tconst renderLoading = () => <div>\n\t\t<h5>\n\t\t\t{uiState.requestCount} {pluralizeEn(\"request\", uiState.requestCount)} \n\t\t\t&nbsp; / &nbsp;\n\t\t\t{uiState.errorCount} {pluralizeEn(\"error\", uiState.errorCount)}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderLoaded = () => <div>\n\t\t<h5>\n\t\t\t{uiState.data.entry.length} {pluralizeEn(\"resource\", uiState.data.entry.length)} retrieved<br/>\n\t\t\t{uiState.data.files.length || \"No\"} {pluralizeEn(\"attachment\", uiState.data.files.length)} downloaded<br/>\n\t\t\t{uiState.data.errorLog.length || \"No\"} {pluralizeEn(\"error\", uiState.data.errorLog.length)} occurred\n\t\t</h5>\n\t</div>\n\n\tconst renderGlobalError = () => <div>\n\t\t<h5 style={{padding: \"1rem 0\", color: \"red\"}}>An error occurred: { uiState.status }</h5>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleClose}>Close</Button>\n\t\t</div>\n\t</div>\n\n\t\n\tconst renderLoadedButtons = () => {\n\t\tconst downloadLink = uiState.data.errorLog.length > 0 && \n\t\t\t<div className=\"mr-auto\"><a href=\"#\" onClick={handleLogDownload}>Download error log</a></div>;\n\t \treturn <ModalFooter>\n\t\t\t{downloadLink}\n\t\t\t<Button color=\"outline-secondary\" onClick={handleClose}>Cancel</Button>\n\t\t\t<Button color=\"primary\" style={{marginLeft: \"1em\"}} onClick={handleSave}>Save</Button>\n\t\t</ModalFooter>\n\t}\n\n\treturn <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalBody style={{textAlign: \"center\"}}>\n\t\t\t<h3>{provider.name}</h3>\n\t\t\t{ uiState.submode === \"authorizing\" && renderAuthorizing() }\n\t\t\t{ uiState.submode === \"loading\" && renderLoading() }\n\t\t\t{ uiState.submode === \"loaded\" && renderLoaded() }\n\t\t\t{ uiState.submode === \"error\" && renderGlobalError() }\n\t\t</ModalBody>\n\t\t{ uiState.submode === \"loaded\" && renderLoadedButtons() }\t\n\t</Modal>\n\n\n}","import React from \"react\";\nimport {Spinner} from 'reactstrap';\n\nexport default () => {\n\n\treturn <div className=\"text-center\" style={{margin:\"3rem\"}}>\n\t\t<Spinner style={{ width:\"3rem\", height:\"3rem\", margin:\"1rem\"}} />\n\t\t<h4>Loading</h4>\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {\n\tButton, Spinner, Col, Row, \n\tForm, FormGroup, Modal, ModalHeader, \n\tModalBody, ModalFooter, Label, \n\tInput, Container, Alert\n} from 'reactstrap';\n\nexport default () => {\n\t//app state\n\tconst {uiState, githubConfig, dispatch} = useStoreon(\"uiState\", \"githubConfig\");\n\n\t//component state\n\tconst [showInstructions, setShowInstructions] = useState();\n\n\tconst handleHideDialog = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"})\n\t}, [dispatch]);\n\n\tconst handleCancelExport = useCallback( e => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/github/cancel\");\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode !== \"push\") {\n\t\t\t\thandleHideDialog(e);\n\t\t\t} else {\n\t\t\t\thandleCancelExport(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancelExport, handleHideDialog]);\n\t\n\tconst handleSubmit = e => {\n\t\te.preventDefault()\n\t\tif (!githubConfig.token || !githubConfig.owner || !githubConfig.project) {\n\t\t\tdispatch(\"uiState/merge\", {\n\t\t\t\terror: \"Please enter a personal access token, repository owner and repository project to continue.\"\n\t\t\t});\n\t\t} else {\n\t\t\tdispatch(\"export/github\");\n\t\t}\n\t}\n\n\tconst handleFieldChange = (fieldName, e) => {\n\t\tconst value = fieldName === \"pullRequest\"\n\t\t\t? e.target.value === \"true\"\n\t\t\t: e.target.value;\n\t\tdispatch(\"config/merge\", {\n\t\t\tgithubConfig: {\n\t\t\t\t...githubConfig, [fieldName]: value\n\t\t\t}\n\t\t});\n\t\tdispatch(\"uiState/merge\", {\n\t\t\tstatus: null,\n\t\t\terror: null\n\t\t});\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleToggleInstructions = e => {\n\t\te.preventDefault();\n\t\tsetShowInstructions(!showInstructions);\n\t}\n\n\tconst renderLoading = () => <ModalBody className=\"text-center\">\n\t\t<h5>\n\t\t\t{uiState.status}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancelExport}>Cancel</Button>\n\t\t</div>\n\t</ModalBody>\n\n\tconst renderError = () => (\n\t\t<Row><Col xs={12}>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"danger\">\n\t\t\t\t\t<span>{uiState.error.toString()}</span>\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</Col></Row>\n\t);\n\n\tconst renderMessage = () => {\n\t\tconst url = uiState.statusUrl \n\t\t\t? <span> (<a href={uiState.statusUrl} target=\"_blank\" rel=\"noopener noreferrer\">view</a>)</span>\n\t\t\t: null;\n\t\treturn <Row><Col xs={12}>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"success\">\n\t\t\t\t\t{uiState.status}\n\t\t\t\t\t{url}.\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</Col></Row>\n\t};\n\n\tconst renderForm = () => <Form onSubmit={handleSubmit}>\n\t\t<ModalBody>\n\t\t\t{ uiState.error && renderError() }\n\t\t\t{ uiState.status && renderMessage() }\n\t\t\t<Row form style={{margin: \"1rem 0\"}}><Col xs={12}>\n\t\t\t\t\t<div className=\"small float-right\">\n\t\t\t\t\t\t<a href=\"#\" onClick={handleToggleInstructions}>How do I get a token?</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\"token-instructions\" style={{display: showInstructions ? \"block\" : \"none\", marginTop: \"2rem\"}}>\n\t\t\t\t\t\tTo obtain a personal access token for your Github account:\n\t\t\t\t\t\t<ol>\n\t\t\t\t\t\t\t<li>Visit <a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\thttps://github.com/settings/tokens\n\t\t\t\t\t\t\t</a></li>\n\t\t\t\t\t\t\t<li>Click the \"Generate new token\" button in upper right corner of the page.</li>\n\t\t\t\t\t\t\t<li>Add a note to identify the token in case you want to revoke it later (eg. \"Procure\").</li>\n\t\t\t\t\t\t\t<li>Select permissions:\n\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t<li>To push data to a public repository, check the <i>\"public_repo\"</i> item under <i>\"repo\"</i>.</li>\n\t\t\t\t\t\t\t\t\t<li>To push data to a private repository, check the <i>\"repo\"</i> item.</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>Click the \"Generate token\" button at the bottom of the page.</li>\n\t\t\t\t\t\t</ol>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Label for=\"token\">Personal Access Token</Label>\n\t\t\t\t\t<Input id=\"token\" \n\t\t\t\t\t\tvalue={(githubConfig && githubConfig.token) || \"\"} \n\t\t\t\t\t\tonChange={ e => handleFieldChange(\"token\", e) }\n\t\t\t\t\t/>\n\n\t\t\t</Col></Row>\n\n\t\t\t<Row form style={{margin: \"1rem 0\"}}><Col xs={12}>\n\t\t\t\t<Label for=\"repo\">Repository</Label>\n\t\t\t</Col><Col xs={4}>\n\t\t\t\t<Input id=\"owner\"\n\t\t\t\t\tvalue={(githubConfig && githubConfig.owner) || \"\"} \n\t\t\t\t\tonChange={ e => handleFieldChange(\"owner\", e) } \n\t\t\t\t\tplaceholder=\"Owner\" data-lpignore=\"true\"\n\t\t\t\t/>\n\t\t\t</Col><Col xs={1}>\n\t\t\t<Input readOnly className=\"form-control-plaintext\" defaultValue=\"/\" />\n\t\t\t</Col><Col xs={7}>\n\t\t\t\t<Input id=\"project\" \n\t\t\t\t\tvalue={(githubConfig && githubConfig.project) || \"\"} \n\t\t\t\t\tonChange={ e => handleFieldChange(\"project\", e) } \n\t\t\t\t\tplaceholder=\"Project\" data-lpignore=\"true\"\n\t\t\t\t/>\n\t\t\t</Col></Row>\n\n\t\t\t<Row form style={{margin: \"2rem 0\"}}><Col xs={12}>\n\t\t\t\t<FormGroup check>\n\t\t\t\t\t<Label check>\n\t\t\t\t\t\t<Input type=\"radio\"\n\t\t\t\t\t\t\tname=\"pull-request\"\n\t\t\t\t\t\t\tvalue={false}\n\t\t\t\t\t\t\tchecked={!githubConfig.pullRequest}\n\t\t\t\t\t\t\tonChange={ e => handleFieldChange(\"pullRequest\", e) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tCommit directly to the master branch</Label>\n\t\t\t\t</FormGroup>\n\t\t\t\t<FormGroup check>\n\t\t\t\t\t<Label check>\n\t\t\t\t\t\t<Input type=\"radio\"\n\t\t\t\t\t\t\tname=\"pull-request\"\n\t\t\t\t\t\t\tvalue={true}\n\t\t\t\t\t\t\tchecked={githubConfig.pullRequest === true}\n\t\t\t\t\t\t\tonChange={ e => handleFieldChange(\"pullRequest\", e) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tCreate a new branch and pull request</Label>\n\t\t\t\t</FormGroup>\n\t\t\t</Col></Row>\n\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"success\" type=\"submit\">Push Data</Button>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Close</Button>\n\t\t</ModalFooter>\n\t</Form>\n\t\n\treturn  <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalHeader>Push to Github Repository</ModalHeader>\n\t\t{ uiState.submode === \"push\" ? renderLoading() : renderForm() }\n\t</Modal>\n\n}","import React, { useState } from \"react\";\n\nexport default ({ children, dropHint, fileDropHandler }) => {\n\n\tconst [dragCounter, setDragCounter] = useState(0);\n\n\tconst isFileDrag = e => {\n\t\treturn !e.dataTransfer.types ||\n\t\t\te.dataTransfer.types[0] === \"Files\" ||\n\t\t\te.dataTransfer.types[0] === \"application/x-moz-file\";\n\t}\n\t\n\tconst handleDrop = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (e.dataTransfer.files && e.dataTransfer.files.length === 1)\n\t\t\tfileDropHandler(e.dataTransfer.files[0]);\n\t\t// e.dataTransfer.clearData();\n\t\tsetDragCounter(0);\n\t}\n\n\tconst handleDragOver = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\t\n\t}\n\n\tconst handleDragEnter = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (isFileDrag(e))\n\t\t\tsetDragCounter(dragCounter+1);\n\t}\n\n\tconst handleDragLeave = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (isFileDrag(e))\n\t\t\tsetDragCounter(dragCounter-1);\n\t}\n\n\tconst overlay = <div className=\"d-flex justify-content-center\" style={{\n\t\tborder: 'dashed grey 4px',\n\t\tbackgroundColor: 'rgba(255,255,255,.8)',\n\t\tposition: 'absolute',\n\t\ttop: 0,\n\t\tbottom: 0,\n\t\tleft: 0, \n\t\tright: 0,\n\t\tzIndex: 9999,\n\t}}>\n\t\t<div className=\"d-flex align-items-center\">\n\t\t\t{ dropHint || \"Drop settings file here\"}\n\t\t</div>\n\t</div>\n\n\treturn <div \n\t\tstyle={{position: \"relative\"}}\n\t\t\tonDragEnter={handleDragEnter}\n\t\t\tonDragOver={handleDragOver}\n\t\t\tonDragLeave={handleDragLeave}\n\t\t\tonDrop={handleDrop}\n\t\t>\n\t\t{ dragCounter > 0 && overlay }\n\t\t{ children }\n\t</div>\n\t\n\t\n} \t","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, {useRef, useEffect} from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Navbar, NavbarBrand, Nav, NavItem, NavLink} from 'reactstrap';\nimport SettingsImportDropZone from \"./SettingsImportDropZone\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faMedkit } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { providers, isDirty, warnOnPageNavigate, appName, dispatch } = useStoreon(\"providers\", \"isDirty\", \"warnOnPageNavigate\", \"appName\");\n\tconst fileInput = useRef();\n\n\tuseEffect( () => {\n\t\twindow.onbeforeunload = () => (isDirty && warnOnPageNavigate) ? true : null;\n\t});\n\n\tconst handleImportSettings = e => {\n\t\te.preventDefault();\n\t\tfileInput.current.value = \"\";\n\t\tfileInput.current.click();\n\t}\n\n\tconst handleFileSelected = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (e.target.files.length === 1)\n\t\t\treadFile(e.target.files[0]);\n\t}\n\n\tconst handleDownloadSettings = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"export/settings\");\n\t}\n\n\tconst readFile = (file) => {\n\t\tconst replace = providers.length === 0 || window.confirm(\n\t\t\t\"Current providers in your list will be replaced. Continue?\"\n\t\t)\n\t\tif (replace) {\n\t\t\tdispatch(\"import/settings\", file)\n\t\t\tdispatch(\"refreshDirty\", true);\n\t\t};\n\t}\n\n\treturn <div style={{marginBottom: \"2rem\"}}><SettingsImportDropZone fileDropHandler={readFile}>\n\t\t<input ref={fileInput}\n\t\t\t\ttype=\"file\" \n\t\t\t\tstyle={{display: 'none'}}\n\t\t\t\tonChange={handleFileSelected}\n\t\t\t\taccept=\".json, application/json\"\n\t\t/>\n\t\t<Navbar color=\"light\" light expand=\"xs\">\n\t\t\t<NavbarBrand href=\"/\">\n\t\t\t\t<FontAwesomeIcon icon={faMedkit} alt=\"Procure logo\" className=\"mr-2\" />\n\t\t\t\t{appName || \"Procure\"}\n\t\t\t</NavbarBrand>\n\t\t\t<Nav className=\"ml-auto\" navbar>\n\t\t\t\t<NavItem>\n\t\t\t\t\t<NavLink href=\"#\" onClick={handleImportSettings}>import settings</NavLink>\n\t\t\t\t</NavItem>\n\t\t\t\t<NavItem>\n\t\t\t\t\t<NavLink href=\"#\" onClick={handleDownloadSettings} style={{fontWeight: isDirty ? \"bold\" : \"normal\"}}>\n\t\t\t\t\t\texport settings\n\t\t\t\t\t</NavLink>\n\t\t\t\t</NavItem>\n\t\t\t</Nav>\n\t\t</Navbar>\n\t</SettingsImportDropZone></div> \n\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useMemo, useRef } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport Select from \"react-select\";\nimport JSONTree from \"react-json-tree\";\nimport {FormGroup, Button} from \"reactstrap\";\nimport _ from \"lodash\";\nimport { saveAs } from \"file-saver\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronLeft, faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\t\n\t//app state\n\tconst { providers, dateSortElements } = useStoreon(\"providers\", \"dateSortElements\");\n\n\t//component state\n\tconst [resourceType, setResourceType] = useState();\n\tconst [position, setPosition] = useState(1);\n\tconst [overlayResources, setOverlayResources] = useState([]);\n\n\tconst componentTopRef = useRef();\n\n\tlet resourceTypeOptions = useMemo( () => {\n\t\treturn _.chain(providers)\n\t\t\t.filter( p => p.data && p.selected )\n\t\t\t.map( p => p.data.entry.map(e => e.resource.resourceType) )\n\t\t\t.flatten().uniq()\n\t\t\t.map(o => ({label: o, value: o}))\n\t\t\t.sortBy([\"label\"])\n\t\t\t.value();\n\t}, [providers]);\n\n\tlet resources = useMemo( () => {\n\t\treturn _.chain(providers)\n\t\t\t.filter( p => p.data && p.data.entry && p.selected )\n\t\t\t.map( p => p.data.entry ).flatten()\n\t\t\t.filter( e => (!resourceType || resourceType.value === e.resource.resourceType) )\n\t\t\t.sortBy( e => {\n\t\t\t\tconst sortElements = dateSortElements[e.resource.resourceType] || [];\n\t\t\t\tconst sortElement = _.find( sortElements, element => e.resource[element]);\n\t\t\t\tconst dateValue =\n\t\t\t\t\t(sortElement && (e.resource[sortElement].start || e.resource[sortElement])) || \n\t\t\t\t\t(e.resource.meta && e.resource.meta.lastUpdated) || \"\";\n\t\t\t\treturn dateValue;\n\t\t\t})\n\t\t\t.reverse()\n\t\t\t.value();\n\t}, [providers, resourceType, dateSortElements]);\n\n\t//remove leading slashes, trailing slashes and protocol\n\tconst simplifyUrl = (url) => url.replace(/^\\/|https?:\\/\\/|\\/*$/g, \"\")\n\n\tconst referenceIndex = useMemo( () => {\n\t\tlet index = {};\n\t\t_.each(providers, (provider, i) => {\n\t\t\t_.each(((provider.data && provider.data.entry) || []), (entry, j) => {\n\t\t\t\tindex[simplifyUrl(entry.fullUrl)] = [i, j, \"resource\"]\n\t\t\t})\n\t\t\t_.each(((provider.data && provider.data.files) || []), (file, j) => {\n\t\t\t\tindex[file.fileName] = [i, j, \"file\"]\n\t\t\t})\t\t\n\t\t});\n\t\treturn index;\n\t}, [providers]);\n\n\tconst handlePosChange = (dir, e) => {\n\t\te.preventDefault();\n\t\tsetPosition(position+dir);\n\t}\n\n\tconst filters = <FormGroup>\n\t\t<Select id=\"resourceType\"\n\t\t\tvalue={resourceType}\n\t\t\tonChange={ selection => {setResourceType(selection); setPosition(1);setOverlayResources([]);} }\n\t\t\tisSearchable={true}\n\t\t\toptions={ resourceTypeOptions }\n\t\t\tplaceholder=\"Filter by Resource Type\"\n\t\t\tisClearable={true}\n\t\t/>\n\t</FormGroup>\n\n\tconst renderPositionNav = () => {\n\t\tconst noResources = <div className=\"text-center\">\n\t\t\tNo resources found\n\t\t</div>;\n\t\t\t\t\n\t\tconst nextPrevNav = <div>\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" \n\t\t\t\tdisabled={position === 1}\n\t\t\t\tonClick={e => handlePosChange(-1, e)} className=\"mr-3\"\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faChevronLeft} />\n\t\t\t</Button>\n\t\t\t\tResource {position} of {resources.length}\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" \n\t\t\t\tdisabled={position === resources.length} \n\t\t\t\tonClick={e => handlePosChange(1, e)}  className=\"ml-3\"\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t</Button>\n\t\t</div>;\n\n\t\tconst overlayNav = <div>\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" onClick={e => {\n\t\t\t\tsetOverlayResources(_.slice(overlayResources, 0, -1))\n\t\t\t}}>\n\t\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\tBack\n\t\t\t</Button>\n\t\t</div>;\n\n\t\tif (overlayResources.length) {\n\t\t\treturn overlayNav;\n\t\t} else if (resources.length) {\n\t\t\treturn nextPrevNav;\n\t\t} else {\n\t\t\treturn noResources;\n\t\t}\n\n\t}\n\n\tconst treeTheme = {\n\t\tbase00: '#272822',base01: '#383830',base02: '#49483e',base03: '#75715e',\n\t\tbase04: '#a59f85',base05: '#f8f8f2',base06: '#f5f4f1',base07: '#f9f8f5',\n\t\tbase08: '#f92672',base09: '#fd971f',base0A: '#f4bf75',base0B: '#a6e22e',\n\t\tbase0C: '#a1efe4',base0D: '#66d9ef',base0E: '#ae81ff',base0F: '#cc6633'\n\t};\n\n\tconst handleReference = (url, e) => {\n\t\te.preventDefault();\n\t\tconst index = referenceIndex[url];\n\t\tif (index[2] === \"file\") {\n\t\t\tconst file = providers[index[0]].data.files[index[1]];\n\t\t\tsaveAs(file.blob, file.fileName);\n\t\t} else {\n\t\t\tsetOverlayResources([...overlayResources, url]);\n\t\t\twindow.scrollTo(0, componentTopRef.current.offsetTop);\n\t\t}\n\t}\n\n\tconst valueRenderer = (raw, value, key) => {\n\t\tlet link;\n\n\t\tif (key === \"reference\") {\n\t\t\t//remove leading and trailing slashes\n\t\t\tlet refUrl = simplifyUrl(value);\n\n\t\t\t//add base url if relative path\n\t\t\tif ((refUrl.match(/\\//g) || []).length === 1) {\n\t\t\t\tconst fullUrl =\n\t\t\t\t\t(overlayResources.length && _.last(overlayResources).fullUrl) ||\n\t\t\t\t\tresources[position-1].fullUrl;\n\t\t\t\tconst baseUrl = simplifyUrl(fullUrl).split(\"/\");\n\t\t\t\trefUrl = baseUrl\n\t\t\t\t\t.slice(0, baseUrl.length-2).join(\"/\") + \"/\" + refUrl;\n\t\t\t}\n\t\t\tif (referenceIndex[refUrl]) link = refUrl;\n\t\t//this could be optimized by only looking at attachment keys\n\t\t} else if (key === \"url\" && referenceIndex[value]) {\n\t\t\tlink = value;\n\t\t//truncate very long values\n\t\t} else if (value.length > 500) {\n\t\t\traw = value.substring(0,500) + \"...\";\n\t\t}\n\n\t\treturn link ? <span>\n\t\t\t\"<a href=\"#\" style={{textDecoration: \"underline\"}}\n\t\t\tonClick={e => handleReference(link, e)}\n\t\t\t>{value}</a>\"\n\t\t</span> : raw;\n\t}\n\n\tconst getResourceByUrl = (url) => {\n\t\tconst index = referenceIndex[url];\n\t\tif (index) return providers[index[0]].data.entry[index[1]];\n\t}\n\n\tconst renderJsonTree = () => {\n\n\t\tconst overlayData = overlayResources.length && getResourceByUrl(_.last(overlayResources))\n\t\tif (overlayResources.length && !overlayData) \n\t\t\tsetOverlayResources(_.slice(overlayResources, 1,-1));\t\n\t\tconst data = (\n\t\t\toverlayData && overlayData.resource\n\t\t) || (\n\t\t\tresources[position-1] && resources[position-1].resource\n\t\t);\n\t\t\n\t\tif (data) return <div style={{\n\t\t\tmarginTop: \"1rem\", padding: \"1rem\", \n\t\t\tborder: \"1px solid #ccc\", borderRadius: \".25rem\", \n\t\t\tbackground: \"#fffffa\"\n\t\t}}>\n\t\t\t<JSONTree \n\t\t\t\tdata={data} \n\t\t\t\ttheme={treeTheme} \n\t\t\t\thideRoot={true} \n\t\t\t\tshouldExpandNode={(keyName, data, level) => true}\n\t\t\t\tinvertTheme={true}\n\t\t\t\tvalueRenderer={valueRenderer}\n\t\t\t/>\n\t\t</div>;\n\t}\n\n\treturn <div ref={componentTopRef}>\n\t\t{ filters }\n\t\t{ renderPositionNav() }\n\t\t{ renderJsonTree() }\n\t</div>\n}","import React, {useState} from \"react\";\nimport {Button, Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faTable, faFileDownload, faFileUpload } from \"@fortawesome/free-solid-svg-icons\"\nimport { faGithub } from \"@fortawesome/free-brands-svg-icons\"\n\nexport default (props) => {\n\n\tconst { \n\t\tspreadsheetTemplates,\n\t\tupload,\n\t\tnonModalUi, dispatch \n\t} = useStoreon(\n\t\t\"spreadsheetTemplates\",\n\t\t\"upload\",\n\t\t\"nonModalUi\"\n\t);\n\t\n\tconst [showSpreadsheetOptions, setShowSpreadsheetOptions] = useState(false);\n\n\tconst handleExportData = (e) => {\t\t\n\t\te.preventDefault();\n\t\tdispatch(\"export/download\");\n\t}\n\n\tconst handleFileUpload = (e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/upload\");\n\t}\n\n\tconst handleShowGithubExport = (e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"githubExport\"});\n\t}\n\n\tconst handelExportSpreadsheet = (templateId, format, e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/spreadsheet\", {templateId, format});\n\t}\n\n\tconst renderSpreadsheetExport = () => {\n\t\tif (!Object.keys(spreadsheetTemplates||{}).length) \n\t\t\treturn null;\n\t\tlet menuItems = [];\n\t\tObject.keys(spreadsheetTemplates).forEach( templateId => {\n\t\t\tmenuItems.push(\n\t\t\t\t<DropdownItem \n\t\t\t\t\tkey={templateId + \"-xlsx\"} \n\t\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"xlsx\")}\n\t\t\t\t>\n\t\t\t\t\t{spreadsheetTemplates[templateId].name + \" (Excel)\"}\n\t\t\t\t</DropdownItem>,\n\t\t\t\t<DropdownItem \n\t\t\t\t\tkey={templateId + \"-csv\"}\n\t\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"csv\")}\n\t\t\t\t>\n\t\t\t\t\t{spreadsheetTemplates[templateId].name + \" (CSV)\"}\n\t\t\t\t</DropdownItem>\n\t\t\t)\n\t\t});\n\t\treturn <Dropdown \n\t\t\tstyle={{display: \"inline\",}}\n\t\t\tdisabled={nonModalUi.isExportingSheet}\n\t\t\tisOpen={showSpreadsheetOptions}\n\t\t\ttoggle={e => setShowSpreadsheetOptions(!showSpreadsheetOptions)}\n\t\t>\n\t\t\t<DropdownToggle \n\t\t\t\tcolor=\"outline-secondary\" \n\t\t\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\t\t\tcaret\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faTable} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Export as Spreadsheet</span>\n\t\t\t</DropdownToggle>\n\t\t\t<DropdownMenu>{menuItems}</DropdownMenu>\n\t\t</Dropdown>\n\t}\n\n\tconst uploadButton = <Button \n\t\tcolor=\"success\"\n\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\tonClick={handleFileUpload}\n\t\t>\n\t\t\t<FontAwesomeIcon icon={faFileUpload} className=\"mr-2\" />\n\t\t\t{upload.label || \"Share Data\"}\n\t</Button>;\n\n\tconst downloadAllButton = <Button \n\t\tcolor=\"outline-secondary\"\n\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\tonClick={handleExportData}\n\t\tdisabled={nonModalUi.isDownloading}\n\t\t>\n\t\t\t<FontAwesomeIcon icon={faFileDownload} className=\"mr-2\" />\n\t\t\tDownload Data\n\t</Button>;\n\n\tconst ghExportButton = <Button \n\t\tstyle={{margin: \"0 0 1rem 0\"}}\n\t\tcolor=\"outline-secondary\"\n\t\tonClick={handleShowGithubExport}\n\t\t>\n\t\t<FontAwesomeIcon icon={faGithub} className=\"mr-2\" />\n\t\tUpload to Github\n\t</Button>;\n\n\treturn <div style={{marginBottom: \".5rem\"}}>\n\t\t{upload && (upload.manifestUrl || upload.uploadUrl) && uploadButton}\n\t\t{downloadAllButton}\n\t\t{props.hasResources && renderSpreadsheetExport()}\n\t\t{ghExportButton}\n\t</div>\n\n}","import React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button} from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { dispatch } = useStoreon();\n\n\tconst handleAddProvider = (e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\treturn \t<Button block color=\"success\"\n\t\tonClick={handleAddProvider}\n\t>\n\t\t<FontAwesomeIcon icon={faPlus} className=\"mr-2\" />\n\t\tAdd Provider\n\t</Button>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {\n\tButton, Spinner, Modal, ModalHeader, \n\tModalBody, ModalFooter, Container, Alert\n} from 'reactstrap';\n\nexport default () => {\n\t//app state\n\tconst {uiState, upload, dispatch} = useStoreon(\"uiState\", \"upload\");\n\n\tconst handleHideDialog = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"})\n\t}, [dispatch]);\n\n\tconst handleDone = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\t\n\t\tif (upload.continueUrl)\n\t\t\twindow.open(upload.continueUrl);\n\t\t\n\t\thandleHideDialog(e);\n\t}, [handleHideDialog, upload]);\n\n\tconst handleCancelExport = useCallback( e => {\n\t\te.preventDefault()\n\t\tconst endState = uiState.submode === \"getManifest\"\n\t\t\t? {mode: \"ready\"}\n\t\t\t: {mode: \"fileUpload\", submode: \"preUpload\"}\n\t\tdispatch(\"export/upload/cancel\");\n\t\tdispatch(\"uiState/set\", endState)\n\t}, [dispatch, uiState.submode]);\n\n\tconst handleUploadFile = useCallback( e => {\n\t\te.preventDefault()\t\n\t\tdispatch(\"export/upload/send\");\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode === \"preUpload\" || uiState.submode === \"postUpload\") {\n\t\t\t\thandleHideDialog(e);\n\t\t\t} else {\n\t\t\t\thandleCancelExport(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancelExport, handleHideDialog]);\n\n\tconst renderLoading = () => <ModalBody className=\"text-center\">\n\t\t<h5>\n\t\t\t{uiState.status}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancelExport}>Cancel</Button>\n\t\t</div>\n\t</ModalBody>\n\n\tconst renderError = () => <div>\n\t\t<ModalBody>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"danger\">\n\t\t\t\t\t<span>{uiState.status}</span>\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Close</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\tconst renderUploadDetails = () => <div>\n\t\t<ModalBody>\n\t\t\t<p>\n\t\t\t\tClicking the <b>upload</b> button below will share your medical record \n\t\t\tinformation with <b>{upload.name}</b> and indicates your agreement to the \n\t\t\tterms of use, privacy policy and other information outlined at \n\t\t\t\t<b>&nbsp;<a href={upload.infoUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t{upload.infoUrl}\n\t\t\t\t</a></b>.\n\t\t\t</p>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"success\" onClick={handleUploadFile}>Upload</Button>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Cancel</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\tconst renderPostUpload = () => <div>\n\t\t<ModalBody className=\"text-center\">\n\t\t\t<h5>{upload.successMessage || \"Your information has been transmitted!\"}</h5>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"primary\" onClick={handleDone}>\n\t\t\t\t{upload.continueUrl ? (upload.continueLabel || \"Continue\") : \"Close\"}\n\t\t\t</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\treturn  <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalHeader>Share My Data</ModalHeader>\n\t\t{uiState.submode === \"error\" && renderError()}\n\t\t{uiState.submode === \"getManifest\" && renderLoading()}\n\t\t{uiState.submode === \"preUpload\" && renderUploadDetails()}\n\t\t{uiState.submode === \"uploading\" && renderLoading()}\n\t\t{uiState.submode === \"postUpload\" && renderPostUpload()}\n\t</Modal>\n\n}","import React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport { Button } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\";\n\nexport default() => {\n\n\tconst {upload, dispatch} = useStoreon(\"upload\");\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Welcome</h4>\n\t\t<p>This app will walk you through the process of collecting digital copies of your medical records from healthcare institutions where you've received care and sharing them with {upload.name}. You can find additional information at <a href={upload.infoUrl} target=\"_blank\" rel=\"noopener noreferrer\">{upload.infoUrl}</a>.\n\t\t</p><p>You'll also have the option to download a copy of the data to this device to keep for yourself.</p>\n\t\t<Button color=\"success\" className=\"float-right mt-4\"\n\t\t\tonClick={ e => dispatch(\"uiState/set\", {mode: \"editProvider\" }) }\n\t\t>\n\t\t\t<span className=\"mr-2\">Get Started</span>\n\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t</Button>\n\t\t<div className=\"clearfix\"></div>\n\t</div>\n\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport { Button } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport Select, { createFilter } from \"react-select\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\t//app state\n\tconst {\n\t\tuiState, providers, credentials,\n\t\torganizations, orgDefaults, redirectUri, dispatch\n\t } = useStoreon(\n\t\t\"uiState\", \"providers\", \"credentials\",\n\t\t\"organizations\", \"orgDefaults\", \"redirectUri\"\n\t );\n\n\t//component state\n\tconst [provider, setProvider] = useState({});\t\n\n\tconst orgOptions = _.chain(organizations)\n\t\t.map( o => ({label: o.name, value: o.orgId || o.fhirEndpoint}) )\n\t\t.sortBy( o => o.label )\n\t\t.value();\n\n\tuseEffect( () => {\n\t\tif (!provider.id && uiState.id && uiState.mode === \"editProvider\") {\n\t\t\tconst currentProvider = providers.find(p => p.id === uiState.id);\n\t\t\tsetProvider(currentProvider)\n\t\t}\n\t}, [uiState.id, uiState.mode, provider.id, providers])\n\n\tconst handleSubmit = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/upsertAndLoad\", provider);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleSkip = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t}\n\n\tconst handleOrgSelection = (selection) => {\n\t\tlet orgConfig = organizations.find( \n\t\t\to => selection.value === o.orgId || selection.value === o.fhirEndpoint\n\t\t);\n\n\t\tconst defaults = orgDefaults[orgConfig.defaultId] || {};\n\t\tif (orgConfig.defaultId !== undefined) \n\t\t\torgConfig = {...defaults, ...orgConfig};\n\n\t\t//get credential details if included by reference\n\t\tif (orgConfig.credentialId)\n\t\t\torgConfig = {...credentials[orgConfig.credentialId], ...orgConfig};\n\n\t\t//update provider with new defaults\n\t\tsetProvider({\n\t\t\t...orgConfig,\n\t\t\tredirectUri,\n\t\t\tid: provider.id,\n\t\t\torgId: selection.value,\n\t\t\tqueryProfile: orgConfig.queryProfile || \"argonaut_spec\"\n\t\t});\n\t}\n\n\tconst renderOrgSelector = () => {\n\n\t\t//workaround since component uses both the value and label to match and we just want to store the value\n\t\tconst value = provider.orgId ? orgOptions.find(o => o.value === provider.orgId) : null;\n\n\t\treturn <Select id=\"organization\" autoFocus\n\t\t\t\t//performance improvement on autocomplete\n\t\t\t\tfilterOption={createFilter({ignoreAccents: false})}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={handleOrgSelection}\n\t\t\t\tisSearchable={true}\n\t\t\t\toptions={orgOptions}\n\t\t\t\tdefaultMenuIsOpen={true}\n\t\t\t/>\n\t}\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Select Your Provider</h4>\n\t\t<p>\n\t\t\tChoose a healthcare institution where you've received care from the list below.\n\t\t</p><p>\n\t\t\tIf you've been to multiple healthcare providers, after retrieving your records you'll have the option to return to this screen to select another institution.\n\t\t</p>\n\t\t{ renderOrgSelector() }\n\n\t\t<div className=\"d-flex\">\n\t\t\t<div className=\"align-self-end flex-grow-1 mt-4 pl-1\">\n\t\t\t\t{providers.length > 0 && <a href=\"#\" onClick={handleSkip}>skip</a>}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<Button color=\"success\" className=\"mt-4\"\n\t\t\t\t\tonClick={ handleSubmit } \n\t\t\t\t\tdisabled={provider.orgId ? false :true}\n\t\t\t\t>\n\t\t\t\t\t<span className=\"mr-2\">Login to Patient Portal</span>\n\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Spinner} from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronLeft } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { uiState, providers, dispatch } = useStoreon(\"uiState\", \"providers\");\n\n\tconst provider =  useMemo( () => {\n\t\treturn providers.find(p => p.id === uiState.id)\n\t}, [uiState.id, providers]);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/cancelLoad\", \"editProvider\");\n\t\tdispatch(\"providers/remove\", provider.id)\n\t}, [dispatch, provider]);\n\n\tconst handleBack = e => {\n\t\tdispatch(\"providers/remove\", provider.id)\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode  === \"authorizing\" || uiState.submode === \"loading\") {\n\t\t\t\thandleCancel(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel, uiState.submode]);\n\n\t//TODO: this is kind of a hack to build on non-wizard modes (need to restructure modes to work with both)\n\tif (uiState.mode !== \"loadData\") return null;\n\tif (uiState.submode === \"loaded\") {\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: provider.id,\n\t\t\tlastUpdated: new Date(),\n\t\t\tdata: uiState.data\n\t\t});\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t};\n\n\tconst renderWorking = (status) => <div className=\"p-4 text-center\">\n\t\t<h5 className=\"mb-4\">{status}</h5>\n\t\t<div className=\"my-4\">\n\t\t\t<Spinner color=\"primary\" style={{ width: \"3rem\", height: \"3rem\" }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button color=\"outline-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderGlobalError = () => <div className=\"p-2\">\n\t\t<h5>Error</h5>\n\t\t<p>An error occurred loading your record: {uiState.status}</p>\n\t\t<div>\n\t\t\t<Button color=\"primary\" className=\"mt-4\" onClick={handleBack}>\n\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Back</span>\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n\n\treturn <div>\n\t\t<h4>{provider.name}</h4>\n\t\t{ uiState.submode === \"authorizing\" && renderWorking(\"Waiting for Portal Login...\") }\n\t\t{ uiState.submode === \"loading\" && renderWorking(\"Retrieving Healthcare Records...\") }\n\t\t{ uiState.submode === \"error\" && renderGlobalError() }\n\t</div>\n\n\n}","import React, {useState} from \"react\";\nimport {Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faFileDownload } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default (props) => {\n\n\tconst { \n\t\tspreadsheetTemplates,\n\t\tnonModalUi,\n\t\tdispatch\n\t} = useStoreon(\n\t\t\"spreadsheetTemplates\",\n\t\t\"nonModalUi\"\n\t);\n\n\tconst [showDownloadOptions, setShowDownloadOptions] = useState(false);\n\n\tconst handelExportSpreadsheet = (templateId, format, e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/spreadsheet\", {templateId, format});\n\t}\n\n\tconst handleExportData = (e) => {\t\t\n\t\te.preventDefault();\n\t\tdispatch(\"export/download\");\n\t}\n\n\tlet menuItems = [\n\t\t<DropdownItem \n\t\t\tkey=\"fhir\" \n\t\t\tonClick={handleExportData}\n\t\t>FHIR Format</DropdownItem>\n\t];\n\n\t(Object.keys(spreadsheetTemplates) || []).forEach( templateId => {\n\t\tmenuItems.push(\n\t\t\t<DropdownItem \n\t\t\t\tkey={templateId + \"-xlsx\"} \n\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"xlsx\")}\n\t\t\t>\n\t\t\t\tSpreadsheet of {spreadsheetTemplates[templateId].name}\n\t\t\t</DropdownItem>\n\t\t)\n\t});\n\n\treturn <Dropdown \n\t\tclassName={props.className}\n\t\tstyle={{display: \"inline\",}}\n\t\tdisabled={nonModalUi.isExportingSheet}\n\t\tisOpen={showDownloadOptions}\n\t\ttoggle={e => setShowDownloadOptions(!showDownloadOptions)}\n\t>\n\t\t<DropdownToggle \n\t\t\tcolor=\"outline-secondary\" \n\t\t\tstyle={{margin: \"0 1rem 0 0\"}}\n\t\t\tcaret\n\t\t>\n\t\t<FontAwesomeIcon icon={faFileDownload} className=\"mr-2\" />\n\t\t\t<span className=\"mr-2\">Download copy of data</span>\n\t\t</DropdownToggle>\n\t\t<DropdownMenu>{menuItems}</DropdownMenu>\n\t</Dropdown>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport { Button } from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport DownloadButton from \"./DownloadButton\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\tconst {providers, upload, dispatch} = useStoreon(\"providers\", \"upload\");\n\n\tconst handleAddProvider = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\tconst handleFileUpload = e => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/upload/send\");\n\t}\n\n\tconst handleDeleteProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/remove\", id);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst renderProvider = (provider) => {\n\t\treturn <li key={provider.id}>\n\t\t\t{provider.name}{\" \"}\n\t\t\t(<a href=\"#\" onClick={e => handleDeleteProvider(provider.id, e)}>remove</a>)\n\t\t</li>\n\t};\n\n\tconst providerList = _.chain(providers)\n\t\t.sortBy( p => p.lastUpdated)\n\t\t.map(renderProvider)\n\t\t.value();\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Review Data to Share</h4>\n\t\t<p>You have collected records from the following healthcare providers:</p>\n\t\t<ul>{ providerList }</ul>\n\n\t\t<div className=\"d-md-flex\">\n\t\t\t<div className=\"align-self-end flex-grow-1 mt-4\">\n\t\t\t\t<DownloadButton />\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<Button color=\"success\" \n\t\t\t\t\tonClick={handleAddProvider}\n\t\t\t\t\tclassName=\"btn-block text-left mt-4\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"d-flex\">\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center flex-grow-1\">Add another provider</div>\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</Button>\n\t\t\t\t<Button color=\"success\" \n\t\t\t\t\tclassName=\"btn-block text-left mt-2\"\n\t\t\t\t\tdisabled={providerList.length === 0}\n\t\t\t\t\tonClick={handleFileUpload}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"d-flex\">\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center flex-grow-1\">\n\t\t\t\t\t\t\tShare with {upload.name}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport DownloadButton from \"./DownloadButton\";\nimport { Button, Spinner } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight, faChevronLeft } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\t//app state\n\tconst {uiState, upload, dispatch} = useStoreon(\"uiState\", \"upload\");\n\n\tconst handleBack = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"review\"})\n\t}, [dispatch]);\n\n\tconst handleDone = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tif (upload.continueUrl) \n\t\t\twindow.location.href = upload.continueUrl;\n\t}, [upload]);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"export/upload/cancel\");\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27 || uiState.submode === \"uploading\") return;\n\t\t\thandleCancel(e);\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancel, handleBack]);\n\n\tconst renderWorking = () => <div className=\"p-4 text-center\">\n\t\t<h5 className=\"mb-4\">{uiState.status || \"Preparing to send data\"}</h5>\n\t\t<div className=\"my-4\">\n\t\t\t<Spinner color=\"primary\" style={{ width: \"3rem\", height: \"3rem\" }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button color=\"outline-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderError = () => <div className=\"p-2\">\n\t\t<h5>Error</h5>\n\t\t<p>{uiState.status}</p>\n\t\t<div>\n\t\t\t<Button color=\"primary\" className=\"mt-4\" onClick={handleBack}>\n\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Back</span>\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderPostUpload = () => \t<div className=\"p-2\">\n\t\t<h5>Success</h5>\n\t\t<p>{\n\t\t\tupload.successMessage || \n\t\t\t(\"Your healthcare records have been successfully shared with \" + upload.name + \".\")\n\t\t}</p>\n\t\t<DownloadButton className=\"float-left mt-4\" />\n\t\t{upload.continueUrl &&\n\t\t\t<Button color=\"success\" className=\"float-right mt-4\" onClick={handleDone}>\n\t\t\t\t<span className=\"mr-2\">\n\t\t\t\t\t{ upload.continueLabel || \"Continue to \" + upload.name }\n\t\t\t\t</span>\n\t\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t\t</Button>\n\t\t}\n\t\t<div className=\"clearfix\"></div>\n\t</div>\n\n\treturn <div>\n\t\t{uiState.submode === \"error\" && renderError()}\n\t\t{uiState.submode !== \"postUpload\" && uiState.submode !== \"error\" && renderWorking()}\n\t\t{uiState.submode === \"postUpload\" && renderPostUpload()}\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport Start from \"./Start\";\nimport SelectProvider from \"./SelectProvider\";\nimport Retrieve from \"./Retrieve\";\nimport Review from \"./Review\";\nimport Upload from \"./Upload\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faMedkit, faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport {Row, Col} from \"reactstrap\";\n\nexport default() => {\n\t\n\t//app state\n\tconst {uiState, dispatch, appName} = useStoreon(\"uiState\", \"appName\");\n\n\tconst handleSwitchMode = () => dispatch(\"wizard/hide\");\n\n\tconst numberStyle = {\n\t\tactive: {background: \"#3182CE\", border: \"1px solid white\", color: \"white\"},\n\t\tinactive: {color: \"#3182CE\", border: \"1px solid #3182CE\", background: \"white\"}\n\t};\n\n\tconst switchToFull = uiState.mode !== \"loadData\" && \n\t\t(uiState.mode !== \"upload\" || uiState.submode === \"loaded\") &&\n\t\t<Row><Col className=\"text-center\">\n\t\t\t<small className=\"mt-4 float-right d-none d-sm-block\"><a href=\"#\" onClick={handleSwitchMode} className=\"text-muted\">switch to full version of Procure</a></small>\n\t\t</Col></Row>;\n\n\treturn <div>\n\t\t{switchToFull}\n\t\t<Row><Col>\n\t\t\t<h2 style={{color: \"#3182CE\", padding: \"1em 0\", textAlign: \"center\"}}>\n\t\t\t\t<FontAwesomeIcon icon={faMedkit} alt=\"Procure logo\" className=\"mr-2\" />\n\t\t\t\t<span>{appName || \"Procure\"}</span>\n\t\t\t</h2>\n\t\t</Col></Row>\n\t\t<Row><Col md={{size:10, offset: 1}} lg={{size:8, offset: 2}}>\n\t\t\t<div className=\"shadow p-4 mb-5 bg-white rounded unbox-sm\">\n\n\t\t\t\t<div className=\"d-none d-sm-block\">\n\t\t\t\t\t<div className=\"d-none d-flex flex-row justify-content-around mb-4\" style={{borderBottom: \"1px solid #3182CE\"}}>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"ready\" ? \"active\" : \"inactive\"], display: \"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">1</div>\n\t\t\t\t\t\t\t<div>Start</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"m-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"editProvider\" || uiState.mode ===\"loadData\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">2</div>\n\t\t\t\t\t\t\t<div>Retrieve Records</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"m-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"review\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">3</div>\n\t\t\t\t\t\t\t<div>Review</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"mr-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"fileUpload\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">4</div>\n\t\t\t\t\t\t\t<div>Share Records</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{ uiState.mode === \"ready\" && <Start /> }\n\t\t\t\t{ uiState.mode === \"editProvider\" && <SelectProvider /> }\n\t\t\t\t{ uiState.mode === \"loadData\" && <Retrieve /> }\n\t\t\t\t{ uiState.mode === \"review\" && <Review />}\n\t\t\t\t{ uiState.mode === \"fileUpload\" && <Upload />}\n\n\t\t\t</div>\n\n\t</Col></Row> \n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, {useEffect} from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Alert, Container, Row, Col} from 'reactstrap';\nimport _ from \"lodash\";\nimport ProviderForm from \"./ProviderForm\";\nimport ProviderList from \"./ProviderList\";\nimport Fetcher from \"./Fetcher\";\nimport Loader from \"./Loader\"\nimport GithubUploader from \"./GithubUploader\";\nimport Header from \"./Header\";\nimport FhirTree from \"./FhirTree\";\nimport Toolbar from \"./Toolbar\";\nimport BlankSlate from \"./BlankSlate\";\nimport FileUploader from \"./FileUploader\";\nimport Wizard from \"./Wizard/\";\n\nconst App = () =>  {\n\n\t//global state\n\tconst { uiState, showWizard, upload, providers, appName } = useStoreon(\"uiState\", \"upload\", \"showWizard\", \"providers\", \"appName\");\n\n\tuseEffect(() => {\n\t\tdocument.title = appName || \"Procure\";\n\t}, [appName]);\n\n\tif (uiState.mode === \"loading\") \n\t\treturn <Loader />;\n\n\tif (uiState.mode === \"globalError\")\n\t\treturn <Container style={{margin: \"1em\"}}>\n\t\t\t<Alert color=\"danger\">\n\t\t\t\t<span>Failed to load configuration information.</span><br />\n\t\t\t\t<span>{uiState.error.toString()}</span>\n\t\t\t</Alert>\n\t\t</Container>;\n\t\n\tconst inlineError = <Col xs=\"12\" style={{margin: \"0.5rem\"}}>\n\t\t<Alert color=\"warning\" style={{textAlign: \"center\"}}>{uiState.error}</Alert>\n\t</Col>\n\n\tconst renderProviderList = () => <Col xs=\"12\" md=\"6\" lg=\"5\" xl=\"4\">\n\t\t<ProviderList />\n\t</Col>\n\n\tconst renderData = (hasResources) => <Col xs=\"12\" md=\"6\" lg=\"7\" xl=\"8\">\n\t\t<Toolbar hasResources={hasResources} />\n\t\t{ hasResources && <FhirTree />\t}\t\n\t</Col>\n\n\tconst renderBlankSlate = () => <Col sm={{size: 4, offset: 4}}>\n\t\t<BlankSlate />\n\t</Col>\n\n\tconst hasProviders = providers && providers.length;\n\tconst hasData = hasProviders && _.find(providers, p => {\n\t\treturn p.selected && p.data && p.data.entry && (p.data.entry.length || p.data.errorLog.length);\n\t});\n\tconst hasResources = hasProviders && _.find(providers, p => {\n\t\treturn p.selected && p.data && p.data.entry && p.data.entry.length\n\t});\n\n\tconst fullUi = <div>\n\t\t<Header />\n\t\t<Container fluid>\n\t\t\t<Row className=\"m-2\">\n\t\t\t\t{ uiState.error && uiState.mode === \"ready\" && inlineError }\n\t\t\t\t{ hasProviders ? renderProviderList() : renderBlankSlate() }\n\t\t\t\t{ hasData ? renderData(hasResources) : null }\n\t\t\t</Row>\n\t\t\t{ uiState.mode === \"editProvider\" && <ProviderForm /> }\n\t\t\t{ uiState.mode === \"loadData\" && <Fetcher /> }\n\t\t\t{ uiState.mode === \"githubExport\" && <GithubUploader /> }\n\t\t\t{ uiState.mode === \"fileUpload\" && <FileUploader /> }\n\t\t</Container>\n\t</div>\n\n\tconst wizardUi = showWizard && \n\t\tupload && (upload.manifestUrl || upload.uploadUrl) &&\n\t\t\t<Container>\n\t\t\t{ uiState.error && uiState.mode === \"ready\" && \n\t\t\t\t<Row className=\"m-2\">{inlineError}</Row>\n\t\t\t}\t\n\t\t\t<Wizard />\n\t\t</Container>\n\n\tif (wizardUi) {\n\t\tdocument.body.classList.add(\"bg-light-md\");\n\t\treturn wizardUi;\n\t} else {\n\t\tdocument.body.classList = \"\";\n\t\treturn fullUi;\n\t}\n\n}\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n\n      //NOTE: changed from CRA default per https://github.com/facebook/create-react-app/issues/5673\n      const swUrl = `${process.env.PUBLIC_URL}/sw.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport StoreContext from 'storeon/react/context'\n//import 'bootstrap/dist/css/bootstrap.min.css';\n//moved to index.html to avoid flash of unstyled content when using dev server\nimport store from \"./store/store\";\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nstore.dispatch(\"config/load\", \"ready\");\n\nReactDOM.render(\n\t<StoreContext.Provider value={store}><App /></StoreContext.Provider>,\n\tdocument.getElementById('root')\n);\n\nserviceWorker.register();"],"sourceRoot":""}