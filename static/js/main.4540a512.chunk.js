(this["webpackJsonpprocure-wip"]=this["webpackJsonpprocure-wip"]||[]).push([[0],{259:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","definitions":{"endpoint_item":{"type":"object","anyOf":[{"required":["fhirEndpoint","name"]},{"required":["FHIRPatientFacingURI","OrganizationName"]}],"properties":{"clientId":{"type":"string"},"clientSecret":{"type":"string"},"orgId":{"type":"string"},"queryProfile":{"type":"string"},"isOpen":{"type":"boolean"},"scope":{"type":"array","items":{"type":"string"}},"fhirEndpoint":{"type":"string","format":"uri"},"patient":{"type":"string"},"OrganizationName":{"type":"string"},"FHIRPatientFacingURI":{"type":"string","format":"uri"}}}},"type":"object","anyOf":[{"required":["Entries"]},{"required":["entry"]}],"properties":{"Entries":{"type":"array","items":{"$ref":"#/definitions/endpoint_item"}}}}')},260:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","definitions":{"credentials":{"type":"object","additionalProperties":{"type":"object","required":["clientId"],"properties":{"clientId":{"type":"string"},"clientSecret":{"type":"string"}}}},"mime_type_mappings":{"type":"object","additionalProperties":{"type":"string","maxLength":4,"propertyNames":{"pattern":"^[-\\\\w]+/[-\\\\w+]+$"}}},"upload":{"type":"object","anyOf":[{"required":["whitelist"]},{"required":["manifestUrl"]},{"required":["name","uploadUrl","infoUrl"]}],"properties":{"whitelist":{"type":"array","items":{"type":"string","pattern":"^https?://.+"}},"name":{"type":"string"},"label":{"type":"string"},"manifestUrl":{"type":"string","format":"uri"},"uploadUrl":{"type":"string","format":"uri"},"infoUrl":{"type":"string","format":"uri"},"simulate":{"type":"boolean"},"successMessage":{"type":"string"},"continueLabel":{"type":"string"},"continueUrl":{"type":"string","format":"uri"}}},"date_sort_elements":{"type":"object","additionalProperties":{"type":"array","items":{"type":"string"}},"propertyNames":{"pattern":"^[A-Z][A-Za-z]*$"}},"endpoint_lists":{"type":"object","additionalProperties":{"$ref":"#/definitions/endpoint_list"}},"endpoint_list":{"type":"object","required":["path"],"properties":{"path":{"type":"string"},"defaults":{"$ref":"#/definitions/endpoint_list_default"}},"additionalProperties":false},"endpoint_list_default":{"type":"object","properties":{"clientId":{"type":"string"},"clientSecret":{"type":"string"},"queryProfile":{"type":"string"},"isOpen":{"type":"boolean"},"scope":{"type":"array","items":{"type":"string","pattern":"^(([-\\\\w]+/(\\\\*\\\\.)?[*-\\\\w+]+(\\\\.\\\\w+)?)|profile|openid|fhirUser|launch|offline_access|online_access)$"}},"fhirEndpoint":{"type":"string","format":"uri"},"patient":{"type":"string"}}},"query_profiles":{"type":"object","additionalProperties":{"$ref":"#/definitions/query_profile"}},"query_profile":{"type":"object","properties":{"title":{"type":"string"},"fhirVersion":{"type":"string","enum":["DSTU2","STU3","R2","R3","R4","R5"]},"retryLimit":{"type":"integer"},"queries":{"type":"array","minLength":1,"items":{"$ref":"#/definitions/query"}}},"additionalProperties":false},"query":{"type":"object","required":["resourcePath"],"properties":{"title":{"type":"string"},"resourcePath":{"type":"string"},"params":{"type":"object","additionalProperties":{"type":["string","array","integer","number"],"item":{"type":"string"}}},"retrieveReferences":{"type":["array","string"],"items":{"type":"string"}},"containReferences":{"type":["array","string"],"items":{"type":"string"}},"downloadAttachments":{"type":["array","string"],"items":{"type":"string"}},"pageLimit":{"type":"integer"}},"additionalProperties":false},"template_item":{"type":"object","properties":{"path":{"type":["array","string"],"items":{"type":"string"}},"test":{"type":"string"},"id":{"type":"string"},"transform":{"type":"string"},"children":{"type":"array","minLength":1,"items":{"$ref":"#/definitions/template_item"}}}},"spreadsheet_template":{"additionalProperties":false,"type":"object","required":["name","template"],"properties":{"name":{"type":"string"},"extends":{"type":"array","items":{"type":"string"}},"sortBy":{"type":"array","items":{"type":"object","required":["name","dir"],"additionalProperties":false,"properties":{"name":{"type":"string"},"dir":{"type":"string","enum":["asc","desc"]}}}},"template":{"type":"array","minLength":1,"items":{"$ref":"#/definitions/template_item"}}}},"spreadsheet_templates":{"type":"object","additionalProperties":{"$ref":"#/definitions/spreadsheet_template"}}},"type":"object","required":["queryProfiles"],"additionalProperties":false,"properties":{"appName":{"type":"string"},"noCustomEndpoints":{"type":"boolean"},"credentials":{"$ref":"#/definitions/credentials"},"mimeTypeMappings":{"$ref":"#/definitions/mime_type_mappings"},"dateSortElements":{"$ref":"#/definitions/date_sort_elements"},"upload":{"$ref":"#/definitions/upload"},"redirectUri":{"type":["string","null"],"format":"uri"},"showWizard":{"type":"boolean"},"endpointLists":{"$ref":"#/definitions/endpoint_lists"},"queryProfiles":{"$ref":"#/definitions/query_profiles"},"spreadsheetTemplates":{"$ref":"#/definitions/spreadsheet_templates"},"warnOnPageNavigate":{"type":"boolean"},"ignoreState":{"type":"boolean"}}}')},262:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","type":"object","required":["name","uploadUrl","infoUrl"],"additionalProperties":false,"properties":{"name":{"type":"string"},"uploadUrl":{"type":"string","format":"uri"},"infoUrl":{"type":"string","format":"uri"},"successMessage":{"type":"string"},"continueLabel":{"type":"string"},"continueUrl":{"type":"string","format":"uri"}}}')},264:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/schema#","definitions":{"provider_secure":{"type":"object","required":["id","fhirEndpoint","orgId","name","queryProfile","redirectUri","scope"],"properties":{"isOpen":{"type":"boolean","enum":[false]},"id":{"type":["string","number"]},"name":{"type":"string"},"clientId":{"type":"string"},"clientSecret":{"type":"string"},"queryProfile":{"type":"string"},"orgId":{"type":"string"},"selected":{"type":"boolean"},"redirectUri":{"type":"string"},"scope":{"type":"array","items":{"type":"string","pattern":"^[-\\\\w]+/(\\\\*\\\\.)?[*-\\\\w+]+(\\\\.\\\\w+)?$"}},"fhirEndpoint":{"type":"string","format":"uri"}}},"provider_open":{"type":"object","required":["id","fhirEndpoint","orgId","name","queryProfile","redirectUri","scope","patient"],"properties":{"isOpen":{"type":"boolean","enum":[true]},"id":{"type":["string","number"]},"name":{"type":"string"},"clientId":{"type":"string"},"queryProfile":{"type":"string"},"orgId":{"type":"string"},"selected":{"type":"boolean"},"patient":{"type":"string"},"scope":{"type":"array","items":{"type":"string","pattern":"^[-\\\\w]+/(\\\\*\\\\.)?[*-\\\\w+]+(\\\\.\\\\w+)?$"}},"fhirEndpoint":{"type":"string","format":"uri"}}},"providers":{"type":"array","items":{"oneOf":[{"$ref":"#/definitions/provider_open"},{"$ref":"#/definitions/provider_secure"}]}},"github_config":{"type":"object","additionalProperties":false,"properties":{"token":{"type":"string"},"owner":{"type":"string"},"project":{"type":"string"}}}},"type":"object","required":["redirectUri","providers","githubConfig"],"additionalProperties":false,"properties":{"providers":{"$ref":"#/definitions/providers"},"redirectUri":{"type":"string","format":"uri"},"githubConfig":{"$ref":"#/definitions/github_config"}}}')},272:function(e,t,r){e.exports=r(535)},284:function(e,t){},286:function(e,t){},334:function(e,t){},359:function(e,t){},360:function(e,t){},403:function(e,t){e.exports={uiState:{mode:"loading"},spreadsheetTemplates:{},isDirty:!1,nonModalUi:{},queryProfile:{},mimeTypeMappings:{},githubConfig:{},upload:{},providers:[]}},535:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),o=r(41),i=r.n(o),l=r(155),s=r.n(l),c=r(11),d=r(258),u=r.n(d),m=r(106),p=r.n(m),h=r(4),f=r.n(h);function g(e,t={},r="DSTU2",a=null,n=0,o=0){if(t||(t={}),t.headers||(t.headers={}),!t.headers.Accept){const e="DSTU2"===r.toUpperCase()||"R2"===r.toUpperCase();t.headers.Accept=e?"application/json+fhir":"application/fhir+json"}return a&&(t.headers.Authorization="Bearer ".concat(a)),fetch(e,t).then(e=>{if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e}).then(e=>e.json()).then(t=>{if(!t.resourceType||"OperationOutcome"===t.resourceType){const r=t.issue&&t.issue[0]&&t.issue[0].diagnostics;throw new Error(r||"Fetch failed for "+e)}return t}).catch(i=>{if(n&&o<n)return g(e,t,r,a,n,o+1);throw i})}function y(e,t,r){if("string"===typeof e&&(e=e.split(".")),!t)return;const a=t[e[0]],n=e.slice(1);if(n.length||void 0===a)void 0!==a&&(Array.isArray(a)?a:[a]).forEach(e=>y(n,e,r));else{const n=r(a);void 0!==n&&(t[e[0]]=n)}return t}function E(e,t){if("string"===typeof e&&(e=e.split(".")),!t)return[];let r=t[e[0]]||[];Array.isArray(r)||(r=[r]);const a=e.slice(1);return a.length?r.map(e=>E(a,e)).reduce((e,t)=>e.concat(t),[]).filter(e=>void 0!==e):r}function b(e="",t){return/^http/.test(t)?t:e.replace(/\/*$/,"/")+t}function v(e,t,r="R2"){return e.meta=e.meta||{},"STU4"===r.toUpperCase()||"R4"===r.toUpperCase()?e.meta.source=e.meta.source||t:(e.meta.extension=e.meta.extension||[],e.meta.extension.push({url:"http://hl7.org/fhir/4.0/StructureDefinition/extension-Meta.source",valueUri:t})),e}function w({urls:e=[],fhirVersion:t,retryLimit:r,token:a,allowErrors:n,signal:o,statusCallback:i}){return Promise.all(f.a.map(e,e=>(i&&i(e),g(e,{signal:o},t,a,r).then(t=>({fullUrl:e,resource:t})).catch(t=>{if(!n||"AbortError"===t.name)throw t;return i&&i(e,!0),{fullUrl:e,error:t.message,requestType:"reference"}})))).then(e=>{const t=e.filter(e=>e.error),r=e.filter(e=>!e.error);return n?{entry:r,errorLog:t}:r})}function k({entry:e=[],paths:t=[],fhirEndpoint:r}){return t=(t=Array.isArray(t)?t:[t]).map(e=>/\.reference$/.test(e)?e:e+".reference"),f.a.reduce(e,(e,a,n)=>(f.a.each(t,t=>{f.a.each(E(t,a.resource),a=>{if(/^#/.test(a))return;const o=b(r,a);e[o]=e[o]||[],e[o].push({i:n,path:t,rawUrl:a})})}),e),{})}function C({entry:e=[],refEntry:t=[],refIndex:r={}}){return f.a.each(t,t=>{let a;f.a.each(r[t.fullUrl]||[],r=>{a||(a=e[r.i].resource,a.contained=e[r.i].resource.contained||[],a.contained.push(t.resource)),y(r.path,a,e=>{if(e===r.rawUrl)return"#"+t.resource.id})})}),e}function U({entry:e=[],paths:t=[],fhirEndpoint:r}){return t=Array.isArray(t)?t:[t],f.a.reduce(e,(e,a)=>(f.a.each(t,t=>{f.a.each(E(t,a.resource),t=>{if(!t.url||t.data)return;const a=b(r,t.url),n=t.contentType||"";e[a+"::"+n||""]=e[a+"::"+n||""]||{contentType:t.contentType,url:a,rawUrl:t.url,count:0},e[a+"::"+n||""].count+=1})}),e),{})}var j={fetchFHIR:g,replaceValue:y,pathToValues:E,findReferences:k,embedReferences:C,findAttachments:U,getResourcesByQuery:function({fhirEndpoint:e,query:t={},retryLimit:r=0,token:a,signal:n,allowErrors:o,statusCallback:i}){let l=[];return new Promise((s,c)=>{const d=(u,m=0,p=1)=>{i&&i(u),g(u,{signal:n},t.fhirVersion,a,r).then(r=>{if("Bundle"!==r.resourceType)return r=v(r,e,t.fhirVersion),s({query:t,entry:[{resource:r,fullUrl:u}]});l=l.concat((r.entry||[]).filter(e=>"OperationOutcome"!==e.resource.resourceType).map(r=>(r.resource=v(r.resource,e,t.fhirVersion),r.fullUrl=b(e,r.resource.resourceType+"/"+r.resource.id),r)));const a=r.link&&r.link.find(e=>"next"===e.relation);return a&&(!t.pageLimit||p<t.pageLimit)?d(a.url,m,p+1):s({entry:l,query:t})}).catch(e=>{o&&"AbortError"!==e.name?(i&&i(u,!0),s({errorLog:[{fullUrl:u,error:e.message,requestType:"query"}],entry:[],errorCount:1})):c(e)})},u=e.replace(/\/*$/,"/")+(t.resourcePath||"")+(Object.keys(t.params||{}).length?(m=t.params,"?"+Object.keys(m).map(e=>{const t=Array.isArray(m[e])?m[e].join(","):m[e];return e+"="+encodeURIComponent(t)}).join("&")):"");var m;d(u)})},followAndEmbedReferences:function({entry:e=[],paths:t=[],fhirEndpoint:r,fhirVersion:a,retryLimit:n=0,token:o,allowErrors:i,signal:l,statusCallback:s}){const c=k({entry:e,paths:t,fhirEndpoint:r});return w({urls:f.a.keys(c),fhirVersion:a,retryLimit:n,token:o,allowErrors:i,signal:l,statusCallback:s}).then(t=>{const r=i?t.entry:t,a=C({entry:e,refEntry:r,refIndex:c});return i?{entry:a,errorLog:t.errorLog}:a})},followReferences:function({entry:e=[],paths:t=[],fhirEndpoint:r,fhirVersion:a,retryLimit:n=0,token:o,allowErrors:i,signal:l,statusCallback:s}){const c=k({entry:e,paths:t,fhirEndpoint:r});return w({urls:f.a.keys(c),fhirVersion:a,retryLimit:n,token:o,allowErrors:i,signal:l,statusCallback:s}).then(e=>(i&&(e.errorCount=f.a.reduce(e.errorLog,(e,t)=>e+c[t.fullUrl].length,0)),e))},findAndDownloadAttachments:function({entry:e=[],paths:t=[],fhirEndpoint:r,token:a,allowErrors:n,retryLimit:o=0,signal:i,statusCallback:l,mimeTypeMappings:s={}}){const c=U({entry:e,paths:t,fhirEndpoint:r}),d=(e,t={},r=0,a=0)=>fetch(e,t).then(e=>{if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e}).catch(n=>{if(r&&a<r)return d(e,t,r,a+1);throw n});let u=0;return Promise.all(f.a.map(c,e=>{let t={signal:i,headers:{Authorization:a?"Bearer ".concat(a):void 0,Accept:e.contentType||void 0}};return l&&l(e.url),d(e.url,t,o).then(e=>e.blob()).then(t=>{const r=e.url.match(/\.(.{3})$|\.(.{4})$/),a=e.contentType&&s[e.contentType],n=r&&r[1]||a;return{fileName:(u+=1).toString()+(n?"."+n:""),fullUrl:e.url,blob:t,contentType:e.contentType,rawUrl:e.rawUrl}}).catch(t=>{if(!n||"AbortError"===t.name)throw t;return l&&l(e.url,!0),{fullUrl:e.url,contentType:e.contentType,error:t.message,requestType:"attachment",rawUrl:e.rawUrl}})})).then(e=>{if(!n)return e;const t=e.filter(e=>e.error),r=f.a.reduce(t,(e,t)=>e+c[t.fullUrl+"::"+t.contentType||""].count,0),a=e.filter(e=>!e.error);return n?{files:a,errorLog:t,errorCount:r}:a})},attachmentsToFilenames:function({entry:e=[],files:t=[],paths:r}){return r=Array.isArray(r)?r:[r],f.a.each(e,e=>{f.a.each(r,r=>{e.resource=y(r,e.resource,e=>{const r=t.find(t=>t.rawUrl===e.url&&t.contentType===e.contentType);if(r)return Object(c.a)({},e,{url:r.fileName})})})}),e}};const O="Authorization endpoint or token endpoint not found";function S(e){return fetch(e+".well-known/smart-configuration").then(e=>{if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e}).then(e=>e.json()).then(e=>{let t={registrationEndpoint:e.registration_endpoint,authorizationEndpoint:e.authorization_endpoint,tokenEndpoint:e.token_endpoint};if(t.authorizationEndpoint&&t.tokenEndpoint)return t;throw O}).catch(e=>{throw O})}function x(e){const t=e+"metadata";return j.fetchFHIR(t).then(e=>{const t=(function(e,t=""){return(t=t.trim())?t.split(".").reduce((e,t)=>e?e[t]:void 0,e):e}(e||{},"rest.0.security.extension")||[]).filter(e=>"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris"===e.url).map(e=>e.extension)[0];let r={};if(t&&t.forEach(e=>{"register"===e.url&&(r.registrationEndpoint=e.valueUri),"authorize"===e.url&&(r.authorizationEndpoint=e.valueUri),"token"===e.url&&(r.tokenEndpoint=e.valueUri)}),r.authorizationEndpoint&&r.tokenEndpoint)return r;throw O}).catch(e=>{throw O})}var P={getWellKnownEndpoints:S,getCapabilityEndpoints:x,getAuthEndpoints:function(e){const t=e.replace(/\/*$/,"/");return new Promise((e,r)=>{S(t).then(t=>e(t)).catch(a=>{x(t).then(t=>e(t)).catch(e=>r(O))})})},buildQs:function(e){return"?"+Object.keys(e).map(t=>{const r=Array.isArray(e[t])?e[t].join(","):e[t];return t+"="+encodeURIComponent(r)}).join("&")},buildAuthorizeUrl:function(e,t,r,a,n,o,i,l){Array.isArray(a)&&(a=a.join(" "));let s=["response_type=code","client_id="+encodeURIComponent(o),"scope="+encodeURIComponent(a),"redirect_uri="+encodeURIComponent(n),"aud="+encodeURIComponent(t),"state="+r];return l&&s.push("launch="+encodeURIComponent(l)),i&&s.push("client_secret="+encodeURIComponent(i)),e+"?"+s.join("&")},exchangeCodeForToken:function(e,t,r,a,n){let o={method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},body:["grant_type=authorization_code","code="+encodeURIComponent(t),"redirect_uri="+encodeURIComponent(r)].join("&")};return n?o.headers.Authorization="Basic ".concat(btoa("".concat(a,":").concat(n))):o.body+="&client_id="+encodeURIComponent(a),fetch(e,o)},refreshToken:function(e,t){return fetch(e,{method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},mode:"cors",body:["grant_type=refresh_token","refresh_token="+encodeURIComponent(t)].join("&")})},generateStateParam:function(e=32){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r=[];for(;e--;)r.push(t.charAt(Math.floor(Math.random()*t.length)));return r.join("")}};class N{constructor(e){this.provider=e,this.authWindow=window.open("","_blank"),this.authWindow.document.write("Loading...")}parseQs(e){const t=e.split("&");let r={};return t.forEach(e=>{e=e.split("="),r[e[0]]=decodeURIComponent(e[1]||"")}),r}cancel(){this.reject&&(clearInterval(this.popupPoll),window.removeEventListener("message",this.messageListener),this.authWindow.close(),this.reject(new Error("cancelled")))}authorize(e,t){return new Promise((r,a)=>{this.reject=a;const n=P.generateStateParam();this.popupPoll=setInterval(()=>{this.authWindow.closed&&(clearInterval(this.popupPoll),window.removeEventListener("message",this.messageListener),a(new Error("Login window closed by user")))},500);const o=P.buildAuthorizeUrl(e.authorizationEndpoint,this.provider.fhirEndpoint,n,this.provider.scope,this.provider.redirectUri,this.provider.clientId);this.messageListener=window.addEventListener("message",o=>{if(o.origin!==window.location.origin)return;if("string"!==typeof o.data)return;clearInterval(this.popupPoll),window.removeEventListener("message",this.messageListener),this.authWindow.close();const i=this.parseQs(o.data);i.error?a(i.error):i.code&&!0!==t&&i.state!==n?a("Invalid state parameter returned by server"):i.code?P.exchangeCodeForToken(e.tokenEndpoint,i.code,this.provider.redirectUri,this.provider.clientId,this.provider.clientSecret).then(e=>e.json()).then(e=>{e.access_token?r(e):(console.log(e),a("No access token in server token response"))}):a("Failed to retrieve code parameter")},!1),this.authWindow.location.href=o})}}var T=r(160),D=r.n(T),L=r(27),A=r.n(L),I=r(259),R=r(260),q=r(261),_=r.n(q),z=r(262);class F{cancel(){this.controller.abort()}resetCancelled(){this.controller=new AbortController,this.signal=this.controller.signal}isValidUrl(e,t){return void 0!==f.a.find(t,t=>_()(e,t))}getManifest(e){this.resetCancelled();const t={signal:this.signal,accept:"application/json"};return fetch(e,t).then(e=>{if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e}).then(e=>e.json()).then(t=>{if(A.a.validate(t,z),A.a.error)throw console&&console.log(A.a.error),new Error(e+": "+A.a.error.message);return t})}putFile(e,t){this.resetCancelled();const r={signal:this.signal,method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:t};return fetch(e,r).then(e=>{if(!e.ok)throw new Error("HTTP ".concat(e.status," - ").concat(e.statusText));return e}).then(e=>{const t=e.headers.get("content-type");return t&&-1!==t.indexOf("application/json")?e.json():{}}).then(e=>{if(e.error)throw new Error(e.error)}).catch(e=>{throw console.log(e),"AbortError"===e.name?e:new Error("An error occurred sending your data: ".concat(e.message))})}}var B={merge:function(e){const t=(e,t)=>(f.a.each(t,t=>{const a=t.id?f.a.findIndex(e,e=>e.id===t.id):-1;t._?a>-1&&e.splice(a,1):a>-1?e[a]=r(e[a],t):e.push(t)}),e),r=(e,a)=>(f.a.each(f.a.keys(a),n=>{"_"===n[0]?e[n.slice(1)]=a[n]:void 0===e[n]?e[n]=a[n]:f.a.isPlainObject(a[n])&&a[n]._?delete e[n]:f.a.isPlainObject(a[n])?e[n]=r(e[n],a[n]):f.a.isArray(e[n])&&f.a.isArray(a[n])?e[n]=t(e[n],a[n]):e[n]=a[n]}),e);let a=JSON.parse(JSON.stringify(e[0]));return f.a.each(e,(e,n)=>{0!==n&&(e=JSON.parse(JSON.stringify(e)),a=f.a.isPlainObject(a)&&f.a.isPlainObject(e)?r(a,e):f.a.isArray(a)&&f.a.isArray(e)?t(a,e):e)}),a}};function M(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function $(e,t){return p()(e,{headers:{Accept:"application/json"}}).then(r=>{if(!r.ok&&!t)throw new Error("".concat(e," - HTTP ").concat(r.status," - ").concat(r.statusText));return!r.ok&&t&&(r={text:()=>"{}"}),r}).then(e=>e.text()).then(t=>{try{return JSON.parse(D()(t))}catch(r){throw console.log(r),new Error("".concat(e," is not valid JSON."))}})}var H={loadConfigFile:function(e,t,r){let a=[$(e)];const n=M("config");return n&&r?a.push($(n,!0)):t&&a.push($(t,!0)),Promise.all(a).then(e=>B.merge(e)).then(t=>{if(A.a.validate(t,R),A.a.error)throw console&&console.log(A.a.error),new Error(e+": "+A.a.error.message);return t}).then(t=>{if(!t.endpointLists)return t;const r=f.a.find(f.a.keys(t.endpointLists)||[],e=>{const r=t.endpointLists[e];return r&&r.defaults&&r.defaults.queryProfile&&!t.queryProfiles[r.defaults.queryProfile]});if(r)throw new Error("Invalid query profile in endpoint "+e+": /endpointLists/"+r+"/defaults");const a=f.a.find(f.a.keys(t.endpointLists)||[],e=>{const r=t.endpointLists[e];return r&&r.defaults&&r.defaults.credentialId&&!t.credentials[r.defaults.credentialId]});if(a)throw new Error("Invalid credential id in endpoint "+e+": /endpointLists/"+a+"/defaults");return t}).then(e=>{if(!e.spreadsheetTemplates)return e;const t=Object.keys(e.spreadsheetTemplates);return t.forEach(r=>{(e.spreadsheetTemplates[r].extends||[]).forEach(e=>{if(-1===t.indexOf(e))throw new Error("Invalid base template name in '"+r+"'")})}),e}).then(e=>e.endpointLists?function(e){const t=f.a.chain(e.endpointLists).map((e,t)=>({l:e,id:t})).sortBy("id").reverse().map(t=>((t,r)=>{if(t.path)return p()(t.path,{headers:{Accept:"application/json"}}).then(e=>{if(!e.ok)throw new Error("".concat(t.path," - HTTP ").concat(e.status," - ").concat(e.statusText));return e}).then(e=>e.text()).then(e=>{try{return JSON.parse(D()(e))}catch(r){throw console.log(r),new Error("".concat(t.path," is not valid JSON."))}}).then(e=>{if("Bundle"!==e.resourceType)return e;return{entry:f.a.chain(e.entry).filter(e=>e.resource&&e.resource.name&&e.resource.address&&"active"===e.resource.status).map(e=>({fhirEndpoint:e.resource.address,name:e.resource.name})).value()}}).then(e=>{if(A.a.validate(e,I),A.a.error)throw console&&console.log(A.a.error),new Error(t.path+": "+A.a.error.message);return e}).then(r=>((r.entry||r.Entries||[]).forEach(r=>{if(r.queryProfile&&!e.queryProfiles[r.queryProfile])throw new Error("Invalid query profile in endpoint list "+t.path+" - "+r.queryProfile)}),(r.entry||r.Entries||[]).forEach(r=>{if(r.credentialId&&!e.credentials[r.credentialId])throw new Error("Invalid credential id endpoint list "+t.path+" - "+r.credentialId)}),r)).then(e=>(e.Entries||e.entry).map(e=>{let a=Object(c.a)({},e);return a.OrganizationName&&(a.name=a.OrganizationName,delete a.OrganizationName),a.FHIRPatientFacingURI&&(a.fhirEndpoint=a.FHIRPatientFacingURI,delete a.FHIRPatientFacingURI),a.id&&(a.orgId=a.id,delete a.id),a.orgId||(a.orgId=a.name.replace(/\W/g,"")),t.defaults&&(a.defaultId=r),a})).catch(e=>{if(e.message)throw e;throw new Error("Error reading "+t.path)})})(t.l,t.id).then(e=>e.reverse())).value();return Promise.all(t).then(t=>{const r=f.a.unionBy(...t,"orgId"),a=f.a.mapValues(e.endpointLists,e=>e.defaults);return Object(c.a)({},e,{orgDefaults:a,organizations:r,endpointLists:null})})}(e):e).then(e=>(e.redirectUri=e.redirectUri||window.location.href.split(/\?|#/)[0].replace(/\/*$/,"/callback.html"),e)).then(e=>function(e){const t=M("upload_manifest_url");t&&(e.upload=e.upload||{},e.upload.manifestUrl=t,e.upload.qsManifestUrl=!0);const r=M("upload_label");return r&&(e.upload=e.upload||{},e.upload.label=r),M("wizard")&&(e.showWizard=!0),e}(e)).then(e=>{if(!e.showWizard||e.upload&&!e.upload.manifestUrl)return e;if(!e.upload||!e.upload.manifestUrl&&!e.upload.uploadUrl)throw new Error("Upload configuration required for wizard mode");const t=new F;if(e.upload.qsManifestUrl){if(!t.isValidUrl(e.upload.manifestUrl,e.upload.whitelist))throw new Error("Url manifest location not in whitelist: "+e.upload.manifestUrl)}return t.getManifest(e.upload.manifestUrl).then(t=>(e.upload=Object(c.a)({},e.upload,{},t),e)).catch(t=>{throw new Error("Unable to load manifest at "+e.upload.manifestUrl)})})}},V=r(59),W=r.n(V),J=r(77),G=r.n(J),Q=r(40),Y=r.n(Q);function Z(e,t){const r=f.a.chain(t.data.entry).groupBy(e=>e.resource.resourceType).mapValues(e=>({entry:f.a.map(e,e=>({fullUrl:e.fullUrl,resource:e.resource})),total:e.length,type:"collection"})).value();f.a.each(r,(t,r)=>{e.file(r+".json",JSON.stringify(t,null,2))}),f.a.each(t.data.files,t=>{e.file(t.fileName,t.blob,{type:"blob"})}),t.data.errorLog.length&&e.file("error_log.json",JSON.stringify(t.data.errorLog,null,2))}function K(e){return new Promise((t,r)=>{const a=new G.a;e.filter(e=>e.data&&e.selected).forEach(e=>{Z(a.folder(W()(e.name)),e)}),a.generateAsync({type:"blob"}).then(t).catch(r)})}var X={generateFile:function(e,t){const r=f.a.filter(e,e=>e.data&&e.data.entry&&e.selected&&(e.data.entry.length||e.data.errorLog.length)),a=new Date,n=new Date(a.getTime()-6e4*a.getTimezoneOffset());return G.a.defaults.date=n,r.length>1?function(e,t="procure-data.zip"){return K(e).then(e=>Object(Q.saveAs)(e,t))}(r,t):(o=r[0],new Promise((e,t)=>{const r=new G.a;Z(r,o);const a=W()(o.name);r.generateAsync({type:"blob"}).then(e=>Object(Q.saveAs)(e,a)).then(e).catch(t)}));var o},exportProvidersAsBlob:K};function ee(e,t,r="GET",a){const n={headers:{Authorization:"Bearer ".concat(e.token)},method:r};a&&(n.body=JSON.stringify(a));const o="".concat(e.baseUrl||"https://api.github.com","/repos/").concat(e.owner,"/").concat(e.project,"/").concat(t);return fetch(o,n).then(e=>{if(e.ok)return e.json();if(404===e.status)throw new Error("Repository not found");if(500===e.stats)throw new Error(e.message||"Github API returned a 500 error");return e.json().then(e=>{throw new Error(e.message)})})}var te={getLastCommit:function(e,t="master"){return ee(e,"git/refs/heads/".concat(t)).catch(e=>{throw"Git Repository is empty."===e.message&&(e.message="Git repository is empty. Please initialize the repository and try again."),e})},getTree:function(e,t){return ee(e,"git/trees/".concat(t.object.sha)).then(e=>{if(e.truncated)throw new Error("Unable to load entire head tree - too many files");return e}).catch(e=>{if("Repository not found"===e.message)return{tree:[]}})},createBlob:function(e,t){return ee(e,"git/blobs","POST",t)},createTree:function(e,t){return ee(e,"git/trees","POST",t)},commitTree:function(e,t,r,a,n="master"){return ee(e,"git/commits","POST",{message:r,tree:t.sha,parents:[a.object.sha]}).then(t=>ee(e,"git/refs/heads/".concat(n),"PATCH",{sha:t.sha}))},commitTreeToPullRequest:function(e,t,r,a,n,o,i="master",l){return ee(e,"git/commits","POST",{message:r,tree:t.sha,parents:[a.object.sha]}).then(t=>ee(e,"git/refs","POST",{ref:"refs/heads/".concat(o),sha:t.sha})).then(()=>ee(e,"pulls","POST",{title:n,body:l,head:o,base:i,maintainer_can_modify:!0}))}};var re=r(263),ae=r.n(re);const ne={validateExists:e=>void 0!==e,validateCode:(e,t)=>!!e&&(Array.isArray(e)||(e=[e]),!!e.find(e=>e.code===t.target)),validateCodeableConcept:(e,t)=>!!e&&(Array.isArray(e)||(e=[e]),!!e.find(e=>e.coding.find(e=>e.code===t.target))),validateValue:(e,t)=>e===t.target,getHelperData:(e,t,r)=>r[t.helperDataField],stringifyCodings:e=>e?(Array.isArray(e)||(e=[e]),e.map(e=>e.system+"|"+e.code).join(" ")):e,parseDateForExcel:(e,t,r)=>e&&"csv"!==r.format?new Date(e):e};function oe(e,t,r={},a){a=a||ne;let n=[];return f.a.each(t,t=>{const o=e=>{0===n.length&&(n=[{}]);let t=[];f.a.each(e,e=>{f.a.isArray(e)||(e=[e]),f.a.each(e,e=>{f.a.each(n,r=>{t.push(Object(c.a)({},r,{},e))})})}),n=t};f.a.isArray(t.path)||(t.path=[t.path]);let i=f.a.chain(e).at(e,t.path).filter(e=>void 0!==e).first().value();if(!i&&t.path.indexOf("*")>-1&&(i=e),t.transform&&(i=a[t.transform](i,t,r)),!(void 0===t.test||a[t.test](i,t,r)))return n=null,!1;if(t.children){f.a.isArray(i)||(i=[i]);const e=f.a.map(i,e=>oe(e,t.children,r,a));if(e.indexOf(null)>-1)return n=null,!1;o(e)}else if(t.name){f.a.isArray(i)||(i=[i]),o(i.map(e=>({[t.name]:e})))}}),n}function ie(e,t,r={},a){return f.a.chain(e).filter(e=>e.selected&&e.data&&e.data.entry&&e.data.entry.length>0).map(e=>f.a.chain(e.data.entry).map(n=>{const o=Object(c.a)({},r,{source:e.name});return oe(n.resource,t,o,a)}).flatten().value()).flatten().filter(e=>null!==e).value()}function le(e){let t=[];const r=e=>{f.a.each(e,e=>{e.name&&t.push(e.name),e.children&&r(e.children)})};return r(e||e.template),t}function se(e,t,r){const a=le(t),n=e.map(e=>a.map(t=>e[t])),o=(e=>{const t=e.map(e=>e.map(e=>{let t=null===e?"":e.toString();return e instanceof Date&&(t=e.toLocaleString()),t=t.replace(/"/g,'""'),t.search(/("|,|\n)/g)>=0&&(t='"'+t+'"'),t}).join(",")).join("\n");return new Blob([t],{type:"text/csv;charset=utf-8;"})})([a].concat(n));return new Promise(e=>{Y()(o,W()(r)+".csv"),e()})}var ce={flatten:oe,flattenProviders:ie,defaultHelperFns:ne,exportSpreadsheet:function(e,t,r,a){const n=t[r],o=f.a.map(n.extends||[],e=>t[e]).concat([n]),i=B.merge(o);let l=ie(e,i.template,{format:a});if(i.sortBy){const e=f.a.map(i.sortBy,e=>e.name),t=f.a.map(i.sortBy,e=>e.dir||"desc");l=f.a.orderBy(l,e,t)}return l=l.map(e=>f.a.mapValues(e,e=>void 0===e?null:e)),"xlsx"===a?function(e,t,r){const a=le(t);let n=[];const o=e.map(e=>a.map((t,r)=>(e[t]instanceof Date&&-1===n.indexOf(r+1)&&n.push(r+1),e[t])));return ae.a.fromBlankAsync().then(e=>(e.sheet(0).name(r).cell("A1").value([a].concat(o)),n.forEach(t=>{e.sheet(0).column(t).style("numberFormat","dddd, mmmm dd, yyyy")}),e.outputAsync())).then(e=>{Y()(e,W()(r)+".xlsx")})}(l,i.template,i.name):se(l,i.template,i.name)}},de=r(264);function ue(e,t,r){const a={providers:f.a.map(e,e=>Object(c.a)({},e,{lastUpdated:null,data:null})),githubConfig:t,redirectUri:r};return JSON.stringify(a,null,2)}var me={buildJSON:ue,download:function(e,t,r,a="procure-settings.json"){const n=ue(e,t,r),o=new Blob([n],{type:"application/json;charset=utf-8"});Y()(o,a)},readFromFile:function(e,t,r){const a=new FileReader;return new Promise((t,r)=>{a.onload=e=>t(a.result),a.onerror=e=>r(e),a.readAsText(e)}).then(e=>{try{return JSON.parse(e)}catch(t){throw new Error("Unable to read file")}}).then(e=>{if(e.redirectUri!==t)throw new Error("Only settings saved from this website can be imported");return e}).then(e=>{if(A.a.validate(e,de),A.a.error)throw console&&console.log(A.a.error),new Error("Invalid file format: "+A.a.error.message);return e}).then(e=>(f.a.each(e.providers,e=>{if(!r[e.queryProfile])throw new Error("Query profile not found: "+e.queryProfile)}),e))}};let pe;pe=r(403);const he=new class{resetAbortController(){this.controller=new AbortController,this.signal=this.controller.signal}cancel(){this.popup?this.popup.cancel():this.controller.abort()}mergeAndDeDupeData(e){let t={},r=[],a=[],n=[],o=0;return e.forEach(e=>{e.entry.forEach(e=>{t[e.fullUrl]||(t[e.fullUrl]=!0,a.push(e))}),r=r.concat(e.files||[]),n=n.concat(e.errorLog||[]),o+=e.errorCount||0}),{entry:a,files:r,errorLog:n,errorCount:o}}getFHIR(e,t,r,a=!0,n={},o,i){const l=r?r.patient:e.patient;return this.resetAbortController(),Promise.all(t.queries.map(s=>{let d=Object(c.a)({},s.params);Object.keys(d).forEach(e=>{Array.isArray(d[e])&&(d[e]=d[e].join(",")),d[e]=d[e].toString().replace("{{patientId}}",l)});const u=s.resourcePath.replace(/\{\{patientId\}\}/g,l);return j.getResourcesByQuery({fhirEndpoint:e.fhirEndpoint,query:Object(c.a)({},s,{params:d,resourcePath:u,fhirVersion:t.fhirVersion}),token:r?r.access_token:null,retryLimit:o,allowErrors:a,statusCallback:i,signal:this.signal}).then(n=>s.containReferences?j.followAndEmbedReferences({entry:n.entry,paths:s.containReferences,fhirEndpoint:e.fhirEndpoint,fhirVersion:t.fhirVersion,token:r?r.access_token:null,retryLimit:o,allowErrors:a,statusCallback:i,signal:this.signal}).then(e=>(n.errorLog=n.errorLog||[],n.errorLog=n.errorLog.concat(e.errorLog),n.errorCount=n.errorCount||0,n.errorCount+=e.errorCount,n.entry=e.entry,n)):n).then(n=>s.retrieveReferences?j.followReferences({entry:n.entry,paths:s.retrieveReferences,fhirEndpoint:e.fhirEndpoint,fhirVersion:t.fhirVersion,token:r?r.access_token:null,retryLimit:o,allowErrors:a,statusCallback:i,signal:this.signal}).then(e=>(n.errorLog=n.errorLog||[],n.errorLog=n.errorLog.concat(e.errorLog),n.errorCount=n.errorCount||0,n.errorCount+=e.errorCount,n.entry=n.entry.concat(e.entry),n)):n).then(a=>s.downloadAttachments?j.findAndDownloadAttachments({entry:a.entry,paths:s.downloadAttachments,fhirEndpoint:e.fhirEndpoint,fhirVersion:t.fhirVersion,token:r?r.access_token:null,retryLimit:o,mimeTypeMappings:n,allowErrors:!0,statusCallback:i,signal:this.signal}).then(e=>(a.errorLog=a.errorLog||[],a.errorLog=a.errorLog.concat(e.errorLog||[]),a.errorCount=a.errorCount||0,a.errorCount+=e.errorCount,a.files=e.files,a.entry=j.attachmentsToFilenames({entry:a.entry,files:e.files,paths:s.downloadAttachments}),a)):a)})).then(this.mergeAndDeDupeData)}authAndGetFHIR(e,t){return this.popup=new N(e),P.getAuthEndpoints(e.fhirEndpoint).then(e=>this.popup.authorize(e,t)).then(e=>(this.popup=null,e)).catch(e=>{throw this.popup=null,e})}},fe=new class{cancel(){this.canceled=!0}blobToBase64(e){return new Promise((t,r)=>{let a=new FileReader;a.onload=()=>{const e=a.result.split(",")[1];t(e)},a.onerror=r,a.readAsDataURL(e)})}buildProviderTree(e,t){const r=(e,r,a="utf-8")=>{if(this.canceled)throw new Error("Canceled");return this.statusCb&&this.statusCb("Adding "+t+"/"+r),te.createBlob(this.config,{content:e,encoding:a}).then(e=>({sha:e.sha,path:t+"/"+r,mode:"100644",type:"blob"}))},a=f.a.chain(e.data.entry).groupBy(e=>e.resource.resourceType).mapValues(e=>({entry:f.a.map(e,e=>({fullUrl:e.fullUrl,resource:e.resource})),total:e.length,type:"collection"})).value();return Promise.all([(e=>Promise.all(f.a.map(e,(e,t)=>r(JSON.stringify(e,null,2),t+".json"))))(a),(e=>Promise.all(f.a.map(e,e=>this.blobToBase64(e.blob).then(t=>r(t,e.fileName,"base64")))))(e.data.files),(n=e.data.errorLog,n.length?r(JSON.stringify(n,null,2),"error_log.json").then(e=>[e]):Promise.resolve([]))]).then(e=>f.a.flatten(e));var n}buildTree(e,t){const r=f.a.filter(t,e=>e.selected&&e.data&&e.data.entry&&(e.data.entry.length||e.data.errorLog.length)),a=f.a.map(r,e=>W()(e.name)),n=f.a.filter(e.tree,e=>!a.find(t=>"tree"===e.type&&e.path===t));return Promise.all(f.a.map(r,(e,t)=>this.buildProviderTree(e,a[t]))).then(t=>Object(c.a)({},e,{tree:n.concat(f.a.flatten(t))}))}prepareCommit(e){let t;return this.statusCb&&this.statusCb("Retrieving repository information"),te.getLastCommit(this.config).then(e=>{if(t=e,this.canceled)throw new Error("canceled");return te.getTree(this.config,e)}).then(t=>{if(this.canceled)throw new Error("canceled");return this.buildTree(t,e)}).then(e=>{if(this.canceled)throw new Error("canceled");return te.createTree(this.config,e)}).then(e=>({tree:e,lastCommit:t}))}export(e,t,r,a){return this.config=t,this.canceled=!1,this.statusCb=r,t.pullRequest?this.commitPullRequest(e,a):this.commitToMaster(e)}commitToMaster(e){return this.prepareCommit(e).then(({tree:e,lastCommit:t})=>{if(this.canceled)throw new Error("canceled");return this.statusCb&&this.statusCb("Committing files"),te.commitTree(this.config,e,"ProcureBot Commit",t).then(()=>{this.statusCb&&this.statusCb("Data has been committed to master branch")})})}commitPullRequest(e,t){return t||(t="Procure/"+(new Date).toISOString().replace(/:/g,"-")),this.prepareCommit(e).then(({tree:e,lastCommit:r})=>{if(this.canceled)throw new Error("canceled");return this.statusCb&&this.statusCb("Creating pull request"),te.commitTreeToPullRequest(this.config,e,"ProcureBot commit",r,"ProcureBot pull request",t).then(e=>{this.statusCb&&this.statusCb("A new pull request has been created",e.html_url)})})}},ge=new F;let ye;const Ee=()=>Math.random().toString(36);var be=u()([e=>{e.on("@init",()=>pe),e.on("uiState/set",(e,t)=>({uiState:t})),e.on("uiState/merge",({uiState:e},t)=>({uiState:Object(c.a)({},e,{},t)})),e.on("uiState/incrementCounts",({uiState:e},t)=>(Object.keys(t).forEach(r=>{t[r]=t[r]+(e[r]||0)}),{uiState:Object(c.a)({},e,{},t)})),e.on("wizard/hide",()=>({showWizard:!1,uiState:{mode:"ready"}})),e.on("nonModalUi/merge",({nonModalUi:e},t)=>({nonModalUi:Object(c.a)({},e||{},{},t)})),e.on("refreshDirty",({providers:e,githubConfig:t,redirectUri:r,dirtySnapshot:a},n)=>{const o=me.buildJSON(e,t,r);return n?{isDirty:!1,dirtySnapshot:o}:{isDirty:a!==o}}),e.on("providers/add",({providers:e},t)=>(t.id||(t.id=Ee()),t.selected=!0,console.log(t),{providers:e.concat([t])})),e.on("providers/update",({providers:e},t)=>({providers:e.map(e=>e.id!==t.id?e:Object(c.a)({},e,{},t))})),e.on("providers/upsert",(t,r)=>{r.id?e.dispatch("providers/update",r):(r.id=Ee(),e.dispatch("providers/add",r))}),e.on("providers/upsertAndLoad",(t,r)=>{e.dispatch("providers/upsert",r),e.dispatch("fhir/loadData",r.id)}),e.on("providers/remove",({providers:e},t)=>({providers:e.filter(e=>e.id!==t)})),e.on("config/load",(t,r="ready")=>{e.dispatch("uiState/set",{mode:"loading"});H.loadConfigFile("./config/config.json","./config/config-override.json",!1).then(t=>{e.dispatch("config/merge",t),e.dispatch("uiState/set",{mode:r}),e.dispatch("refreshDirty",!0)}).catch(t=>{e.dispatch("uiState/set",{mode:"globalError",error:t})})}),e.on("config/merge",(e,t)=>Object(c.a)({},e,{},t)),e.on("fhir/loadData",({providers:t,queryProfiles:r,mimeTypeMappings:a,ignoreState:n},o)=>{const i=t.find(e=>e.id===o),l=r[i.queryProfile],s=r[i.queryProfile].retryLimit||0,c=t=>{e.dispatch("uiState/set",{mode:"loadData",submode:"loaded",data:t,id:i.id})},d=(t,r)=>{console&&console.log("Fetching: ",t),e.dispatch("uiState/incrementCounts",{requestCount:1,errorCount:r?1:0})},u=t=>{e.dispatch("uiState/merge",{submode:"loading"}),he.getFHIR(i,l,t,!0,a,s,d).then(c).catch(m)},m=t=>{"cancelled"!==t.message&&"AbortError"!==t.name&&e.dispatch("uiState/set",{mode:"loadData",submode:"error",status:t.message||t,id:i.id})};i.isOpen?(e.dispatch("uiState/set",{mode:"loadData",submode:"loading",id:i.id}),u()):(e.dispatch("uiState/set",{mode:"loadData",submode:"authorizing",id:i.id}),he.authAndGetFHIR(i,n).then(u).catch(m))}),e.on("fhir/cancelLoad",(t,r="ready")=>{he.cancel(),e.dispatch("uiState/set",{mode:r})}),e.on("export/download",({providers:t})=>{e.dispatch("nonModalUi/merge",{isDownloading:!0}),X.generateFile(t).catch(t=>{e.dispatch("uiState/set",{mode:"ready",error:t.message})}).finally(()=>{e.dispatch("nonModalUi/merge",{isDownloading:!1})})}),e.on("export/spreadsheet",({providers:t,spreadsheetTemplates:r},a)=>{e.dispatch("nonModalUi/merge",{isExportingSheet:!0}),ce.exportSpreadsheet(t,r,a.templateId,a.format).catch(t=>{e.dispatch("uiState/set",{mode:"globalError",error:t})}).finally(()=>{e.dispatch("nonModalUi/merge",{isExportingSheet:!1})})}),e.on("export/github",({githubConfig:t,providers:r})=>{e.dispatch("uiState/merge",{submode:"push",error:null}),fe.export(r,t,(t,r)=>{e.dispatch("uiState/merge",{status:t,statusUrl:r})}).then(()=>{e.dispatch("uiState/merge",{submode:null})}).catch(t=>{e.dispatch("uiState/set",{mode:"githubExport",error:"canceled"===t.message?null:t.message})})}),e.on("export/github/cancel",()=>{fe.cancel(),e.dispatch("uiState/set",{mode:"githubExport"})}),e.on("export/upload",({upload:t})=>{if(e.dispatch("uiState/set",{mode:"fileUpload",submode:"getManifest",status:"Preparing to send data"}),t.qsManifestUrl){if(!ge.isValidUrl(t.manifestUrl,t.whitelist))return e.dispatch("uiState/merge",{submode:"error",status:"Url manifest location not in whitelist: "+t.manifestUrl})}if(t.uploadUrl&&!t.manifestUrl)return e.dispatch("uiState/merge",{submode:"preUpload"});ge.getManifest(t.manifestUrl).then(r=>{e.dispatch("config/merge",{upload:Object(c.a)({manifestUrl:t.manifestUrl,label:t.label},r)}),e.dispatch("uiState/merge",{submode:"preUpload"})}).catch(r=>{e.dispatch("uiState/merge",{submode:"error",status:"Unable to load manifest at "+t.manifestUrl})})}),e.on("export/upload/cancel",({upload:e})=>{if(e.simulate)return window.clearTimeout(ye);ge.cancel()}),e.on("export/upload/send",({upload:t,providers:r})=>{if(e.dispatch("uiState/set",{mode:"fileUpload",submode:"uploading",status:"Uploading Data"}),t.simulate)return ye=window.setTimeout(()=>{e.dispatch("uiState/merge",{submode:"postUpload"})},2e3);X.exportProvidersAsBlob(r).then(e=>ge.putFile(t.uploadUrl,e)).then(()=>{e.dispatch("uiState/merge",{submode:"postUpload"})}).catch(t=>{"AbortError"!==t.name&&e.dispatch("uiState/merge",{submode:"error",status:t.message.toString()})})}),e.on("export/settings",({providers:e,githubConfig:t,redirectUri:r})=>{me.download(e,t,r)}),e.on("import/settings",({redirectUri:t,queryProfiles:r,noCustomEndpoints:a},n)=>{me.readFromFile(n,t,r).then(t=>{a&&(t.providers=[]),e.dispatch("uiState/set",{mode:"loading"}),e.dispatch("config/merge",t),e.dispatch("uiState/set",{mode:"ready"})}).catch(t=>{e.dispatch("uiState/set",{mode:"ready",error:t.message})})})}]),ve=r(16),we=r.n(ve),ke=r(550),Ce=r(551),Ue=r(548),je=r(547),Oe=r(28),Se=r(536),xe=r(537),Pe=r(538),Ne=r(539),Te=r(540),De=r(559),Le=r(541),Ae=r(542),Ie=r(543),Re=r(544),qe=r(266),_e=r(79),ze=r(76),Fe=()=>{const e=we()("uiState","providers","queryProfiles","credentials","organizations","orgDefaults","redirectUri","noCustomEndpoints"),t=e.uiState,r=e.providers,o=e.queryProfiles,i=e.credentials,l=e.organizations,s=e.orgDefaults,d=e.redirectUri,u=e.noCustomEndpoints,m=e.dispatch,p=Object(a.useState)({}),h=Object(Oe.a)(p,2),g=h[0],y=h[1],E=Object(a.useState)({}),b=Object(Oe.a)(E,2),v=b[0],w=b[1],k=Object(a.useState)(!1),C=Object(Oe.a)(k,2),U=C[0],j=C[1],O=(u?[]:[{label:"Custom Endpoint",value:"custom"}]).concat(f.a.chain(l).map(e=>({label:e.name,value:e.orgId||e.fhirEndpoint})).sortBy(e=>e.label).value()),S=Object(a.useCallback)(e=>{e.preventDefault(),m("uiState/set",{mode:"ready"})},[m]);Object(a.useEffect)(()=>{const e=e=>{27===e.keyCode&&S(e)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[S]),Object(a.useEffect)(()=>{if(!g.id&&t.id&&"editProvider"===t.mode){const e=r.find(e=>e.id===t.id);y(e),w({}),j(e&&"custom"===e.orgId)}},[t.id,t.mode,g.id,r]);const x=(e,t)=>{e.preventDefault();const r=N(g);if(r)return w(r);t?(m("providers/upsert",g),m("uiState/set",{mode:"ready"})):m("providers/upsertAndLoad",g),m("refreshDirty")},P=e=>{let t;if("custom"!==e.value){t=l.find(t=>e.value===t.orgId||e.value===t.fhirEndpoint);const r=s[t.defaultId]||{};void 0!==t.defaultId&&(t=Object(c.a)({},r,{},t))}else t={name:e.label};t.credentialId&&(t=Object(c.a)({},i[t.credentialId],{},t));const r=Object(c.a)({scope:["patient/*.read","launch/patient"],queryProfile:"argonaut_spec"},t,{redirectUri:d,id:g.id,orgId:e.value});j(N(r)),y(r)},N=e=>{let t={};const r=e=>!/^https?:\/\//.test(e.toLowerCase());return e.isOpen?["name","patient"].forEach(r=>{e[r]||(t[r]="Required")}):["name","clientId","scope"].forEach(r=>{e[r]||(t[r]="Required")}),r(e.fhirEndpoint||"")&&(t.fhirEndpoint="Valid URL Required"),!e.isOpen&&r(e.redirectUri||"")&&(t.redirectUri="Valid URL Required"),Object.keys(t).length>0?t:null},T=(e,t,r,a,o,i,l)=>{const s=o?n.a.createElement(Pe.a,{color:"muted"},o):"",d=v[t]?n.a.createElement(Ne.a,null,v[t]):"",u=l||(e=>{y(Object(c.a)({},g,{[t]:e.target.value}))});return n.a.createElement(Se.a,null,n.a.createElement(xe.a,{for:"{property}"},e),n.a.createElement(Te.a,{value:i?i():g[t]||"",type:r||"text",id:t,onChange:u,invalid:!!v[t],required:a}),s,d)},D=()=>{const e=Object.keys(o).map(e=>n.a.createElement("option",{value:e,key:e},o[e].title));return n.a.createElement(Se.a,null,n.a.createElement(xe.a,{for:"profile"},"Profile"),n.a.createElement(Te.a,{type:"select",value:g.queryProfile||"argonaut_spec",onChange:e=>y(Object(c.a)({},g,{queryProfile:e.target.value})),name:"profile"}," ",e," "))},L=n.a.createElement(Se.a,{check:!0},n.a.createElement(Te.a,{type:"checkbox",id:"isOpen",checked:!0===g.isOpen||"true"===g.isOpen||!1,onChange:e=>y(Object(c.a)({},g,{isOpen:!g.isOpen}))}),n.a.createElement(xe.a,{for:"isOpen"},"Open Endpoint")),A=!u&&n.a.createElement(Se.a,null,n.a.createElement("a",{href:"#",onClick:e=>j(!0)},"Show Configuration Details")),I=n.a.createElement(n.a.Fragment,null,(()=>{const e=g.orgId?O.find(e=>e.value===g.orgId):null;return n.a.createElement(Se.a,null,n.a.createElement(xe.a,{for:"organization"},"Healthcare Organization"),n.a.createElement(_e.a,{id:"organization",autoFocus:!0,filterOption:Object(ze.b)({ignoreAccents:!1}),value:e,onChange:P,isSearchable:!0,options:O,defaultMenuIsOpen:!g.id}))})(),T("Title","name","text",!0)),R=n.a.createElement(n.a.Fragment,null,T("FHIR Endpoint URL","fhirEndpoint","url",!0),L,D(),T("Patient Id","patient","text",!0)),q=n.a.createElement(n.a.Fragment,null,T("FHIR Endpoint URL","fhirEndpoint","url",!0),L,D(),T("Client Id","clientId","text",!0),T("Client Secret (if applicable)","clientSecret","text",!0),T("Redirect URL","redirectUri","url",!0),T("Scope","scope","text",!0,"separate scopes with spaces",()=>(g.scope||[]).join(" "),e=>y(Object(c.a)({},g,{scope:e.target.value.split(/\s+/)}))));return n.a.createElement(De.a,{isOpen:!0,fade:!1,backdrop:!0,autoFocus:!1},n.a.createElement(Le.a,null,g.id?"Update Provider":"Add Provider"," "),n.a.createElement(Ae.a,null,n.a.createElement(Ie.a,{onSubmit:x,className:"needs-validation",noValidate:!0},I,!U&&g.orgId?A:null,U&&g.isOpen?R:null,U&&!g.isOpen?q:null)),n.a.createElement(Re.a,null,n.a.createElement("div",{className:"mr-auto"},n.a.createElement("a",{href:"#",onClick:S},"Cancel")),n.a.createElement(qe.a,{color:"outline-secondary",onClick:e=>x(e,!0)},"Save"),n.a.createElement(qe.a,{color:"primary",style:{marginLeft:"1em"},onClick:x},"Save and Load Records")))},Be=r(161);class Me extends n.a.Component{constructor(e){super(e),this.state={timeAgo:Object(Be.format)(this.props.time)}}componentDidMount(){this.interval=setInterval(()=>{this.setState({timeAgo:Object(Be.format)(this.props.time)})},6e4*(this.props.refreshMinutes||1))}componentWillUnmount(){clearInterval(this.interval)}render(){return this.state.timeAgo}}var $e=r(545),He=r(546),Ve=r(14),We=r(15),Je=r(267),Ge=()=>{const e=we()("providers"),t=e.providers,r=e.dispatch,a=(e,t,a)=>{r("providers/update",{id:e,selected:t})},o=(e,t)=>1===t?e:e+"s";return n.a.createElement("div",null,n.a.createElement("div",{style:{marginBottom:"1.5rem"}},n.a.createElement(qe.a,{color:"success",style:{marginRight:"1rem"},onClick:e=>{e.preventDefault(),r("uiState/set",{mode:"editProvider"})}},n.a.createElement(Ve.a,{icon:We.h,className:"mr-2"}),"Add Provider")),t.map(e=>{const t=n.a.createElement("div",null,n.a.createElement("div",{className:"float-right"},n.a.createElement("a",{href:"#",onClick:t=>((e,t)=>{t.preventDefault(),r("uiState/set",{mode:"editProvider",id:e})})(e.id,t),title:"Edit Provider"},n.a.createElement(Ve.a,{icon:We.d,color:"#6c757d",className:"mx-2"})),n.a.createElement("a",{href:"#",onClick:t=>((e,t)=>{t.preventDefault(),r("providers/remove",e),r("refreshDirty")})(e.id,t),title:"Delete Provider"},n.a.createElement(Ve.a,{icon:We.j,color:"#6c757d",className:"mx-2"}))),n.a.createElement("a",{href:"#",style:{fontWeight:e.lastUpdated?"normal":"bold"},onClick:t=>((e,t)=>{t.preventDefault(),r("fhir/loadData",e)})(e.id,t)},e.lastUpdated?"re":"","load records"));return n.a.createElement($e.a,{style:{margin:"0 1rem 1rem 0"},key:e.id},n.a.createElement(He.a,null,n.a.createElement(je.a,null,n.a.createElement(Ue.a,{xs:{size:"auto"},className:"mr-0 pr-1 text-center"},n.a.createElement("div",null,n.a.createElement("input",{type:"checkbox",style:{visibility:"hidden",width:0,height:0},checked:!!e.selected,id:"selection-"+e.id,onChange:t=>a(e.id,!e.selected)}),n.a.createElement("label",{htmlFor:"selection-"+e.id},n.a.createElement(Ve.a,{icon:e.selected?We.a:Je.a,size:"lg",color:e.selected?"green":"black"})))),n.a.createElement(Ue.a,null,n.a.createElement("p",{className:"font-weight-bold",style:{marginBottom:".25rem",cursor:"pointer",display:"inline-block"},onClick:t=>a(e.id,!e.selected)},e.name),e.lastUpdated&&n.a.createElement("p",null,e.data.entry.length," ",o("resource",e.data.entry.length)," | ",e.data.files.length," ",o("file",e.data.files.length)," | ",e.data.errorLog.length," ",o("error",e.data.errorLog.length),n.a.createElement("br",null),"loaded ",n.a.createElement(Me,{time:e.lastUpdated})),t))))}))},Qe=r(549),Ye=()=>{const e=we()("uiState","providers"),t=e.uiState,r=e.providers,o=e.dispatch,i=Object(a.useMemo)(()=>r.find(e=>e.id===t.id),[t.id,r]),l=Object(a.useCallback)(e=>{e.preventDefault(),o("fhir/cancelLoad")},[o]),s=Object(a.useCallback)(e=>{e&&e.preventDefault(),o("uiState/set",{mode:"ready"})},[o]);Object(a.useEffect)(()=>{const e=e=>{27===e.keyCode&&("authorizing"===t.submode||"loading"===t.submode?l(e):s(e))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[l,s,t.submode]);const c=e=>{e.preventDefault(),o("providers/update",{id:i.id,lastUpdated:new Date,data:t.data}),s()},d=e=>{e.preventDefault();const r=new Blob([JSON.stringify(t.data.errorLog,null,2)],{type:"application/json"});Object(Q.saveAs)(r,"errors.json")},u=(e,t)=>1===t?e:e+"s";return n.a.createElement(De.a,{isOpen:!0,fade:!1,backdrop:!0},n.a.createElement(Ae.a,{style:{textAlign:"center"}},n.a.createElement("h3",null,i.name),"authorizing"===t.submode&&n.a.createElement("div",null,n.a.createElement("h5",null,"Waiting for authorization..."),n.a.createElement("div",null,n.a.createElement(qe.a,{className:"btn-primary",onClick:l},"Cancel"))),"loading"===t.submode&&n.a.createElement("div",null,n.a.createElement("h5",null,t.requestCount," ",u("request",t.requestCount),"\xa0 / \xa0",t.errorCount," ",u("error",t.errorCount)),n.a.createElement("div",{style:{padding:"1rem 0rem"}},n.a.createElement(Qe.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),n.a.createElement("div",null,n.a.createElement(qe.a,{className:"btn-primary",onClick:l},"Cancel"))),"loaded"===t.submode&&n.a.createElement("div",null,n.a.createElement("h5",null,t.data.entry.length," ",u("resource",t.data.entry.length)," retrieved",n.a.createElement("br",null),t.data.files.length||"No"," ",u("attachment",t.data.files.length)," downloaded",n.a.createElement("br",null),t.data.errorLog.length||"No"," ",u("error",t.data.errorLog.length)," occurred")),"error"===t.submode&&n.a.createElement("div",null,n.a.createElement("h5",{style:{padding:"1rem 0",color:"red"}},"An error occurred: ",t.status),n.a.createElement("div",null,n.a.createElement(qe.a,{className:"btn-primary",onClick:s},"Close")))),"loaded"===t.submode&&(()=>{const e=t.data.errorLog.length>0&&n.a.createElement("div",{className:"mr-auto"},n.a.createElement("a",{href:"#",onClick:d},"Download error log"));return n.a.createElement(Re.a,null,e,n.a.createElement(qe.a,{color:"outline-secondary",onClick:s},"Cancel"),n.a.createElement(qe.a,{color:"primary",style:{marginLeft:"1em"},onClick:c},"Save"))})())},Ze=()=>n.a.createElement("div",{className:"text-center",style:{margin:"3rem"}},n.a.createElement(Qe.a,{style:{width:"3rem",height:"3rem",margin:"1rem"}}),n.a.createElement("h4",null,"Loading")),Ke=()=>{const e=we()("uiState","githubConfig"),t=e.uiState,r=e.githubConfig,o=e.dispatch,i=Object(a.useState)(),l=Object(Oe.a)(i,2),s=l[0],d=l[1],u=Object(a.useCallback)(e=>{e&&e.preventDefault(),o("uiState/set",{mode:"ready"})},[o]),m=Object(a.useCallback)(e=>{e.preventDefault(),o("export/github/cancel")},[o]);Object(a.useEffect)(()=>{const e=e=>{27===e.keyCode&&("push"!==t.submode?u(e):m(e))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t.submode,m,u]);const p=e=>{e.preventDefault(),r.token&&r.owner&&r.project?o("export/github"):o("uiState/merge",{error:"Please enter a personal access token, repository owner and repository project to continue."})},h=(e,t)=>{const a="pullRequest"===e?"true"===t.target.value:t.target.value;o("config/merge",{githubConfig:Object(c.a)({},r,{[e]:a})}),o("uiState/merge",{status:null,error:null}),o("refreshDirty")},f=e=>{e.preventDefault(),d(!s)};return n.a.createElement(De.a,{isOpen:!0,fade:!1,backdrop:!0},n.a.createElement(Le.a,null,"Push to Github Repository"),"push"===t.submode?n.a.createElement(Ae.a,{className:"text-center"},n.a.createElement("h5",null,t.status),n.a.createElement("div",{style:{padding:"1rem 0rem"}},n.a.createElement(Qe.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),n.a.createElement("div",null,n.a.createElement(qe.a,{className:"btn-primary",onClick:m},"Cancel"))):n.a.createElement(Ie.a,{onSubmit:p},n.a.createElement(Ae.a,null,t.error&&n.a.createElement(je.a,null,n.a.createElement(Ue.a,{xs:12},n.a.createElement(ke.a,null,n.a.createElement(Ce.a,{color:"danger"},n.a.createElement("span",null,t.error.toString()))))),t.status&&(()=>{const e=t.statusUrl?n.a.createElement("span",null," (",n.a.createElement("a",{href:t.statusUrl,target:"_blank",rel:"noopener noreferrer"},"view"),")"):null;return n.a.createElement(je.a,null,n.a.createElement(Ue.a,{xs:12},n.a.createElement(ke.a,null,n.a.createElement(Ce.a,{color:"success"},t.status,e,"."))))})(),n.a.createElement(je.a,{form:!0,style:{margin:"1rem 0"}},n.a.createElement(Ue.a,{xs:12},n.a.createElement("div",{className:"small float-right"},n.a.createElement("a",{href:"#",onClick:f},"How do I get a token?")),n.a.createElement("div",{id:"token-instructions",style:{display:s?"block":"none",marginTop:"2rem"}},"To obtain a personal access token for your Github account:",n.a.createElement("ol",null,n.a.createElement("li",null,"Visit ",n.a.createElement("a",{href:"https://github.com/settings/tokens",target:"_blank",rel:"noopener noreferrer"},"https://github.com/settings/tokens")),n.a.createElement("li",null,'Click the "Generate new token" button in upper right corner of the page.'),n.a.createElement("li",null,'Add a note to identify the token in case you want to revoke it later (eg. "Procure").'),n.a.createElement("li",null,"Select permissions:",n.a.createElement("ul",null,n.a.createElement("li",null,"To push data to a public repository, check the ",n.a.createElement("i",null,'"public_repo"')," item under ",n.a.createElement("i",null,'"repo"'),"."),n.a.createElement("li",null,"To push data to a private repository, check the ",n.a.createElement("i",null,'"repo"')," item."))),n.a.createElement("li",null,'Click the "Generate token" button at the bottom of the page.'))),n.a.createElement(xe.a,{for:"token"},"Personal Access Token"),n.a.createElement(Te.a,{id:"token",value:r&&r.token||"",onChange:e=>h("token",e)}))),n.a.createElement(je.a,{form:!0,style:{margin:"1rem 0"}},n.a.createElement(Ue.a,{xs:12},n.a.createElement(xe.a,{for:"repo"},"Repository")),n.a.createElement(Ue.a,{xs:4},n.a.createElement(Te.a,{id:"owner",value:r&&r.owner||"",onChange:e=>h("owner",e),placeholder:"Owner","data-lpignore":"true"})),n.a.createElement(Ue.a,{xs:1},n.a.createElement(Te.a,{readOnly:!0,className:"form-control-plaintext",defaultValue:"/"})),n.a.createElement(Ue.a,{xs:7},n.a.createElement(Te.a,{id:"project",value:r&&r.project||"",onChange:e=>h("project",e),placeholder:"Project","data-lpignore":"true"}))),n.a.createElement(je.a,{form:!0,style:{margin:"2rem 0"}},n.a.createElement(Ue.a,{xs:12},n.a.createElement(Se.a,{check:!0},n.a.createElement(xe.a,{check:!0},n.a.createElement(Te.a,{type:"radio",name:"pull-request",value:!1,checked:!r.pullRequest,onChange:e=>h("pullRequest",e)}),"Commit directly to the master branch")),n.a.createElement(Se.a,{check:!0},n.a.createElement(xe.a,{check:!0},n.a.createElement(Te.a,{type:"radio",name:"pull-request",value:!0,checked:!0===r.pullRequest,onChange:e=>h("pullRequest",e)}),"Create a new branch and pull request"))))),n.a.createElement(Re.a,null,n.a.createElement(qe.a,{color:"success",type:"submit"},"Push Data"),n.a.createElement(qe.a,{color:"secondary",onClick:u},"Close"))))},Xe=r(552),et=r(553),tt=r(554),rt=r(555),at=r(556),nt=({children:e,dropHint:t,fileDropHandler:r})=>{const o=Object(a.useState)(0),i=Object(Oe.a)(o,2),l=i[0],s=i[1],c=e=>!e.dataTransfer.types||"Files"===e.dataTransfer.types[0]||"application/x-moz-file"===e.dataTransfer.types[0],d=n.a.createElement("div",{className:"d-flex justify-content-center",style:{border:"dashed grey 4px",backgroundColor:"rgba(255,255,255,.8)",position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:9999}},n.a.createElement("div",{className:"d-flex align-items-center"},t||"Drop settings file here"));return n.a.createElement("div",{style:{position:"relative"},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),c(e)&&s(l+1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),c(e)&&s(l-1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&1===e.dataTransfer.files.length&&r(e.dataTransfer.files[0]),s(0)}},l>0&&d,e)},ot=()=>{const e=we()("providers","isDirty","warnOnPageNavigate","appName"),t=e.providers,r=e.isDirty,o=e.warnOnPageNavigate,i=e.appName,l=e.dispatch,s=Object(a.useRef)();Object(a.useEffect)(()=>{window.onbeforeunload=()=>!(!r||!o)||null});const c=e=>{(0===t.length||window.confirm("Current providers in your list will be replaced. Continue?"))&&(l("import/settings",e),l("refreshDirty",!0))};return n.a.createElement("div",{style:{marginBottom:"2rem"}},n.a.createElement(nt,{fileDropHandler:c},n.a.createElement("input",{ref:s,type:"file",style:{display:"none"},onChange:e=>{e.preventDefault(),e.stopPropagation(),1===e.target.files.length&&c(e.target.files[0])},accept:".json, application/json"}),n.a.createElement(Xe.a,{color:"light",light:!0,expand:"xs"},n.a.createElement(et.a,{href:"/"},n.a.createElement(Ve.a,{icon:We.g,alt:"Procure logo",className:"mr-2"}),i||"Procure"),n.a.createElement(tt.a,{className:"ml-auto",navbar:!0},n.a.createElement(rt.a,null,n.a.createElement(at.a,{href:"#",onClick:e=>{e.preventDefault(),s.current.value="",s.current.click()}},"import settings")),n.a.createElement(rt.a,null,n.a.createElement(at.a,{href:"#",onClick:e=>{e.preventDefault(),l("export/settings")},style:{fontWeight:r?"bold":"normal"}},"export settings"))))))},it=r(268),lt=r.n(it),st=()=>{const e=we()("providers","dateSortElements"),t=e.providers,r=e.dateSortElements,o=Object(a.useState)(),i=Object(Oe.a)(o,2),l=i[0],s=i[1],c=Object(a.useState)(1),d=Object(Oe.a)(c,2),u=d[0],m=d[1],p=Object(a.useState)([]),h=Object(Oe.a)(p,2),g=h[0],y=h[1],E=Object(a.useRef)();let b=Object(a.useMemo)(()=>f.a.chain(t).filter(e=>e.data&&e.selected).map(e=>e.data.entry.map(e=>e.resource.resourceType)).flatten().uniq().map(e=>({label:e,value:e})).sortBy(["label"]).value(),[t]),v=Object(a.useMemo)(()=>f.a.chain(t).filter(e=>e.data&&e.data.entry&&e.selected).map(e=>e.data.entry).flatten().filter(e=>!l||l.value===e.resource.resourceType).sortBy(e=>{const t=r[e.resource.resourceType]||[],a=f.a.find(t,t=>e.resource[t]);return a&&(e.resource[a].start||e.resource[a])||e.resource.meta&&e.resource.meta.lastUpdated||""}).reverse().value(),[t,l,r]);const w=e=>e.replace(/^\/|https?:\/\/|\/*$/g,""),k=Object(a.useMemo)(()=>{let e={};return f.a.each(t,(t,r)=>{f.a.each(t.data&&t.data.entry||[],(t,a)=>{e[w(t.fullUrl)]=[r,a,"resource"]}),f.a.each(t.data&&t.data.files||[],(t,a)=>{e[t.fileName]=[r,a,"file"]})}),e},[t]),C=(e,t)=>{t.preventDefault(),m(u+e)},U=n.a.createElement(Se.a,null,n.a.createElement(_e.a,{id:"resourceType",value:l,onChange:e=>{s(e),m(1),y([])},isSearchable:!0,options:b,placeholder:"Filter by Resource Type",isClearable:!0})),j={base00:"#272822",base01:"#383830",base02:"#49483e",base03:"#75715e",base04:"#a59f85",base05:"#f8f8f2",base06:"#f5f4f1",base07:"#f9f8f5",base08:"#f92672",base09:"#fd971f",base0A:"#f4bf75",base0B:"#a6e22e",base0C:"#a1efe4",base0D:"#66d9ef",base0E:"#ae81ff",base0F:"#cc6633"},O=(e,r,a)=>{let o;if("reference"===a){let e=w(r);if(1===(e.match(/\//g)||[]).length){const t=g.length&&f.a.last(g).fullUrl||v[u-1].fullUrl,r=w(t).split("/");e=r.slice(0,r.length-2).join("/")+"/"+e}k[e]&&(o=e)}else"url"===a&&k[r]?o=r:r.length>500&&(e=r.substring(0,500)+"...");return o?n.a.createElement("span",null,'"',n.a.createElement("a",{href:"#",style:{textDecoration:"underline"},onClick:e=>((e,r)=>{r.preventDefault();const a=k[e];if("file"===a[2]){const e=t[a[0]].data.files[a[1]];Object(Q.saveAs)(e.blob,e.fileName)}else y([...g,e]),window.scrollTo(0,E.current.offsetTop)})(o,e)},r),'"'):e};return n.a.createElement("div",{ref:E},U,(()=>{const e=n.a.createElement("div",{className:"text-center"},"No resources found"),t=n.a.createElement("div",null,n.a.createElement(qe.a,{size:"sm",outline:!0,color:"primary",disabled:1===u,onClick:e=>C(-1,e),className:"mr-3"},n.a.createElement(Ve.a,{icon:We.b})),"Resource ",u," of ",v.length,n.a.createElement(qe.a,{size:"sm",outline:!0,color:"primary",disabled:u===v.length,onClick:e=>C(1,e),className:"ml-3"},n.a.createElement(Ve.a,{icon:We.c}))),r=n.a.createElement("div",null,n.a.createElement(qe.a,{size:"sm",outline:!0,color:"primary",onClick:e=>{y(f.a.slice(g,0,-1))}},n.a.createElement(Ve.a,{icon:We.b,className:"mr-2"}),"Back"));return g.length?r:v.length?t:e})(),(()=>{const e=g.length&&(e=>{const r=k[e];if(r)return t[r[0]].data.entry[r[1]]})(f.a.last(g));g.length&&!e&&y(f.a.slice(g,1,-1));const r=e&&e.resource||v[u-1]&&v[u-1].resource;if(r)return n.a.createElement("div",{style:{marginTop:"1rem",padding:"1rem",border:"1px solid #ccc",borderRadius:".25rem",background:"#fffffa"}},n.a.createElement(lt.a,{data:r,theme:j,hideRoot:!0,shouldExpandNode:(e,t,r)=>!0,invertTheme:!0,valueRenderer:O}))})())},ct=r(557),dt=r(558),ut=r(560),mt=r(561),pt=r(269),ht=e=>{const t=we()("spreadsheetTemplates","upload","nonModalUi"),r=t.spreadsheetTemplates,o=t.upload,i=t.nonModalUi,l=t.dispatch,s=Object(a.useState)(!1),c=Object(Oe.a)(s,2),d=c[0],u=c[1],m=(e,t,r)=>{r.preventDefault(),l("export/spreadsheet",{templateId:e,format:t})},p=n.a.createElement(qe.a,{color:"success",style:{margin:"0 1rem 1rem 0"},onClick:e=>{e.preventDefault(),l("export/upload")}},n.a.createElement(Ve.a,{icon:We.f,className:"mr-2"}),o.label||"Share Data"),h=n.a.createElement(qe.a,{color:"outline-secondary",style:{margin:"0 1rem 1rem 0"},onClick:e=>{e.preventDefault(),l("export/download")},disabled:i.isDownloading},n.a.createElement(Ve.a,{icon:We.e,className:"mr-2"}),"Download Data"),f=n.a.createElement(qe.a,{style:{margin:"0 0 1rem 0"},color:"outline-secondary",onClick:e=>{e.preventDefault(),l("uiState/set",{mode:"githubExport"})}},n.a.createElement(Ve.a,{icon:pt.a,className:"mr-2"}),"Upload to Github");return n.a.createElement("div",{style:{marginBottom:".5rem"}},o&&(o.manifestUrl||o.uploadUrl)&&p,h,e.hasResources&&(()=>{if(!Object.keys(r||{}).length)return null;let e=[];return Object.keys(r).forEach(t=>{e.push(n.a.createElement(ct.a,{key:t+"-xlsx",onClick:m.bind(void 0,t,"xlsx")},r[t].name+" (Excel)"),n.a.createElement(ct.a,{key:t+"-csv",onClick:m.bind(void 0,t,"csv")},r[t].name+" (CSV)"))}),n.a.createElement(dt.a,{style:{display:"inline"},disabled:i.isExportingSheet,isOpen:d,toggle:e=>u(!d)},n.a.createElement(ut.a,{color:"outline-secondary",style:{margin:"0 1rem 1rem 0"},caret:!0},n.a.createElement(Ve.a,{icon:We.i,className:"mr-2"}),n.a.createElement("span",{className:"mr-2"},"Export as Spreadsheet")),n.a.createElement(mt.a,null,e))})(),f)},ft=()=>{const e=we()().dispatch;return n.a.createElement(qe.a,{block:!0,color:"success",onClick:t=>{t.preventDefault(),e("uiState/set",{mode:"editProvider"})}},n.a.createElement(Ve.a,{icon:We.h,className:"mr-2"}),"Add Provider")},gt=()=>{const e=we()("uiState","upload"),t=e.uiState,r=e.upload,o=e.dispatch,i=Object(a.useCallback)(e=>{e&&e.preventDefault(),o("uiState/set",{mode:"ready"})},[o]),l=Object(a.useCallback)(e=>{e&&e.preventDefault(),r.continueUrl&&window.open(r.continueUrl),i(e)},[i,r]),s=Object(a.useCallback)(e=>{e.preventDefault();const r="getManifest"===t.submode?{mode:"ready"}:{mode:"fileUpload",submode:"preUpload"};o("export/upload/cancel"),o("uiState/set",r)},[o,t.submode]),c=Object(a.useCallback)(e=>{e.preventDefault(),o("export/upload/send")},[o]);Object(a.useEffect)(()=>{const e=e=>{27===e.keyCode&&("preUpload"===t.submode||"postUpload"===t.submode?i(e):s(e))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t.submode,s,i]);const d=()=>n.a.createElement(Ae.a,{className:"text-center"},n.a.createElement("h5",null,t.status),n.a.createElement("div",{style:{padding:"1rem 0rem"}},n.a.createElement(Qe.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),n.a.createElement("div",null,n.a.createElement(qe.a,{className:"btn-primary",onClick:s},"Cancel")));return n.a.createElement(De.a,{isOpen:!0,fade:!1,backdrop:!0},n.a.createElement(Le.a,null,"Share My Data"),"error"===t.submode&&n.a.createElement("div",null,n.a.createElement(Ae.a,null,n.a.createElement(ke.a,null,n.a.createElement(Ce.a,{color:"danger"},n.a.createElement("span",null,t.status)))),n.a.createElement(Re.a,null,n.a.createElement(qe.a,{color:"secondary",onClick:i},"Close"))),"getManifest"===t.submode&&d(),"preUpload"===t.submode&&n.a.createElement("div",null,n.a.createElement(Ae.a,null,n.a.createElement("p",null,"Clicking the ",n.a.createElement("b",null,"upload")," button below will share your medical record information with ",n.a.createElement("b",null,r.name)," and indicates your agreement to the terms of use, privacy policy and other information outlined at",n.a.createElement("b",null,"\xa0",n.a.createElement("a",{href:r.infoUrl,target:"_blank",rel:"noopener noreferrer"},r.infoUrl)),".")),n.a.createElement(Re.a,null,n.a.createElement(qe.a,{color:"success",onClick:c},"Upload"),n.a.createElement(qe.a,{color:"secondary",onClick:i},"Cancel"))),"uploading"===t.submode&&d(),"postUpload"===t.submode&&n.a.createElement("div",null,n.a.createElement(Ae.a,{className:"text-center"},n.a.createElement("h5",null,r.successMessage||"Your information has been transmitted!")),n.a.createElement(Re.a,null,n.a.createElement(qe.a,{color:"primary",onClick:l},r.continueUrl?r.continueLabel||"Continue":"Close"))))},yt=()=>{const e=we()("upload"),t=e.upload,r=e.dispatch;return n.a.createElement("div",{className:"p-2"},n.a.createElement("h4",{className:"mb-4"},"Welcome"),n.a.createElement("p",null,"This app will walk you through the process of collecting digital copies of your medical records from healthcare institutions where you've received care and sharing them with ",t.name,". You can find additional information at ",n.a.createElement("a",{href:t.infoUrl,target:"_blank",rel:"noopener noreferrer"},t.infoUrl),"."),n.a.createElement("p",null,"You'll also have the option to download a copy of the data to this device to keep for yourself."),n.a.createElement(qe.a,{color:"success",className:"float-right mt-4",onClick:e=>r("uiState/set",{mode:"editProvider"})},n.a.createElement("span",{className:"mr-2"},"Get Started"),n.a.createElement(Ve.a,{icon:We.c,className:"mr-2"})),n.a.createElement("div",{className:"clearfix"}))},Et=()=>{const e=we()("uiState","providers","credentials","organizations","orgDefaults","redirectUri"),t=e.uiState,r=e.providers,o=e.credentials,i=e.organizations,l=e.orgDefaults,s=e.redirectUri,d=e.dispatch,u=Object(a.useState)({}),m=Object(Oe.a)(u,2),p=m[0],h=m[1],g=f.a.chain(i).map(e=>({label:e.name,value:e.orgId||e.fhirEndpoint})).sortBy(e=>e.label).value();Object(a.useEffect)(()=>{if(!p.id&&t.id&&"editProvider"===t.mode){const e=r.find(e=>e.id===t.id);h(e)}},[t.id,t.mode,p.id,r]);const y=e=>{let t=i.find(t=>e.value===t.orgId||e.value===t.fhirEndpoint);const r=l[t.defaultId]||{};void 0!==t.defaultId&&(t=Object(c.a)({},r,{},t)),t.credentialId&&(t=Object(c.a)({},o[t.credentialId],{},t)),h(Object(c.a)({},t,{redirectUri:s,id:p.id,orgId:e.value,queryProfile:t.queryProfile||"argonaut_spec"}))};return n.a.createElement("div",{className:"p-2"},n.a.createElement("h4",{className:"mb-4"},"Select Your Provider"),n.a.createElement("p",null,"Choose a healthcare institution where you've received care from the list below."),n.a.createElement("p",null,"If you've been to multiple healthcare providers, after retrieving your records you'll have the option to return to this screen to select another institution."),(()=>{const e=p.orgId?g.find(e=>e.value===p.orgId):null;return n.a.createElement(_e.a,{id:"organization",autoFocus:!0,filterOption:Object(ze.b)({ignoreAccents:!1}),value:e,onChange:y,isSearchable:!0,options:g,defaultMenuIsOpen:!0})})(),n.a.createElement("div",{className:"d-flex"},n.a.createElement("div",{className:"align-self-end flex-grow-1 mt-4 pl-1"},r.length>0&&n.a.createElement("a",{href:"#",onClick:e=>{e.preventDefault(),d("uiState/set",{mode:"review"})}},"skip")),n.a.createElement("div",null,n.a.createElement(qe.a,{color:"success",className:"mt-4",onClick:e=>{e.preventDefault(),d("providers/upsertAndLoad",p),d("refreshDirty")},disabled:!p.orgId},n.a.createElement("span",{className:"mr-2"},"Login to Patient Portal"),n.a.createElement(Ve.a,{icon:We.c,className:"mr-2"})))))},bt=()=>{const e=we()("uiState","providers"),t=e.uiState,r=e.providers,o=e.dispatch,i=Object(a.useMemo)(()=>r.find(e=>e.id===t.id),[t.id,r]),l=Object(a.useCallback)(e=>{e.preventDefault(),o("fhir/cancelLoad","editProvider"),o("providers/remove",i.id)},[o,i]),s=e=>{o("providers/remove",i.id),o("uiState/set",{mode:"editProvider"})};if(Object(a.useEffect)(()=>{const e=e=>{27===e.keyCode&&("authorizing"!==t.submode&&"loading"!==t.submode||l(e))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[l,t.submode]),"loadData"!==t.mode)return null;"loaded"===t.submode&&(o("providers/update",{id:i.id,lastUpdated:new Date,data:t.data}),o("uiState/set",{mode:"review"}));const c=e=>n.a.createElement("div",{className:"p-4 text-center"},n.a.createElement("h5",{className:"mb-4"},e),n.a.createElement("div",{className:"my-4"},n.a.createElement(Qe.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),n.a.createElement("div",null,n.a.createElement(qe.a,{color:"outline-primary",onClick:l},"Cancel")));return n.a.createElement("div",null,n.a.createElement("h4",null,i.name),"authorizing"===t.submode&&c("Waiting for Portal Login..."),"loading"===t.submode&&c("Retrieving Healthcare Records..."),"error"===t.submode&&n.a.createElement("div",{className:"p-2"},n.a.createElement("h5",null,"Error"),n.a.createElement("p",null,"An error occurred loading your record: ",t.status),n.a.createElement("div",null,n.a.createElement(qe.a,{color:"primary",className:"mt-4",onClick:s},n.a.createElement(Ve.a,{icon:We.b,className:"mr-2"}),n.a.createElement("span",{className:"mr-2"},"Back")))))},vt=e=>{const t=we()("spreadsheetTemplates","nonModalUi"),r=t.spreadsheetTemplates,o=t.nonModalUi,i=t.dispatch,l=Object(a.useState)(!1),s=Object(Oe.a)(l,2),c=s[0],d=s[1],u=(e,t,r)=>{r.preventDefault(),i("export/spreadsheet",{templateId:e,format:t})};let m=[n.a.createElement(ct.a,{key:"fhir",onClick:e=>{e.preventDefault(),i("export/download")}},"FHIR Format")];return(Object.keys(r)||[]).forEach(e=>{m.push(n.a.createElement(ct.a,{key:e+"-xlsx",onClick:u.bind(void 0,e,"xlsx")},"Spreadsheet of ",r[e].name))}),n.a.createElement(dt.a,{className:e.className,style:{display:"inline"},disabled:o.isExportingSheet,isOpen:c,toggle:e=>d(!c)},n.a.createElement(ut.a,{color:"outline-secondary",style:{margin:"0 1rem 0 0"},caret:!0},n.a.createElement(Ve.a,{icon:We.e,className:"mr-2"}),n.a.createElement("span",{className:"mr-2"},"Download copy of data")),n.a.createElement(mt.a,null,m))},wt=()=>{const e=we()("providers","upload"),t=e.providers,r=e.upload,a=e.dispatch,o=f.a.chain(t).sortBy(e=>e.lastUpdated).map(e=>n.a.createElement("li",{key:e.id},e.name," ","(",n.a.createElement("a",{href:"#",onClick:t=>((e,t)=>{t.preventDefault(),a("providers/remove",e),a("refreshDirty")})(e.id,t)},"remove"),")")).value();return n.a.createElement("div",{className:"p-2"},n.a.createElement("h4",{className:"mb-4"},"Review Data to Share"),n.a.createElement("p",null,"You have collected records from the following healthcare providers:"),n.a.createElement("ul",null,o),n.a.createElement("div",{className:"d-md-flex"},n.a.createElement("div",{className:"align-self-end flex-grow-1 mt-4"},n.a.createElement(vt,null)),n.a.createElement("div",null,n.a.createElement(qe.a,{color:"success",onClick:e=>{e.preventDefault(),a("uiState/set",{mode:"editProvider"})},className:"btn-block text-left mt-4"},n.a.createElement("div",{className:"d-flex"},n.a.createElement("div",{className:"mr-2 align-self-center flex-grow-1"},"Add another provider"),n.a.createElement("div",{className:"mr-2 align-self-center"},n.a.createElement(Ve.a,{icon:We.c})))),n.a.createElement(qe.a,{color:"success",className:"btn-block text-left mt-2",disabled:0===o.length,onClick:e=>{e.preventDefault(),a("export/upload/send")}},n.a.createElement("div",{className:"d-flex"},n.a.createElement("div",{className:"mr-2 align-self-center flex-grow-1"},"Share with ",r.name),n.a.createElement("div",{className:"mr-2 align-self-center"},n.a.createElement(Ve.a,{icon:We.c})))))))},kt=()=>{const e=we()("uiState","upload"),t=e.uiState,r=e.upload,o=e.dispatch,i=Object(a.useCallback)(e=>{e&&e.preventDefault(),o("uiState/set",{mode:"review"})},[o]),l=Object(a.useCallback)(e=>{e&&e.preventDefault(),r.continueUrl&&(window.location.href=r.continueUrl)},[r]),s=Object(a.useCallback)(e=>{e.preventDefault(),o("export/upload/cancel"),o("uiState/set",{mode:"review"})},[o]);Object(a.useEffect)(()=>{const e=e=>{27===e.keyCode&&"uploading"!==t.submode&&s(e)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t.submode,s,i]);return n.a.createElement("div",null,"error"===t.submode&&n.a.createElement("div",{className:"p-2"},n.a.createElement("h5",null,"Error"),n.a.createElement("p",null,t.status),n.a.createElement("div",null,n.a.createElement(qe.a,{color:"primary",className:"mt-4",onClick:i},n.a.createElement(Ve.a,{icon:We.b,className:"mr-2"}),n.a.createElement("span",{className:"mr-2"},"Back")))),"postUpload"!==t.submode&&"error"!==t.submode&&n.a.createElement("div",{className:"p-4 text-center"},n.a.createElement("h5",{className:"mb-4"},t.status||"Preparing to send data"),n.a.createElement("div",{className:"my-4"},n.a.createElement(Qe.a,{color:"primary",style:{width:"3rem",height:"3rem"}})),n.a.createElement("div",null,n.a.createElement(qe.a,{color:"outline-primary",onClick:s},"Cancel"))),"postUpload"===t.submode&&n.a.createElement("div",{className:"p-2"},n.a.createElement("h5",null,"Success"),n.a.createElement("p",null,r.successMessage||"Your healthcare records have been successfully shared with "+r.name+"."),n.a.createElement(vt,{className:"float-left mt-4"}),r.continueUrl&&n.a.createElement(qe.a,{color:"success",className:"float-right mt-4",onClick:l},n.a.createElement("span",{className:"mr-2"},r.continueLabel||"Continue to "+r.name),n.a.createElement(Ve.a,{icon:We.c,className:"mr-2"})),n.a.createElement("div",{className:"clearfix"})))},Ct=()=>{const e=we()("uiState","appName"),t=e.uiState,r=e.dispatch,a=e.appName,o={active:{background:"#3182CE",border:"1px solid white",color:"white"},inactive:{color:"#3182CE",border:"1px solid #3182CE",background:"white"}},i="loadData"!==t.mode&&("upload"!==t.mode||"loaded"===t.submode)&&n.a.createElement(je.a,null,n.a.createElement(Ue.a,{className:"text-center"},n.a.createElement("small",{className:"mt-4 float-right d-none d-sm-block"},n.a.createElement("a",{href:"#",onClick:()=>r("wizard/hide"),className:"text-muted"},"switch to full version of Procure"))));return n.a.createElement("div",null,i,n.a.createElement(je.a,null,n.a.createElement(Ue.a,null,n.a.createElement("h2",{style:{color:"#3182CE",padding:"1em 0",textAlign:"center"}},n.a.createElement(Ve.a,{icon:We.g,alt:"Procure logo",className:"mr-2"}),n.a.createElement("span",null,a||"Procure")))),n.a.createElement(je.a,null,n.a.createElement(Ue.a,{md:{size:10,offset:1},lg:{size:8,offset:2}},n.a.createElement("div",{className:"shadow p-4 mb-5 bg-white rounded unbox-sm"},n.a.createElement("div",{className:"d-none d-sm-block"},n.a.createElement("div",{className:"d-none d-flex flex-row justify-content-around mb-4",style:{borderBottom:"1px solid #3182CE"}},n.a.createElement("div",{className:"p-2 text-center"},n.a.createElement("div",{style:Object(c.a)({},o["ready"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"1"),n.a.createElement("div",null,"Start")),n.a.createElement("div",{className:"my-auto"},n.a.createElement(Ve.a,{icon:We.c,alt:"arrow right",className:"m-2"})),n.a.createElement("div",{className:"p-2 text-center"},n.a.createElement("div",{style:Object(c.a)({},o["editProvider"===t.mode||"loadData"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"2"),n.a.createElement("div",null,"Retrieve Records")),n.a.createElement("div",{className:"my-auto"},n.a.createElement(Ve.a,{icon:We.c,alt:"arrow right",className:"m-2"})),n.a.createElement("div",{className:"p-2 text-center"},n.a.createElement("div",{style:Object(c.a)({},o["review"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"3"),n.a.createElement("div",null,"Review")),n.a.createElement("div",{className:"my-auto"},n.a.createElement(Ve.a,{icon:We.c,alt:"arrow right",className:"mr-2"})),n.a.createElement("div",{className:"p-2 text-center"},n.a.createElement("div",{style:Object(c.a)({},o["fileUpload"===t.mode?"active":"inactive"],{display:"inline-block",minWidth:"2em",minHeight:"2em"}),className:"m-1 p-1"},"4"),n.a.createElement("div",null,"Share Records")))),"ready"===t.mode&&n.a.createElement(yt,null),"editProvider"===t.mode&&n.a.createElement(Et,null),"loadData"===t.mode&&n.a.createElement(bt,null),"review"===t.mode&&n.a.createElement(wt,null),"fileUpload"===t.mode&&n.a.createElement(kt,null)))))};var Ut=()=>{const e=we()("uiState","upload","showWizard","providers","appName"),t=e.uiState,r=e.showWizard,o=e.upload,i=e.providers,l=e.appName;if(Object(a.useEffect)(()=>{document.title=l||"Procure"},[l]),"loading"===t.mode)return n.a.createElement(Ze,null);if("globalError"===t.mode)return n.a.createElement(ke.a,{style:{margin:"1em"}},n.a.createElement(Ce.a,{color:"danger"},n.a.createElement("span",null,"Failed to load configuration information."),n.a.createElement("br",null),n.a.createElement("span",null,t.error.toString())));const s=n.a.createElement(Ue.a,{xs:"12",style:{margin:"0.5rem"}},n.a.createElement(Ce.a,{color:"warning",style:{textAlign:"center"}},t.error)),c=i&&i.length,d=c&&f.a.find(i,e=>e.selected&&e.data&&e.data.entry&&(e.data.entry.length||e.data.errorLog.length)),u=c&&f.a.find(i,e=>e.selected&&e.data&&e.data.entry&&e.data.entry.length),m=n.a.createElement("div",null,n.a.createElement(ot,null),n.a.createElement(ke.a,{fluid:!0},n.a.createElement(je.a,{className:"m-2"},t.error&&"ready"===t.mode&&s,c?n.a.createElement(Ue.a,{xs:"12",md:"6",lg:"5",xl:"4"},n.a.createElement(Ge,null)):n.a.createElement(Ue.a,{sm:{size:4,offset:4}},n.a.createElement(ft,null)),d?(e=>n.a.createElement(Ue.a,{xs:"12",md:"6",lg:"7",xl:"8"},n.a.createElement(ht,{hasResources:e}),e&&n.a.createElement(st,null)))(u):null),"editProvider"===t.mode&&n.a.createElement(Fe,null),"loadData"===t.mode&&n.a.createElement(Ye,null),"githubExport"===t.mode&&n.a.createElement(Ke,null),"fileUpload"===t.mode&&n.a.createElement(gt,null))),p=r&&o&&(o.manifestUrl||o.uploadUrl)&&n.a.createElement(ke.a,null,t.error&&"ready"===t.mode&&n.a.createElement(je.a,{className:"m-2"},s),n.a.createElement(Ct,null));return p?(document.body.classList.add("bg-light-md"),p):(document.body.classList="",m)};const jt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ot(e,t){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const r=e.installing;null!=r&&(r.onstatechange=()=>{"installed"===r.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}be.dispatch("config/load","ready"),i.a.render(n.a.createElement(s.a.Provider,{value:be},n.a.createElement(Ut,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/procure-wip",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="".concat("/procure-wip","/sw.js");jt?(!function(e,t){fetch(e).then(r=>{const a=r.headers.get("content-type");404===r.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Ot(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):Ot(t,e)})}}()}},[[272,1,2]]]);
//# sourceMappingURL=main.4540a512.chunk.js.map