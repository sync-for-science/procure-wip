{"version":3,"sources":["store/initial-state.js","smart/fhir.js","smart/smart-core.js","smart/smart-popup.js","store/fhir-loader.js","store/file-exporter.js","store/merge-objects.js","store/config-loader.js","store/zip-exporter.js","store/github-api.js","store/github-exporter.js","store/spreadsheet-exporter.js","store/csv-writer.js","store/user-settings.js","store/store.js","components/ProviderForm.js","components/TimeAgo.js","components/ProviderList.js","components/Fetcher.js","components/Loader.js","components/GithubUploader.js","components/SettingsImportDropZone.js","components/Header.js","components/FhirTree.js","components/Toolbar.js","components/BlankSlate.js","components/FileUploader.js","components/Wizard/Start.js","components/Wizard/SelectProvider.js","components/Wizard/Retrieve.js","components/Wizard/DownloadButton.js","components/Wizard/Review.js","components/Wizard/Upload.js","components/Wizard/index.js","components/App.js","serviceWorker.js","index.js"],"names":["module","exports","uiState","mode","spreadsheetTemplates","isDirty","nonModalUi","queryProfile","mimeTypeMappings","githubConfig","upload","providers","fetchFHIR","url","config","fhirVersion","token","retryLimit","retries","headers","Accept","isR2","toUpperCase","Authorization","fetch","then","response","ok","Error","status","statusText","data","json","resourceType","error","issue","diagnostics","catch","err","replaceValue","path","element","replaceFn","split","value","nextPath","slice","length","undefined","Array","isArray","forEach","v","newValue","pathToValues","map","reduce","a","b","concat","filter","buildAbsoluteUrl","fhirEndpoint","reference","test","replace","addProvenance","resource","meta","source","extension","push","valueUri","getResourcesByUrl","urls","allowErrors","signal","statusCallback","Promise","all","_","fullUrl","e","name","message","requestType","errorLog","r","entry","findReferences","paths","p","refIndex","ent","i","each","ref","rawUrl","embedReferences","refEntry","contained","id","findAttachments","attachmentIndex","attachment","contentType","count","getResourcesByQuery","query","resolve","reject","fhirParams","fetchResources","page","fhirData","nextUrl","link","find","l","relation","pageLimit","errorCount","resourcePath","Object","keys","params","k","join","encodeURIComponent","followAndEmbedReferences","updatedEntry","followReferences","findAndDownloadAttachments","fetchAttachment","blob","urlExtension","match","mimeExtension","fileName","toString","files","attachmentsToFilenames","file","f","authEndpointErr","getWellKnownEndpoints","baseUrl","endpoints","registrationEndpoint","registration_endpoint","authorizationEndpoint","authorization_endpoint","tokenEndpoint","token_endpoint","getCapabilityEndpoints","fhir","extensions","obj","trim","out","key","getPath","o","ext","getAuthEndpoints","buildQs","buildAuthorizeUrl","authEndpoint","state","scope","redirectUri","clientId","clientSecret","launch","exchangeCodeForToken","code","method","body","btoa","refreshToken","generateStateParam","targetLen","charSet","result","charAt","Math","floor","random","SmartPopup","provider","this","authWindow","window","open","document","write","qs","pairs","pair","decodeURIComponent","clearInterval","popupPoll","removeEventListener","messageListener","close","authEndpoints","ignoreState","stateParam","SMART","setInterval","closed","addEventListener","event","origin","location","parseQs","access_token","console","log","href","FhirLoader","controller","AbortController","popup","cancel","abort","uniqueUrls","queryResult","context","patientId","patient","fetchQuery","FHIR","containReferences","retrieveReferences","downloadAttachments","resetAbortController","queries","mergeAndDeDupeData","Smart","authorize","FileExporter","whitelist","rule","matchUrl","resetCancelled","accept","tv4","validate","configSchema","get","indexOf","merge","templates","mergeArray","base","override","overrideItem","baseIndex","findIndex","splice","mergeObject","isPlainObject","JSON","parse","stringify","template","getUrlParameter","results","RegExp","exec","search","readConfigFile","isOverride","text","stripJsonComments","loadConfigFile","overridePath","allowQsOverride","configReaders","qsOverridePath","mergeObjects","endpointLists","invalidEndpointId","defaults","queryProfiles","invalidCredentialId","credentialId","credentials","templateNames","templateName","extends","baseTemplateName","endpointList","endpointListSchema","Entries","endpoint","newEntry","OrganizationName","FHIRPatientFacingURI","orgId","defaultId","getEndpointList","organizations","apply","orgDefaults","mapValues","loadEndpointLists","manifestUrl","qsManifestUrl","label","showWizard","overlayQsValues","uploadUrl","fileExporter","isValidUrl","getManifest","manifest","addProviderToZip","zipFolder","bundles","chain","groupBy","total","type","bundle","exportProvidersAsBlob","zip","jszip","selected","folder","sanitizeFilename","generateAsync","generateFile","multiProviderFileName","exportableProviders","saveAs","exportProviders","callApi","jsonPayload","reqConfig","owner","project","stats","getLastCommit","branchName","getTree","commit","object","sha","tree","truncated","createBlob","createTree","commitTree","lastCommit","parents","commitTreeToPullRequest","title","newBranchName","baseBranch","bodyText","head","maintainer_can_modify","GithubExporter","canceled","reader","FileReader","onload","base64","onerror","readAsDataURL","content","encoding","statusCb","gh","buildResourceTree","blobToBase64","trees","flatten","baseTree","allProviders","folders","item","buildProviderTree","newTrees","buildTree","pullRequest","commitPullRequest","commitToMaster","prepareCommit","Date","toISOString","pull","html_url","defaultHelperFns","validateExists","validateCode","c","target","validateValue","getHelperData","helperData","helperDataField","stringifyCodings","system","parseDateForExcel","format","helperFns","rows","field","mergeRows","rowsToMerge","newRows","mergeRow","mergeRowItem","row","at","first","transform","children","childRows","childElement","flattenProviders","providerHelperData","getTemplateColumns","cols","arrayToCols","templateArray","exportFlatDataCSV","flatData","columns","col","csv","rawValue","toLocaleString","Blob","csvWriter","exportSpreadsheet","templateId","templateDefinition","templateDefinitions","mergedTemplateDefinition","sortBy","s","sortDir","dir","orderBy","dateCols","XlsxPopulate","fromBlankAsync","workbook","sheet","cell","dateCol","column","style","outputAsync","exportFlatDataExcel","buildJSON","lastUpdated","initialState","download","readFromFile","readAsText","userSettingsSchema","require","simulateTimer","fhirLoader","ghExporter","createUniqueId","store","createStore","on","newUiState","counts","countType","newState","reset","dirtySnapshot","newSnapshot","UserSettings","dispatch","endState","isDev","process","ConfigLoader","newConfig","providerId","handleLoadDone","submode","handleStatusUpdate","isError","requestCount","loadFhir","getFHIR","handleGlobalError","isOpen","authAndGetFHIR","isDownloading","ZipExporter","finally","isExportingSheet","SpreadsheetExporter","export","statusUrl","simulate","clearTimeout","setTimeout","zipExporter","putFile","noCustomEndpoints","useStoreon","useState","setProvider","validation","setValidation","showDetails","setShowDetails","orgOptions","handleCancel","useCallback","preventDefault","useEffect","downHandler","keyCode","currentProvider","handleSubmit","skipRefresh","errors","handleOrgSelection","selection","orgConfig","updatedProvider","isInvalidUrl","toLowerCase","renderTextInput","property","isRequired","instructions","valueFn","onChangeFn","formText","FormText","color","errorText","FormFeedback","onChange","FormGroup","Label","for","Input","invalid","required","renderProfileSelector","profileOptions","q","openCheckbox","check","checked","detailsLink","onClick","shortForm","autoFocus","filterOption","createFilter","ignoreAccents","isSearchable","options","defaultMenuIsOpen","renderOrgSelector","openDetails","secureDetails","Modal","fade","backdrop","ModalHeader","ModalBody","Form","onSubmit","className","noValidate","ModalFooter","Button","marginLeft","TimeAgo","props","timeAgo","time","interval","setState","refreshMinutes","React","Component","toggleProviderSelection","pluralizeEn","len","marginBottom","marginRight","icon","faPlus","controls","handleEditProvider","faEdit","handleDeleteProvider","faTrash","fontWeight","handleLoadRecords","Card","margin","CardBody","Row","Col","xs","size","visibility","width","height","htmlFor","faCheckSquare","faSquare","cursor","display","useMemo","handleClose","handleSave","handleLogDownload","textAlign","padding","Spinner","downloadLink","renderLoadedButtons","showInstructions","setShowInstructions","handleHideDialog","handleCancelExport","handleFieldChange","fieldName","handleToggleInstructions","Container","Alert","rel","renderMessage","form","marginTop","placeholder","data-lpignore","readOnly","defaultValue","dropHint","fileDropHandler","dragCounter","setDragCounter","isFileDrag","dataTransfer","types","overlay","border","backgroundColor","position","top","bottom","left","right","zIndex","onDragEnter","stopPropagation","onDragOver","onDragLeave","onDrop","warnOnPageNavigate","appName","fileInput","useRef","onbeforeunload","readFile","confirm","SettingsImportDropZone","Navbar","light","expand","NavbarBrand","faMedkit","alt","Nav","navbar","NavItem","NavLink","current","click","dateSortElements","setResourceType","setPosition","overlayResources","setOverlayResources","componentTopRef","resourceTypeOptions","uniq","resources","sortElements","sortElement","start","reverse","simplifyUrl","referenceIndex","index","j","handlePosChange","filters","isClearable","treeTheme","base00","base01","base02","base03","base04","base05","base06","base07","base08","base09","base0A","base0B","base0C","base0D","base0E","base0F","valueRenderer","raw","refUrl","last","substring","textDecoration","scrollTo","offsetTop","handleReference","noResources","nextPrevNav","outline","disabled","faChevronLeft","faChevronRight","overlayNav","renderPositionNav","overlayData","getResourceByUrl","borderRadius","background","theme","hideRoot","shouldExpandNode","keyName","level","invertTheme","renderJsonTree","showSpreadsheetOptions","setShowSpreadsheetOptions","handelExportSpreadsheet","uploadButton","faFileUpload","downloadAllButton","faFileDownload","ghExportButton","faGithub","hasResources","menuItems","DropdownItem","bind","Dropdown","toggle","DropdownToggle","caret","faTable","DropdownMenu","renderSpreadsheetExport","block","handleDone","continueUrl","handleUploadFile","renderLoading","infoUrl","successMessage","continueLabel","handleBack","renderWorking","showDownloadOptions","setShowDownloadOptions","providerList","DownloadButton","numberStyle","active","inactive","switchToFull","md","offset","lg","borderBottom","minWidth","minHeight","Start","SelectProvider","Retrieve","Review","Upload","App","Loader","inlineError","hasProviders","hasData","fullUi","Header","fluid","xl","ProviderList","sm","BlankSlate","Toolbar","FhirTree","renderData","ProviderForm","Fetcher","GithubUploader","FileUploader","wizardUi","Wizard","classList","add","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","onUpdate","onSuccess","ReactDOM","render","Provider","getElementById","URL","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.9ce10170.chunk.js","sourcesContent":["module.exports = {\n\tuiState: {mode: \"loading\"},\n\tspreadsheetTemplates: {},\n\tisDirty: false,\n\tnonModalUi: {},\n\tqueryProfile: {},\n\tmimeTypeMappings: {},\n\tgithubConfig: {},\n\tupload: {},\n\tproviders: []\n}","import \"cross-fetch\";\nimport _ from \"lodash\";\n\nfunction fetchFHIR(url, config={}, fhirVersion=\"DSTU2\", token=null, retryLimit=0, retries=0) {\n\tif (!config) config = {};\n\tif (!config.headers) config.headers = {};\n\tif (!config.headers.Accept) {\n\t\tconst isR2 = fhirVersion.toUpperCase() === \"DSTU2\" || fhirVersion.toUpperCase() === \"R2\";\n\t\tconfig.headers.Accept = isR2 ? \"application/json+fhir\" : \"application/fhir+json\"; \n\t}\n\tif (token) config.headers.Authorization = `Bearer ${token}`\n\n\t// if (console) console.log(\"Fetching: \" + url);\n\n\treturn fetch(url, config)\n\t\t.then( response => {\n\t\t\tif (!response.ok)\n\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.json() )\n\t\t// .then( json => { console.log(json); return json; })\n\t\t.then( json => {\n\t\t\tif (!json.resourceType || json.resourceType === \"OperationOutcome\") {\n\t\t\t\tconst error = json.issue && json.issue[0] && json.issue[0].diagnostics;\n\t\t\t\tthrow new Error(error || \"Fetch failed for \" + url);\n\t\t\t}\n\t\t\treturn json;\n\t\t})\n\t\t.catch( err => {\n\t\t\tif (retryLimit && retries < retryLimit) {\n\t\t\t\treturn fetchFHIR(url, config, fhirVersion, token, retryLimit, retries+1)\n\t\t\t} else {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t});\n}\n\nfunction buildQs(fhirParams) {\n\treturn \"?\" + Object.keys(fhirParams).map( k => {\n\t\tconst value = Array.isArray(fhirParams[k]) ? fhirParams[k].join(\",\") : fhirParams[k];\n\t\treturn k + \"=\" + encodeURIComponent(value);\n\t}).join(\"&\");\n}\n\n\nfunction replaceValue(path, element, replaceFn) {\n\tif (typeof(path) === \"string\")\n\t\tpath = path.split(\".\");\n\n\tif (!element) return;\n\n\tconst value = element[path[0]];\n\tconst nextPath = path.slice(1);\n\n\tif (!nextPath.length && value !== undefined) {\n\t\tconst newValue = replaceFn(value);\n\t\tif (newValue !== undefined) element[path[0]] = newValue;\n\n\t} else if (value !== undefined) {\n\t\t(Array.isArray(value) ? value : [value])\n\t\t\t.forEach( v => replaceValue(nextPath, v, replaceFn) )\n\t}\n\t\n\treturn element;\n}\n\nfunction pathToValues(path, element) {\n\tif (typeof(path) === \"string\")\n\t\tpath = path.split(\".\");\n\n\tif (!element) return [];\n\n\tlet value = element[path[0]] || [];\n\tif (!Array.isArray(value)) value = [value];\n\tconst nextPath = path.slice(1);\n\n\tif (!nextPath.length) return value\n\n\treturn value\n\t\t.map( v => pathToValues(nextPath, v) )\n\t\t.reduce((a, b) => a.concat(b), []) //flatten\n\t\t.filter( v => v !== undefined);\n}\n\n//this is probably too simplistic\nfunction buildAbsoluteUrl(fhirEndpoint=\"\", reference) {\n\tif (/^http/.test(reference)) {\n\t\treturn reference;\n\t} else {\n\t\treturn fhirEndpoint.replace(/\\/*$/, \"/\") + reference;\n\t}\n}\n\nfunction addProvenance(resource, fhirEndpoint, fhirVersion=\"R2\") {\n\tresource.meta = resource.meta || {};\n\tif (fhirVersion.toUpperCase() === \"STU4\" || fhirVersion.toUpperCase() === \"R4\") {\n\t\tresource.meta.source = resource.meta.source || fhirEndpoint;\n\t} else {\n\t\tresource.meta.extension = resource.meta.extension || [];\n\t\t//per http://build.fhir.org/versions.html#extensions\n\t\tresource.meta.extension.push({\n\t\t\turl: \"http://hl7.org/fhir/4.0/StructureDefinition/extension-Meta.source\",\n\t\t\tvalueUri: fhirEndpoint\n\t\t})\n\t}\n\treturn resource;\n}\n\nfunction getResourcesByQuery({ fhirEndpoint, query={}, retryLimit=0, token, signal, allowErrors, statusCallback }) {\n\tlet entry = [];\n\treturn new Promise( (resolve, reject) => {\n\t\tconst fetchResources = (url, retries=0, page=1) => {\n\t\t\tif (statusCallback) statusCallback(url);\n\t\t\tfetchFHIR(url, {signal}, query.fhirVersion, token, retryLimit)\n\t\t\t\t.then( fhirData => {\n\t\t\t\t\t//single resource fetch (Operation Outcomes are converted to errors in fetchFHIR function)\n\t\t\t\t\tif (fhirData.resourceType !== \"Bundle\") {\n\t\t\t\t\t\tfhirData = addProvenance(fhirData, fhirEndpoint, query.fhirVersion);\n\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\tquery, entry: [{resource: fhirData, fullUrl: url}]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t//Epic returns Operation Outcomes in bundles to indicate data is not guaranteed to be complete\n\t\t\t\t\tentry = entry.concat(\n\t\t\t\t\t\t(fhirData.entry || [])\n\t\t\t\t\t\t\t.filter( r => r.resource.resourceType !== \"OperationOutcome\")\n\t\t\t\t\t\t\t.map(r => {\n\t\t\t\t\t\t\t\tr.resource = addProvenance(r.resource, fhirEndpoint, query.fhirVersion);\n\t\t\t\t\t\t\t\tr.fullUrl = buildAbsoluteUrl(fhirEndpoint, r.resource.resourceType + \"/\" + r.resource.id);\n\t\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\t//walk to next bundle or return resources\n\t\t\t\t\tconst nextUrl = fhirData.link && fhirData.link.find(l => l.relation === \"next\");\n\t\t\t\t\treturn (nextUrl && (!query.pageLimit || page < query.pageLimit))\n\t\t\t\t\t\t? fetchResources(nextUrl.url, retries, page+1)\n\t\t\t\t\t\t: resolve({ entry, query });\n\t\t\t\t\n\t\t\t\t})\n\t\t\t\t.catch( e => {\n\t\t\t\t\tif (allowErrors && e.name !== \"AbortError\") {\n\t\t\t\t\t\tif (statusCallback) statusCallback(url, true);\n\t\t\t\t\t\tresolve({errorLog: [{fullUrl: url, error: e.message, requestType: \"query\"}], entry: [], errorCount: 1});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(e)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t}\n\n\t\tconst url = fhirEndpoint.replace(/\\/*$/, \"/\") + (query.resourcePath || \"\") + \n\t\t\t(Object.keys(query.params || {}).length ? buildQs(query.params) : \"\");\n\t\tfetchResources(url);\n\t\n\t});\n\n}\n\nfunction getResourcesByUrl({ urls=[], fhirVersion, retryLimit, token, allowErrors, signal, statusCallback }) {\n\tconst getResourceByUrl = (url) => {\n\t\tif (statusCallback) statusCallback(url);\n\t\treturn fetchFHIR(url, {signal}, fhirVersion, token, retryLimit)\n\t\t\t.then( resource => ({fullUrl: url, resource}) )\n\t\t\t.catch( e => {\n\t\t\t\tif (!allowErrors || e.name === \"AbortError\") throw e;\n\t\t\t\tif (statusCallback) statusCallback(url, true);\n\t\t\t\treturn {fullUrl: url, error: e.message, requestType: \"reference\"};\n\t\t\t});\n\t}\n\n\treturn Promise.all( _.map(urls, getResourceByUrl) )\n\t\t.then( data => {\n\t\t\tconst errorLog = data.filter( r => r.error );\n\t\t\tconst entry = data.filter( r => !r.error );\n\t\t\treturn allowErrors ? {entry, errorLog} : entry;\n\t\t});\n\n}\n\nfunction findReferences({ entry=[], paths=[], fhirEndpoint }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\t//add reference element within reference type if not included\n\tpaths = paths.map(p => /\\.reference$/.test(p) ? p : p+\".reference\");\n\n\treturn _.reduce( entry, (refIndex, ent, i) => {\n\t\t_.each( paths, path => {\n\t\t\t_.each( pathToValues(path, ent.resource), ref => {\n\t\t\t\t//ignore contained references\n\t\t\t\tif (/^#/.test(ref)) return;\n\t\t\t\tconst url = buildAbsoluteUrl(fhirEndpoint, ref);\n\t\t\t\trefIndex[url] = refIndex[url] || [];\n\t\t\t\trefIndex[url].push({i, path, rawUrl: ref});\n\t\t\t});\n\t\t});\n\t\treturn refIndex;\n\t}, {});\n}\n\n//note - this function mutates the entries that are passed in\nfunction embedReferences({ entry=[], refEntry=[], refIndex={} }) {\n\t_.each( refEntry, ent => {\n\t\tlet resource;\n\t\t_.each( (refIndex[ent.fullUrl] || []), ref => {\n\t\t\tif (!resource) {\n\t\t\t\tresource = \tentry[ref.i].resource;\n\t\t\t\tresource.contained = entry[ref.i].resource.contained || [];\n\t\t\t\tresource.contained.push(ent.resource);\n\t\t\t}\n\t\t\treplaceValue(ref.path, resource, v => {\n\t\t\t\tif (v === ref.rawUrl) return \"#\" + ent.resource.id;\n\t\t\t});\n\t\t});\n\t});\n\treturn entry;\n}\n\nfunction followReferences({ entry=[], paths=[], fhirEndpoint, fhirVersion, retryLimit=0, token, allowErrors, signal, statusCallback }) {\n\tconst refIndex = findReferences({ entry, paths, fhirEndpoint });\n\treturn getResourcesByUrl({ urls: _.keys(refIndex), fhirVersion, retryLimit, token, allowErrors, signal, statusCallback })\n\t\t.then( data => {\n\t\t\tif (allowErrors) data.errorCount = \n\t\t\t\t_.reduce(data.errorLog, (count, ent) => count+refIndex[ent.fullUrl].length, 0);\n\t\t\treturn data;\n\t\t})\n}\n\nfunction followAndEmbedReferences({ entry=[], paths=[], fhirEndpoint, fhirVersion, retryLimit=0, token, allowErrors, signal, statusCallback }) {\n\tconst refIndex = findReferences({ entry, paths, fhirEndpoint });\n\treturn getResourcesByUrl({ urls: _.keys(refIndex), fhirVersion, retryLimit, token, allowErrors, signal, statusCallback })\n\t\t.then( data => {\n\t\t\tconst refEntry = allowErrors ? data.entry : data;\n\t\t\tconst updatedEntry = embedReferences({ entry, refEntry, refIndex })\n\t\t\treturn allowErrors ? {entry: updatedEntry, errorLog: data.errorLog} : updatedEntry;\n\t\t})\n}\n\nfunction findAttachments({ entry=[], paths=[], fhirEndpoint }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\n\treturn _.reduce( entry, (attachmentIndex, ent) => {\n\t\t_.each( paths, path => {\n\t\t\t_.each( pathToValues(path, ent.resource), attachment => {\n\t\t\t\t//ignore embedded data\n\t\t\t\tif (!attachment.url || attachment.data) return;\n\t\t\t\tconst url = buildAbsoluteUrl(fhirEndpoint, attachment.url);\n\t\t\t\tconst contentType = attachment.contentType || \"\";\n\t\t\t\tattachmentIndex[url+\"::\"+contentType||\"\"] = attachmentIndex[url+\"::\"+contentType||\"\"] || \n\t\t\t\t\t{contentType: attachment.contentType, url: url, rawUrl: attachment.url, count: 0};\n\t\t\t\tattachmentIndex[url+\"::\"+contentType||\"\"].count += 1;\n\t\t\t});\n\t\t});\n\t\treturn attachmentIndex;\n\t}, {});\n}\n\n//this function mutates the resources passed in\nfunction attachmentsToFilenames({ entry = [], files = [], paths }) {\n\tpaths = Array.isArray(paths) ? paths : [paths];\n\t_.each( entry, ent => {\n\t\t_.each( paths, path => {\n\t\t\tent.resource = replaceValue(path, ent.resource, v => {\n\t\t\t\tconst file = files.find(f => f.rawUrl === v.url && f.contentType === v.contentType);\n\t\t\t\tif (file) return {...v, url: file.fileName};\n\t\t\t});\n\t\t});\n\t})\n\treturn entry;\n}\n\nfunction findAndDownloadAttachments({ entry=[], paths=[], fhirEndpoint, token, allowErrors, retryLimit=0, signal, statusCallback, mimeTypeMappings={} }) {\n\t\n\tconst attachmentIndex = findAttachments({ entry, paths, fhirEndpoint });\n\t\n\tconst fetchAttachment = (url, config={}, retryLimit=0, retries=0) => {\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\t//Note that CORS errors for any reason even due to a 401 will not have an error code\n\t\t\t\t//in logs. See https://github.com/github/fetch/issues/201\n\t\t\t\tif (retryLimit && retries < retryLimit) {\n\t\t\t\t\treturn fetchAttachment(url, config, retryLimit, retries+1)\n\t\t\t\t} else {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\tlet i = 0;\n\treturn Promise.all(\n\t\t_.map( attachmentIndex, attachment => {\n\t\t\tlet config = {signal, headers: {\n\t\t\t\tAuthorization: token ? `Bearer ${token}` : undefined,\n\t\t\t\tAccept: attachment.contentType || undefined\n\t\t\t}};\n\t\t\tif (statusCallback) statusCallback(attachment.url);\n\t\t\treturn fetchAttachment(attachment.url, config, retryLimit)\n\t\t\t\t.then( data => data.blob() )\n\t\t\t\t.then( blob => {\n\t\t\t\t\tconst urlExtension = attachment.url.match(/\\.(.{3})$|\\.(.{4})$/);\n\t\t\t\t\tconst mimeExtension = attachment.contentType && mimeTypeMappings[attachment.contentType];\n\t\t\t\t\tconst extension = (urlExtension && urlExtension[1]) || mimeExtension;\n\t\t\t\t\tconst fileName = (i += 1).toString() + (extension ? \".\" + extension : \"\");\n\t\t\t\t\treturn {fileName, fullUrl: attachment.url, blob, contentType: attachment.contentType, rawUrl: attachment.rawUrl}\n\t\t\t\t})\n\t\t\t\t.catch( e => {\n\t\t\t\t\tif (!allowErrors || e.name === \"AbortError\") throw e;\n\t\t\t\t\tif (statusCallback) statusCallback(attachment.url, true);\n\t\t\t\t\treturn {fullUrl: attachment.url, contentType: attachment.contentType, error: e.message, requestType: \"attachment\", rawUrl: attachment.rawUrl};\n\t\t\t\t})\n\t\t})\n\t).then( data => {\n\t\tif (!allowErrors) return data;\n\t\tconst errorLog = data.filter( r => r.error );\n\t\tconst errorCount = _.reduce(errorLog, (count, ent) => count+attachmentIndex[ent.fullUrl+\"::\"+ent.contentType||\"\"].count, 0);\n\t\tconst files = data.filter( r => !r.error );\n\t\treturn allowErrors ? { files, errorLog, errorCount } : files;\n\t});\n}\n\n\nexport default { \n\tfetchFHIR, replaceValue, pathToValues, findReferences, embedReferences, findAttachments,\n\tgetResourcesByQuery, followAndEmbedReferences, followReferences, findAndDownloadAttachments,\n\tattachmentsToFilenames\n}","import fhir from \"./fhir\";\n\nconst authEndpointErr = \"Authorization endpoint or token endpoint not found\";\n\nfunction getPath(obj, path = \"\") {\n\tpath = path.trim();\n\tif (!path) return obj;\n\treturn path.split(\".\").reduce(\n\t\t(out, key) => out ? out[key] : undefined,\n\t\tobj\n\t);\n}\n\nfunction getAuthEndpoints(fhirEndpoint) {\n\tconst url = fhirEndpoint.replace(/\\/*$/, \"/\");\n\treturn new Promise( (resolve, reject) => {\n\t\tgetWellKnownEndpoints(url)\n\t\t\t.then( endpoints => resolve(endpoints) )\n\t\t\t.catch( err => {\n\t\t\t\tgetCapabilityEndpoints(url)\n\t\t\t\t\t.then( endpoints => resolve(endpoints) )\n\t\t\t\t\t.catch( err => reject( authEndpointErr ) )\n\t\t\t});\n\t});\n}\n\nfunction getWellKnownEndpoints(baseUrl) {\n\tconst url = baseUrl + \".well-known/smart-configuration\";\n\treturn fetch(url)\n\t\t.then( response => {\n\t\t\tif (!response.ok)\n\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.json() )\n\t\t.then( json => {\n\t\t\tlet endpoints = {\n\t\t\t\tregistrationEndpoint  : json.registration_endpoint,\n\t\t\t\tauthorizationEndpoint : json.authorization_endpoint,\n\t\t\t\ttokenEndpoint         : json.token_endpoint\n\t\t\t};\n\t\t\tif (!endpoints.authorizationEndpoint || !endpoints.tokenEndpoint) {\n\t\t\t\tthrow authEndpointErr;\n\t\t\t} else {\n\t\t\t\treturn endpoints;\t\t\n\t\t\t}\n\t\t})\n\t\t.catch( e => { throw authEndpointErr });\n}\n\nfunction getCapabilityEndpoints(baseUrl) {\n\tconst nsUri = \"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris\";\n\tconst url = baseUrl + \"metadata\";\n\n\treturn fhir.fetchFHIR(url)\n\t\t.then( json => {\n\t\t\tconst extensions = (getPath(json || {}, \"rest.0.security.extension\") || [])\n\t\t\t\t.filter(e => e.url === nsUri)\n\t\t\t\t.map(o => o.extension)[0];\n\n\t\t\tlet endpoints = {};\n\t\t\tif (extensions) {\n\t\t\t\textensions.forEach(ext => {\n\t\t\t\t\tif (ext.url === \"register\")\n\t\t\t\t\t\tendpoints.registrationEndpoint = ext.valueUri;\n\t\t\t\t\tif (ext.url === \"authorize\")\n\t\t\t\t\t\tendpoints.authorizationEndpoint = ext.valueUri;\n\t\t\t\t\tif (ext.url === \"token\")\n\t\t\t\t\t\tendpoints.tokenEndpoint = ext.valueUri;\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!endpoints.authorizationEndpoint || !endpoints.tokenEndpoint) {\n\t\t\t\tthrow authEndpointErr;\n\t\t\t} else{\n\t\t\t\treturn endpoints;\t\t\n\t\t\t}\n\t\t})\n\t\t.catch( e => { throw authEndpointErr });\n}\n\nfunction generateStateParam(targetLen=32) {\n\tconst charSet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\tlet result = [];\n\twhile (targetLen--)\n\t\tresult.push(charSet.charAt(Math.floor(Math.random() * charSet.length)));\n\treturn result.join(\"\");\n}\n\nfunction buildAuthorizeUrl(authEndpoint, fhirEndpoint, state, scope, redirectUri, clientId, clientSecret, launch) {\n\tif (Array.isArray(scope)) scope = scope.join(\" \");\n\n\tlet params = [\n\t\t\"response_type=code\",\n\t\t\"client_id=\"    + encodeURIComponent(clientId),\n\t\t\"scope=\"        + encodeURIComponent(scope),\n\t\t\"redirect_uri=\" + encodeURIComponent(redirectUri),\n\t\t\"aud=\"          + encodeURIComponent(fhirEndpoint),\n\t\t\"state=\"        + state\n\t];\n\n\tif (launch) \n\t\tparams.push(\"launch=\" + encodeURIComponent(launch));\n\tif (clientSecret) \n\t\tparams.push(\"client_secret=\" + encodeURIComponent(clientSecret));\n\n\treturn authEndpoint + \"?\" + params.join(\"&\");\n}\n\nfunction exchangeCodeForToken(tokenEndpoint, code, redirectUri, clientId, clientSecret) {\n\tlet config = {\n\t\tmethod: \"post\",\n\t\theaders:  {\"content-type\": \"application/x-www-form-urlencoded\"},\n\t\t// mode: \"cors\",\n\t\tbody: [\n\t\t\t\"grant_type=authorization_code\",\n\t\t\t\"code=\" + encodeURIComponent(code),\n\t\t\t\"redirect_uri=\" + encodeURIComponent(redirectUri)\n\t\t].join(\"&\")\n\t}\n\n\tif (clientSecret) {\n\t\tconfig.headers.Authorization = `Basic ${btoa(`${clientId}:${clientSecret}`)}`;\n\t} else {\n\t\tconfig.body += \"&client_id=\" + encodeURIComponent(clientId);\n\t}\n\n\treturn fetch(tokenEndpoint, config)\n\n}\n\nfunction refreshToken(tokenEndpoint, refreshToken) {\n\treturn fetch(tokenEndpoint, {\n\t\tmethod: \"post\",\n\t\theaders:  {\"content-type\": \"application/x-www-form-urlencoded\"},\n\t\tmode: \"cors\",\n\t\tbody: [\n\t\t\t\"grant_type=refresh_token\",\n\t\t\t\"refresh_token=\" + encodeURIComponent(refreshToken)\n\t\t].join(\"&\")\n\t})\n}\n\nfunction buildQs(fhirParams) {\n\treturn \"?\" + Object.keys(fhirParams).map( k => {\n\t\tconst value = Array.isArray(fhirParams[k]) ? fhirParams[k].join(\",\") : fhirParams[k];\n\t\treturn k + \"=\" + encodeURIComponent(value);\n\t}).join(\"&\");\n}\n\nexport default {\n\tgetWellKnownEndpoints, getCapabilityEndpoints, getAuthEndpoints, buildQs,\n\tbuildAuthorizeUrl, exchangeCodeForToken, refreshToken, generateStateParam\n}","import SMART from \"./smart-core\";\n\nexport default class SmartPopup {\n\n\tconstructor(provider) {\n\t\tthis.provider = provider;\n\t\tthis.authWindow = window.open('', '_blank');\n\t\tthis.authWindow.document.write('Loading...');\n\t}\n\n\tparseQs(qs) {\n\t\tconst pairs = qs.split('&');\n\t\tlet result = {};\n\t\tpairs.forEach( pair => {\n\t\t\tpair = pair.split('=');\n\t\t\tresult[pair[0]] = decodeURIComponent(pair[1]||\"\");\n\t\t});\n\t\treturn result;\n\t}\n\n\tcancel() {\n\t\tif (this.reject) {\n\t\t\tclearInterval(this.popupPoll);\n\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\tthis.authWindow.close();\n\t\t\tthis.reject(new Error(\"cancelled\"))\n\t\t}\n\t}\n\n\tauthorize(authEndpoints, ignoreState) {\t\n\t\treturn new Promise( (resolve, reject) => {\n\t\t\tthis.reject = reject;\n\t\t\tconst stateParam = SMART.generateStateParam();\n\n\t\t\tthis.popupPoll = setInterval( () => {   \n\t\t\t\tif (this.authWindow.closed) {\n\t\t\t\t\tclearInterval(this.popupPoll);\n\t\t\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\t\t\treject(new Error(\"Login window closed by user\"));\n\t\t\t\t}\n\t\t\t}, 500); \n\t\n\n\t\t\tconst receiveMessage = (event) => {\n\t\t\t\tif (event.origin !== window.location.origin) return;\n\t\t\t\t//block react dev tools messages\n\t\t\t\tif (typeof event.data !== \"string\") return;\n\t\t\t\tclearInterval(this.popupPoll);\n\t\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\t\tthis.authWindow.close();\n\n\t\t\t\tconst data = this.parseQs(event.data);\n\n\t\t\t\tif (data.error) {\n\t\t\t\t\treject(data.error);\n\t\t\t\t} else if (data.code && ignoreState !== true && data.state !== stateParam) {\n\t\t\t\t\treject(\"Invalid state parameter returned by server\");\n\t\t\t\t} else if (data.code) {\n\t\t\t\t\tSMART.exchangeCodeForToken(\n\t\t\t\t\t\tauthEndpoints.tokenEndpoint,\n\t\t\t\t\t\tdata.code,\n\t\t\t\t\t\tthis.provider.redirectUri,\n\t\t\t\t\t\tthis.provider.clientId,\n\t\t\t\t\t\tthis.provider.clientSecret\n\t\t\t\t\t)\n\t\t\t\t\t.then( data => data.json() )\n\t\t\t\t\t.then( data => {\n\t\t\t\t\t\tif (data.access_token) {\n\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t\t\treject(\"No access token in server token response\");\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\treject(\"Failed to retrieve code parameter\");\n\t\t\t\t}\n\t\t\t};\n\t\t\n\t\t\tconst url = SMART.buildAuthorizeUrl(\n\t\t\t\tauthEndpoints.authorizationEndpoint,\n\t\t\t\tthis.provider.fhirEndpoint,\n\t\t\t\tstateParam,\n\t\t\t\tthis.provider.scope,\n\t\t\t\tthis.provider.redirectUri,\n\t\t\t\tthis.provider.clientId\n\t\t\t);\n\n\t\t\tthis.messageListener = \n\t\t\t\twindow.addEventListener(\"message\", receiveMessage, false);\n\t\t\t\n\t\t\tthis.authWindow.location.href = url;\n\t\t});\n\t}\n\n}","import Smart from \"../smart/smart-core\";\nimport SmartPopup from \"../smart/smart-popup\";\nimport FHIR from \"../smart/fhir\";\n\nexport default class FhirLoader {\n\t\n\tresetAbortController() {\n\t\tthis.controller = new AbortController();\n\t\tthis.signal = this.controller.signal;\t\n\t}\n\n\tcancel() {\n\t\tif (this.popup) {\n\t\t\tthis.popup.cancel();\n\t\t} else {\n\t\t\tthis.controller.abort();\n\t\t}\n\t}\n\n\tmergeAndDeDupeData(data) {\n\t\tlet uniqueUrls = {};\n\t\tlet files = [];\n\t\tlet entry = [];\n\t\tlet errorLog = [];\n\t\tlet errorCount = 0;\n\t\tdata.forEach( queryResult => {\n\t\t\tqueryResult.entry.forEach( ent => {\n\t\t\t\t//prevent duplicates\n\t\t\t\tif (uniqueUrls[ent.fullUrl]) return;\n\t\t\t\tuniqueUrls[ent.fullUrl] = true;\n\t\t\t\tentry.push(ent)\n\t\t\t})\n\t\t\tfiles = files.concat(queryResult.files || []);\n\t\t\terrorLog = errorLog.concat(queryResult.errorLog || []);\n\t\t\terrorCount += queryResult.errorCount || 0;\n\t\t})\n\t\treturn {entry, files, errorLog, errorCount}\n\t}\n\n\tgetFHIR(provider, queryProfile, context, allowErrors=true, mimeTypeMappings={}, retryLimit, statusCallback) {\n\t\tconst patientId = context ? context.patient : provider.patient;\n\n\t\tconst fetchQuery = (query) => {\n\t\t\tlet params = {...query.params}\n\t\t\tObject.keys(params).forEach(k => {\n\t\t\t\tif (Array.isArray(params[k])) params[k] = params[k].join(\",\");\n\t\t\t\tparams[k] = params[k].toString().replace(\"{{patientId}}\", patientId);\n\t\t\t});\n\t\t\tconst resourcePath = query.resourcePath.replace(/\\{\\{patientId\\}\\}/g, patientId);\n\n\t\t\treturn FHIR.getResourcesByQuery({\n\t\t\t\tfhirEndpoint: provider.fhirEndpoint, \n\t\t\t\tquery: {...query, params, resourcePath, fhirVersion: queryProfile.fhirVersion},\n\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\tretryLimit,\n\t\t\t\tallowErrors,\n\t\t\t\tstatusCallback,\n\t\t\t\tsignal: this.signal\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.containReferences) return data;\n\n\t\t\t\treturn FHIR.followAndEmbedReferences({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.containReferences,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tallowErrors,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then( result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.entry = result.entry;\n\t\t\t\t\treturn data;\n\t\t\t\t}); \n\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.retrieveReferences) return data;\n\n\t\t\t\treturn FHIR.followReferences({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.retrieveReferences,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tallowErrors,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then( result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.entry = data.entry.concat(result.entry);\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (!query.downloadAttachments) return data;\n\t\t\t\treturn FHIR.findAndDownloadAttachments({\n\t\t\t\t\tentry: data.entry,\n\t\t\t\t\tpaths: query.downloadAttachments,\n\t\t\t\t\tfhirEndpoint: provider.fhirEndpoint,\n\t\t\t\t\tfhirVersion: queryProfile.fhirVersion,\n\t\t\t\t\ttoken: context ? context.access_token : null,\n\t\t\t\t\tretryLimit,\n\t\t\t\t\tmimeTypeMappings,\n\t\t\t\t\tallowErrors: true,\n\t\t\t\t\tstatusCallback,\n\t\t\t\t\tsignal: this.signal\n\t\t\t\t}).then(result => {\n\t\t\t\t\tdata.errorLog = data.errorLog || [];\n\t\t\t\t\tdata.errorLog = data.errorLog.concat(result.errorLog || []);\n\t\t\t\t\tdata.errorCount = data.errorCount || 0;\n\t\t\t\t\tdata.errorCount += result.errorCount;\n\t\t\t\t\tdata.files = result.files;\n\t\t\t\t\tdata.entry = FHIR.attachmentsToFilenames({\n\t\t\t\t\t\tentry: data.entry, files: result.files, paths: query.downloadAttachments\n\t\t\t\t\t});\n\t\t\t\t\treturn data;\n\t\t\t\t});\n\t\t\t})\n\t\t}\n\n\t\tthis.resetAbortController();\n\n\t\t//sequential query\n\t\t// return queryProfile.queries.reduce((promiseChain, currentQuery) => {\n\t\t// \treturn promiseChain.then( chainResults =>\n\t\t// \t\tfetchQuery(currentQuery) .then( currentResult =>\n\t\t// \t\t\t[ ...chainResults, currentResult ]\n\t\t// \t\t)\n\t\t// \t);\n\t\t// }, Promise.resolve([]))\n\t\t// \t.then( this.mergeAndDeDupeData )\n\n\t\t//parallel (moderated by browser)\n\t\treturn Promise.all( queryProfile.queries.map(fetchQuery) )\n\t\t\t.then( this.mergeAndDeDupeData )\n\t}\n\t\n\tauthAndGetFHIR(provider, ignoreState) {\n\t\t//make available to cancel function\n\t\tthis.popup = new SmartPopup(provider);\n\t\treturn Smart.getAuthEndpoints(provider.fhirEndpoint)\n\t\t\t.then(authEndpoints => {\n\t\t\t\treturn this.popup.authorize(authEndpoints, ignoreState);\n\t\t\t})\n\t\t\t.then(context => {\n\t\t\t\tthis.popup = null;\n\t\t\t\treturn context;\n\t\t\t}).catch(e => {\n\t\t\t\tthis.popup = null;\n\t\t\t\tthrow e;\n\t\t\t});\n\n\t}\n\n}\n","import tv4 from \"tv4\";\nimport  matchUrl from 'match-url-wildcard';\nimport configSchema from \"../schemas/upload-manifest-schema.json\";\nimport _ from \"lodash\";\n\nexport default class FileExporter {\n\n\tcancel() {\n\t\tthis.controller.abort();\n\t}\n\n\tresetCancelled() {\n\t\tthis.controller = new AbortController();\n\t\tthis.signal = this.controller.signal;\n\t}\n\n\tisValidUrl(url, whitelist) {\n\t\treturn _.find(whitelist, rule => matchUrl(url, rule)) !== undefined;\n\t}\n\n\tgetManifest(url) {\n\t\tthis.resetCancelled();\n\t\tconst config = {\n\t\t\tsignal: this.signal,\n\t\t\taccept: \"application/json\"\n\t\t}\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.then( data => data.json() )\n\t\t\t.then( data => {\n\t\t\t\ttv4.validate(data, configSchema);\n\t\t\t\tif (tv4.error) {\n\t\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\t\tthrow new Error(url + \": \" + tv4.error.message);\n\t\t\t\t}\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\t\n\tputFile(url, file) {\n\t\tthis.resetCancelled()\n\t\tconst config = {\n\t\t\tsignal: this.signal,\n\t\t\tmethod: \"PUT\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/octet-stream\"\n\t\t\t},\n\t\t\tbody: file\n\t\t}\n\t\treturn fetch(url, config)\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.then( response => {\n\t\t\t\tconst contentType = response.headers.get(\"content-type\");\n\t\t\t\tif (contentType && contentType.indexOf(\"application/json\") !== -1) {\n\t\t\t\t\treturn response.json();\n\t\t\t\t} else {\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tif (data.error) throw new Error(data.error);\n\t\t\t})\n\t\t\t.catch( error => {\t\n\t\t\t\tconsole.log(error);\n\t\t\t\tif (error.name === \"AbortError\") {\n\t\t\t\t\tthrow(error);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`An error occurred sending your data: ${error.message}`);\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\n}","import _ from \"lodash\";\n\n//matching object keys merge properties\n//if key has an underscore, then object is replaced\n//arrays items merge by id, appending otherwise\n//array items with an underscore property replace all properties\n//objects item with an underscore property are deleted\nfunction merge(templates) {\n\n\tconst mergeArray = (base, override) => {\n\t\t_.each(override, overrideItem => {\n\t\t\tconst baseIndex = overrideItem.id \n\t\t\t\t? _.findIndex(base, b => b.id === overrideItem.id) \n\t\t\t\t: -1;\n\t\t\tif (overrideItem._) {\n\t\t\t\tif (baseIndex > -1) base.splice(baseIndex, 1); \n\t\t\t} else if (baseIndex > -1) {\n\t\t\t\tbase[baseIndex] = mergeObject(base[baseIndex], overrideItem);\n\t\t\t} else {\n\t\t\t\tbase.push(overrideItem)\n\t\t\t}\n\t\t});\n\t\treturn base;\n\t}\n\n\tconst mergeObject = (base, override) => {\n\t\t_.each( _.keys(override), key => {\n\t\t\tif (key[0] === \"_\") {\n\t\t\t\tbase[key.slice(1)] = override[key];\n\t\t\t} else if (base[key] === undefined) {\n\t\t\t\tbase[key] = override[key];\n\t\t\t} else if (_.isPlainObject(override[key]) && override[key]._) {\n\t\t\t\tdelete base[key];\n\t\t\t} else if (_.isPlainObject(override[key])) {\n\t\t\t\tbase[key] = mergeObject(base[key], override[key]);\n\t\t\t} else if (_.isArray(base[key]) && _.isArray(override[key])) {\n\t\t\t\tbase[key] = mergeArray(base[key], override[key]);\n\t\t\t} else {\n\t\t\t\tbase[key] = override[key];\n\t\t\t}\n\t\t})\n\t\treturn base;\n\t}\n\n\tlet base = JSON.parse(JSON.stringify(templates[0]));\n\t_.each( templates, (template, i) => {\n\t\tif (i === 0) return;\n\t\ttemplate = JSON.parse(JSON.stringify(template));\n\t\tif (_.isPlainObject(base) && _.isPlainObject(template)) {\n\t\t\tbase = mergeObject(base, template)\n\t\t} else if (_.isArray(base) && _.isArray(template)) {\n\t\t\tbase = mergeArray(base, template);\n\t\t} else {\n\t\t\tbase = template;\n\t\t}\n\t})\n\treturn base;\n\n}\n\nexport default { merge };","import fetch from \"cross-fetch\";\nimport stripJsonComments from \"strip-json-comments\";\nimport tv4 from \"tv4\";\nimport endpointListSchema from \"../schemas/endpoint-list-schema.json\";\nimport configSchema from \"../schemas/config-schema.json\";\nimport FileExporter from \"./file-exporter\";\nimport _ from \"lodash\";\nimport mergeObjects from \"./merge-objects.js\";\n\nfunction getUrlParameter(name) {\n    name = name.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\");\n    var results = regex.exec(window.location.search);\n    return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\nfunction overlayQsValues(config) {\n\tconst manifestUrl = getUrlParameter(\"upload_manifest_url\");\n\tif (manifestUrl) {\n\t\tconfig.upload = config.upload || {};\n\t\tconfig.upload.manifestUrl = manifestUrl;\n\t\tconfig.upload.qsManifestUrl = true;\n\t}\n\tconst label = getUrlParameter(\"upload_label\");\n\tif (label) {\n\t\tconfig.upload = config.upload || {};\n\t\tconfig.upload.label = label;\n\t}\n\tconst wizard = getUrlParameter(\"wizard\");\n\tif (wizard) config.showWizard = true;\n\treturn config;\n}\n\n\nfunction readConfigFile(path, isOverride) {\n\treturn fetch(path, { headers: {'Accept': 'application/json'} })\n\t\t.then( response => {\n\t\t\tif (!response.ok && !isOverride)\n\t\t\t\tthrow new Error(`${path} - HTTP ${response.status} - ${response.statusText}`);\t\t\t\t\n\t\t\t\n\t\t\tif (!response.ok && isOverride)\n\t\t\t\tresponse = { text: () => \"{}\" };\n\n\t\t\treturn response;\n\t\t})\n\t\t.then( data => data.text() )\n\t\t.then( data => {\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(stripJsonComments(data));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tthrow new Error(`${path} is not valid JSON.`);\n\t\t\t}\n\t\t})\n\n}\n\nfunction loadConfigFile(path, overridePath, allowQsOverride) {\n\tlet configReaders = [readConfigFile(path)];\n\tconst qsOverridePath = getUrlParameter(\"config\");\n\n\tif (qsOverridePath && allowQsOverride) {\n\t\tconfigReaders.push(readConfigFile(qsOverridePath, true));\n\t} else if (overridePath) {\n\t\tconfigReaders.push(readConfigFile(overridePath, true));\n\t}\n\n\treturn Promise.all(configReaders)\n\t\t.then( data => mergeObjects.merge(data) )\n\t\t.then( data => {\n\t\t\ttv4.validate(data, configSchema);\n\t\t\tif (tv4.error) {\n\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\tthrow new Error(path + \": \" + tv4.error.message);\n\t\t\t}\n\t\t\treturn data;\n\t\t})\n\t\t//check for invalid queryProfile name and credential references (can't do this in json schema v4)\n\t\t.then( config => {\n\t\t\tif (!config.endpointLists) return config;\n\t\t\t\n\t\t\tconst invalidEndpointId = _.find( _.keys(config.endpointLists) || [], id => {\n\t\t\t\tconst v = config.endpointLists[id];\n\t\t\t\treturn (\n\t\t\t\t\tv && v.defaults && v.defaults.queryProfile && \n\t\t\t\t\t!config.queryProfiles[v.defaults.queryProfile]\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tif (invalidEndpointId) throw new Error(\n\t\t\t\t\"Invalid query profile in endpoint \" + \n\t\t\t\tpath + \": /endpointLists/\" + invalidEndpointId + \"/defaults\"\n\t\t\t);\n\n\t\t\tconst invalidCredentialId = _.find( _.keys(config.endpointLists) || [], id => {\n\t\t\t\tconst v = config.endpointLists[id];\n\t\t\t\treturn (\n\t\t\t\t\tv && v.defaults && v.defaults.credentialId && \n\t\t\t\t\t!config.credentials[v.defaults.credentialId]\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tif (invalidCredentialId) throw new Error(\n\t\t\t\t\"Invalid credential id in endpoint \" + \n\t\t\t\tpath + \": /endpointLists/\" + invalidCredentialId + \"/defaults\"\n\t\t\t);\n\n\t\t\treturn config;\n\t\t})\n\t\t//check for invalid template name references (can't do this in json schema v4)\n\t\t.then( config => {\n\t\t\tif (!config.spreadsheetTemplates) return config;\n\n\t\t\tconst templateNames = Object.keys(config.spreadsheetTemplates);\n\t\t\ttemplateNames.forEach( templateName => {\n\t\t\t\tconst baseTemplates = config.spreadsheetTemplates[templateName].extends || [];\n\t\t\t\tbaseTemplates.forEach( baseTemplateName => {\n\t\t\t\t\tif (templateNames.indexOf(baseTemplateName) === -1)\n\t\t\t\t\t\tthrow new Error(\"Invalid base template name in '\" + templateName + \"'\");\n\t\t\t\t})\n\t\t\t})\n\t\t\treturn config;\n\t\t})\n\t\t.then( config => {\n\t\t\tif (!config.endpointLists) return config;\n\t\t\treturn loadEndpointLists(config);\n\t\t})\n\t\t.then( config => {\n\t\t\tconfig.redirectUri = config.redirectUri || \n\t\t\t\twindow.location.href.split(/\\?|#/)[0].replace(/\\/*$/, \"/callback.html\");\n\t\t\treturn config;\n\t\t})\n\t\t.then( config => {\n\t\t\treturn overlayQsValues(config);\n\t\t})\n\t\t//preload manifest if in wizard mode.\n\t\t//manifest is loaded on-demand when in full mode so as not to display \n\t\t//unnecessary errors to the user if it fails to load.\n\t\t.then( config => {\n\n\t\t\tif (!config.showWizard || (config.upload && !config.upload.manifestUrl)) \n\t\t\t\treturn config;\n\t\t\t\n\t\t\tif (!config.upload || (!config.upload.manifestUrl && !config.upload.uploadUrl))\n\t\t\t\tthrow new Error(\"Upload configuration required for wizard mode\");\n\t\t\t\n\t\t\tconst fileExporter = new FileExporter();\n\t\t\tif (config.upload.qsManifestUrl) {\n\t\t\t\tconst isValidUrl = fileExporter.isValidUrl(config.upload.manifestUrl, config.upload.whitelist);\n\t\t\t\tif (!isValidUrl) \n\t\t\t\t\tthrow new Error(\"Url manifest location not in whitelist: \" + config.upload.manifestUrl);\n\t\t\t}\n\n\t\t\treturn fileExporter.getManifest(config.upload.manifestUrl)\n\t\t\t\t.then( manifest => {\n\t\t\t\t\tconfig.upload = {...config.upload, ...manifest}\n\t\t\t\t\treturn config;\n\t\t\t\t})\n\t\t\t\t.catch(e => {\n\t\t\t\t\tthrow new Error(\"Unable to load manifest at \" + config.upload.manifestUrl);\n\t\t\t\t});\n\t\n\n\t\t})\n\t\t// .then( config => {\n\t\t// \tconsole.log(config);\n\t\t// \treturn config;\n\t\t// })\n\n}\n\nfunction loadEndpointLists(config) {\n\n\tconst getEndpointList = (endpointList, id) => {\n\t\tif (!endpointList.path) return;\n\n\t\treturn fetch(endpointList.path, { headers: {'Accept': 'application/json'} })\n\t\t\t.then( response => {\n\t\t\t\tif (!response.ok)\n\t\t\t\t\tthrow new Error(`${endpointList.path} - HTTP ${response.status} - ${response.statusText}`);\n\t\t\t\treturn response;\n\t\t\t})\t\t\n\t\t\t.then( data => data.text() )\n\t\t\t.then( data => {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(stripJsonComments(data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t\tthrow new Error(`${endpointList.path} is not valid JSON.`);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\ttv4.validate(data, endpointListSchema);\n\t\t\t\tif (tv4.error) {\n\t\t\t\t\tif (console) console.log(tv4.error);\n\t\t\t\t\tthrow new Error(endpointList.path + \": \" + tv4.error.message);\n\t\t\t\t}\n\t\t\t\treturn data;\n\t\t\t})\n\n\t\t\t//check for invalid queryProfile name references and credential ids(can't do this in json schema)\n\t\t\t.then( data => {\n\n\t\t\t\t(data.entry || data.Entries || []).forEach( endpoint => {\n\t\t\t\t\tif (endpoint.queryProfile && !config.queryProfiles[endpoint.queryProfile]\n\t\t\t\t\t) throw new Error(\n\t\t\t\t\t\t\"Invalid query profile in endpoint list \" + \n\t\t\t\t\t\tendpointList.path + \" - \" + endpoint.queryProfile\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\t(data.entry || data.Entries || []).forEach( endpoint => {\n\t\t\t\t\tif (endpoint.credentialId && !config.credentials[endpoint.credentialId]\n\t\t\t\t\t) throw new Error(\n\t\t\t\t\t\t\"Invalid credential id endpoint list \" + \n\t\t\t\t\t\tendpointList.path + \" - \" + endpoint.credentialId\n\t\t\t\t\t);\n\t\t\t\t})\n\n\t\t\t\treturn data; \n\n\t\t\t})\n\t\t\t.then( data => {\n\t\t\t\tconst result = (data.Entries || data.entry).map( entry => {\n\t\t\t\t\tlet newEntry = {...entry}\n\t\t\t\t\t//standardize epic format\n\t\t\t\t\tif (newEntry.OrganizationName) {\n\t\t\t\t\t\tnewEntry.name = newEntry.OrganizationName;\n\t\t\t\t\t\tdelete newEntry.OrganizationName;\n\t\t\t\t\t}\n\t\t\t\t\tif (newEntry.FHIRPatientFacingURI) {\n\t\t\t\t\t\tnewEntry.fhirEndpoint = newEntry.FHIRPatientFacingURI;\n\t\t\t\t\t\tdelete newEntry.FHIRPatientFacingURI;\n\t\t\t\t\t}\n\t\t\t\t\tif (newEntry.id) {\n\t\t\t\t\t\tnewEntry.orgId = newEntry.id;\n\t\t\t\t\t\tdelete newEntry.id;\n\t\t\t\t\t}\n\t\t\t\t\t//add defaults group name\n\t\t\t\t\tif (endpointList.defaults)\n\t\t\t\t\t\tnewEntry.defaultId = id;\n\t\t\t\t\treturn newEntry;\n\t\t\t\t});\n\t\t\t\treturn result\n\t\t\t})\n\t\t\t.catch( e => { \n\t\t\t\tif (e.message) throw e;\n\t\t\t\tthrow new Error(\"Error reading \" + endpointList.path)\n\t\t\t})\n\t}\n\n\treturn Promise.all(\n\t\t_.map( config.endpointLists, (l,id) => getEndpointList(l,id) )\n\t)\n\t\t.then( data => {\n\t\t\tconst organizations = [].concat.apply([], data);\n\t\t\tconst orgDefaults = _.mapValues( config.endpointLists, v => v.defaults );\n\t\t\treturn {...config, orgDefaults, organizations, endpointLists: null}\n\t\t});\n}\n\nexport default { loadConfigFile }","import sanitizeFilename from \"sanitize-filename\";\nimport _ from \"lodash\";\nimport jszip from \"jszip\";\nimport { saveAs } from \"file-saver\";\n\nfunction addProviderToZip(zipFolder, provider) {\n\t\n\t// console.log(JSON.stringify(provider.data))\n\t\n\tconst bundles = _.chain(provider.data.entry)\n\t\t.groupBy(e => e.resource.resourceType)\n\t\t.mapValues(entry => {\n\t\t\treturn {\n\t\t\t\tentry: _.map(entry, e => ({fullUrl: e.fullUrl, resource: e.resource}) ),\n\t\t\t\ttotal: entry.length, \n\t\t\t\ttype:\"collection\"\n\t\t\t}\n\t\t}).value();\n\t_.each(bundles, (bundle, resourceType) => {\n\t\tzipFolder.file(resourceType+\".json\", JSON.stringify(bundle, null, 2)) \n\t});\n\t_.each(provider.data.files, f => {\n\t\tzipFolder.file(f.fileName, f.blob, {type: \"blob\"});\n\t});\n\tif (provider.data.errorLog.length)\n\t\tzipFolder.file(\"error_log.json\", JSON.stringify(provider.data.errorLog, null, 2));\n}\n\nfunction exportProvider(provider) {\n\treturn new Promise( (resolve, reject) => {\n\t\tconst zip = new jszip();\n\t\taddProviderToZip(zip, provider);\n\t\tconst fileName = sanitizeFilename(provider.name);\n\t\tzip.generateAsync({type: \"blob\"})\n\t\t\t.then( blob => saveAs(blob, fileName) )\n\t\t\t.then( resolve )\n\t\t\t.catch( reject );\n\t});\n}\n\nfunction exportProviders(providers, fileName=\"procure-data.zip\") {\n\treturn exportProvidersAsBlob(providers)\n\t\t.then( blob => saveAs(blob, fileName) );\n}\n\nfunction exportProvidersAsBlob(providers) {\n\treturn new Promise( (resolve, reject) => {\n\t\tconst zip = new jszip();\n\t\tproviders.filter( p => p.data && p.selected).forEach( provider => {\n\t\t\tconst folder = zip.folder( sanitizeFilename(provider.name) );\n\t\t\taddProviderToZip(folder, provider);\n\t\t});\n\t\tzip.generateAsync({type: \"blob\"})\n\t\t\t.then( resolve )\n\t\t\t.catch( reject );\n\t});\n}\n\nfunction generateFile(providers, multiProviderFileName) {\n\tconst exportableProviders = _.filter(providers, p => {\n\t\treturn p.data && p.data.entry && p.selected && (p.data.entry.length || p.data.errorLog.length)\n\t});\n\tif (exportableProviders.length > 1) {\n\t\treturn exportProviders(exportableProviders, multiProviderFileName);\n\t} else {\n\t\treturn exportProvider(exportableProviders[0]);\n\t}\n}\n\nexport default { generateFile, exportProvidersAsBlob }","const defaultBaseUrl = \"https://api.github.com\";\n\nfunction callApi(config, path, method=\"GET\", jsonPayload) {\n\tconst reqConfig = {\n\t\theaders: {\"Authorization\": `Bearer ${config.token}`},\n\t\tmethod\n\t}\n\tif (jsonPayload) reqConfig.body = JSON.stringify(jsonPayload);\n\t\n\tconst url = `${config.baseUrl||defaultBaseUrl}/repos/${config.owner}/${config.project}/${path}`\n\treturn fetch(url, reqConfig).then( response => {\n\t\tif (response.ok) {\n\t\t\treturn response.json();\n\t\t} else if (response.status === 404) {\n\t\t\tthrow new Error(\"Repository not found\");\n\t\t} else if (response.stats === 500) {\n\t\t\tthrow new Error(response.message || \"Github API returned a 500 error\");\n\t\t} else {\n\t\t\treturn response.json().then( (json) => {\n\t\t\t\tthrow new Error(json.message);\n\t\t\t});\n\t\t}\n\t})\n}\n\nfunction getLastCommit(config, branchName=\"master\") {\n\treturn callApi(config, `git/refs/heads/${branchName}`)\n\t\t//special handling for uninitialized repository (repo without any files)\n\t\t.catch( e => {\n\t\t\tif (e.message === \"Git Repository is empty.\")\n\t\t\t\te.message = \"Git repository is empty. Please initialize the repository and try again.\"\n\t\t\tthrow e;\n\t\t});\n}\n\nfunction getTree(config, commit) {\n\treturn callApi(config, `git/trees/${commit.object.sha}`)\n\t\t.then( tree => {\n\t\t\tif (tree.truncated)\n\t\t\t\tthrow new Error(\"Unable to load entire head tree - too many files\");\n\t\t\treturn tree;\n\t\t})\n\t\t//handle 404 for when tree has been deleted and repo is empty\n\t\t.catch( e => {\n\t\t\tif (e.message === \"Repository not found\") {\n\t\t\t\treturn {tree: []}\n\t\t\t}\n\t\t})\n}\n\nfunction createBlob(config, blob) {\n\treturn callApi(config, \"git/blobs\", \"POST\", blob)\n}\n\nfunction createTree(config, tree) {\n\treturn callApi(config, \"git/trees\", \"POST\", tree);\n}\n\nfunction commitTree(config, tree, message, lastCommit, branchName=\"master\") {\n\t\treturn callApi(config, \"git/commits\", \"POST\", {\n\t\t\tmessage,\n\t\t\ttree: tree.sha,\n\t\t\tparents: [lastCommit.object.sha]\n\t\t}).then( commit => {\n\t\t\treturn callApi(config, `git/refs/heads/${branchName}`,\"PATCH\", {\n\t\t\t\tsha: commit.sha\n\t\t\t})\n\t\t})\n\t}\n\nfunction commitTreeToPullRequest(config, tree, message, lastCommit, title, newBranchName,  baseBranch=\"master\", bodyText) {\n\treturn callApi(config, \"git/commits\", \"POST\", {\n\t\tmessage,\n\t\ttree: tree.sha,\n\t\tparents: [lastCommit.object.sha]\n\t}).then( commit => {\n\t\treturn callApi(config, \"git/refs\", \"POST\", {\n\t\t\tref: `refs/heads/${newBranchName}`,\n\t\t\tsha: commit.sha\n\t\t});\n\t}).then( () => {\n\t\treturn callApi(config, \"pulls\", \"POST\", {\n\t\t\ttitle: title,\n\t\t\tbody: bodyText,\n\t\t\thead: newBranchName,\n\t\t\tbase: baseBranch,\n\t\t\tmaintainer_can_modify: true\n\t\t})\n\t})\n}\n\nexport default {\n\tgetLastCommit, getTree, createBlob, \n\tcreateTree, commitTree, commitTreeToPullRequest\n}","import gh from \"./github-api\";\nimport sanitizeFilename from \"sanitize-filename\";\nimport _ from \"lodash\";\n\nexport default class GithubExporter {\n\n\tcancel() {\n\t\tthis.canceled = true;\n\t}\n\n\tblobToBase64(blob) {\n\t\treturn new Promise( (resolve, reject) => {\n\t\t\tlet reader = new FileReader();\n\t\t\treader.onload = () => {\n\t\t\t\tconst dataUrl = reader.result;\n\t\t\t\tconst base64 = dataUrl.split(',')[1];\n\t\t\t\tresolve(base64);\n\t\t\t};\n\t\t\treader.onerror = reject;\n\t\t\treader.readAsDataURL(blob);\n\t\t});\n\t}\n\t\n\tbuildProviderTree(provider, folder) {\t\n\t\tconst createBlob = (content, fileName, encoding=\"utf-8\") => {\n\t\t\tif (this.canceled) throw new Error(\"Canceled\");\n\n\t\t\tif (this.statusCb)\n\t\t\t\tthis.statusCb(\"Adding \" + folder + \"/\" + fileName);\n\n\t\t\treturn gh.createBlob(this.config, {content, encoding})\n\t\t\t\t.then( blob => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsha: blob.sha,\n\t\t\t\t\t\tpath: folder + \"/\" + fileName,\n\t\t\t\t\t\tmode: \"100644\", //file\n\t\t\t\t\t\ttype: \"blob\"\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t};\n\n\t\tconst buildResourceTree = (bundles) => {\n\t\t\treturn Promise.all(\n\t\t\t\t_.map( bundles, (bundle, resourceType) => {\n\t\t\t\t\treturn createBlob(\n\t\t\t\t\t\tJSON.stringify(bundle, null, 2),\n\t\t\t\t\t\tresourceType+\".json\"\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\n\t\tconst buildFileTree = (files) => {\n\t\t\treturn Promise.all(\n\t\t\t\t_.map( files, file => {\n\t\t\t\t\treturn this.blobToBase64(file.blob)\n\t\t\t\t\t\t.then( base64 => {\n\t\t\t\t\t\t\treturn createBlob(base64, file.fileName, \"base64\") \n\t\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\n\t\tconst buildErrorLogTree = (errorLog) => {\n\t\t\treturn !errorLog.length \n\t\t\t\t? Promise.resolve([])\n\t\t\t\t: createBlob(\n\t\t\t\t\t\tJSON.stringify(errorLog, null, 2),\n\t\t\t\t\t\t\"error_log.json\"\n\t\t\t\t\t).then( blob => [blob] );\n\t\t}\n\n\t\tconst bundles = _.chain(provider.data.entry)\n\t\t\t.groupBy(e => e.resource.resourceType)\n\t\t\t.mapValues(entry => {\n\t\t\t\treturn {\n\t\t\t\t\tentry: _.map(entry, e => ({fullUrl: e.fullUrl, resource: e.resource}) ),\n\t\t\t\t\ttotal: entry.length, \n\t\t\t\t\ttype:\"collection\"\n\t\t\t\t}\n\t\t\t}).value();\n\n\t\treturn Promise.all([\n\t\t\tbuildResourceTree(bundles),\n\t\t\tbuildFileTree(provider.data.files),\n\t\t\tbuildErrorLogTree(provider.data.errorLog)\n\t\t]).then( trees => _.flatten(trees) );\n\n\t}\n\t\n\tbuildTree(baseTree, allProviders) {\n\t\tconst providers = _.filter( allProviders, p => {\n\t\t\treturn p.selected && p.data && p.data.entry && (p.data.entry.length || p.data.errorLog.length)\n\t\t})\n\t\tconst folders = _.map(providers, p => {\n\t\t\treturn sanitizeFilename(p.name);\n\t\t})\n\t\tconst tree = _.filter(baseTree.tree, item => {\n\t\t\tconst clear = folders.find( f => item.type === \"tree\" && item.path === f);\n\t\t\treturn clear ? false : true;\n\t\t});\n\t\treturn Promise.all( \n\t\t\t_.map( providers, (provider, i) => {\n\t\t\t\treturn this.buildProviderTree(provider, folders[i]);\n\t\t\t})\n\t\t).then( newTrees => {\n\t\t\treturn { \n\t\t\t\t...baseTree, \n\t\t\t\ttree: tree.concat(_.flatten(newTrees))\n\t\t\t}\n\t\t})\n\t}\n\n\tprepareCommit(providers) {\n\t\tlet lastCommit;\n\t\tif (this.statusCb)\n\t\t\tthis.statusCb(\"Retrieving repository information\");\n\n\t\treturn gh.getLastCommit(this.config)\n\t\t\t.then( commit => {\n\t\t\t\tlastCommit = commit;\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn gh.getTree(this.config, commit);\n\t\t\t})\n\t\t\t.then( commit => {\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn this.buildTree(commit, providers) \n\t\t\t})\n\t\t\t.then( tree => {\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\t\t\t\treturn gh.createTree(this.config, tree) \n\t\t\t})\n\t\t\t.then( tree => ({ tree, lastCommit }) );\n\t}\n\n\texport(providers, githubConfig, statusCb, branchName) {\n\t\tthis.config = githubConfig;\n\t\tthis.canceled = false;\n\t\tthis.statusCb = statusCb;\n\t\treturn githubConfig.pullRequest \n\t\t\t? this.commitPullRequest(providers, branchName)\n\t\t\t: this.commitToMaster(providers);\n\t}\n\n\tcommitToMaster(providers) {\n\t\treturn this.prepareCommit(providers)\n\t\t\t.then( ({tree, lastCommit}) => {\n\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\n\t\t\t\tif (this.statusCb)\n\t\t\t\t\tthis.statusCb(\"Committing files\");\n\n\t\t\t\treturn gh.commitTree(\n\t\t\t\t\tthis.config,\n\t\t\t\t\ttree,\n\t\t\t\t\t\"ProcureBot Commit\",\n\t\t\t\t\tlastCommit\n\t\t\t\t).then( () => {\n\t\t\t\t\tif (this.statusCb)\n\t\t\t\t\t\tthis.statusCb(\"Data has been committed to master branch\");\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tcommitPullRequest(providers, branchName) {\n\t\tif (!branchName) \n\t\t\tbranchName = \"Procure/\" + \n\t\t\t\t(new Date().toISOString()).replace(/:/g, \"-\");\n\n\t\treturn this.prepareCommit(providers)\n\t\t\t.then( ({tree, lastCommit}) => {\n\n\t\t\t\tif (this.canceled) throw new Error(\"canceled\");\n\n\t\t\t\tif (this.statusCb)\n\t\t\t\t\tthis.statusCb(\"Creating pull request\");\n\n\t\t\t\treturn gh.commitTreeToPullRequest(\n\t\t\t\t\tthis.config,\n\t\t\t\t\ttree,\n\t\t\t\t\t\"ProcureBot commit\",\n\t\t\t\t\tlastCommit,\n\t\t\t\t\t\"ProcureBot pull request\",\n\t\t\t\t\tbranchName\n\t\t\t\t).then( pull => {\n\t\t\t\t\tif (this.statusCb)\n\t\t\t\t\t\tthis.statusCb(\"A new pull request has been created\", pull.html_url);\n\t\t\t\t})\n\t\t\t});\t\t\n\t}\n\n}","import _ from \"lodash\";\nimport XlsxPopulate from \"xlsx-populate\";\nimport saveAs from \"file-saver\";\nimport sanitizeFilename from \"sanitize-filename\";\nimport mergeObjects from \"./merge-objects.js\";\nimport csvWriter from \"./csv-writer\";\n\nconst defaultHelperFns = {\n\tvalidateExists: v => {\n\t\treturn v !== undefined\n\t},\n\tvalidateCode: (v, template) => {\n\t\tif (!v) return false;\n\t\tif (!Array.isArray(v)) v = [v];\n\t\treturn v.find( c => c.code === template.target ) ? true : false;\n\t},\n\tvalidateValue: (v, template) => {\n\t\treturn v === template.target;\n\t},\n\tgetHelperData: (v, template, helperData) => {\n\t\treturn helperData[template.helperDataField];\n\t},\n\tstringifyCodings: v => {\n\t\tif (!v) return v;\n\t\tif (!Array.isArray(v)) v = [v];\n\t\treturn v\n\t\t\t.map( c => c.system + \"|\" + c.code )\n\t\t\t.join(\" \");\n\t},\n\tparseDateForExcel:  (v, template, helperData) => {\n\t\treturn (v && helperData.format !== \"csv\")\n\t\t\t? new Date(v) \n\t\t\t: v;\n\t}\n}\n\nfunction flatten(element, template, helperData={}, helperFns) {\n\thelperFns = helperFns || defaultHelperFns;\n\tlet rows = [];\n\t_.each(template, field => {\n\n\t\tconst mergeRows = (rowsToMerge) => {\n\t\t\tif (rows.length === 0) rows = [{}];\n\t\t\tlet newRows = [];\n\t\t\t_.each(rowsToMerge, mergeRow => {\n\t\t\t\tif (!_.isArray(mergeRow)) mergeRow = [mergeRow];\n\t\t\t\t_.each(mergeRow, mergeRowItem => {\n\t\t\t\t\t_.each(rows, row => {\n\t\t\t\t\t\tnewRows.push({ ...row, ...mergeRowItem});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\trows = newRows;\n\t\t}\n\n\t\tif (!_.isArray(field.path))\n\t\t\tfield.path = [field.path];\n\n\t\tlet data = _.chain(element)\n\t\t\t.at(element, field.path)\n\t\t\t.filter( v => v !== undefined )\n\t\t\t.first().value();\n\n\t\t//allow a fallback path. Note: this will always be evaluated last regardless of array position\n\t\tif (!data && field.path.indexOf(\"*\") > -1) \n\t\t\tdata = element;\n\n\t\tif (field.transform)\n\t\t\tdata = helperFns[field.transform](data, field, helperData);\n\n\t\tconst valid = \n\t\t\tfield.test === undefined || helperFns[field.test](data, field, helperData);\n\n\t\t// console.log(valid, field, data)\n\n\t\tif (!valid) {\n\t\t\trows = null;\n\t\t\treturn false;\n\t\t} else if (field.children) {\n\t\t\tif (!_.isArray(data)) data = [data];\n\t\t\tconst childRows = _.map( data, childElement => {\n\t\t\t\treturn flatten(childElement, field.children, helperData, helperFns);\n\t\t\t});\n\t\t\t//check if all children were valid and bail if they weren't\n\t\t\tif (childRows.indexOf(null) > -1) {\n\t\t\t\trows = null;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tmergeRows(childRows);\n\t\t\t}\n\t\t} else if (field.name) {\n\t\t\tif (!_.isArray(data)) data = [data];\n\t\t\tconst rowsToMerge = data.map( item => ({[field.name]: item}) );\n\t\t\tmergeRows(rowsToMerge);\n\t\t}\n\t})\n\treturn rows;\n}\n\nfunction flattenProviders(providers, template, helperData={}, helperFns) {\n\treturn _.chain(providers)\n\t\t.filter( p => p.selected && p.data && p.data.entry && p.data.entry.length > 0)\n\t\t.map( p => {\n\t\t\treturn _.chain(p.data.entry).map( e => {\n\t\t\t\tconst providerHelperData = {...helperData, source: p.name};\n\t\t\t\treturn flatten(e.resource, template, providerHelperData, helperFns);\n\t\t\t}).flatten().value()\n\t\t})\n\t\t.flatten()\n\t\t.filter( f => f !== null )\n\t\t.value();\n}\n\nfunction getTemplateColumns(template) {\n\tlet cols = [];\n\tconst arrayToCols = templateArray => {\n\t\t_.each(templateArray, field => {\n\t\t\tif (field.name) cols.push(field.name);\n\t\t\tif (field.children) arrayToCols(field.children);\n\t\t});\n\t}\n\tarrayToCols(template || template.template);\n\treturn cols;\n}\n\n// JS Excel libraries with browser compatibility (others are node.js only)\n// https://github.com/SheetJS/js-xlsx (Apache2, very robust, support for .xls, formatting requires commercial license)\n// https://github.com/dtjohnson/xlsx-populate (MIT, good option)\n// https://github.com/exceljs/exceljs (MIT, good option, slightly more dependencies)\n// https://github.com/egeriis/zipcelx (MIT, very light weight, currently no date support)\n// https://en.wikipedia.org/wiki/Microsoft_Office_XML_formats#Excel_XML_Spreadsheet_example (Excel 2003, seems to not require zip)\n\nfunction exportFlatDataCSV(flatData, template, name) {\n\tconst columns = getTemplateColumns(template);\n\tconst data = flatData.map( row => {\n\t\treturn columns.map( col =>  row[col] );\n\t});\n\tconst blob = csvWriter([columns].concat(data));\n\treturn new Promise( (resolve) => {\n\t\tsaveAs(blob, sanitizeFilename(name) + \".csv\")\n\t\tresolve();\n\t})\n}\n\nfunction exportFlatDataExcel(flatData, template, name) {\n\tconst columns = getTemplateColumns(template);\n\tlet dateCols = [];\n\tconst data = flatData.map( row => {\n\t\treturn columns.map( (col, i) => {\n\t\t\tif (row[col] instanceof Date && dateCols.indexOf(i+1) === -1)\n\t\t\t\tdateCols.push(i+1);\n\t\t\treturn row[col] \n\t\t});\n\t});\n\n\treturn XlsxPopulate.fromBlankAsync()\n    \t.then( workbook => {\n\t\t\tworkbook.sheet(0).name(name)\n\t\t\t\t.cell(\"A1\").value(\n\t\t\t\t\t[columns].concat(data)\n\t\t\t\t)\n\t\t\tdateCols.forEach( dateCol => {\n\t\t\t\tworkbook.sheet(0).column(dateCol)\n\t\t\t\t\t.style(\"numberFormat\", \"dddd, mmmm dd, yyyy\");\n\t\t\t});\n\t\t\treturn workbook.outputAsync()\n\t\t})\n\t\t.then( blob => {\n\t\t\tsaveAs(blob, sanitizeFilename(name) + \".xlsx\");\n\t\t});\n}\n\nfunction exportSpreadsheet(providers, spreadsheetTemplates, templateId, format) {\n\tconst templateDefinition = spreadsheetTemplates[templateId];\n\n\tconst templateDefinitions = _.map( (templateDefinition.extends||[]),\n\t\tid => spreadsheetTemplates[id]\n\t).concat([templateDefinition]);\n\n\tconst mergedTemplateDefinition = mergeObjects.merge(templateDefinitions);\t\n\tlet flatData = flattenProviders(providers, mergedTemplateDefinition.template, { format });\n\n\tif (mergedTemplateDefinition.sortBy) {\n\t\tconst sortBy = _.map(mergedTemplateDefinition.sortBy, s => s.name);\n\t\tconst sortDir = _.map(mergedTemplateDefinition.sortBy, s => s.dir || \"desc\");\n\t\tflatData = _.orderBy(flatData, sortBy, sortDir);\n\t}\n\tif (format === \"xlsx\") {\n\t\treturn exportFlatDataExcel(flatData, mergedTemplateDefinition.template, mergedTemplateDefinition.name)\n\t} else {\n\t\treturn exportFlatDataCSV(flatData, mergedTemplateDefinition.template, mergedTemplateDefinition.name)\n\t}\n}\n\n\nexport default { \n\tflatten, flattenProviders, \n\tdefaultHelperFns, exportSpreadsheet\n}","export default (rows) => {\n\tconst processRow = (row) => {\n\t\treturn row.map( rawValue => {\n\t\t\tlet value = rawValue === null ? \"\" : rawValue.toString();\n\t\t\tif (rawValue instanceof Date)\n\t\t\t\tvalue = rawValue.toLocaleString();\n\t\t\tvalue = value.replace(/\"/g, '\"\"');\n\t\t\tif (value.search(/(\"|,|\\n)/g) >= 0)\n\t\t\t\tvalue = '\"' + value + '\"';\n\t\t\treturn value;\n\t\t}).join(\",\");\n\t};\n\n\tconst csv = rows.map(processRow).join(\"\\n\");\n\treturn new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n}","import _ from \"lodash\";\nimport saveAs from \"file-saver\";\nimport tv4 from \"tv4\";\nimport userSettingsSchema from \"../schemas/user-settings-schema.json\";\n\nfunction buildJSON(providers, githubConfig, redirectUri) {\n\tconst json = {\n\t\tproviders: _.map(providers, p => ({\n\t\t\t...p, lastUpdated: null, data: null\n\t\t}) ),\n\t\tgithubConfig, redirectUri\n\t};\n\treturn JSON.stringify(json, null, 2);\n\n}\n\nfunction download(providers, githubConfig, redirectUri, fileName=\"procure-settings.json\") {\n\tconst json = buildJSON(providers, githubConfig, redirectUri);\n\tconst blob = new Blob(\n\t\t[json], \n\t\t{type: \"application/json;charset=utf-8\"}\n\t);\n    saveAs(blob, fileName);\n}\n\nfunction readFromFile(file, redirectUri, queryProfiles) {\n\tconst reader = new FileReader();\n\treturn new Promise( (resolve, reject) => {\t\n\t\treader.onload = e => resolve(reader.result);\n\t\treader.onerror = e => reject(e);\n\t\treader.readAsText(file);\n\t})\n\t.then( data => {\n\t\ttry {\n\t\t\treturn JSON.parse(data);\n\t\t} catch (e) {\n\t\t\tthrow new Error(\"Unable to read file\")\n\t\t}\n\t})\n\t.then( json => {\n\t\tif (json.redirectUri !== redirectUri)\n\t\t\tthrow new Error(\"Only settings saved from this website can be imported\")\n\t\treturn json;\n\n\t})\n\t.then( json => {\n\t\ttv4.validate(json, userSettingsSchema);\n\t\tif (tv4.error) {\n\t\t\tif (console) console.log(tv4.error);\n\t\t\tthrow new Error(\"Invalid file format: \" + tv4.error.message);\n\t\t}\n\t\treturn json;\n\n\t})\n\t.then( json => {\n\t\t_.each( json.providers, provider => {\n\t\t\tif (!queryProfiles[provider.queryProfile]) \n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Query profile not found: \" + provider.queryProfile\n\t\t\t\t);\n\t\t});\n\t\treturn json;\n\t})\n}\n\nexport default { \n\tbuildJSON, download, readFromFile \n}","import createStore from \"storeon\";\nimport FhirLoader from \"./fhir-loader\";\nimport ConfigLoader from \"./config-loader\";\nimport ZipExporter from \"./zip-exporter\";\nimport GithubExporter from \"./github-exporter\";\nimport SpreadsheetExporter from \"./spreadsheet-exporter\";\nimport UserSettings from \"./user-settings\";\nimport FileExporter from \"./file-exporter\";\nimport zipExporter from \"./zip-exporter\";\n\n//have to use require here since imports need to be at the top level\nlet initialState;\nif (process.env.NODE_ENV !== \"development\") {\n\tinitialState = require(\"./initial-state\");\n} else {\n\tinitialState =  require(\"./initial-state-dev\");\n}\n\nconst fhirLoader = new FhirLoader();\nconst ghExporter = new GithubExporter();\nconst fileExporter = new FileExporter();\nlet simulateTimer;\n\nconst createUniqueId = () => Math.random().toString(36);\nconst actions = store => {\n\tstore.on(\"@init\", () => initialState);\n\tstore.on(\"uiState/set\", (state, uiState) => { \n\t\treturn { uiState }\n\t});\n\tstore.on(\"uiState/merge\", ({ uiState }, newUiState) => {\n\t\treturn {uiState: {...uiState, ...newUiState}}\n\t})\n\tstore.on(\"uiState/incrementCounts\", ({ uiState }, counts) => {\n\t\tObject.keys(counts).forEach( countType => {\n\t\t\tcounts[countType] = counts[countType] + (uiState[countType] || 0)\n\t\t});\t\n\t\treturn {uiState: {...uiState, ...counts}}\n\t})\n\tstore.on(\"wizard/hide\", () => {\n\t\treturn {showWizard: false, uiState: {mode: \"ready\"}}\n\t})\n\tstore.on(\"nonModalUi/merge\", ({ nonModalUi }, newState) => {\n\t\treturn {nonModalUi: {...(nonModalUi ||{}), ...newState}}\n\t});\n\tstore.on(\"refreshDirty\", ({ providers, githubConfig, redirectUri, dirtySnapshot }, reset) => {\n\t\tconst newSnapshot = UserSettings.buildJSON(providers, githubConfig, redirectUri);\n\t\tif (reset) {\n\t\t\treturn {isDirty: false, dirtySnapshot: newSnapshot};\n\t\t} else {\n\t\t\treturn {isDirty: dirtySnapshot === newSnapshot ? false : true};\n\t\t}\n\t})\n\tstore.on(\"providers/add\", ({ providers }, provider) => {\n\t\tif (!provider.id) provider.id = createUniqueId();\n\t\tprovider.selected = true;\n\t\tconsole.log(provider)\n\t\treturn {providers: providers.concat([provider])}\n\t});\n\tstore.on(\"providers/update\", ({ providers }, provider) => {\n\t\treturn {\n\t\t\tproviders: providers.map( p => {\n\t\t\t\treturn (p.id !== provider.id) \n\t\t\t\t\t? p \n\t\t\t\t\t: {...p, ...provider}\n\t\t\t})\n\t\t}\n\t});\n\tstore.on(\"providers/upsert\", (state, provider) => {\n\t\tif (!provider.id) {\n\t\t\tprovider.id = createUniqueId();\n\t\t\tstore.dispatch(\"providers/add\", provider);\n\t\t} else {\n\t\t\tstore.dispatch(\"providers/update\", provider);\n\t\t}\n\t});\n\tstore.on(\"providers/upsertAndLoad\", (state, provider) => {\n\t\tstore.dispatch(\"providers/upsert\", provider);\n\t\tstore.dispatch(\"fhir/loadData\", provider.id);\n\t});\n\tstore.on(\"providers/remove\", ({ providers }, id) => {\n\t\treturn {\n\t\t\tproviders: providers.filter( p => {\n\t\t\t\treturn p.id !== id\n\t\t\t})\n\t\t}\n\t});\n\tstore.on(\"config/load\", (state, endState=\"ready\") => {\n\t\tstore.dispatch(\"uiState/set\", {mode: \"loading\"});\n\t\tconst isDev = process.env.NODE_ENV === \"development\";\n\t\tconst overridePath = isDev\n\t\t\t? \"./config/config-override-dev.json\" \n\t\t\t: \"./config/config-override.json\";\n\n\t\tConfigLoader\n\t\t\t.loadConfigFile(\"./config/config.json\", overridePath, isDev)\n\t\t\t.then( config => {\n\t\t\t\tstore.dispatch(\"config/merge\", config);\n\n\t\t\t\tstore.dispatch(\"uiState/set\", {mode: endState});\n\n\t\t\t\t//initialize content for refresh\n\t\t\t\tstore.dispatch(\"refreshDirty\", true);\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"globalError\", \n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t})\n\t});\n\tstore.on(\"config/merge\", (state, newConfig) => {\n\t\treturn {...state, ...newConfig}\n\t});\n\tstore.on(\"fhir/loadData\", ({ providers, queryProfiles, mimeTypeMappings, ignoreState }, providerId) => {\n\t\tconst provider = providers.find(p => p.id === providerId);\n\t\tconst queryProfile = queryProfiles[provider.queryProfile];\n\t\tconst retryLimit = queryProfiles[provider.queryProfile].retryLimit || 0;\n\t\t\n\t\tconst handleLoadDone = (data) => {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"loaded\",\n\t\t\t\tdata: data,\n\t\t\t\tid: provider.id\n\t\t\t});\n\t\t}\n\n\t\tconst handleStatusUpdate = (url, isError) => {\n\t\t\tif (console) console.log(\"Fetching: \", url);\n\t\t\tstore.dispatch(\"uiState/incrementCounts\", {\n\t\t\t\trequestCount: 1,\n\t\t\t\terrorCount: isError ? 1 : 0,\n\t\t\t})\n\t\t}\n\t\t\n\t\tconst loadFhir = (context) => {\n\t\t\tstore.dispatch(\"uiState/merge\", {submode: \"loading\"});\n\t\t\tfhirLoader.getFHIR(provider, queryProfile, context, true, mimeTypeMappings, retryLimit, handleStatusUpdate)\n\t\t\t\t.then(handleLoadDone)\n\t\t\t\t.catch(handleGlobalError);\n\t\t}\n\n\t\tconst handleGlobalError = (e) => {\n\t\t\t//don't show error if user clicked the cancel button\n\t\t\tif (e.message === \"cancelled\" || e.name === \"AbortError\")\n\t\t\t\treturn;\n\t\t\t\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"loadData\",\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: e.message || e,\n\t\t\t\t\tid: provider.id\n\t\t\t\t});\n\t\t}\n\n\t\tif (!provider.isOpen) {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"authorizing\",\n\t\t\t\tid: provider.id\n\t\t\t});\n\t\t\tfhirLoader.authAndGetFHIR(provider, ignoreState)\n\t\t\t\t.then(loadFhir)\n\t\t\t\t.catch(handleGlobalError);\n\t\t} else {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"loadData\",\n\t\t\t\tsubmode: \"loading\",\n\t\t\t\tid: provider.id\t\n\t\t\t});\t\t\n\t\t\tloadFhir()\n\t\t}\n\t});\n\tstore.on(\"fhir/cancelLoad\", (state, endState=\"ready\") =>  {\n\t\tfhirLoader.cancel();\n\t\tstore.dispatch(\"uiState/set\", {mode: endState});\n\t});\n\n\tstore.on(\"export/download\", ({ providers }) => {\n\t\tstore.dispatch(\"nonModalUi/merge\", {isDownloading: true})\n\t\tZipExporter.generateFile(providers)\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"ready\", \n\t\t\t\t\terror: e.message\n\t\t\t\t});\n\t\t\t})\n\t\t\t.finally( () => {\n\t\t\t\tstore.dispatch(\"nonModalUi/merge\", {isDownloading: false})\n\t\t\t});\n\t});\n\tstore.on(\"export/spreadsheet\", ({ providers, spreadsheetTemplates}, params) => {\n\t\tstore.dispatch(\"nonModalUi/merge\", {isExportingSheet: true})\n\t\tSpreadsheetExporter.exportSpreadsheet(\n\t\t\tproviders, spreadsheetTemplates, params.templateId, params.format\n\t\t)\n\t\t.catch( e => {\n\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\tmode: \"globalError\", \n\t\t\t\terror: e\n\t\t\t});\n\t\t})\n\t\t.finally( () => {\n\t\t\tstore.dispatch(\"nonModalUi/merge\", {isExportingSheet: false})\n\t\t});\n\t});\n\n\tstore.on(\"export/github\", ( {githubConfig, providers} ) => {\n\t\t\n\t\tconst statusCallback = (status, statusUrl) => {\n\t\t\tstore.dispatch(\"uiState/merge\", { status, statusUrl });\n\t\t}\n\n\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\tsubmode: \"push\",\n\t\t\terror: null\n\t\t});\n\n\t\tghExporter.export(\n\t\t\tproviders, githubConfig, statusCallback\n\t\t)\n\t\t\t.then( () => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: null\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"githubExport\",\n\t\t\t\t\terror: e.message === \"canceled\" ? null : e.message\n\t\t\t\t});\n\t\t\t});\n\n\t})\n\n\tstore.on(\"export/github/cancel\", () => {\n\t\tghExporter.cancel();\n\t\tstore.dispatch(\"uiState/set\", { \n\t\t\tmode: \"githubExport\"\n\t\t});\n\t});\n\n\tstore.on(\"export/upload\", ({upload})  => {\n\t\tstore.dispatch(\"uiState/set\", { \n\t\t\tmode: \"fileUpload\",\n\t\t\tsubmode: \"getManifest\",\n\t\t\tstatus: \"Preparing to send data\"\n\t\t});\n\n\t\t//check whitelist if url doesn't come from config file\n\t\tif (upload.qsManifestUrl) {\n\t\t\tconst isValidUrl = fileExporter.isValidUrl(upload.manifestUrl, upload.whitelist);\n\t\t\tif (!isValidUrl) return store.dispatch(\"uiState/merge\", {\n\t\t\t\tsubmode: \"error\",\n\t\t\t\tstatus: \"Url manifest location not in whitelist: \" + upload.manifestUrl\n\t\t\t});\n\t\t}\n\n\t\t//if upload url is in config and no overriding manifest url, don't fetch manifest\n\t\tif (upload.uploadUrl && !upload.manifestUrl) {\n\t\t\treturn store.dispatch(\"uiState/merge\", {\n\t\t\t\tsubmode: \"preUpload\"\n\t\t\t});\n\t\t}\n\n\t\t//fetch manifest to get upload info\n\t\tfileExporter.getManifest(upload.manifestUrl)\n\t\t\t.then( data => {\n\t\t\t\tstore.dispatch(\"config/merge\", {\n\t\t\t\t\tupload: {\n\t\t\t\t\t\tmanifestUrl: upload.manifestUrl,\n\t\t\t\t\t\tlabel: upload.label,\n\t\t\t\t\t\t...data\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"preUpload\"\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: \"Unable to load manifest at \" + upload.manifestUrl\n\t\t\t\t});\n\t\t\t});\n\t});\n\t\n\tstore.on(\"export/upload/cancel\", ({upload}) => {\n\t\tif (upload.simulate)\n\t\t\treturn window.clearTimeout(simulateTimer);\n\t\tfileExporter.cancel();\n\t});\n\n\tstore.on(\"export/upload/send\", ({upload, providers}) => {\n\t\tstore.dispatch(\"uiState/set\", {\n\t\t\tmode: \"fileUpload\", \n\t\t\tsubmode: \"uploading\",\n\t\t\tstatus: \"Uploading Data\"\n\t\t});\n\n\t\tif (upload.simulate) {\n\t\t\treturn simulateTimer = window.setTimeout(() => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"postUpload\"\n\t\t\t\t});\n\t\t\t}, 2000);\n\t\t}\n\n\t\tzipExporter.exportProvidersAsBlob(providers)\n\t\t\t.then( file => {\n\t\t\t\treturn fileExporter.putFile(upload.uploadUrl, file)\n\t\t\t})\n\t\t\t.then( () => {\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"postUpload\"\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tif (err.name === \"AbortError\") return;\n\t\t\t\tstore.dispatch(\"uiState/merge\", {\n\t\t\t\t\tsubmode: \"error\",\n\t\t\t\t\tstatus: err.message.toString()\n\t\t\t\t});\n\t\t\t})\n\n\t});\n\n\tstore.on(\"export/settings\", ({providers, githubConfig, redirectUri}) => {\n\t\tUserSettings.download(providers, githubConfig, redirectUri);\n\t});\n\n\tstore.on(\"import/settings\", ({redirectUri, queryProfiles, noCustomEndpoints}, file) => {\n\t\tUserSettings.readFromFile(file, redirectUri, queryProfiles)\n\t\t\t.then( config => {\n\t\t\t\tif (noCustomEndpoints) config.providers = [];\n\t\t\t\t//unloading data controls prior to modifying config to avoid\n\t\t\t\t//timing error from control update and unmount at same time\n\t\t\t\tstore.dispatch(\"uiState/set\", {mode: \"loading\"});\n\t\t\t\tstore.dispatch(\"config/merge\", config);\n\t\t\t\tstore.dispatch(\"uiState/set\", { mode: \"ready\" });\n\t\t\t})\n\t\t\t.catch( e => {\n\t\t\t\tstore.dispatch(\"uiState/set\", {\n\t\t\t\t\tmode: \"ready\", \n\t\t\t\t\terror: e.message\n\t\t\t\t})\n\t\t\t})\n\t});\n\n}\n\nconst store = createStore([actions]);\n\nexport default store;","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Modal, ModalHeader, ModalBody, ModalFooter, Form, FormGroup, Label, Input, FormText, FormFeedback} from 'reactstrap';\nimport Select, { createFilter } from \"react-select\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\t//app state\n\tconst {\n\t\tuiState, providers, queryProfiles, credentials,\n\t\torganizations, orgDefaults, redirectUri, noCustomEndpoints, dispatch\n\t } = useStoreon(\n\t\t\"uiState\", \"providers\", \"queryProfiles\", \"credentials\",\n\t\t\"organizations\", \"orgDefaults\", \"redirectUri\", \"noCustomEndpoints\"\n\t );\n\n\t//component state\n\tconst [provider, setProvider] = useState({});\n\tconst [validation, setValidation] = useState({});\n\tconst [showDetails, setShowDetails] = useState(false);\n\t\n\tconst orgOptions = (\n\t\tnoCustomEndpoints ? [] : [{label: \"Custom Endpoint\", value: \"custom\"}] \n\t).concat(\n\t\t_.chain(organizations)\n\t\t\t.map( o => ({label: o.name, value: o.orgId || o.fhirEndpoint}) )\n\t\t\t.sortBy( o => o.label )\n\t\t\t.value()\n\t);\n\n\t// const orgRef = useRef(null)\n\t// useEffect(() => orgRef.current.focus(), []);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode === 27) handleCancel(e);\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel]);\n\n\tuseEffect( () => {\n\t\tif (!provider.id && uiState.id && uiState.mode === \"editProvider\") {\n\t\t\tconst currentProvider = providers.find(p => p.id === uiState.id);\n\t\t\tsetProvider(currentProvider)\n\t\t\tsetValidation({});\n\t\t\tsetShowDetails(currentProvider && currentProvider.orgId === \"custom\");\n\t\t}\n\t}, [uiState.id, uiState.mode, provider.id, providers])\n\n\tconst handleSubmit = (e, skipRefresh) => {\n\t\te.preventDefault();\n\n\t\tconst errors = validate(provider);\n\t\tif (errors) return setValidation(errors);\n\n\t\tif (skipRefresh) {\n\t\t\tdispatch(\"providers/upsert\", provider);\n\t\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t\t} else {\n\t\t\tdispatch(\"providers/upsertAndLoad\", provider);\n\t\t}\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleOrgSelection = (selection) => {\n\t\tlet orgConfig;\n\t\t//get default details\n\t\tif (selection.value !== \"custom\") {\n\t\t\torgConfig = organizations.find( o => selection.value === o.orgId || selection.value === o.fhirEndpoint );\n\t\t\tconst defaults = orgDefaults[orgConfig.defaultId] || {};\n\t\t\tif (orgConfig.defaultId !== undefined) orgConfig = {...defaults, ...orgConfig};\n\t\t} else {\n\t\t\torgConfig = {\n\t\t\t\tname: selection.label,\n\t\t\t\tscope: [\"patient/*.read\", \"launch/patient\"],\n\t\t\t}\n\t\t}\n\t\t//get credential details if included by reference\n\t\tif (orgConfig.credentialId)\n\t\t\torgConfig = {...credentials[orgConfig.credentialId], ...orgConfig};\n\n\t\t//update provider with new defaults\n\t\tconst updatedProvider = {\n\t\t\t...orgConfig,\n\t\t\tredirectUri,\n\t\t\tid: provider.id,\n\t\t\torgId: selection.value\n\t\t}\n\t\t//show form if there's any missing data\n\t\tsetShowDetails(validate(updatedProvider));\n\t\tsetProvider(updatedProvider);\n\t}\n\n\tconst validate = (provider) => {\n\t\tlet validation = {};\n\t\tconst isInvalidUrl = (url) => !/^https?:\\/\\//.test(url.toLowerCase());\n\n\t\tif (provider.isOpen) {\n\t\t\t[\"name\", \"patient\"].forEach( f => { if (!provider[f]) validation[f] = \"Required\" })\n\t\t} else {\n\t\t\t[\"name\", \"clientId\", \"scope\"].forEach( f => { if (!provider[f]) validation[f] = \"Required\" })\n\t\t}\n\n\t\tif (isInvalidUrl(provider.fhirEndpoint || \"\"))\n\t\t\tvalidation.fhirEndpoint = \"Valid URL Required\";\n\t\t\n\t\tif (!provider.isOpen && isInvalidUrl(provider.redirectUri || \"\"))\n\t\t\tvalidation.redirectUri = \"Valid URL Required\";\n\n\t\treturn Object.keys(validation).length > 0 ? validation : null;\n\t}\n\n\tconst renderOrgSelector = () => {\n\t\t//workaround since component uses both the value and label to match and we just want to store the value\n\t\tconst value = provider.orgId ? orgOptions.find(o => o.value === provider.orgId) : null;\n\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"organization\">Healthcare Organization</Label>\n\t\t\t<Select id=\"organization\" autoFocus\n\t\t\t\t//performance improvement on autocomplete\n\t\t\t\tfilterOption={createFilter({ignoreAccents: false})}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={handleOrgSelection}\n\t\t\t\tisSearchable={true}\n\t\t\t\toptions={orgOptions}\n\t\t\t\tdefaultMenuIsOpen={provider.id ? false : true}\n\t\t\t/>\n\t\t</FormGroup>\n\t}\n\n\tconst renderTextInput = (title, property, type, isRequired, instructions, valueFn, onChangeFn) => {\n\t\tconst formText = instructions ? <FormText color=\"muted\">{instructions}</FormText> : \"\";\n\t\tconst errorText = validation[property] ? <FormFeedback>{validation[property]}</FormFeedback> : \"\";\n\t\tconst onChange = onChangeFn || ( e => {setProvider({...provider, [property]: e.target.value}) });\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"{property}\">{title}</Label>\n\t\t\t<Input\n\t\t\t\tvalue={valueFn ? valueFn() : provider[property] || \"\"}\n\t\t\t\ttype={type || \"text\"}\n\t\t\t\tid={property}\n\t\t\t\tonChange={onChange}\n\t\t\t\tinvalid={validation[property] ? true : false}\n\t\t\t\trequired={isRequired}\n\t\t\t/>\n\t\t\t{formText}\n\t\t\t{errorText}\n\t\t</FormGroup>\n\t}\t\n\n\tconst renderProfileSelector = () => {\n\t\tconst profileOptions = Object.keys(queryProfiles).map(q => {\n\t\t\treturn <option value={q} key={q}>{queryProfiles[q].title}</option>\n\t\t});\n\n\t\treturn <FormGroup>\n\t\t\t<Label for=\"profile\">Profile</Label>\n\t\t\t<Input type=\"select\"\n\t\t\t\tvalue={provider.queryProfile || \"argonaut_spec\"}\n\t\t\t\tonChange={ e=> setProvider({...provider, queryProfile: e.target.value}) }\n\t\t\t\tname=\"profile\"\n\t\t\t> {profileOptions} </Input>\n\t\t</FormGroup>\n\t}\n\n\tconst openCheckbox = <FormGroup check>\n\t\t<Input type=\"checkbox\"\n\t\t\tid=\"isOpen\"\n\t\t\tchecked={provider.isOpen === true || provider.isOpen === \"true\" || false}\n\t\t\tonChange={e => setProvider({...provider, isOpen:!provider.isOpen})}\n\t\t/>\n\t\t<Label for=\"isOpen\">Open Endpoint</Label>\n\t</FormGroup>\n\n\tconst detailsLink = !noCustomEndpoints && <FormGroup>\n\t\t<a href=\"#\" onClick={e => setShowDetails(true)} >\n\t\t\t{\"Show Configuration Details\"}\n\t\t</a>\n\t</FormGroup>\n\n\tconst shortForm = <>\n\t\t{ renderOrgSelector() }\n\t\t{ renderTextInput(\"Title\", \"name\", \"text\", true) }\n\t</>\n\n\tconst openDetails = <>\n\t\t{ renderTextInput(\"FHIR Endpoint URL\", \"fhirEndpoint\", \"url\", true) }\n\t\t{ openCheckbox }\n\t\t{ renderProfileSelector() }\n\t\t{ renderTextInput(\"Patient Id\", \"patient\", \"text\", true)}\n\t</>\n\t\n\tconst secureDetails =  <>\n\t\t{ renderTextInput(\"FHIR Endpoint URL\", \"fhirEndpoint\", \"url\", true) }\n\t\t{ openCheckbox }\n\t\t{ renderProfileSelector() }\n\t\t{ renderTextInput(\"Client Id\", \"clientId\", \"text\", true) }\n\t\t{ renderTextInput(\"Client Secret (if applicable)\", \"clientSecret\", \"text\", true) }\n\t\t{ renderTextInput(\"Redirect URL\", \"redirectUri\", \"url\", true) }\n\t\t{ renderTextInput(\n\t\t\t\"Scope\", \"scope\", \"text\", true,  \"separate scopes with spaces\",\n\t\t\t() => (provider.scope || []).join(\" \"),\n\t\t\te => setProvider({...provider, scope: e.target.value.split(/\\s+/)})\n\t\t)}\n\t</>\n\n\treturn  <Modal isOpen={true} fade={false} backdrop={true} autoFocus={false}>\n\t\t<ModalHeader>{provider.id ? \"Update Provider\" : \"Add Provider\"} </ModalHeader>\n\t\t<ModalBody><Form onSubmit={handleSubmit} className=\"needs-validation\" noValidate>\n\t\t\t{ shortForm }\n\t\t\t{ !showDetails && provider.orgId ? detailsLink : null }\n\t\t\t{ showDetails && provider.isOpen ? openDetails : null }\n\t\t\t{ showDetails && !provider.isOpen ? secureDetails : null }\n\t\t</Form></ModalBody>\n\t\t<ModalFooter>\n\t\t\t<div className=\"mr-auto\"><a href=\"#\" onClick={handleCancel}>Cancel</a></div>\n\t\t\t<Button color=\"outline-secondary\" onClick={e => handleSubmit(e, true)}>Save</Button>\n\t\t\t<Button color=\"primary\" style={{marginLeft: \"1em\"}} onClick={handleSubmit}>Save and Load Records</Button>\n\t\t</ModalFooter>\n\t</Modal>\n\n}","import React from \"react\";\nimport {format} from \"timeago.js\";\n\nexport default class TimeAgo extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state= {timeAgo: format(this.props.time)}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.interval = setInterval(() => {\n\t\tthis.setState({timeAgo: format(this.props.time)});\n\t\t}, (this.props.refreshMinutes||1)*60000);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tclearInterval(this.interval);\n\t}\n\n\trender() {\n\t\treturn this.state.timeAgo\n\t}\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport TimeAgo from \"./TimeAgo\"\nimport { Button, CardBody, Card, Row, Col } from \"reactstrap\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faPlus, faTrash, faEdit, faCheckSquare } from \"@fortawesome/free-solid-svg-icons\"\nimport { faSquare } from \"@fortawesome/free-regular-svg-icons\"\n\nexport default () => {\n\n\tconst { providers, dispatch } = useStoreon(\"providers\");\n\n\tconst handleDeleteProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/remove\", id);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleEditProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {\n\t\t\tmode: \"editProvider\", id\n\t\t});\n\t}\n\n\tconst handleLoadRecords = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/loadData\", id);\n\t}\n\n\tconst handleAddProvider = (e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\tconst toggleProviderSelection = (id, newValue, e) => {\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: id, selected: newValue\n\t\t});\n\t}\n\n\tconst pluralizeEn = (text, len) => len === 1 ? text : text+\"s\";\n\n\tconst renderCard = (provider) => {\n\n\n\t\tconst renderDataDetails = () => <p>\t\n\t\t\t{ provider.data.entry.length} { pluralizeEn(\"resource\", provider.data.entry.length) }{\" | \"}\n\t\t\t{ provider.data.files.length} { pluralizeEn(\"file\", provider.data.files.length) }{\" | \"}\n\t\t\t{ provider.data.errorLog.length} { pluralizeEn(\"error\", provider.data.errorLog.length) }\n\t\t\t<br />loaded <TimeAgo time={provider.lastUpdated} />\n\t\t</p>\n\n\t\tconst controls = <div>\n\t\t\t<div className=\"float-right\">\n\t\t\t\t<a href=\"#\" \n\t\t\t\t\tonClick={e => handleEditProvider(provider.id, e)}\n\t\t\t\t\ttitle=\"Edit Provider\"\n\t\t\t\t>\n\t\t\t\t\t<FontAwesomeIcon icon={faEdit} color=\"#6c757d\" className=\"mx-2\" />\n\t\t\t\t</a>\n\n\t\t\t\t<a href=\"#\" \n\t\t\t\t\tonClick={e => handleDeleteProvider(provider.id, e)}\n\t\t\t\t\ttitle=\"Delete Provider\"\n\t\t\t\t>\n\t\t\t\t\t<FontAwesomeIcon icon={faTrash} color=\"#6c757d\" className=\"mx-2\" />\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<a href=\"#\" \n\t\t\t\tstyle={{fontWeight: !provider.lastUpdated ? \"bold\" : \"normal\"}}\n\t\t\t\tonClick={e => handleLoadRecords(provider.id, e)}>\n\t\t\t\t{provider.lastUpdated ? \"re\" : \"\"}load records\n\t\t\t</a>\n\t\t</div>\n\n\t\treturn <Card style={{margin:\"0 1rem 1rem 0\"}} key={provider.id}>\n\t\t\t<CardBody><Row>\n\t\t\t\t<Col xs={{size: \"auto\"}} className=\"mr-0 pr-1 text-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<input type=\"checkbox\"\n\t\t\t\t\t\t\tstyle={{visibility: \"hidden\", width:0, height:0}}\n\t\t\t\t\t\t\tchecked={!!provider.selected} \n\t\t\t\t\t\t\tid={\"selection-\"+ provider.id}\n\t\t\t\t\t\t\tonChange={e => toggleProviderSelection(provider.id, !provider.selected)} \n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label htmlFor={\"selection-\"+ provider.id}>\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={!!provider.selected ? faCheckSquare : faSquare} size=\"lg\" color={!!provider.selected ? \"green\" : \"black\"} />\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</Col><Col>\n\t\t\t\t\t<p className=\"font-weight-bold\" \n\t\t\t\t\t\tstyle={{marginBottom: \".25rem\", cursor: \"pointer\", display:\"inline-block\"}}\n\t\t\t\t\t\tonClick={e => toggleProviderSelection(provider.id, !provider.selected, e)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{provider.name}\n\t\t\t\t\t</p>\n\t\t\t\t\t\t{ provider.lastUpdated && renderDataDetails() }\n\t\t\t\t\t\t{ controls }\n\t\t\t\t</Col>\n\t\t\t</Row></CardBody>\n\t\t</Card>\n\n\t};\n\n\treturn <div>\n\t\t<div style={{marginBottom: \"1.5rem\"}}>\n\t\t\t<Button color=\"success\"\n\t\t\t\tstyle={{marginRight: \"1rem\"}}\n\t\t\t\tonClick={handleAddProvider}\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faPlus} className=\"mr-2\" />\n\t\t\t\tAdd Provider\n\t\t\t</Button>\t\n\t\t</div>\n\t\t{ providers.map(renderCard) }\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Spinner, Modal, ModalBody, ModalFooter} from 'reactstrap';\nimport { saveAs } from \"file-saver\";\n\nexport default () => {\n\n\tconst { uiState, providers, dispatch } = useStoreon(\"uiState\", \"providers\");\n\n\tconst provider =  useMemo( () => {\n\t\treturn providers.find(p => p.id === uiState.id)\n\t}, [uiState.id, providers]);\n\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/cancelLoad\");\n\t}, [dispatch]);\n\n\tconst handleClose = useCallback( e => {\n\t\tif (e) e.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode  === \"authorizing\" || uiState.submode === \"loading\") {\n\t\t\t\thandleCancel(e);\n\t\t\t} else {\n\t\t\t\thandleClose(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel, handleClose, uiState.submode]);\n\n\tconst handleSave = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: provider.id,\n\t\t\tlastUpdated: new Date(),\n\t\t\tdata: uiState.data\n\t\t});\n\t\thandleClose();\n\t}\n\n\tconst handleLogDownload = e => {\n\t\te.preventDefault();\n\t\tconst blob = new Blob(\n\t\t\t[JSON.stringify(uiState.data.errorLog, null, 2)], \n\t\t\t{type: \"application/json\"}\n\t\t);\n\t\tsaveAs(blob, \"errors.json\");\n\t}\n\t\n\tconst renderAuthorizing = () => <div>\n\t\t<h5>Waiting for authorization...</h5>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst pluralizeEn = (text, len) => len === 1 ? text : text+\"s\";\n\n\tconst renderLoading = () => <div>\n\t\t<h5>\n\t\t\t{uiState.requestCount} {pluralizeEn(\"request\", uiState.requestCount)} \n\t\t\t&nbsp; / &nbsp;\n\t\t\t{uiState.errorCount} {pluralizeEn(\"error\", uiState.errorCount)}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderLoaded = () => <div>\n\t\t<h5>\n\t\t\t{uiState.data.entry.length} {pluralizeEn(\"resource\", uiState.data.entry.length)} retrieved<br/>\n\t\t\t{uiState.data.files.length || \"No\"} {pluralizeEn(\"attachment\", uiState.data.files.length)} downloaded<br/>\n\t\t\t{uiState.data.errorLog.length || \"No\"} {pluralizeEn(\"error\", uiState.data.errorLog.length)} occurred\n\t\t</h5>\n\t</div>\n\n\tconst renderGlobalError = () => <div>\n\t\t<h5 style={{padding: \"1rem 0\", color: \"red\"}}>An error occurred: { uiState.status }</h5>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleClose}>Close</Button>\n\t\t</div>\n\t</div>\n\n\t\n\tconst renderLoadedButtons = () => {\n\t\tconst downloadLink = uiState.data.errorLog.length > 0 && \n\t\t\t<div className=\"mr-auto\"><a href=\"#\" onClick={handleLogDownload}>Download error log</a></div>;\n\t \treturn <ModalFooter>\n\t\t\t{downloadLink}\n\t\t\t<Button color=\"outline-secondary\" onClick={handleClose}>Cancel</Button>\n\t\t\t<Button color=\"primary\" style={{marginLeft: \"1em\"}} onClick={handleSave}>Save</Button>\n\t\t</ModalFooter>\n\t}\n\n\treturn <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalBody style={{textAlign: \"center\"}}>\n\t\t\t<h3>{provider.name}</h3>\n\t\t\t{ uiState.submode === \"authorizing\" && renderAuthorizing() }\n\t\t\t{ uiState.submode === \"loading\" && renderLoading() }\n\t\t\t{ uiState.submode === \"loaded\" && renderLoaded() }\n\t\t\t{ uiState.submode === \"error\" && renderGlobalError() }\n\t\t</ModalBody>\n\t\t{ uiState.submode === \"loaded\" && renderLoadedButtons() }\t\n\t</Modal>\n\n\n}","import React from \"react\";\nimport {Spinner} from 'reactstrap';\n\nexport default () => {\n\n\treturn <div className=\"text-center\" style={{margin:\"3rem\"}}>\n\t\t<Spinner style={{ width:\"3rem\", height:\"3rem\", margin:\"1rem\"}} />\n\t\t<h4>Loading</h4>\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {\n\tButton, Spinner, Col, Row, \n\tForm, FormGroup, Modal, ModalHeader, \n\tModalBody, ModalFooter, Label, \n\tInput, Container, Alert\n} from 'reactstrap';\n\nexport default () => {\n\t//app state\n\tconst {uiState, githubConfig, dispatch} = useStoreon(\"uiState\", \"githubConfig\");\n\n\t//component state\n\tconst [showInstructions, setShowInstructions] = useState();\n\n\tconst handleHideDialog = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"})\n\t}, [dispatch]);\n\n\tconst handleCancelExport = useCallback( e => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/github/cancel\");\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode !== \"push\") {\n\t\t\t\thandleHideDialog(e);\n\t\t\t} else {\n\t\t\t\thandleCancelExport(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancelExport, handleHideDialog]);\n\t\n\tconst handleSubmit = e => {\n\t\te.preventDefault()\n\t\tif (!githubConfig.token || !githubConfig.owner || !githubConfig.project) {\n\t\t\tdispatch(\"uiState/merge\", {\n\t\t\t\terror: \"Please enter a personal access token, repository owner and repository project to continue.\"\n\t\t\t});\n\t\t} else {\n\t\t\tdispatch(\"export/github\");\n\t\t}\n\t}\n\n\tconst handleFieldChange = (fieldName, e) => {\n\t\tconst value = fieldName === \"pullRequest\"\n\t\t\t? e.target.value === \"true\"\n\t\t\t: e.target.value;\n\t\tdispatch(\"config/merge\", {\n\t\t\tgithubConfig: {\n\t\t\t\t...githubConfig, [fieldName]: value\n\t\t\t}\n\t\t});\n\t\tdispatch(\"uiState/merge\", {\n\t\t\tstatus: null,\n\t\t\terror: null\n\t\t});\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleToggleInstructions = e => {\n\t\te.preventDefault();\n\t\tsetShowInstructions(!showInstructions);\n\t}\n\n\tconst renderLoading = () => <ModalBody className=\"text-center\">\n\t\t<h5>\n\t\t\t{uiState.status}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancelExport}>Cancel</Button>\n\t\t</div>\n\t</ModalBody>\n\n\tconst renderError = () => (\n\t\t<Row><Col xs={12}>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"danger\">\n\t\t\t\t\t<span>{uiState.error.toString()}</span>\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</Col></Row>\n\t);\n\n\tconst renderMessage = () => {\n\t\tconst url = uiState.statusUrl \n\t\t\t? <span> (<a href={uiState.statusUrl} target=\"_blank\" rel=\"noopener noreferrer\">view</a>)</span>\n\t\t\t: null;\n\t\treturn <Row><Col xs={12}>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"success\">\n\t\t\t\t\t{uiState.status}\n\t\t\t\t\t{url}.\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</Col></Row>\n\t};\n\n\tconst renderForm = () => <Form onSubmit={handleSubmit}>\n\t\t<ModalBody>\n\t\t\t{ uiState.error && renderError() }\n\t\t\t{ uiState.status && renderMessage() }\n\t\t\t<Row form style={{margin: \"1rem 0\"}}><Col xs={12}>\n\t\t\t\t\t<div className=\"small float-right\">\n\t\t\t\t\t\t<a href=\"#\" onClick={handleToggleInstructions}>How do I get a token?</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\"token-instructions\" style={{display: showInstructions ? \"block\" : \"none\", marginTop: \"2rem\"}}>\n\t\t\t\t\t\tTo obtain a personal access token for your Github account:\n\t\t\t\t\t\t<ol>\n\t\t\t\t\t\t\t<li>Visit <a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\thttps://github.com/settings/tokens\n\t\t\t\t\t\t\t</a></li>\n\t\t\t\t\t\t\t<li>Click the \"Generate new token\" button in upper right corner of the page.</li>\n\t\t\t\t\t\t\t<li>Add a note to identify the token in case you want to revoke it later (eg. \"Procure\").</li>\n\t\t\t\t\t\t\t<li>Select permissions:\n\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t<li>To push data to a public repository, check the <i>\"public_repo\"</i> item under <i>\"repo\"</i>.</li>\n\t\t\t\t\t\t\t\t\t<li>To push data to a private repository, check the <i>\"repo\"</i> item.</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li>Click the \"Generate token\" button at the bottom of the page.</li>\n\t\t\t\t\t\t</ol>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Label for=\"token\">Personal Access Token</Label>\n\t\t\t\t\t<Input id=\"token\" \n\t\t\t\t\t\tvalue={(githubConfig && githubConfig.token) || \"\"} \n\t\t\t\t\t\tonChange={ e => handleFieldChange(\"token\", e) }\n\t\t\t\t\t/>\n\n\t\t\t</Col></Row>\n\n\t\t\t<Row form style={{margin: \"1rem 0\"}}><Col xs={12}>\n\t\t\t\t<Label for=\"repo\">Repository</Label>\n\t\t\t</Col><Col xs={4}>\n\t\t\t\t<Input id=\"owner\"\n\t\t\t\t\tvalue={(githubConfig && githubConfig.owner) || \"\"} \n\t\t\t\t\tonChange={ e => handleFieldChange(\"owner\", e) } \n\t\t\t\t\tplaceholder=\"Owner\" data-lpignore=\"true\"\n\t\t\t\t/>\n\t\t\t</Col><Col xs={1}>\n\t\t\t<Input readOnly className=\"form-control-plaintext\" defaultValue=\"/\" />\n\t\t\t</Col><Col xs={7}>\n\t\t\t\t<Input id=\"project\" \n\t\t\t\t\tvalue={(githubConfig && githubConfig.project) || \"\"} \n\t\t\t\t\tonChange={ e => handleFieldChange(\"project\", e) } \n\t\t\t\t\tplaceholder=\"Project\" data-lpignore=\"true\"\n\t\t\t\t/>\n\t\t\t</Col></Row>\n\n\t\t\t<Row form style={{margin: \"2rem 0\"}}><Col xs={12}>\n\t\t\t\t<FormGroup check>\n\t\t\t\t\t<Label check>\n\t\t\t\t\t\t<Input type=\"radio\"\n\t\t\t\t\t\t\tname=\"pull-request\"\n\t\t\t\t\t\t\tvalue={false}\n\t\t\t\t\t\t\tchecked={!githubConfig.pullRequest}\n\t\t\t\t\t\t\tonChange={ e => handleFieldChange(\"pullRequest\", e) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tCommit directly to the master branch</Label>\n\t\t\t\t</FormGroup>\n\t\t\t\t<FormGroup check>\n\t\t\t\t\t<Label check>\n\t\t\t\t\t\t<Input type=\"radio\"\n\t\t\t\t\t\t\tname=\"pull-request\"\n\t\t\t\t\t\t\tvalue={true}\n\t\t\t\t\t\t\tchecked={githubConfig.pullRequest === true}\n\t\t\t\t\t\t\tonChange={ e => handleFieldChange(\"pullRequest\", e) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tCreate a new branch and pull request</Label>\n\t\t\t\t</FormGroup>\n\t\t\t</Col></Row>\n\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"success\" type=\"submit\">Push Data</Button>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Close</Button>\n\t\t</ModalFooter>\n\t</Form>\n\t\n\treturn  <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalHeader>Push to Github Repository</ModalHeader>\n\t\t{ uiState.submode === \"push\" ? renderLoading() : renderForm() }\n\t</Modal>\n\n}","import React, { useState } from \"react\";\n\nexport default ({ children, dropHint, fileDropHandler }) => {\n\n\tconst [dragCounter, setDragCounter] = useState(0);\n\n\tconst isFileDrag = e => {\n\t\treturn !e.dataTransfer.types ||\n\t\t\te.dataTransfer.types[0] === \"Files\" ||\n\t\t\te.dataTransfer.types[0] === \"application/x-moz-file\";\n\t}\n\t\n\tconst handleDrop = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (e.dataTransfer.files && e.dataTransfer.files.length === 1)\n\t\t\tfileDropHandler(e.dataTransfer.files[0]);\n\t\t// e.dataTransfer.clearData();\n\t\tsetDragCounter(0);\n\t}\n\n\tconst handleDragOver = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\t\n\t}\n\n\tconst handleDragEnter = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (isFileDrag(e))\n\t\t\tsetDragCounter(dragCounter+1);\n\t}\n\n\tconst handleDragLeave = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (isFileDrag(e))\n\t\t\tsetDragCounter(dragCounter-1);\n\t}\n\n\tconst overlay = <div className=\"d-flex justify-content-center\" style={{\n\t\tborder: 'dashed grey 4px',\n\t\tbackgroundColor: 'rgba(255,255,255,.8)',\n\t\tposition: 'absolute',\n\t\ttop: 0,\n\t\tbottom: 0,\n\t\tleft: 0, \n\t\tright: 0,\n\t\tzIndex: 9999,\n\t}}>\n\t\t<div className=\"d-flex align-items-center\">\n\t\t\t{ dropHint || \"Drop settings file here\"}\n\t\t</div>\n\t</div>\n\n\treturn <div \n\t\tstyle={{position: \"relative\"}}\n\t\t\tonDragEnter={handleDragEnter}\n\t\t\tonDragOver={handleDragOver}\n\t\t\tonDragLeave={handleDragLeave}\n\t\t\tonDrop={handleDrop}\n\t\t>\n\t\t{ dragCounter > 0 && overlay }\n\t\t{ children }\n\t</div>\n\t\n\t\n} \t","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, {useRef, useEffect} from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Navbar, NavbarBrand, Nav, NavItem, NavLink} from 'reactstrap';\nimport SettingsImportDropZone from \"./SettingsImportDropZone\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faMedkit } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { providers, isDirty, warnOnPageNavigate, appName, dispatch } = useStoreon(\"providers\", \"isDirty\", \"warnOnPageNavigate\", \"appName\");\n\tconst fileInput = useRef();\n\n\tuseEffect( () => {\n\t\twindow.onbeforeunload = () => (isDirty && warnOnPageNavigate) ? true : null;\n\t});\n\n\tconst handleImportSettings = e => {\n\t\te.preventDefault();\n\t\tfileInput.current.value = \"\";\n\t\tfileInput.current.click();\n\t}\n\n\tconst handleFileSelected = e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tif (e.target.files.length === 1)\n\t\t\treadFile(e.target.files[0]);\n\t}\n\n\tconst handleDownloadSettings = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"export/settings\");\n\t}\n\n\tconst readFile = (file) => {\n\t\tconst replace = providers.length === 0 || window.confirm(\n\t\t\t\"Current providers in your list will be replaced. Continue?\"\n\t\t)\n\t\tif (replace) {\n\t\t\tdispatch(\"import/settings\", file)\n\t\t\tdispatch(\"refreshDirty\", true);\n\t\t};\n\t}\n\n\treturn <div style={{marginBottom: \"2rem\"}}><SettingsImportDropZone fileDropHandler={readFile}>\n\t\t<input ref={fileInput}\n\t\t\t\ttype=\"file\" \n\t\t\t\tstyle={{display: 'none'}}\n\t\t\t\tonChange={handleFileSelected}\n\t\t\t\taccept=\".json, application/json\"\n\t\t/>\n\t\t<Navbar color=\"light\" light expand=\"xs\">\n\t\t\t<NavbarBrand href=\"/\">\n\t\t\t\t<FontAwesomeIcon icon={faMedkit} alt=\"Procure logo\" className=\"mr-2\" />\n\t\t\t\t{appName || \"Procure\"}\n\t\t\t</NavbarBrand>\n\t\t\t<Nav className=\"ml-auto\" navbar>\n\t\t\t\t<NavItem>\n\t\t\t\t\t<NavLink href=\"#\" onClick={handleImportSettings}>import settings</NavLink>\n\t\t\t\t</NavItem>\n\t\t\t\t<NavItem>\n\t\t\t\t\t<NavLink href=\"#\" onClick={handleDownloadSettings} style={{fontWeight: isDirty ? \"bold\" : \"normal\"}}>\n\t\t\t\t\t\texport settings\n\t\t\t\t\t</NavLink>\n\t\t\t\t</NavItem>\n\t\t\t</Nav>\n\t\t</Navbar>\n\t</SettingsImportDropZone></div> \n\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useMemo, useRef } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport Select from \"react-select\";\nimport JSONTree from \"react-json-tree\";\nimport {FormGroup, Button} from \"reactstrap\";\nimport _ from \"lodash\";\nimport { saveAs } from \"file-saver\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronLeft, faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\t\n\t//app state\n\tconst { providers, dateSortElements } = useStoreon(\"providers\", \"dateSortElements\");\n\n\t//component state\n\tconst [resourceType, setResourceType] = useState();\n\tconst [position, setPosition] = useState(1);\n\tconst [overlayResources, setOverlayResources] = useState([]);\n\n\tconst componentTopRef = useRef();\n\n\tlet resourceTypeOptions = useMemo( () => {\n\t\treturn _.chain(providers)\n\t\t\t.filter( p => p.data && p.selected )\n\t\t\t.map( p => p.data.entry.map(e => e.resource.resourceType) )\n\t\t\t.flatten().uniq()\n\t\t\t.map(o => ({label: o, value: o}))\n\t\t\t.sortBy([\"label\"])\n\t\t\t.value();\n\t}, [providers]);\n\n\tlet resources = useMemo( () => {\n\t\treturn _.chain(providers)\n\t\t\t.filter( p => p.data && p.data.entry && p.selected )\n\t\t\t.map( p => p.data.entry ).flatten()\n\t\t\t.filter( e => (!resourceType || resourceType.value === e.resource.resourceType) )\n\t\t\t.sortBy( e => {\n\t\t\t\tconst sortElements = dateSortElements[e.resource.resourceType] || [];\n\t\t\t\tconst sortElement = _.find( sortElements, element => e.resource[element]);\n\t\t\t\tconst dateValue =\n\t\t\t\t\t(sortElement && (e.resource[sortElement].start || e.resource[sortElement])) || \n\t\t\t\t\t(e.resource.meta && e.resource.meta.lastUpdated) || \"\";\n\t\t\t\treturn dateValue;\n\t\t\t})\n\t\t\t.reverse()\n\t\t\t.value();\n\t}, [providers, resourceType, dateSortElements]);\n\n\t//remove leading slashes, trailing slashes and protocol\n\tconst simplifyUrl = (url) => url.replace(/^\\/|https?:\\/\\/|\\/*$/g, \"\")\n\n\tconst referenceIndex = useMemo( () => {\n\t\tlet index = {};\n\t\t_.each(providers, (provider, i) => {\n\t\t\t_.each(((provider.data && provider.data.entry) || []), (entry, j) => {\n\t\t\t\tindex[simplifyUrl(entry.fullUrl)] = [i, j, \"resource\"]\n\t\t\t})\n\t\t\t_.each(((provider.data && provider.data.files) || []), (file, j) => {\n\t\t\t\tindex[file.fileName] = [i, j, \"file\"]\n\t\t\t})\t\t\n\t\t});\n\t\treturn index;\n\t}, [providers]);\n\n\tconst handlePosChange = (dir, e) => {\n\t\te.preventDefault();\n\t\tsetPosition(position+dir);\n\t}\n\n\tconst filters = <FormGroup>\n\t\t<Select id=\"resourceType\"\n\t\t\tvalue={resourceType}\n\t\t\tonChange={ selection => {setResourceType(selection); setPosition(1);setOverlayResources([]);} }\n\t\t\tisSearchable={true}\n\t\t\toptions={ resourceTypeOptions }\n\t\t\tplaceholder=\"Filter by Resource Type\"\n\t\t\tisClearable={true}\n\t\t/>\n\t</FormGroup>\n\n\tconst renderPositionNav = () => {\n\t\tconst noResources = <div className=\"text-center\">\n\t\t\tNo resources found\n\t\t</div>;\n\t\t\t\t\n\t\tconst nextPrevNav = <div>\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" \n\t\t\t\tdisabled={position === 1}\n\t\t\t\tonClick={e => handlePosChange(-1, e)} className=\"mr-3\"\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faChevronLeft} />\n\t\t\t</Button>\n\t\t\t\tResource {position} of {resources.length}\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" \n\t\t\t\tdisabled={position === resources.length} \n\t\t\t\tonClick={e => handlePosChange(1, e)}  className=\"ml-3\"\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t</Button>\n\t\t</div>;\n\n\t\tconst overlayNav = <div>\n\t\t\t<Button size=\"sm\" outline={true} color=\"primary\" onClick={e => {\n\t\t\t\tsetOverlayResources(_.slice(overlayResources, 0, -1))\n\t\t\t}}>\n\t\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\tBack\n\t\t\t</Button>\n\t\t</div>;\n\n\t\tif (overlayResources.length) {\n\t\t\treturn overlayNav;\n\t\t} else if (resources.length) {\n\t\t\treturn nextPrevNav;\n\t\t} else {\n\t\t\treturn noResources;\n\t\t}\n\n\t}\n\n\tconst treeTheme = {\n\t\tbase00: '#272822',base01: '#383830',base02: '#49483e',base03: '#75715e',\n\t\tbase04: '#a59f85',base05: '#f8f8f2',base06: '#f5f4f1',base07: '#f9f8f5',\n\t\tbase08: '#f92672',base09: '#fd971f',base0A: '#f4bf75',base0B: '#a6e22e',\n\t\tbase0C: '#a1efe4',base0D: '#66d9ef',base0E: '#ae81ff',base0F: '#cc6633'\n\t};\n\n\tconst handleReference = (url, e) => {\n\t\te.preventDefault();\n\t\tconst index = referenceIndex[url];\n\t\tif (index[2] === \"file\") {\n\t\t\tconst file = providers[index[0]].data.files[index[1]];\n\t\t\tsaveAs(file.blob, file.fileName);\n\t\t} else {\n\t\t\tsetOverlayResources([...overlayResources, url]);\n\t\t\twindow.scrollTo(0, componentTopRef.current.offsetTop);\n\t\t}\n\t}\n\n\tconst valueRenderer = (raw, value, key) => {\n\t\tlet link;\n\n\t\tif (key === \"reference\") {\n\t\t\t//remove leading and trailing slashes\n\t\t\tlet refUrl = simplifyUrl(value);\n\n\t\t\t//add base url if relative path\n\t\t\tif ((refUrl.match(/\\//g) || []).length === 1) {\n\t\t\t\tconst fullUrl =\n\t\t\t\t\t(overlayResources.length && _.last(overlayResources).fullUrl) ||\n\t\t\t\t\tresources[position-1].fullUrl;\n\t\t\t\tconst baseUrl = simplifyUrl(fullUrl).split(\"/\");\n\t\t\t\trefUrl = baseUrl\n\t\t\t\t\t.slice(0, baseUrl.length-2).join(\"/\") + \"/\" + refUrl;\n\t\t\t}\n\t\t\tif (referenceIndex[refUrl]) link = refUrl;\n\t\t//this could be optimized by only looking at attachment keys\n\t\t} else if (key === \"url\" && referenceIndex[value]) {\n\t\t\tlink = value;\n\t\t//truncate very long values\n\t\t} else if (value.length > 500) {\n\t\t\traw = value.substring(0,500) + \"...\";\n\t\t}\n\n\t\treturn link ? <span>\n\t\t\t\"<a href=\"#\" style={{textDecoration: \"underline\"}}\n\t\t\tonClick={e => handleReference(link, e)}\n\t\t\t>{value}</a>\"\n\t\t</span> : raw;\n\t}\n\n\tconst getResourceByUrl = (url) => {\n\t\tconst index = referenceIndex[url];\n\t\tif (index) return providers[index[0]].data.entry[index[1]];\n\t}\n\n\tconst renderJsonTree = () => {\n\n\t\tconst overlayData = overlayResources.length && getResourceByUrl(_.last(overlayResources))\n\t\tif (overlayResources.length && !overlayData) \n\t\t\tsetOverlayResources(_.slice(overlayResources, 1,-1));\t\n\t\tconst data = (\n\t\t\toverlayData && overlayData.resource\n\t\t) || (\n\t\t\tresources[position-1] && resources[position-1].resource\n\t\t);\n\t\t\n\t\tif (data) return <div style={{\n\t\t\tmarginTop: \"1rem\", padding: \"1rem\", \n\t\t\tborder: \"1px solid #ccc\", borderRadius: \".25rem\", \n\t\t\tbackground: \"#fffffa\"\n\t\t}}>\n\t\t\t<JSONTree \n\t\t\t\tdata={data} \n\t\t\t\ttheme={treeTheme} \n\t\t\t\thideRoot={true} \n\t\t\t\tshouldExpandNode={(keyName, data, level) => true}\n\t\t\t\tinvertTheme={true}\n\t\t\t\tvalueRenderer={valueRenderer}\n\t\t\t/>\n\t\t</div>;\n\t}\n\n\treturn <div ref={componentTopRef}>\n\t\t{ filters }\n\t\t{ renderPositionNav() }\n\t\t{ renderJsonTree() }\n\t</div>\n}","import React, {useState} from \"react\";\nimport {Button, Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faTable, faFileDownload, faFileUpload } from \"@fortawesome/free-solid-svg-icons\"\nimport { faGithub } from \"@fortawesome/free-brands-svg-icons\"\n\nexport default (props) => {\n\n\tconst { \n\t\tspreadsheetTemplates,\n\t\tupload,\n\t\tnonModalUi, dispatch \n\t} = useStoreon(\n\t\t\"spreadsheetTemplates\",\n\t\t\"upload\",\n\t\t\"nonModalUi\"\n\t);\n\t\n\tconst [showSpreadsheetOptions, setShowSpreadsheetOptions] = useState(false);\n\n\tconst handleExportData = (e) => {\t\t\n\t\te.preventDefault();\n\t\tdispatch(\"export/download\");\n\t}\n\n\tconst handleFileUpload = (e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/upload\");\n\t}\n\n\tconst handleShowGithubExport = (e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"githubExport\"});\n\t}\n\n\tconst handelExportSpreadsheet = (templateId, format, e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/spreadsheet\", {templateId, format});\n\t}\n\n\tconst renderSpreadsheetExport = () => {\n\t\tif (!Object.keys(spreadsheetTemplates||{}).length) \n\t\t\treturn null;\n\t\tlet menuItems = [];\n\t\tObject.keys(spreadsheetTemplates).forEach( templateId => {\n\t\t\tmenuItems.push(\n\t\t\t\t<DropdownItem \n\t\t\t\t\tkey={templateId + \"-xlsx\"} \n\t\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"xlsx\")}\n\t\t\t\t>\n\t\t\t\t\t{spreadsheetTemplates[templateId].name + \" (Excel)\"}\n\t\t\t\t</DropdownItem>,\n\t\t\t\t<DropdownItem \n\t\t\t\t\tkey={templateId + \"-csv\"}\n\t\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"csv\")}\n\t\t\t\t>\n\t\t\t\t\t{spreadsheetTemplates[templateId].name + \" (CSV)\"}\n\t\t\t\t</DropdownItem>\n\t\t\t)\n\t\t});\n\t\treturn <Dropdown \n\t\t\tstyle={{display: \"inline\",}}\n\t\t\tdisabled={nonModalUi.isExportingSheet}\n\t\t\tisOpen={showSpreadsheetOptions}\n\t\t\ttoggle={e => setShowSpreadsheetOptions(!showSpreadsheetOptions)}\n\t\t>\n\t\t\t<DropdownToggle \n\t\t\t\tcolor=\"outline-secondary\" \n\t\t\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\t\t\tcaret\n\t\t\t>\n\t\t\t\t<FontAwesomeIcon icon={faTable} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Export as Spreadsheet</span>\n\t\t\t</DropdownToggle>\n\t\t\t<DropdownMenu>{menuItems}</DropdownMenu>\n\t\t</Dropdown>\n\t}\n\n\tconst uploadButton = <Button \n\t\tcolor=\"success\"\n\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\tonClick={handleFileUpload}\n\t\t>\n\t\t\t<FontAwesomeIcon icon={faFileUpload} className=\"mr-2\" />\n\t\t\t{upload.label || \"Share Data\"}\n\t</Button>;\n\n\tconst downloadAllButton = <Button \n\t\tcolor=\"outline-secondary\"\n\t\tstyle={{margin: \"0 1rem 1rem 0\"}}\n\t\tonClick={handleExportData}\n\t\tdisabled={nonModalUi.isDownloading}\n\t\t>\n\t\t\t<FontAwesomeIcon icon={faFileDownload} className=\"mr-2\" />\n\t\t\tDownload Data\n\t</Button>;\n\n\tconst ghExportButton = <Button \n\t\tstyle={{margin: \"0 0 1rem 0\"}}\n\t\tcolor=\"outline-secondary\"\n\t\tonClick={handleShowGithubExport}\n\t\t>\n\t\t<FontAwesomeIcon icon={faGithub} className=\"mr-2\" />\n\t\tUpload to Github\n\t</Button>;\n\n\treturn <div style={{marginBottom: \".5rem\"}}>\n\t\t{upload && (upload.manifestUrl || upload.uploadUrl) && uploadButton}\n\t\t{downloadAllButton}\n\t\t{props.hasResources && renderSpreadsheetExport()}\n\t\t{ghExportButton}\n\t</div>\n\n}","import React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button} from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faPlus } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { dispatch } = useStoreon();\n\n\tconst handleAddProvider = (e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\treturn \t<Button block color=\"success\"\n\t\tonClick={handleAddProvider}\n\t>\n\t\t<FontAwesomeIcon icon={faPlus} className=\"mr-2\" />\n\t\tAdd Provider\n\t</Button>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {\n\tButton, Spinner, Modal, ModalHeader, \n\tModalBody, ModalFooter, Container, Alert\n} from 'reactstrap';\n\nexport default () => {\n\t//app state\n\tconst {uiState, upload, dispatch} = useStoreon(\"uiState\", \"upload\");\n\n\tconst handleHideDialog = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"ready\"})\n\t}, [dispatch]);\n\n\tconst handleDone = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\t\n\t\tif (upload.continueUrl)\n\t\t\twindow.open(upload.continueUrl);\n\t\t\n\t\thandleHideDialog(e);\n\t}, [handleHideDialog, upload]);\n\n\tconst handleCancelExport = useCallback( e => {\n\t\te.preventDefault()\n\t\tconst endState = uiState.submode === \"getManifest\"\n\t\t\t? {mode: \"ready\"}\n\t\t\t: {mode: \"fileUpload\", submode: \"preUpload\"}\n\t\tdispatch(\"export/upload/cancel\");\n\t\tdispatch(\"uiState/set\", endState)\n\t}, [dispatch, uiState.submode]);\n\n\tconst handleUploadFile = useCallback( e => {\n\t\te.preventDefault()\t\n\t\tdispatch(\"export/upload/send\");\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode === \"preUpload\" || uiState.submode === \"postUpload\") {\n\t\t\t\thandleHideDialog(e);\n\t\t\t} else {\n\t\t\t\thandleCancelExport(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancelExport, handleHideDialog]);\n\n\tconst renderLoading = () => <ModalBody className=\"text-center\">\n\t\t<h5>\n\t\t\t{uiState.status}\n\t\t</h5>\n\t\t<div style={{padding: \"1rem 0rem\"}}>\n\t\t\t<Spinner color=\"primary\" style={{ width: '3rem', height: '3rem' }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button className=\"btn-primary\" onClick={handleCancelExport}>Cancel</Button>\n\t\t</div>\n\t</ModalBody>\n\n\tconst renderError = () => <div>\n\t\t<ModalBody>\n\t\t\t<Container>\n\t\t\t\t<Alert color=\"danger\">\n\t\t\t\t\t<span>{uiState.status}</span>\n\t\t\t\t</Alert>\n\t\t\t</Container>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Close</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\tconst renderUploadDetails = () => <div>\n\t\t<ModalBody>\n\t\t\t<p>\n\t\t\t\tClicking the <b>upload</b> button below will share your medical record \n\t\t\tinformation with <b>{upload.name}</b> and indicates your agreement to the \n\t\t\tterms of use, privacy policy and other information outlined at \n\t\t\t\t<b>&nbsp;<a href={upload.infoUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t{upload.infoUrl}\n\t\t\t\t</a></b>.\n\t\t\t</p>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"success\" onClick={handleUploadFile}>Upload</Button>\n\t\t\t<Button color=\"secondary\" onClick={handleHideDialog}>Cancel</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\tconst renderPostUpload = () => <div>\n\t\t<ModalBody className=\"text-center\">\n\t\t\t<h5>{upload.successMessage || \"Your information has been transmitted!\"}</h5>\n\t\t</ModalBody>\n\t\t<ModalFooter>\n\t\t\t<Button color=\"primary\" onClick={handleDone}>\n\t\t\t\t{upload.continueUrl ? (upload.continueLabel || \"Continue\") : \"Close\"}\n\t\t\t</Button>\n\t\t</ModalFooter>\n\t</div>\n\n\treturn  <Modal isOpen={true} fade={false} backdrop={true}>\n\t\t<ModalHeader>Share My Data</ModalHeader>\n\t\t{uiState.submode === \"error\" && renderError()}\n\t\t{uiState.submode === \"getManifest\" && renderLoading()}\n\t\t{uiState.submode === \"preUpload\" && renderUploadDetails()}\n\t\t{uiState.submode === \"uploading\" && renderLoading()}\n\t\t{uiState.submode === \"postUpload\" && renderPostUpload()}\n\t</Modal>\n\n}","import React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport { Button } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\";\n\nexport default() => {\n\n\tconst {upload, dispatch} = useStoreon(\"upload\");\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Welcome</h4>\n\t\t<p>This app will walk you through the process of collecting digital copies of your medical records from healthcare institutions where you've received care and sharing them with {upload.name}. You can find additional information at <a href={upload.infoUrl} target=\"_blank\" rel=\"noopener noreferrer\">{upload.infoUrl}</a>.\n\t\t</p><p>You'll also have the option to download a copy of the data to this device to keep for yourself.</p>\n\t\t<Button color=\"success\" className=\"float-right mt-4\"\n\t\t\tonClick={ e => dispatch(\"uiState/set\", {mode: \"editProvider\" }) }\n\t\t>\n\t\t\t<span className=\"mr-2\">Get Started</span>\n\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t</Button>\n\t\t<div className=\"clearfix\"></div>\n\t</div>\n\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useState, useEffect } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport { Button } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport Select, { createFilter } from \"react-select\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\t//app state\n\tconst {\n\t\tuiState, providers, credentials,\n\t\torganizations, orgDefaults, redirectUri, dispatch\n\t } = useStoreon(\n\t\t\"uiState\", \"providers\", \"credentials\",\n\t\t\"organizations\", \"orgDefaults\", \"redirectUri\"\n\t );\n\n\t//component state\n\tconst [provider, setProvider] = useState({});\t\n\n\tconst orgOptions = _.chain(organizations)\n\t\t.map( o => ({label: o.name, value: o.orgId || o.fhirEndpoint}) )\n\t\t.sortBy( o => o.label )\n\t\t.value();\n\n\tuseEffect( () => {\n\t\tif (!provider.id && uiState.id && uiState.mode === \"editProvider\") {\n\t\t\tconst currentProvider = providers.find(p => p.id === uiState.id);\n\t\t\tsetProvider(currentProvider)\n\t\t}\n\t}, [uiState.id, uiState.mode, provider.id, providers])\n\n\tconst handleSubmit = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/upsertAndLoad\", provider);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst handleSkip = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t}\n\n\tconst handleOrgSelection = (selection) => {\n\t\tlet orgConfig = organizations.find( \n\t\t\to => selection.value === o.orgId || selection.value === o.fhirEndpoint\n\t\t);\n\n\t\tconst defaults = orgDefaults[orgConfig.defaultId] || {};\n\t\tif (orgConfig.defaultId !== undefined) \n\t\t\torgConfig = {...defaults, ...orgConfig};\n\n\t\t//get credential details if included by reference\n\t\tif (orgConfig.credentialId)\n\t\t\torgConfig = {...credentials[orgConfig.credentialId], ...orgConfig};\n\n\t\t//update provider with new defaults\n\t\tsetProvider({\n\t\t\t...orgConfig,\n\t\t\tredirectUri,\n\t\t\tid: provider.id,\n\t\t\torgId: selection.value,\n\t\t\tqueryProfile: orgConfig.queryProfile || \"argonaut_spec\"\n\t\t});\n\t}\n\n\tconst renderOrgSelector = () => {\n\n\t\t//workaround since component uses both the value and label to match and we just want to store the value\n\t\tconst value = provider.orgId ? orgOptions.find(o => o.value === provider.orgId) : null;\n\n\t\treturn <Select id=\"organization\" autoFocus\n\t\t\t\t//performance improvement on autocomplete\n\t\t\t\tfilterOption={createFilter({ignoreAccents: false})}\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={handleOrgSelection}\n\t\t\t\tisSearchable={true}\n\t\t\t\toptions={orgOptions}\n\t\t\t\tdefaultMenuIsOpen={true}\n\t\t\t/>\n\t}\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Select Your Provider</h4>\n\t\t<p>\n\t\t\tChoose a healthcare institution where you've received care from the list below.\n\t\t</p><p>\n\t\t\tIf you've been to multiple healthcare providers, after retrieving your records you'll have the option to return to this screen to select another institution.\n\t\t</p>\n\t\t{ renderOrgSelector() }\n\n\t\t<div className=\"d-flex\">\n\t\t\t<div className=\"align-self-end flex-grow-1 mt-4 pl-1\">\n\t\t\t\t{providers.length > 0 && <a href=\"#\" onClick={handleSkip}>skip</a>}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<Button color=\"success\" className=\"mt-4\"\n\t\t\t\t\tonClick={ handleSubmit } \n\t\t\t\t\tdisabled={provider.orgId ? false :true}\n\t\t\t\t>\n\t\t\t\t\t<span className=\"mr-2\">Login to Patient Portal</span>\n\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Button, Spinner} from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronLeft } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\n\tconst { uiState, providers, dispatch } = useStoreon(\"uiState\", \"providers\");\n\n\tconst provider =  useMemo( () => {\n\t\treturn providers.find(p => p.id === uiState.id)\n\t}, [uiState.id, providers]);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"fhir/cancelLoad\", \"editProvider\");\n\t\tdispatch(\"providers/remove\", provider.id)\n\t}, [dispatch, provider]);\n\n\tconst handleBack = e => {\n\t\tdispatch(\"providers/remove\", provider.id)\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27) return;\n\t\t\tif (uiState.submode  === \"authorizing\" || uiState.submode === \"loading\") {\n\t\t\t\thandleCancel(e);\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [handleCancel, uiState.submode]);\n\n\t//TODO: this is kind of a hack to build on non-wizard modes (need to restructure modes to work with both)\n\tif (uiState.mode !== \"loadData\") return null;\n\tif (uiState.submode === \"loaded\") {\n\t\tdispatch(\"providers/update\", {\n\t\t\tid: provider.id,\n\t\t\tlastUpdated: new Date(),\n\t\t\tdata: uiState.data\n\t\t});\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t};\n\n\tconst renderWorking = (status) => <div className=\"p-4 text-center\">\n\t\t<h5 className=\"mb-4\">{status}</h5>\n\t\t<div className=\"my-4\">\n\t\t\t<Spinner color=\"primary\" style={{ width: \"3rem\", height: \"3rem\" }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button color=\"outline-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderGlobalError = () => <div className=\"p-2\">\n\t\t<h5>Error</h5>\n\t\t<p>An error occurred loading your record: {uiState.status}</p>\n\t\t<div>\n\t\t\t<Button color=\"primary\" className=\"mt-4\" onClick={handleBack}>\n\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Back</span>\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n\n\treturn <div>\n\t\t<h4>{provider.name}</h4>\n\t\t{ uiState.submode === \"authorizing\" && renderWorking(\"Waiting for Portal Login...\") }\n\t\t{ uiState.submode === \"loading\" && renderWorking(\"Retrieving Healthcare Records...\") }\n\t\t{ uiState.submode === \"error\" && renderGlobalError() }\n\t</div>\n\n\n}","import React, {useState} from \"react\";\nimport {Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faFileDownload } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default (props) => {\n\n\tconst { \n\t\tspreadsheetTemplates,\n\t\tnonModalUi,\n\t\tdispatch\n\t} = useStoreon(\n\t\t\"spreadsheetTemplates\",\n\t\t\"nonModalUi\"\n\t);\n\n\tconst [showDownloadOptions, setShowDownloadOptions] = useState(false);\n\n\tconst handelExportSpreadsheet = (templateId, format, e) => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/spreadsheet\", {templateId, format});\n\t}\n\n\tconst handleExportData = (e) => {\t\t\n\t\te.preventDefault();\n\t\tdispatch(\"export/download\");\n\t}\n\n\tlet menuItems = [\n\t\t<DropdownItem \n\t\t\tkey=\"fhir\" \n\t\t\tonClick={handleExportData}\n\t\t>FHIR Format</DropdownItem>\n\t];\n\n\t(Object.keys(spreadsheetTemplates) || []).forEach( templateId => {\n\t\tmenuItems.push(\n\t\t\t<DropdownItem \n\t\t\t\tkey={templateId + \"-xlsx\"} \n\t\t\t\tonClick={handelExportSpreadsheet.bind(this, templateId, \"xlsx\")}\n\t\t\t>\n\t\t\t\tSpreadsheet of {spreadsheetTemplates[templateId].name}\n\t\t\t</DropdownItem>\n\t\t)\n\t});\n\n\treturn <Dropdown \n\t\tclassName={props.className}\n\t\tstyle={{display: \"inline\",}}\n\t\tdisabled={nonModalUi.isExportingSheet}\n\t\tisOpen={showDownloadOptions}\n\t\ttoggle={e => setShowDownloadOptions(!showDownloadOptions)}\n\t>\n\t\t<DropdownToggle \n\t\t\tcolor=\"outline-secondary\" \n\t\t\tstyle={{margin: \"0 1rem 0 0\"}}\n\t\t\tcaret\n\t\t>\n\t\t<FontAwesomeIcon icon={faFileDownload} className=\"mr-2\" />\n\t\t\t<span className=\"mr-2\">Download copy of data</span>\n\t\t</DropdownToggle>\n\t\t<DropdownMenu>{menuItems}</DropdownMenu>\n\t</Dropdown>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport { Button } from 'reactstrap';\nimport useStoreon from \"storeon/react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport DownloadButton from \"./DownloadButton\";\nimport _ from \"lodash\";\n\nexport default () => {\n\n\tconst {providers, upload, dispatch} = useStoreon(\"providers\", \"upload\");\n\n\tconst handleAddProvider = e => {\n\t\te.preventDefault();\n\t\tdispatch(\"uiState/set\", {mode: \"editProvider\"});\n\t}\n\tconst handleFileUpload = e => {\n\t\te.preventDefault()\n\t\tdispatch(\"export/upload/send\");\n\t}\n\n\tconst handleDeleteProvider = (id, e) => {\n\t\te.preventDefault();\n\t\tdispatch(\"providers/remove\", id);\n\t\tdispatch(\"refreshDirty\");\n\t}\n\n\tconst renderProvider = (provider) => {\n\t\treturn <li key={provider.id}>\n\t\t\t{provider.name}{\" \"}\n\t\t\t(<a href=\"#\" onClick={e => handleDeleteProvider(provider.id, e)}>remove</a>)\n\t\t</li>\n\t};\n\n\tconst providerList = _.chain(providers)\n\t\t.sortBy( p => p.lastUpdated)\n\t\t.map(renderProvider)\n\t\t.value();\n\n\treturn <div className=\"p-2\">\n\t\t<h4 className=\"mb-4\">Review Data to Share</h4>\n\t\t<p>You have collected records from the following healthcare providers:</p>\n\t\t<ul>{ providerList }</ul>\n\n\t\t<div className=\"d-md-flex\">\n\t\t\t<div className=\"align-self-end flex-grow-1 mt-4\">\n\t\t\t\t<DownloadButton />\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<Button color=\"success\" \n\t\t\t\t\tonClick={handleAddProvider}\n\t\t\t\t\tclassName=\"btn-block text-left mt-4\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"d-flex\">\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center flex-grow-1\">Add another provider</div>\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</Button>\n\t\t\t\t<Button color=\"success\" \n\t\t\t\t\tclassName=\"btn-block text-left mt-2\"\n\t\t\t\t\tdisabled={providerList.length === 0}\n\t\t\t\t\tonClick={handleFileUpload}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"d-flex\">\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center flex-grow-1\">\n\t\t\t\t\t\t\tShare with {upload.name}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"mr-2 align-self-center\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, { useEffect, useCallback } from \"react\";\nimport useStoreon from \"storeon/react\";\nimport DownloadButton from \"./DownloadButton\";\nimport { Button, Spinner } from 'reactstrap';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faChevronRight, faChevronLeft } from \"@fortawesome/free-solid-svg-icons\"\n\nexport default () => {\n\t//app state\n\tconst {uiState, upload, dispatch} = useStoreon(\"uiState\", \"upload\");\n\n\tconst handleBack = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tdispatch(\"uiState/set\", {mode: \"review\"})\n\t}, [dispatch]);\n\n\tconst handleDone = useCallback( e => {\n\t\tif (e) e.preventDefault()\n\t\tif (upload.continueUrl) \n\t\t\twindow.location.href = upload.continueUrl;\n\t}, [upload]);\n\n\tconst handleCancel = useCallback( e => {\n\t\te.preventDefault();\n\t\tdispatch(\"export/upload/cancel\");\n\t\tdispatch(\"uiState/set\", {mode: \"review\"});\n\t}, [dispatch]);\n\n\t//escape key effect\n\t//creates a warning due to a reactjs bug: https://github.com/facebook/react/pull/15650 \n\tuseEffect(() => {\n\t\tconst downHandler = e => {\n\t\t\tif (e.keyCode !== 27 || uiState.submode === \"uploading\") return;\n\t\t\thandleCancel(e);\n\t\t};\n\t\twindow.addEventListener(\"keydown\", downHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"keydown\", downHandler);\n\t\t};\n\t}, [uiState.submode, handleCancel, handleBack]);\n\n\tconst renderWorking = () => <div className=\"p-4 text-center\">\n\t\t<h5 className=\"mb-4\">{uiState.status || \"Preparing to send data\"}</h5>\n\t\t<div className=\"my-4\">\n\t\t\t<Spinner color=\"primary\" style={{ width: \"3rem\", height: \"3rem\" }} />\n\t\t</div>\n\t\t<div>\n\t\t\t<Button color=\"outline-primary\" onClick={handleCancel}>Cancel</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderError = () => <div className=\"p-2\">\n\t\t<h5>Error</h5>\n\t\t<p>{uiState.status}</p>\n\t\t<div>\n\t\t\t<Button color=\"primary\" className=\"mt-4\" onClick={handleBack}>\n\t\t\t<FontAwesomeIcon icon={faChevronLeft} className=\"mr-2\" />\n\t\t\t\t<span className=\"mr-2\">Back</span>\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n\n\tconst renderPostUpload = () => \t<div className=\"p-2\">\n\t\t<h5>Success</h5>\n\t\t<p>{\n\t\t\tupload.successMessage || \n\t\t\t(\"Your healthcare records have been successfully shared with \" + upload.name + \".\")\n\t\t}</p>\n\t\t<DownloadButton className=\"float-left mt-4\" />\n\t\t{upload.continueUrl &&\n\t\t\t<Button color=\"success\" className=\"float-right mt-4\" onClick={handleDone}>\n\t\t\t\t<span className=\"mr-2\">\n\t\t\t\t\t{ upload.continueLabel || \"Continue to \" + upload.name }\n\t\t\t\t</span>\n\t\t\t\t<FontAwesomeIcon icon={faChevronRight} className=\"mr-2\" />\n\t\t\t</Button>\n\t\t}\n\t\t<div className=\"clearfix\"></div>\n\t</div>\n\n\treturn <div>\n\t\t{uiState.submode === \"error\" && renderError()}\n\t\t{uiState.submode !== \"postUpload\" && uiState.submode !== \"error\" && renderWorking()}\n\t\t{uiState.submode === \"postUpload\" && renderPostUpload()}\n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React from \"react\";\nimport useStoreon from \"storeon/react\";\nimport Start from \"./Start\";\nimport SelectProvider from \"./SelectProvider\";\nimport Retrieve from \"./Retrieve\";\nimport Review from \"./Review\";\nimport Upload from \"./Upload\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { faMedkit, faChevronRight } from \"@fortawesome/free-solid-svg-icons\"\nimport {Row, Col} from \"reactstrap\";\n\nexport default() => {\n\t\n\t//app state\n\tconst {uiState, dispatch} = useStoreon(\"uiState\");\n\n\tconst handleSwitchMode = () => dispatch(\"wizard/hide\");\n\n\tconst numberStyle = {\n\t\tactive: {background: \"#3182CE\", border: \"1px solid white\", color: \"white\"},\n\t\tinactive: {color: \"#3182CE\", border: \"1px solid #3182CE\", background: \"white\"}\n\t};\n\n\tconst switchToFull = uiState.mode !== \"loadData\" && \n\t\t(uiState.mode !== \"upload\" || uiState.submode === \"loaded\") &&\n\t\t<Row><Col className=\"text-center\">\n\t\t\t<small className=\"mt-4 float-right d-none d-sm-block\"><a href=\"#\" onClick={handleSwitchMode} className=\"text-muted\">switch to full version of Procure</a></small>\n\t\t</Col></Row>;\n\n\treturn <div>\n\t\t{switchToFull}\n\t\t<Row><Col>\n\t\t\t<h2 style={{color: \"#3182CE\", padding: \"1em 0\", textAlign: \"center\"}}>\n\t\t\t\t<FontAwesomeIcon icon={faMedkit} alt=\"Procure logo\" className=\"mr-2\" />\n\t\t\t\t<span>Procure</span>\n\t\t\t</h2>\n\t\t</Col></Row>\n\t\t<Row><Col md={{size:10, offset: 1}} lg={{size:8, offset: 2}}>\n\t\t\t<div className=\"shadow p-4 mb-5 bg-white rounded unbox-sm\">\n\n\t\t\t\t<div className=\"d-none d-sm-block\">\n\t\t\t\t\t<div className=\"d-none d-flex flex-row justify-content-around mb-4\" style={{borderBottom: \"1px solid #3182CE\"}}>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"ready\" ? \"active\" : \"inactive\"], display: \"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">1</div>\n\t\t\t\t\t\t\t<div>Start</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"m-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"editProvider\" || uiState.mode ===\"loadData\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">2</div>\n\t\t\t\t\t\t\t<div>Retrieve Records</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"m-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"review\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">3</div>\n\t\t\t\t\t\t\t<div>Review</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"my-auto\">\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faChevronRight} alt=\"arrow right\" className=\"mr-2\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"p-2 text-center\">\n\t\t\t\t\t\t\t<div style={{...numberStyle[uiState.mode === \"fileUpload\" ? \"active\" : \"inactive\"], display:\"inline-block\", minWidth: \"2em\", minHeight: \"2em\"}} className=\"m-1 p-1\">4</div>\n\t\t\t\t\t\t\t<div>Share Records</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{ uiState.mode === \"ready\" && <Start /> }\n\t\t\t\t{ uiState.mode === \"editProvider\" && <SelectProvider /> }\n\t\t\t\t{ uiState.mode === \"loadData\" && <Retrieve /> }\n\t\t\t\t{ uiState.mode === \"review\" && <Review />}\n\t\t\t\t{ uiState.mode === \"fileUpload\" && <Upload />}\n\n\t\t\t</div>\n\n\t</Col></Row> \n\t</div>\n\n}","/* eslint jsx-a11y/anchor-is-valid: 0 */ //disable to support bootstrap link styling\n\nimport React, {useEffect} from \"react\";\nimport useStoreon from \"storeon/react\";\nimport {Alert, Container, Row, Col} from 'reactstrap';\nimport _ from \"lodash\";\nimport ProviderForm from \"./ProviderForm\";\nimport ProviderList from \"./ProviderList\";\nimport Fetcher from \"./Fetcher\";\nimport Loader from \"./Loader\"\nimport GithubUploader from \"./GithubUploader\";\nimport Header from \"./Header\";\nimport FhirTree from \"./FhirTree\";\nimport Toolbar from \"./Toolbar\";\nimport BlankSlate from \"./BlankSlate\";\nimport FileUploader from \"./FileUploader\";\nimport Wizard from \"./Wizard/\";\n\nconst App = () =>  {\n\n\t//global state\n\tconst { uiState, showWizard, upload, providers, appName } = useStoreon(\"uiState\", \"upload\", \"showWizard\", \"providers\", \"appName\");\n\n\tuseEffect(() => {\n\t\tdocument.title = appName || \"Procure\";\n\t}, [appName]);\n\n\tif (uiState.mode === \"loading\") \n\t\treturn <Loader />;\n\n\tif (uiState.mode === \"globalError\")\n\t\treturn <Container style={{margin: \"1em\"}}>\n\t\t\t<Alert color=\"danger\">\n\t\t\t\t<span>Failed to load configuration information.</span><br />\n\t\t\t\t<span>{uiState.error.toString()}</span>\n\t\t\t</Alert>\n\t\t</Container>;\n\t\n\tconst inlineError = <Col xs=\"12\" style={{margin: \"0.5rem\"}}>\n\t\t<Alert color=\"warning\" style={{textAlign: \"center\"}}>{uiState.error}</Alert>\n\t</Col>\n\n\tconst renderProviderList = () => <Col xs=\"12\" md=\"6\" lg=\"5\" xl=\"4\">\n\t\t<ProviderList />\n\t</Col>\n\n\tconst renderData = (hasResources) => <Col xs=\"12\" md=\"6\" lg=\"7\" xl=\"8\">\n\t\t<Toolbar hasResources={hasResources} />\n\t\t{ hasResources && <FhirTree />\t}\t\n\t</Col>\n\n\tconst renderBlankSlate = () => <Col sm={{size: 4, offset: 4}}>\n\t\t<BlankSlate />\n\t</Col>\n\n\tconst hasProviders = providers && providers.length;\n\tconst hasData = hasProviders && _.find(providers, p => {\n\t\treturn p.selected && p.data && p.data.entry && (p.data.entry.length || p.data.errorLog.length);\n\t});\n\tconst hasResources = hasProviders && _.find(providers, p => {\n\t\treturn p.selected && p.data && p.data.entry && p.data.entry.length\n\t});\n\n\tconst fullUi = <div>\n\t\t<Header />\n\t\t<Container fluid>\n\t\t\t<Row className=\"m-2\">\n\t\t\t\t{ uiState.error && uiState.mode === \"ready\" && inlineError }\n\t\t\t\t{ hasProviders ? renderProviderList() : renderBlankSlate() }\n\t\t\t\t{ hasData ? renderData(hasResources) : null }\n\t\t\t</Row>\n\t\t\t{ uiState.mode === \"editProvider\" && <ProviderForm /> }\n\t\t\t{ uiState.mode === \"loadData\" && <Fetcher /> }\n\t\t\t{ uiState.mode === \"githubExport\" && <GithubUploader /> }\n\t\t\t{ uiState.mode === \"fileUpload\" && <FileUploader /> }\n\t\t</Container>\n\t</div>\n\n\tconst wizardUi = showWizard && \n\t\tupload && (upload.manifestUrl || upload.uploadUrl) &&\n\t\t\t<Container>\n\t\t\t{ uiState.error && uiState.mode === \"ready\" && \n\t\t\t\t<Row className=\"m-2\">{inlineError}</Row>\n\t\t\t}\t\n\t\t\t<Wizard />\n\t\t</Container>\n\n\tif (wizardUi) {\n\t\tdocument.body.classList.add(\"bg-light-md\");\n\t\treturn wizardUi;\n\t} else {\n\t\tdocument.body.classList = \"\";\n\t\treturn fullUi;\n\t}\n\n}\nexport default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n\n      //NOTE: changed from CRA default per https://github.com/facebook/create-react-app/issues/5673\n      const swUrl = `${process.env.PUBLIC_URL}/sw.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport StoreContext from 'storeon/react/context'\n//import 'bootstrap/dist/css/bootstrap.min.css';\n//moved to index.html to avoid flash of unstyled content when using dev server\nimport store from \"./store/store\";\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\n\nstore.dispatch(\"config/load\", \"ready\");\n\nReactDOM.render(\n\t<StoreContext.Provider value={store}><App /></StoreContext.Provider>,\n\tdocument.getElementById('root')\n);\n\nserviceWorker.register();"],"sourceRoot":""}